Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2015.12.11 - 23:37:12]

main.asm
Errors: 0

       1   00:0000                      ;----------------------------------------------------------------------------
       2   00:0000                      ;			(\__/)
       3   00:0000                      ;			(='.'=)
       4   00:0000                      ;			(")_(")
       5   00:0000                      ;----------------------------------------------------------------------------
       6   00:0000                      
       7   00:0000                              output "urd_scr8.rom"
       8   00:0000                      
       9   00:0000                      		incdir ene_code
      10   00:0000                      		incdir music
      11   00:0000                      		incdir manta
      12   00:0000                      		incdir sources
      13   00:0000                      		incdir databin
      14   00:0000                      
      15   00:0000                      		defpage	 0,0x4000, 0x2000		; page 0 main code + far call routines
      16   00:0000                      		defpage	 1,0x6000, 0x2000		; page 1 main code + far call routines
      17   00:0000                      		defpage	 2,0x8000, 0x2000		; swapped data 
      18   00:0000                      		defpage	 3,0xA000, 0x2000		; swapped data 
      19   00:0000                      		
      20   00:0000                      		defpage	 4..12					; 64KB of swapped data 
      21   00:0000                      
      22   00:0000                      		; defpage	12,0x4000, 0x2000		; swapped code
      23   00:0000                      		defpage	13,0x6000, 0x2000		; swapped code 
      24   00:0000                      		defpage	14,0x8000, 0x2000		; swapped data 
      25   00:0000                      		defpage	15,0xA000, 0x2000		; swapped data 
      26   00:0000                      
      27   00:0000                      		defpage	16..31					; 128KB of swapped data 
      28   00:0000                      
      29   00:0000                      		;	konami scc
      30   00:0000                      		
      31   00:0000  (00:5000)           _kBank1:	equ 05000h ;- 57FFh (5000h used)
      32   00:0000  (00:7000)           _kBank2: 	equ 07000h ;- 77FFh (7000h used)
      33   00:0000  (00:9000)           _kBank3: 	equ 09000h ;- 97FFh (9000h used)
      34   00:0000  (00:B000)           _kBank4: 	equ 0B000h ;- B7FFh (B000h used)
      35   00:0000                      	
      36   00:0000  (00:0100)           mapWidth	equ	256
      37   00:0000  (00:000B)           mapHeight	equ	11
      38   00:0000  (00:00A8)           YSIZE		equ	10*16+8
      39   00:0000                      
      40   00:0000                      	macro setpage_a
      41   00:0000                    < 		ld	(_kBank3),a
      42   00:0000                    < 		inc	a
      43   00:0000                    < 		ld	(_kBank4),a
      44   00:0000                    < 	endmacro
      45   00:0000                        
      46   00:0000                        		include "header.asm"
       1.  00:0000                      
       2.  00:0000                      	
       3.  00:0000                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       4.  00:0000                      
       5.  00:0000  (00:000C)           max_enem:					equ 12		; max 12
       6.  00:0000  (00:0003)           max_enem_bullets:			equ 3
       7.  00:0000  (00:0002)           max_bullets:				equ 2		; max number of enemies*2 + ms_bullets + enem_bullets + 3 for ms	<= 32 sprites
       8.  00:0000                      
       9.  00:0000  (00:0004)           maxspeed:					equ 4		; the actual speed is divided by 4
      10.  00:0000  (00:00B4)           assault_wave_timer_preset:	equ	3*60	; a wave each 3 seconds
      11.  00:0000  (00:0002)           enemy_bullet_speed:			equ	2	
      12.  00:0000  (00:0078)           xship_rel:					equ (128-8)
      13.  00:0000                      
      14.  00:0000                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      15.  00:0000                      
      16.  00:0000                      
      47   00:0000                      		
      48   00:0000                      		
      49   00:0000                      		
      50   00:0000  (00)                		page 0
      51   00:4000                      		
      52   00:4000                              org 4000h
      53   00:4000                              dw  4241h,START,0,0,0,0,0,0
      53   00:4000  41 42 7F 55 00 00 00 00 00 00 00 00 00 00 00 00 
      54   00:4010                      
      55   00:4010                      	;-------------------------------------		
      56   00:4010                      
      57   00:4010                      
      58   00:4010                      		include "rominit64.asm"
       1.  00:4010                      
       2.  00:4010                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       3.  00:4010                      ; set pages and subslot
       4.  00:4010                      ;
       5.  00:4010                      
       6.  00:4010                      
       7.  00:4010  (00:0024)           ENASLT:			equ		024h
       8.  00:4010  (00:0138)           RSLREG:			equ		0138h
       9.  00:4010  (00:FCC1)           EXPTBL:			equ		0FCC1h	; Bios Slot / Expansion Slot
      10.  00:4010                      
      11.  00:4010                      
      12.  00:4010                      ; ----------------------------
      13.  00:4010                      ; pre-set main slot for page 3
      14.  00:4010                      ; and set sub-slot for page 3
      15.  00:4010                      ; ----------------------------
      16.  00:4010                      	macro	mainslot_setup n
      17.  00:4010                    < 	and		3
      18.  00:4010                    < [2]	rrca
      19.  00:4010                    < 	and		0xC0
      20.  00:4010                    < 	ld		c,a
      21.  00:4010                    < 	ld		a,d
      22.  00:4010                    < 	and		0x3F
      23.  00:4010                    < 	or		c
      24.  00:4010                    < 	ld		c,a					; Primary slot value with main slot in page 3
      25.  00:4010                    < 
      26.  00:4010                    < 	ld		a,b
      27.  00:4010                    < 	and		0x0C
      28.  00:4010                    < [2]	rrca
      29.  00:4010                    < 	and		3
      30.  00:4010                    < 	ld		b,a					; B = Expanded slot in page 3
      31.  00:4010                    < 	ld		a,c
      32.  00:4010                    < 	out		(0A8h),a			; Slot : Main Slot, xx, xx, Main slot
      33.  00:4010                    < 	ld		a,(0FFFFh)
      34.  00:4010                    < 	cpl
      35.  00:4010                    < 	if (n<=4)
      36.  00:4010                    < [n]	RLCA
      37.  00:4010                    < 	else
      38.  00:4010                    < [8-n] RRCA	
      39.  00:4010                    < 	endif
      40.  00:4010                    < 	and		0xFC
      41.  00:4010                    < 	or		b
      42.  00:4010                    < 	if (n<=4)
      43.  00:4010                    < [n]	RRCA
      44.  00:4010                    < 	else
      45.  00:4010                    < [8-n] RLCA
      46.  00:4010                    < 	endif
      47.  00:4010                    < 	ld		(0FFFFh),a		; Expanded slot selected
      48.  00:4010                    < 	ld		b,a				; save for later	
      49.  00:4010                    < 	endmacro
      50.  00:4010                      		
      51.  00:4010                      
      52.  00:4010                      ; ------------------------------
      53.  00:4010                      ; SEARCH_SLOT
      54.  00:4010                      ; look for the slot of our rom
      55.  00:4010                      ; active in page 1
      56.  00:4010                      ; ------------------------------
      57.  00:4010                      
      58.  00:4010                      search_slot:
      59.  00:4010  CD 38 01            	call	RSLREG
      60.  00:4013  0F 0F               [2]	rrca
      61.  00:4015  E6 03               	and		3
      62.  00:4017  4F                  	ld		c,a
      63.  00:4018  06 00               	ld		b,0
      64.  00:401A  21 C1 FC            	ld		hl,EXPTBL
      65.  00:401D  09                  	add		hl,bc
      66.  00:401E  7E                  	ld		a,(hl)
      67.  00:401F  E6 80               	and		080h
      68.  00:4021  B1                  	or		c
      69.  00:4022  4F                  	ld		c,a
      70.  00:4023  23 23 23 23         [4]	inc		hl
      71.  00:4027  7E                  	ld		a,(hl)
      72.  00:4028  E6 0C               	and		0Ch
      73.  00:402A  B1                  	or		c
      74.  00:402B  32 00 CB            	ld		(slotvar),a
      75.  00:402E  C9                  	ret
      76.  00:402F                      	
      77.  00:402F                      ; ------------------------------
      78.  00:402F                      ; look for the slot of ram
      79.  00:402F                      ; active in page 3
      80.  00:402F                      ; ------------------------------
      81.  00:402F                      
      82.  00:402F                      search_slotram:
      83.  00:402F  F3                  	di
      84.  00:4030  CD 38 01            	call	RSLREG
      85.  00:4033  07 07               [2]	rlca
      86.  00:4035  E6 03               	and		3
      87.  00:4037  4F                  	ld		c,a
      88.  00:4038  06 00               	ld		b,0
      89.  00:403A  21 C1 FC            	ld		hl,EXPTBL
      90.  00:403D  09                  	add		hl,bc
      91.  00:403E  7E                  	ld		a,(hl)
      92.  00:403F  E6 80               	and		080h
      93.  00:4041  28 0D               	jr		z,search_slotram0
      94.  00:4043  B1                  	or		c
      95.  00:4044  4F                  	ld		c,a
      96.  00:4045  23 23 23 23         [4]	inc		hl
      97.  00:4049  7E                  	ld		a,(hl)
      98.  00:404A  07 07 07 07         [4]	rlca
      99.  00:404E  E6 0C               	and		0Ch
     100.  00:4050                      search_slotram0:
     101.  00:4050  B1                  	or		c
     102.  00:4051  32 01 CB            	ld		(slotram),a
     103.  00:4054  C9                  	ret
     104.  00:4055                      	
     105.  00:4055                      ; ------------------------------
     106.  00:4055                      ; SETROMPAGE0
     107.  00:4055                      ; Set the chart in
     108.  00:4055                      ; Page 0
     109.  00:4055                      ; -----------------------------
     110.  00:4055                      
     111.  00:4055                      setrompage0:
     112.  00:4055  3A 00 CB            	ld		a,(slotvar)
     113.  00:4058  C3 7C 40            	jp		setslotpage0
     114.  00:405B                      
     115.  00:405B                      setrampage0:
     116.  00:405B  3A 01 CB            	ld		a,(slotram)
     117.  00:405E  C3 7C 40            	jp		setslotpage0
     118.  00:4061                      
     119.  00:4061                      setrompage2:
     120.  00:4061  3A 00 CB            	ld		a,(slotvar)
     121.  00:4064  C3 F2 40            	jp		setslotpage2
     122.  00:4067                      
     123.  00:4067                      setrampage2:
     124.  00:4067  3A 01 CB            	ld		a,(slotram)
     125.  00:406A  C3 F2 40            	jp		setslotpage2
     126.  00:406D                      	
     127.  00:406D                      setrompage3:
     128.  00:406D  3A 00 CB            	ld		a,(slotvar)
     129.  00:4070  C3 39 41            	jp		setslotpage3
     130.  00:4073                      
     131.  00:4073                      setrampage3:
     132.  00:4073  3A 01 CB            	ld		a,(slotram)
     133.  00:4076  C3 39 41            	jp		setslotpage3
     134.  00:4079                      	
     135.  00:4079                      ; ------------------------------
     136.  00:4079                      ; RECBIOS
     137.  00:4079                      ; set the bios ROM
     138.  00:4079                      ; -------------------------------
     139.  00:4079                      recbios:
     140.  00:4079  3A C1 FC            	ld		a,(EXPTBL)
     141.  00:407C                      
     142.  00:407C                      ; ---------------------------
     143.  00:407C                      ; SETSLOTPAGE0
     144.  00:407C                      ; Set the slot passed in A
     145.  00:407C                      ; at page 0 in the Z80 address space
     146.  00:407C                      ; A: Format FxxxSSPP
     147.  00:407C                      ; ----------------------------
     148.  00:407C                      
     149.  00:407C                      setslotpage0:
     150.  00:407C  F3                  	di
     151.  00:407D  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     152.  00:407E  DB A8               	in		a,(0A8h)
     153.  00:4080  E6 FC               	and		0xFC
     154.  00:4082  57                  	ld		d,a					; D = Primary slot value
     155.  00:4083  78                  	ld		a,b
     156.  00:4084  E6 03               	and		3
     157.  00:4086  B2                  	or		d
     158.  00:4087  57                  	ld		d,a		; D = Final Value for primary slot
     159.  00:4088  78                  	ld		a,b		; Check if expanded
     160.  00:4089  CB 7F               	bit		7,a
     161.  00:408B  28 22               	jr		z,1f	; Not Expanded
     162.  00:408D                      	mainslot_setup	0
     162.  00:408D  E6 03             >  and  3
     162.  00:408F  0F 0F             > [2] rrca
     162.  00:4091  E6 C0             >  and  0xC0
     162.  00:4093  4F                >  ld  c,a
     162.  00:4094  7A                >  ld  a,d
     162.  00:4095  E6 3F             >  and  0x3F
     162.  00:4097  B1                >  or  c
     162.  00:4098  4F                >  ld  c,a
     162.  00:4099                    > 
     162.  00:4099  78                >  ld  a,b
     162.  00:409A  E6 0C             >  and  0x0C
     162.  00:409C  0F 0F             > [2] rrca
     162.  00:409E  E6 03             >  and  3
     162.  00:40A0  47                >  ld  b,a
     162.  00:40A1  79                >  ld  a,c
     162.  00:40A2  D3 A8             >  out  (0A8h),a
     162.  00:40A4  3A FF FF          >  ld  a,(0FFFFh)
     162.  00:40A7  2F                >  cpl
     162.  00:40A8                    >  if (n<=4)
     162.  00:40A8                    > [n] RLCA
     162.  00:40A8                    >  else
     162.  00:40A8                    ~ [8-n] RRCA
     162.  00:40A8                    ~  endif
     162.  00:40A8  E6 FC             >  and  0xFC
     162.  00:40AA  B0                >  or  b
     162.  00:40AB                    >  if (n<=4)
     162.  00:40AB                    > [n] RRCA
     162.  00:40AB                    >  else
     162.  00:40AB                    ~ [8-n] RLCA
     162.  00:40AB                    ~  endif
     162.  00:40AB  32 FF FF          >  ld  (0FFFFh),a
     162.  00:40AE  47                >  ld  b,a
     163.  00:40AF  7A                  1:	ld		a,d				; A = Final value
     164.  00:40B0  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     165.  00:40B2  C9                  	ret
     166.  00:40B3                      
     167.  00:40B3                      ; ---------------------------
     168.  00:40B3                      ; SETSLOTPAGE1
     169.  00:40B3                      ; Set the slot passed in A
     170.  00:40B3                      ; at page 1 in the Z80 address space
     171.  00:40B3                      ; A: Format FxxxSSPP
     172.  00:40B3                      ; ----------------------------
     173.  00:40B3                      
     174.  00:40B3                      setslotpage1:
     175.  00:40B3  F3                  	di
     176.  00:40B4  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     177.  00:40B5  DB A8               	in		a,(0A8h)
     178.  00:40B7  0F 0F               [2]	RRCA
     179.  00:40B9  E6 FC               	and		0xFC
     180.  00:40BB  57                  	ld		d,a					; D = Primary slot value
     181.  00:40BC  78                  	ld		a,b
     182.  00:40BD  E6 03               	and		3
     183.  00:40BF  B2                  	or		d
     184.  00:40C0  07 07               [2]	RLCA
     185.  00:40C2  57                  	ld		d,a		; D = Final Value for primary slot
     186.  00:40C3  78                  	ld		a,b		; Check if expanded
     187.  00:40C4  CB 7F               	bit		7,a
     188.  00:40C6  28 26               	jr		z,1f	; Not Expanded
     189.  00:40C8                      	mainslot_setup	6
     189.  00:40C8  E6 03             >  and  3
     189.  00:40CA  0F 0F             > [2] rrca
     189.  00:40CC  E6 C0             >  and  0xC0
     189.  00:40CE  4F                >  ld  c,a
     189.  00:40CF  7A                >  ld  a,d
     189.  00:40D0  E6 3F             >  and  0x3F
     189.  00:40D2  B1                >  or  c
     189.  00:40D3  4F                >  ld  c,a
     189.  00:40D4                    > 
     189.  00:40D4  78                >  ld  a,b
     189.  00:40D5  E6 0C             >  and  0x0C
     189.  00:40D7  0F 0F             > [2] rrca
     189.  00:40D9  E6 03             >  and  3
     189.  00:40DB  47                >  ld  b,a
     189.  00:40DC  79                >  ld  a,c
     189.  00:40DD  D3 A8             >  out  (0A8h),a
     189.  00:40DF  3A FF FF          >  ld  a,(0FFFFh)
     189.  00:40E2  2F                >  cpl
     189.  00:40E3                    >  if (n<=4)
     189.  00:40E3                    ~ [n] RLCA
     189.  00:40E3                    ~  else
     189.  00:40E3  0F 0F             > [8-n] RRCA
     189.  00:40E5                    >  endif
     189.  00:40E5  E6 FC             >  and  0xFC
     189.  00:40E7  B0                >  or  b
     189.  00:40E8                    >  if (n<=4)
     189.  00:40E8                    ~ [n] RRCA
     189.  00:40E8                    ~  else
     189.  00:40E8  07 07             > [8-n] RLCA
     189.  00:40EA                    >  endif
     189.  00:40EA  32 FF FF          >  ld  (0FFFFh),a
     189.  00:40ED  47                >  ld  b,a
     190.  00:40EE  7A                  1:	ld		a,d				; A = Final value
     191.  00:40EF  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     192.  00:40F1  C9                  	ret
     193.  00:40F2                      	
     194.  00:40F2                      
     195.  00:40F2                      ; ---------------------------
     196.  00:40F2                      ; SETSLOTPAGE2
     197.  00:40F2                      ; Set the slot passed in A
     198.  00:40F2                      ; at page 2 in the Z80 address space
     199.  00:40F2                      ; A: Format FxxxSSPP
     200.  00:40F2                      ; ----------------------------
     201.  00:40F2                      
     202.  00:40F2                      setslotpage2:
     203.  00:40F2  F3                  	di
     204.  00:40F3  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     205.  00:40F4  DB A8               	in		a,(0A8h)
     206.  00:40F6  07 07 07 07         [4]	RLCA
     207.  00:40FA  E6 FC               	and		0xFC
     208.  00:40FC  57                  	ld		d,a					; D = Primary slot value
     209.  00:40FD  78                  	ld		a,b
     210.  00:40FE  E6 03               	and		3
     211.  00:4100  B2                  	or		d
     212.  00:4101  0F 0F 0F 0F         [4]	RRCA
     213.  00:4105  57                  	ld		d,a		; D = Final Value for primary slot
     214.  00:4106  78                  	ld		a,b		; Check if expanded
     215.  00:4107  CB 7F               	bit		7,a
     216.  00:4109  28 2A               	jr		z,1f	; Not Expanded
     217.  00:410B                      	mainslot_setup	4
     217.  00:410B  E6 03             >  and  3
     217.  00:410D  0F 0F             > [2] rrca
     217.  00:410F  E6 C0             >  and  0xC0
     217.  00:4111  4F                >  ld  c,a
     217.  00:4112  7A                >  ld  a,d
     217.  00:4113  E6 3F             >  and  0x3F
     217.  00:4115  B1                >  or  c
     217.  00:4116  4F                >  ld  c,a
     217.  00:4117                    > 
     217.  00:4117  78                >  ld  a,b
     217.  00:4118  E6 0C             >  and  0x0C
     217.  00:411A  0F 0F             > [2] rrca
     217.  00:411C  E6 03             >  and  3
     217.  00:411E  47                >  ld  b,a
     217.  00:411F  79                >  ld  a,c
     217.  00:4120  D3 A8             >  out  (0A8h),a
     217.  00:4122  3A FF FF          >  ld  a,(0FFFFh)
     217.  00:4125  2F                >  cpl
     217.  00:4126                    >  if (n<=4)
     217.  00:4126  07 07 07 07       > [n] RLCA
     217.  00:412A                    >  else
     217.  00:412A                    ~ [8-n] RRCA
     217.  00:412A                    ~  endif
     217.  00:412A  E6 FC             >  and  0xFC
     217.  00:412C  B0                >  or  b
     217.  00:412D                    >  if (n<=4)
     217.  00:412D  0F 0F 0F 0F       > [n] RRCA
     217.  00:4131                    >  else
     217.  00:4131                    ~ [8-n] RLCA
     217.  00:4131                    ~  endif
     217.  00:4131  32 FF FF          >  ld  (0FFFFh),a
     217.  00:4134  47                >  ld  b,a
     218.  00:4135  7A                  1:	ld		a,d				; A = Final value
     219.  00:4136  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     220.  00:4138  C9                  	ret
     221.  00:4139                      	
     222.  00:4139                      ; ---------------------------
     223.  00:4139                      ; SETSLOTPAGE3
     224.  00:4139                      ; Set the slot passed in A
     225.  00:4139                      ; at page 3 in the Z80 address space
     226.  00:4139                      ; A: Format FxxxSSPP
     227.  00:4139                      ; ----------------------------
     228.  00:4139                      	
     229.  00:4139                      setslotpage3:
     230.  00:4139  F3                  	di
     231.  00:413A  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     232.  00:413B  DB A8               	in		a,(0A8h)
     233.  00:413D  07 07               [2]	RLCA
     234.  00:413F  E6 FC               	and		0xFC
     235.  00:4141  57                  	ld		d,a					; D = Primary slot value
     236.  00:4142  78                  	ld		a,b
     237.  00:4143  E6 03               	and		3
     238.  00:4145  B2                  	or		d
     239.  00:4146  0F 0F               [2]	RRCA	
     240.  00:4148  57                  	ld		d,a		; D = Final Value for primary slot
     241.  00:4149  78                  	ld		a,b		; Check if expanded
     242.  00:414A  CB 7F               	bit		7,a
     243.  00:414C  28 26               	jr		z,1f	; Not Expanded
     244.  00:414E                      	mainslot_setup	2
     244.  00:414E  E6 03             >  and  3
     244.  00:4150  0F 0F             > [2] rrca
     244.  00:4152  E6 C0             >  and  0xC0
     244.  00:4154  4F                >  ld  c,a
     244.  00:4155  7A                >  ld  a,d
     244.  00:4156  E6 3F             >  and  0x3F
     244.  00:4158  B1                >  or  c
     244.  00:4159  4F                >  ld  c,a
     244.  00:415A                    > 
     244.  00:415A  78                >  ld  a,b
     244.  00:415B  E6 0C             >  and  0x0C
     244.  00:415D  0F 0F             > [2] rrca
     244.  00:415F  E6 03             >  and  3
     244.  00:4161  47                >  ld  b,a
     244.  00:4162  79                >  ld  a,c
     244.  00:4163  D3 A8             >  out  (0A8h),a
     244.  00:4165  3A FF FF          >  ld  a,(0FFFFh)
     244.  00:4168  2F                >  cpl
     244.  00:4169                    >  if (n<=4)
     244.  00:4169  07 07             > [n] RLCA
     244.  00:416B                    >  else
     244.  00:416B                    ~ [8-n] RRCA
     244.  00:416B                    ~  endif
     244.  00:416B  E6 FC             >  and  0xFC
     244.  00:416D  B0                >  or  b
     244.  00:416E                    >  if (n<=4)
     244.  00:416E  0F 0F             > [n] RRCA
     244.  00:4170                    >  else
     244.  00:4170                    ~ [8-n] RLCA
     244.  00:4170                    ~  endif
     244.  00:4170  32 FF FF          >  ld  (0FFFFh),a
     244.  00:4173  47                >  ld  b,a
     245.  00:4174  7A                  1:	ld		a,d				; A = Final value
     246.  00:4175  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     247.  00:4177  C9                  	ret
     248.  00:4178                      
     249.  00:4178                      	
      59   00:4178                      		include "vdpio.asm"
       1.  00:4178                      
       2.  00:4178                             
       3.  00:4178                      ;-------------------------------------
       4.  00:4178                      _cls:		
       5.  00:4178  0E 00               		ld		c,0
       6.  00:417A  51                  		ld		d,c
       7.  00:417B  59                  		ld		e,c
       8.  00:417C  F3                  		di
       9.  00:417D  CD A5 41            		call	_vdpsetvramwr
      10.  00:4180  41                  		ld		b,c
      11.  00:4181  1E 01               		ld		e,1
      12.  00:4183  AF                  1:		xor		a
      13.  00:4184  D3 98               		out		(0x98),a
      14.  00:4186  ED A1                       cpi
      15.  00:4188  EA 83 41                    jp   	pe,1b
      16.  00:418B  1D                  		dec	e
      17.  00:418C  C2 83 41            		jp		nz,1b
      18.  00:418F  C9                  		ret
      19.  00:4190                      _cls0:
      20.  00:4190  0E 00               		ld		c,0
      21.  00:4192  51                  		ld		d,c
      22.  00:4193  59                  		ld		e,c
      23.  00:4194  F3                  		di
      24.  00:4195  CD A5 41            		call	_vdpsetvramwr
      25.  00:4198  FB                  		ei
      26.  00:4199  01 00 B0            		ld		bc,mapHeight*16*256
      27.  00:419C  AF                  		xor		a
      28.  00:419D  D3 98               1:		out		(0x98),a
      29.  00:419F  ED A1                       cpi
      30.  00:41A1  EA 9D 41                    jp   	pe,1b
      31.  00:41A4  C9                  		ret
      32.  00:41A5                      		
      33.  00:41A5                      ;-------------------------------------
      34.  00:41A5                      		
      35.  00:41A5  (00:0099)           vdpport1 equ 0x99
      36.  00:41A5  (00:009A)           vdpport2 equ 0x9A
      37.  00:41A5                      
      38.  00:41A5                      ; levelcolors:
      39.  00:41A5                      	;  incbin "palette.bin"
      40.  00:41A5                      
      41.  00:41A5                      ; _SetPalet:   
      42.  00:41A5                      		; di
      43.  00:41A5                      		; xor a 			;Set pointer to zero.
      44.  00:41A5                      		; out (vdpport1),a        
      45.  00:41A5                      		; ld  a,16 | 010000000B
      46.  00:41A5                      		; out (vdpport1),a
      47.  00:41A5                      
      48.  00:41A5                      		; ld  hl,levelcolors
      49.  00:41A5                      		; ld bc,vdpport2+32*256
      50.  00:41A5                      		; otir
      51.  00:41A5                      		; ei
      52.  00:41A5                      		; ret
      53.  00:41A5                      
      54.  00:41A5                      ;Set VDP for writing at address CDE (17-bit) 
      55.  00:41A5                      
      56.  00:41A5                      _vdpsetvramwr:
      57.  00:41A5  79                  		ld a,c
      58.  00:41A6                      _vdpsetvramwr2:
      59.  00:41A6                      ;Set VDP for writing at address ADE (17-bit) ;
      60.  00:41A6  CB 02               		rlc d
      61.  00:41A8  17                  		rla
      62.  00:41A9  CB 02               		rlc d
      63.  00:41AB  17                  		rla
      64.  00:41AC  CB 3A               		srl d ; primo shift, il secondo dopo la out
      65.  00:41AE                      
      66.  00:41AE  D3 99               		out (0x99),a ;set bits 14-16
      67.  00:41B0  3E 8E               		ld a,14+128
      68.  00:41B2  D3 99               		out (0x99),a
      69.  00:41B4                      
      70.  00:41B4  CB 3A               		srl d ; secondo shift.     
      71.  00:41B6                      _vdpsetvramwr14
      72.  00:41B6  7B                  		ld a,e ;set bits 0-7
      73.  00:41B7  D3 99               		out (0x99),a
      74.  00:41B9  7A                  		ld a,d ;set bits 8-13
      75.  00:41BA  F6 40               		or 0x40 ; + write access
      76.  00:41BC  D3 99               		out (0x99),a
      77.  00:41BE  C9                  		ret
      78.  00:41BF                      	
      79.  00:41BF                      ;Set VDP port #98 to start reading at address CDE (17-bit) ;
      80.  00:41BF                      
      81.  00:41BF                      _vdpsetvramrd:
      82.  00:41BF  79                  		ld a,c
      83.  00:41C0                      ;Set VDP port #98 to start reading at address ADE (17-bit) ;
      84.  00:41C0  CB 02               		rlc d
      85.  00:41C2  17                  		rla
      86.  00:41C3  CB 02               		rlc d
      87.  00:41C5  17                  		rla
      88.  00:41C6  CB 3A               		srl d 			; primo shift, il secondo dopo la out
      89.  00:41C8                      
      90.  00:41C8  D3 99               		out (0x99),a 	; set bits 14-16
      91.  00:41CA  3E 8E               		ld a,14+128
      92.  00:41CC  D3 99               		out (0x99),a
      93.  00:41CE                      
      94.  00:41CE  CB 3A               		srl d 	; secondo shift.            
      95.  00:41D0  7B                  		ld a,e 	; set bits 0-7
      96.  00:41D1  D3 99               		out (0x99),a
      97.  00:41D3  7A                  		ld a,d 	; set bits 8-13
      98.  00:41D4  E6 3F               		and 0x3F
      99.  00:41D6  D3 99               		out (0x99),a
     100.  00:41D8  C9                  		ret
     101.  00:41D9                      
     102.  00:41D9                      ;Display page E in screen 5
     103.  00:41D9                      _setpage:
     104.  00:41D9  7B                  	ld a,e
     105.  00:41DA  87 87 87 87 87      [5]	add a,a ;x32
     106.  00:41DF  F6 1F               	or	 00011111B
     107.  00:41E1  F3                  	di
     108.  00:41E2  D3 99               	out (0x99),a
     109.  00:41E4  3E 82               	ld a,2+128
     110.  00:41E6  D3 99               	out (0x99),a
     111.  00:41E8  FB                  	ei            
     112.  00:41E9  C9                  	ret
     113.  00:41EA                      
     114.  00:41EA  (00:005F)           chgmod        equ     0x005f      ;change graphic mode
     115.  00:41EA  (00:000C)           RDSLT         equ     0x000c      ;read address HL in slot A
     116.  00:41EA  (00:0156)           KILBUF        equ     0x0156      ;clear keyboard buffer
     117.  00:41EA                      
     118.  00:41EA                      set_scr:
     119.  00:41EA                      	
     120.  00:41EA                      	// sprites 16x16
     121.  00:41EA  3A E0 F3            	ld		a,(RG1SAV)
     122.  00:41ED  F6 02               	or		00000010B
     123.  00:41EF  32 E0 F3            	ld		(RG1SAV),a
     124.  00:41F2                      
     125.  00:41F2                      	// enable sprites + TP
     126.  00:41F2  3A E7 FF            	ld		a,(RG8SAV)
     127.  00:41F5  F6 22               	or		00100010B
     128.  00:41F7  32 E7 FF            	ld		(RG8SAV),a
     129.  00:41FA                      		
     130.  00:41FA                      	// Set @50Hz (only PAL is supported)
     131.  00:41FA  3A 02 CB            	ld	a,(SEL_NTSC)
     132.  00:41FD  A7                  	and 	a
     133.  00:41FE  20 07               	jr		nz,1f
     134.  00:4200                      	
     135.  00:4200  3A E8 FF            	ld		a,(RG9SAV)		
     136.  00:4203  F6 02               	or		00000010B		; PAL
     137.  00:4205  18 05               	jr	2f
     138.  00:4207                      1:		
     139.  00:4207  3A E8 FF            	ld		a,(RG9SAV)		
     140.  00:420A  E6 FD               	and		11111101B		; NTSC
     141.  00:420C  32 E8 FF            2:	ld		(RG9SAV),a
     142.  00:420F                      
     143.  00:420F  3E 08               	ld  	a,8
     144.  00:4211  CD 5F 00            	call		chgmod
     145.  00:4214                      
     146.  00:4214                      	// border color
     147.  00:4214  AF                  	xor		a
     148.  00:4215  32 E6 F3            	ld		(RG7SAV),a
     149.  00:4218  D3 99               	out		(0x99),a
     150.  00:421A  3E 87               	ld		a,7+128
     151.  00:421C  D3 99               	out		(0x99),a
     152.  00:421E  C9                  	ret
     153.  00:421F                      
     154.  00:421F                      
     155.  00:421F                      
     156.  00:421F                      _waitvdp:
     157.  00:421F  3E 02               	ld a,2
     158.  00:4221  D3 99               	out (0x99),a
     159.  00:4223  3E 8F               	ld a, 128+15
     160.  00:4225  D3 99               	out (0x99),a
     161.  00:4227  DB 99               1:  in	a,(0x99)
     162.  00:4229  0F                  	rrca
     163.  00:422A  DA 27 42            	jp c,1b
     164.  00:422D                      
     165.  00:422D  C9                  	ret
     166.  00:422E                      
     167.  00:422E                      ; .inf:
     168.  00:422E                      	; ld	a,r			; random colour
     169.  00:422E                      	; out		(0x99),a
     170.  00:422E                      	; ld		a,7+128
     171.  00:422E                      	; out		(0x99),a
     172.  00:422E                      	; jp	1b
     173.  00:422E                      	
      60   00:422E                      		include "turbo.asm"
       1.  00:422E                      
       2.  00:422E  (00:000C)           rdslt	equ	0x000c
       3.  00:422E  (00:001C)           CALSLT	equ	0x001c
       4.  00:422E  (00:0180)           chgcpu	equ	0x0180	; change cpu mode
       5.  00:422E  (00:FCC1)           exttbl	equ	0xfcc1	; main rom slot
       6.  00:422E                      
       7.  00:422E                      ; Switch to r800 rom mode
       8.  00:422E                      	
       9.  00:422E                      _set_r800:
      10.  00:422E  DB AA               		in	a,(0aah)
      11.  00:4230  E6 F0               		and 011110000B			; upper 4 bits contain info to preserve
      12.  00:4232  F6 06               		or	6
      13.  00:4234  D3 AA               		out (0aah),a
      14.  00:4236  DB A9               		in	a,(0a9h)
      15.  00:4238  6F                  		ld	l,a
      16.  00:4239                      
      17.  00:4239  3A 2D 00            		ld	a,(0x002d)
      18.  00:423C  FE 03               		cp	3					; this is a TR
      19.  00:423E  7D                  		ld	a,l
      20.  00:423F  28 0E               		jr	z,set_turbo_tr
      21.  00:4241                      								; this is anything else
      22.  00:4241  E6 02               		and	0x02				; CTR
      23.  00:4243  C0                  		ret	nz					; if NZ, CTR is not pressed set the turbo
      24.  00:4244                      
      25.  00:4244  3A 80 01            		ld	A,(chgcpu)
      26.  00:4247  FE C3               		cp	0C3h
      27.  00:4249  3E 81               		ld	a,81h              ; R800 ROM mode or any other turbo
      28.  00:424B  CC 80 01            		call	z,chgcpu
      29.  00:424E  C9                  		ret
      30.  00:424F                      
      31.  00:424F                      set_turbo_tr
      32.  00:424F  E6 02               		and	0x02				; CTR
      33.  00:4251  C8                  		ret	z					; if Z, CTR is pressed -> do not set the turbo
      34.  00:4252  3E 81               		ld	a,81h              	; R800 ROM mode
      35.  00:4254  C3 80 01            		jp chgcpu
      36.  00:4257                      		
      61   00:4257                      		include "isr.asm"
       1.  00:4257                      
       2.  00:4257                      		; include "header.asm"
       3.  00:4257                      		
       4.  00:4257                      // MSX 1 
       5.  00:4257  (00:F3DF)           RG0SAV  equ 0xF3DF  
       6.  00:4257  (00:F3E0)           RG1SAV  equ 0xF3E0  
       7.  00:4257  (00:F3E1)           RG2SAV  equ 0xF3E1
       8.  00:4257  (00:F3E2)           RG3SAV  equ 0xF3E2
       9.  00:4257  (00:F3E3)           RG4SAV  equ 0xF3E3
      10.  00:4257  (00:F3E4)           RG5SAV  equ 0xF3E4
      11.  00:4257  (00:F3E5)           RG6SAV  equ 0xF3E5
      12.  00:4257  (00:F3E6)           RG7SAV  equ 0xF3E6
      13.  00:4257                      // MSX 2
      14.  00:4257  (00:FFE7)           RG8SAV  equ 0xFFE7 
      15.  00:4257  (00:FFE8)           RG9SAV  equ 0xFFE8 
      16.  00:4257  (00:FFE9)           RG10SAV equ 0xFFE9 
      17.  00:4257  (00:FFEA)           RG11SAV equ 0xFFEA 
      18.  00:4257  (00:FFEB)           RG12SAV equ 0xFFEB 
      19.  00:4257  (00:FFEC)           RG13SAV equ 0xFFEC 
      20.  00:4257  (00:FFED)           RG14SAV equ 0xFFED 
      21.  00:4257  (00:FFEE)           RG15SAV equ 0xFFEE 
      22.  00:4257  (00:FFEF)           RG16SAV equ 0xFFEF 
      23.  00:4257  (00:FFF0)           RG17SAV equ 0xFFF0 
      24.  00:4257  (00:FFF1)           RG18SAV equ 0xFFF1 
      25.  00:4257  (00:FFF2)           RG19SAV equ 0xFFF2 
      26.  00:4257  (00:FFF3)           RG20SAV equ 0xFFF3 
      27.  00:4257  (00:FFF4)           RG21SAV equ 0xFFF4 
      28.  00:4257  (00:FFF5)           RG22SAV equ 0xFFF5 
      29.  00:4257  (00:FFF7)           RG23SAV equ 0xFFF7 
      30.  00:4257                      
      31.  00:4257  (00:FC9E)           _jiffy: equ 0xFC9E 
      32.  00:4257                      
      33.  00:4257                      _fake_isr
      34.  00:4257  F5                  		push	af
      35.  00:4258  AF                  		xor	a 			; read S#0
      36.  00:4259  D3 99               		out (0x99),a
      37.  00:425B  3E 8F               		ld a,128+15
      38.  00:425D  D3 99               		out (0x99),a
      39.  00:425F                      
      40.  00:425F  3A 10 01            		ld	a,(replay_mode)
      41.  00:4262  A7                  		and	a
      42.  00:4263  28 20               		jr	z,1f
      43.  00:4265                      		
      44.  00:4265  E5                  		push   hl         
      45.  00:4266  D5                  		push   de         
      46.  00:4267  C5                  		push   bc         
      47.  00:4268  D9                  		exx               
      48.  00:4269  08                  		ex     af,af'     
      49.  00:426A  E5                  		push   hl         
      50.  00:426B  D5                  		push   de         
      51.  00:426C  C5                  		push   bc         
      52.  00:426D  F5                  		push   af         
      53.  00:426E  FD E5               		push   iy         
      54.  00:4270  DD E5               		push   ix         
      55.  00:4272                      
      56.  00:4272                      
      57.  00:4272  CD AA 43            		call	_replay_route		; first output data	
      58.  00:4275  CD 8E 43            		call	_replay_play		; calculate next output
      59.  00:4278                      		
      60.  00:4278  DD E1               		pop    ix         
      61.  00:427A  FD E1               		pop    iy         
      62.  00:427C  F1                  		pop    af         
      63.  00:427D  C1                  		pop    bc         
      64.  00:427E  D1                  		pop    de         
      65.  00:427F  E1                  		pop    hl         
      66.  00:4280  08                  		ex     af,af'     
      67.  00:4281  D9                  		exx               
      68.  00:4282  C1                  		pop    bc         
      69.  00:4283  D1                  		pop    de         
      70.  00:4284  E1                  		pop    hl         
      71.  00:4285                      
      72.  00:4285  DB 99               1:		in	a,(0x99)
      73.  00:4287  F1                  		pop	af
      74.  00:4288  FB                  		ei
      75.  00:4289  C9                  		ret
      76.  00:428A                      	
      77.  00:428A                      _isrinit:
      78.  00:428A  F3                  		di
      79.  00:428B  21 38 00            		ld	hl,0x0038
      80.  00:428E  36 C3               		ld	(hl),0xC3
      81.  00:4290  23                  		inc	hl
      82.  00:4291  36 CA               		ld	(hl),low _scroll
      83.  00:4293  23                  		inc	hl
      84.  00:4294  36 42               		ld	(hl),high _scroll
      85.  00:4296                      
      86.  00:4296                      ; set interrupt line
      87.  00:4296  3E A7               		LD    A,YSIZE-1
      88.  00:4298  D3 99               		out (0x99),a
      89.  00:429A  3E 93               		LD    A,19+128
      90.  00:429C  D3 99               		out (0x99),a
      91.  00:429E                      	
      92.  00:429E                      ; enable line interrupt
      93.  00:429E  3A DF F3            		LD    A,(RG0SAV)
      94.  00:42A1  F6 10               		OR    00010000B
      95.  00:42A3  32 DF F3            		LD    (RG0SAV),A
      96.  00:42A6  D3 99               		out (0x99),a
      97.  00:42A8  3E 80               		LD    A,0+128
      98.  00:42AA  D3 99               		out (0x99),a
      99.  00:42AC  FB                  		ei
     100.  00:42AD  C9                  		ret
     101.  00:42AE                      	
     102.  00:42AE                      _intreset:
     103.  00:42AE  F3                  		di
     104.  00:42AF  21 38 00            		ld	hl,0x0038
     105.  00:42B2  36 C3               		ld	(hl),0xC3
     106.  00:42B4  23                  		inc	hl
     107.  00:42B5  36 57               		ld	(hl),low _fake_isr
     108.  00:42B7  23                  		inc	hl
     109.  00:42B8  36 42               		ld	(hl),high _fake_isr
     110.  00:42BA                      
     111.  00:42BA                      ; disable line interrupt		
     112.  00:42BA  3A DF F3            		LD    A,(RG0SAV)
     113.  00:42BD  E6 EF               		and    11101111B
     114.  00:42BF  32 DF F3            		LD    (RG0SAV),A
     115.  00:42C2  D3 99               		out (0x99),a
     116.  00:42C4  3E 80               		LD    A,0+128
     117.  00:42C6  D3 99               		out (0x99),a
     118.  00:42C8  FB                  		ei
     119.  00:42C9  C9                  		ret
     120.  00:42CA                      	
     121.  00:42CA                      ;;;;;;;;;;;;;;;;;;;;;;
     122.  00:42CA                      ; actual ISR handler
     123.  00:42CA                      ;;;;;;;;;;;;;;;;;;;;;;
     124.  00:42CA                      
     125.  00:42CA                      _scroll:
     126.  00:42CA  F5                  		push	af
     127.  00:42CB                      		
     128.  00:42CB  3E 01               		ld a,1 			; read S#1
     129.  00:42CD  D3 99               		out (0x99),a
     130.  00:42CF  3E 8F               		ld a,128+15
     131.  00:42D1  D3 99               		out (0x99),a
     132.  00:42D3                      		 
     133.  00:42D3  DB 99               		in	a,(0x99)
     134.  00:42D5  1F                  		rra
     135.  00:42D6  DA F9 42            		jp	c,lint	
     136.  00:42D9                      
     137.  00:42D9  AF                  		xor	a 			; read S#0
     138.  00:42DA  D3 99               		out (0x99),a
     139.  00:42DC  3E 8F               		ld a,128+15
     140.  00:42DE  D3 99               		out (0x99),a
     141.  00:42E0                      		 
     142.  00:42E0  DB 99               		in	a,(0x99)
     143.  00:42E2  07                  		rlca
     144.  00:42E3  DA 58 43            		jp	c,vblank
     145.  00:42E6                      		
     146.  00:42E6  F1                  		pop	af			; none of them (?)
     147.  00:42E7  FB                  		ei
     148.  00:42E8  C9                  		ret
     149.  00:42E9                      	
     150.  00:42E9                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
     151.  00:42E9                      ; manage score bar at YSIZE
     152.  00:42E9                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
     153.  00:42E9                      waitHBLANK
     154.  00:42E9  3E 02               		ld a,2 				; read S#2
     155.  00:42EB  D3 99               		out (0x99),a
     156.  00:42ED  3E 8F               		ld a,128+15
     157.  00:42EF  D3 99               		out (0x99),a		; poll for HBLANK
     158.  00:42F1                      		 
     159.  00:42F1                      ; 1:		in	a,(0x99)		; we are in HBLANK already, so wait until end of HBLANK
     160.  00:42F1                      		; and	0x20
     161.  00:42F1                      		; jp	nz,1b			
     162.  00:42F1  DB 99               2:		in	a,(0x99)		; wait until end of the active area
     163.  00:42F3  E6 20               		and	0x20
     164.  00:42F5  CA F1 42            		jp	z,2b
     165.  00:42F8  C9                  		ret
     166.  00:42F9                      	
     167.  00:42F9                      lint:	
     168.  00:42F9                      		; call	waitHBLANK
     169.  00:42F9                      		; now we are at the start of HBLANK
     170.  00:42F9                      	
     171.  00:42F9                      		; ld	a,(RG1SAV)
     172.  00:42F9                      		; and	010111111B			; disable screen
     173.  00:42F9                      		; ld	(RG1SAV),a
     174.  00:42F9                      		; out	(0x99),a
     175.  00:42F9                      		; ld	a,1+128
     176.  00:42F9                      		; out	(0x99),a
     177.  00:42F9                      
     178.  00:42F9                      
     179.  00:42F9  3E 1F               		ld a,00011111B		; 0XX11111B
     180.  00:42FB  D3 99               		out (0x99),a
     181.  00:42FD  3E 82               		ld a,2+128			; R#2 
     182.  00:42FF  D3 99               		out (0x99),a		; score bar in page 0
     183.  00:4301                      
     184.  00:4301  3E 0A               		LD    A,mapHeight*16-(YSIZE-2)	; SCROLL DOWN
     185.  00:4303  D3 99               		out (0x99),a
     186.  00:4305  3E 97               		LD    A,23+128
     187.  00:4307  D3 99               		out (0x99),a
     188.  00:4309                      
     189.  00:4309  AF                  		xor		a
     190.  00:430A  D3 99               		out	(099h),a
     191.  00:430C  3E 92               		ld	a,18+128
     192.  00:430E  D3 99               		out	(099h),a		; set adjust 0,0
     193.  00:4310                      
     194.  00:4310                      
     195.  00:4310  3A E7 FF            		ld	a,(RG8SAV)
     196.  00:4313  F6 02               		or	000000010B		; disable sprites
     197.  00:4315  32 E7 FF            		ld	(RG8SAV),a
     198.  00:4318  D3 99               		out	(0x99),a
     199.  00:431A  3E 88               		ld	a,8+128
     200.  00:431C  D3 99               		out	(0x99),a
     201.  00:431E                      
     202.  00:431E                      		; call	waitHBLANK
     203.  00:431E                      		
     204.  00:431E                      		; ld	a,(RG1SAV)
     205.  00:431E                      		; or 	01000010B		; enable screen
     206.  00:431E                      		; ld	(RG1SAV),a
     207.  00:431E                      		; out	(0x99),a
     208.  00:431E                      		; ld	a,1+128
     209.  00:431E                      		; out	(0x99),a
     210.  00:431E                      	
     211.  00:431E  E5                  		push   hl         
     212.  00:431F  D5                  		push   de         
     213.  00:4320  C5                  		push   bc         
     214.  00:4321  D9                  		exx               
     215.  00:4322  08                  		ex     af,af'     
     216.  00:4323  E5                  		push   hl         
     217.  00:4324  D5                  		push   de         
     218.  00:4325  C5                  		push   bc         
     219.  00:4326  F5                  		push   af         
     220.  00:4327  FD E5               		push   iy         
     221.  00:4329  DD E5               		push   ix         
     222.  00:432B                      
     223.  00:432B                      		
     224.  00:432B  21 3E 43            		ld	hl,.exit
     225.  00:432E  E5                  		push	hl
     226.  00:432F  3A 43 CB            		ld		a,(dxmap)
     227.  00:4332  CB 07               		rlc a
     228.  00:4334  CA AA 43            		jp	z,_replay_route			;  output music data	
     229.  00:4337  D2 B3 43            		jp	nc,_blank_line_lft		; >0 == dx
     230.  00:433A  DA BC 43            		jp	 c,_blank_line_rgt		; <0 == sx
     231.  00:433D  E1                  1:		pop	hl
     232.  00:433E                      .exit:
     233.  00:433E                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     234.  00:433E                      		; ld		a,00001000B
     235.  00:433E                      		; out		(0x99),a
     236.  00:433E                      		; ld		a,7+128
     237.  00:433E                      		; out		(0x99),a
     238.  00:433E                      		
     239.  00:433E                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     240.  00:433E  CD 12 71            		call	test_star
     241.  00:4341                      
     242.  00:4341  AF                  		xor		a
     243.  00:4342  D3 99               		out		(0x99),a
     244.  00:4344  3E 87               		ld		a,7+128
     245.  00:4346  D3 99               		out		(0x99),a
     246.  00:4348                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     247.  00:4348                      		
     248.  00:4348  DD E1               		pop    ix         
     249.  00:434A  FD E1               		pop    iy         
     250.  00:434C  F1                  		pop    af         
     251.  00:434D  C1                  		pop    bc         
     252.  00:434E  D1                  		pop    de         
     253.  00:434F  E1                  		pop    hl         
     254.  00:4350  08                  		ex     af,af'     
     255.  00:4351  D9                  		exx               
     256.  00:4352  C1                  		pop    bc         
     257.  00:4353  D1                  		pop    de         
     258.  00:4354  E1                  		pop    hl         
     259.  00:4355                      
     260.  00:4355  F1                  		pop		af
     261.  00:4356  FB                  		ei
     262.  00:4357  C9                  		ret
     263.  00:4358                      
     264.  00:4358                      ;-------------------------------------		
     265.  00:4358                      
     266.  00:4358  (00:0000)           border_color	equ 	0;	00100101B
     267.  00:4358                      		
     268.  00:4358                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
     269.  00:4358                      ;   manage normal vblank routine
     270.  00:4358                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;	
     271.  00:4358                      
     272.  00:4358                      vblank:
     273.  00:4358  CD 59 44            		call	activate_window	
     274.  00:435B                      
     275.  00:435B  E5                  		push   hl         
     276.  00:435C  D5                  		push   de         
     277.  00:435D  C5                  		push   bc         
     278.  00:435E  D9                  		exx               
     279.  00:435F  08                  		ex     af,af'     
     280.  00:4360  E5                  		push   hl         
     281.  00:4361  D5                  		push   de         
     282.  00:4362  C5                  		push   bc         
     283.  00:4363  F5                  		push   af         
     284.  00:4364  FD E5               		push   iy         
     285.  00:4366  DD E5               		push   ix         
     286.  00:4368                      
     287.  00:4368                      		; ld	a,00011100B		; red
     288.  00:4368                      		; out		(0x99),a
     289.  00:4368                      		; ld		a,7+128
     290.  00:4368                      		; out		(0x99),a
     291.  00:4368                      
     292.  00:4368  CD 98 44            		call	changedir
     293.  00:436B                      				
     294.  00:436B  2A 9E FC            		ld	hl,(_jiffy)
     295.  00:436E  23                  		inc	hl
     296.  00:436F  22 9E FC            		ld	(_jiffy),hl
     297.  00:4372                      				
     298.  00:4372                      		; ld	a,00011100B		; red
     299.  00:4372                      		; out	(0x99),a
     300.  00:4372                      		; ld	a,7+128
     301.  00:4372                      		; out	(0x99),a
     302.  00:4372                      		
     303.  00:4372  CD 8E 43            		call	_replay_play			; calculate next output
     304.  00:4375                      
     305.  00:4375                      		; xor		a		; black
     306.  00:4375                      		; out	(0x99),a
     307.  00:4375                      		; ld	a,7+128
     308.  00:4375                      		; out	(0x99),a
     309.  00:4375                      	
     310.  00:4375  DD E1               		pop    ix         
     311.  00:4377  FD E1               		pop    iy         
     312.  00:4379  F1                  		pop    af         
     313.  00:437A  C1                  		pop    bc         
     314.  00:437B  D1                  		pop    de         
     315.  00:437C  E1                  		pop    hl         
     316.  00:437D  08                  		ex     af,af'     
     317.  00:437E  D9                  		exx               
     318.  00:437F  C1                  		pop    bc         
     319.  00:4380  D1                  		pop    de         
     320.  00:4381  E1                  		pop    hl         
     321.  00:4382                      
     322.  00:4382  F1                  		pop		af
     323.  00:4383  FB                  		ei
     324.  00:4384  C9                  		ret
     325.  00:4385                      ;-------------------------------------
     326.  00:4385                      _replay_loadsong
     327.  00:4385  F3                  		di
     328.  00:4386  3E 0C               		ld	a,:demo_song
     329.  00:4388  32 00 B0            		ld	(_kBank4),a
     330.  00:438B  C3 5A 60            		jp replay_loadsong
     331.  00:438E                      _replay_play	
     332.  00:438E  C9                  		ret
     333.  00:438F  F3                  		di
     334.  00:4390  3E 0C               		ld	a,:demo_song
     335.  00:4392  32 00 B0            		ld	(_kBank4),a
     336.  00:4395  C3 51 61            		jp	replay_play
     337.  00:4398                      _replay_init
     338.  00:4398  F3                  		di
     339.  00:4399  3E 0C               		ld	a,:demo_song
     340.  00:439B  32 00 B0            		ld	(_kBank4),a
     341.  00:439E  C3 00 60            		jp	replay_init
     342.  00:43A1                      _replay_pause
     343.  00:43A1  F3                  		di
     344.  00:43A2  3E 0C               		ld	a,:demo_song
     345.  00:43A4  32 00 B0            		ld	(_kBank4),a
     346.  00:43A7  C3 0F 60            		jp	replay_pause
     347.  00:43AA                      _replay_route
     348.  00:43AA  F3                  		di
     349.  00:43AB  3E 0C               		ld	a,:demo_song
     350.  00:43AD  32 00 B0            		ld	(_kBank4),a
     351.  00:43B0  C3 33 6B            		jp	replay_route
     352.  00:43B3                      ;-------------------------------------
     353.  00:43B3                      
     354.  00:43B3                      _blank_line_lft:
     355.  00:43B3                      		; ld	a,00000111B		; blue
     356.  00:43B3                      		; out	(0x99),a
     357.  00:43B3                      		; ld	a,7+128
     358.  00:43B3                      		; out	(0x99),a
     359.  00:43B3                      
     360.  00:43B3  1E 00               		ld	e,0
     361.  00:43B5  CD 85 57            		call	blank_line
     362.  00:43B8  CD AA 43            		call	_replay_route		; first output data	
     363.  00:43BB                      		
     364.  00:43BB                      		
     365.  00:43BB                      		; xor	a
     366.  00:43BB                      		; out	(0x99),a
     367.  00:43BB                      		; ld	a,7+128
     368.  00:43BB                      		; out	(0x99),a
     369.  00:43BB  C9                  		ret
     370.  00:43BC                      
     371.  00:43BC                      ;-------------------------------------	
     372.  00:43BC                      
     373.  00:43BC                      _blank_line_rgt
     374.  00:43BC                      		; ld	a,00000111B		; blue
     375.  00:43BC                      		; out	(0x99),a
     376.  00:43BC                      		; ld	a,7+128
     377.  00:43BC                      		; out	(0x99),a
     378.  00:43BC                      
     379.  00:43BC  1E F0               		ld	e,240
     380.  00:43BE  CD 85 57            		call	blank_line
     381.  00:43C1  CD AA 43            		call	_replay_route		; first output data	
     382.  00:43C4                      
     383.  00:43C4                      		; xor	a
     384.  00:43C4                      		; out	(0x99),a
     385.  00:43C4                      		; ld	a,7+128
     386.  00:43C4                      		; out	(0x99),a
     387.  00:43C4  C9                  		ret
     388.  00:43C5                      		
     389.  00:43C5                      ;-------------------------------------	
     390.  00:43C5                      		
     391.  00:43C5                      inc_xoffset
     392.  00:43C5  CD C9 57            		call	plot_line_rgt1
     393.  00:43C8  CD D1 43            		call	.movex
     394.  00:43CB  CD D5 57            		call	plot_line_rgt2
     395.  00:43CE                      				
     396.  00:43CE                      		; ld	a,00000010B		; blue
     397.  00:43CE                      		; out	(0x99),a
     398.  00:43CE                      		; ld	a,7+128
     399.  00:43CE                      		; out	(0x99),a
     400.  00:43CE                      		
     401.  00:43CE  C3 16 44            		jp		newxmap
     402.  00:43D1                      		
     403.  00:43D1                      .movex
     404.  00:43D1  3A 35 CB            		ld		a,(_xoffset)
     405.  00:43D4  A7                  		and		a
     406.  00:43D5  20 0B               		jr		nz,.case1_15
     407.  00:43D7                      .case0
     408.  00:43D7  3A 33 CB            		ld 		a,(_displaypage)
     409.  00:43DA  EE 01               		xor		1
     410.  00:43DC  57                  		ld 		d,a
     411.  00:43DD  1E F0               		ld		e,240
     412.  00:43DF  C3 58 58            		jp		clrboder
     413.  00:43E2                      		
     414.  00:43E2                      .case1_15
     415.  00:43E2  87 87 87 87         [4]		add		a,a
     416.  00:43E6  5F                  		ld		e,a
     417.  00:43E7  D6 10               		sub		a,16
     418.  00:43E9  57                  		ld		d,a
     419.  00:43EA  C3 8A 58            		jp		move_block
     420.  00:43ED                      
     421.  00:43ED                      
     422.  00:43ED                      ;-------------------------------------	
     423.  00:43ED                      	
     424.  00:43ED                      dec_xoffset
     425.  00:43ED  CD B9 57            		call	plot_line_lft1
     426.  00:43F0  CD F9 43            		call	.movex
     427.  00:43F3  CD C1 57            		call	plot_line_lft2
     428.  00:43F6                      				
     429.  00:43F6                      		; ld	a,00000011B		; blue
     430.  00:43F6                      		; out	(0x99),a
     431.  00:43F6                      		; ld	a,7+128
     432.  00:43F6                      		; out	(0x99),a
     433.  00:43F6                      
     434.  00:43F6  C3 16 44            		jp		newxmap
     435.  00:43F9                      		
     436.  00:43F9                      .movex
     437.  00:43F9  3A 35 CB            		ld		a,(_xoffset)
     438.  00:43FC  FE 0F               		cp	15
     439.  00:43FE  20 0B               		jr		nz,.case0_14
     440.  00:4400                      .case15
     441.  00:4400  3A 33 CB            		ld 		a,(_displaypage)
     442.  00:4403  EE 01               		xor		1
     443.  00:4405  57                  		ld 		d,a
     444.  00:4406  1E 00               		ld		e,0
     445.  00:4408  C3 58 58            		jp		clrboder
     446.  00:440B                      		
     447.  00:440B                      .case0_14
     448.  00:440B  87 87 87 87         [4]		add		a,a
     449.  00:440F  5F                  		ld		e,a
     450.  00:4410  C6 10               		add		a,16
     451.  00:4412  57                  		ld		d,a
     452.  00:4413  C3 8A 58            		jp		move_block
     453.  00:4416                      
     454.  00:4416                      
     455.  00:4416                      ;-------------------------------------
     456.  00:4416                      newxmap
     457.  00:4416  CD 8E 45            		call 	plot_enemy		
     458.  00:4419  CD CA 5A            		call	color_enemy
     459.  00:441C                      
     460.  00:441C  2A 46 CB            		ld		hl,(_xmapx4)
     461.  00:441F  3A 43 CB            		ld		a,(dxmap)
     462.  00:4422  5F                  		ld		e,a
     463.  00:4423  87                  		add 	a,a
     464.  00:4424  9F                  		sbc 	a,a
     465.  00:4425  57                  		ld		d,a
     466.  00:4426  19                  		add 	hl,de
     467.  00:4427  22 46 CB            		ld		(_xmapx4),hl
     468.  00:442A                      		repeat 2
     469.  00:442A                    < 		sra		h
     470.  00:442A                    < 		rr  	l
     471.  00:442A                    < 		endrepeat
     471.  00:442A  CB 2C CB 1D CB 2C CB 1D 
     472.  00:4432  22 44 CB            		ld		(xmap),hl
     473.  00:4435  7D                  		ld 		a,l
     474.  00:4436  E6 0F               		and		15
     475.  00:4438  32 35 CB            		ld		(_xoffset),a
     476.  00:443B                      		repeat 4
     477.  00:443B                    < 		sra		h
     478.  00:443B                    < 		rr  	l
     479.  00:443B                    < 		endrepeat
     479.  00:443B  CB 2C CB 1D CB 2C CB 1D CB 2C CB 1D CB 2C CB 1D 
     480.  00:444B  7D                  		ld 		a,l
     481.  00:444C  E6 01               		and		1
     482.  00:444E  32 33 CB            		ld		(_displaypage),a
     483.  00:4451  11 00 C0            		ld		de,_levelmap
     484.  00:4454  19                  		add		hl,de
     485.  00:4455  22 2F CB            		ld		(_levelmap_pos),hl
     486.  00:4458  C9                  		ret
     487.  00:4459                      		
     488.  00:4459                      ;-------------------------------------
     489.  00:4459                      
     490.  00:4459                      activate_window	
     491.  00:4459  3A 33 CB            		ld	a,(_displaypage)
     492.  00:445C  87 87 87 87 87      [5]		add a,a 			; x32
     493.  00:4461  F6 1F               		or	00011111B
     494.  00:4463  D3 99               		out (0x99),a
     495.  00:4465  3E 82               		ld a,2+128
     496.  00:4467  D3 99               		out (0x99),a
     497.  00:4469                      		
     498.  00:4469  3A 36 CB            		LD    A,(_yoffset)		; SCROLL DOWN
     499.  00:446C  D3 99               		out (0x99),a
     500.  00:446E  C6 A7               		add    A,YSIZE-1
     501.  00:4470  6F                  		ld		l,a
     502.  00:4471  3E 97               		LD    A,23+128
     503.  00:4473  D3 99               		out (0x99),a
     504.  00:4475                      
     505.  00:4475  7D                  		ld    a,l
     506.  00:4476  D3 99               		out (0x99),a			; set interrupt line
     507.  00:4478  3E 93               		LD    A,19+128
     508.  00:447A  D3 99               		out (0x99),a
     509.  00:447C                      		
     510.  00:447C  3A 35 CB            		ld	a,(_xoffset)		; set R#18 only if not scrolling
     511.  00:447F  C6 F8               		add	a,-8
     512.  00:4481  E6 0F               		and	0Fh
     513.  00:4483  D3 99               		out	(099h),a
     514.  00:4485  3E 92               		ld	a,18+128
     515.  00:4487  D3 99               		out	(099h),a
     516.  00:4489                      
     517.  00:4489  3A E7 FF            		ld	a,(RG8SAV)		; enable sprites
     518.  00:448C  E6 FD               		and	11111101B
     519.  00:448E  32 E7 FF            		ld	(RG8SAV),a
     520.  00:4491  D3 99               		out	(0x99),a
     521.  00:4493  3E 88               		ld	a,8+128
     522.  00:4495  D3 99               		out	(0x99),a
     523.  00:4497                      
     524.  00:4497  C9                  		ret
     525.  00:4498                      			
     526.  00:4498                      ;-------------------------------------
     527.  00:4498                      	
     528.  00:4498                      changedir:
     529.  00:4498  3A 42 CB            		ld		a,(_dxmap)
     530.  00:449B  E6 80               		and		128
     531.  00:449D  47                  		ld		b,a
     532.  00:449E  23                  		inc		hl
     533.  00:449F  3A 43 CB            		ld		a,(dxmap)		; dxmap
     534.  00:44A2  4F                  		ld		c,a
     535.  00:44A3  E6 80               		and		128
     536.  00:44A5  A8                  		xor		b				; compare signs
     537.  00:44A6  CA D8 44            		jp		z,nodirchange
     538.  00:44A9  32 41 CB            		ld		(_dxchng),a		; a<>0
     539.  00:44AC  CB 79               		bit		7,c
     540.  00:44AE  28 14               		jr		z,.right
     541.  00:44B0                      .left
     542.  00:44B0  CD B9 57            		call	plot_line_lft1
     543.  00:44B3  3A 33 CB            		ld 		a,(_displaypage)
     544.  00:44B6  EE 01               		xor		1
     545.  00:44B8  57                  		ld 		d,a
     546.  00:44B9  1E 00               		ld		e,0
     547.  00:44BB  CD 58 58            		call	clrboder
     548.  00:44BE  CD C1 57            		call	plot_line_lft2
     549.  00:44C1  C3 16 44            		jp		newxmap
     550.  00:44C4                      
     551.  00:44C4                      .right
     552.  00:44C4  CD C9 57            		call	plot_line_rgt1
     553.  00:44C7  3A 33 CB            		ld 		a,(_displaypage)
     554.  00:44CA  EE 01               		xor		1
     555.  00:44CC  57                  		ld 		d,a
     556.  00:44CD  1E F0               		ld		e,240
     557.  00:44CF  CD 58 58            		call	clrboder
     558.  00:44D2  CD D5 57            		call	plot_line_rgt2
     559.  00:44D5  C3 16 44            		jp		newxmap
     560.  00:44D8                      
     561.  00:44D8                      nodirchange:
     562.  00:44D8  3A 41 CB            		ld		a,(_dxchng)
     563.  00:44DB  A7                  		and		a
     564.  00:44DC  20 08               		jr		nz,1f
     565.  00:44DE  CB 79               		bit		7,c
     566.  00:44E0  CA C5 43            		jp		z,inc_xoffset
     567.  00:44E3  C3 ED 43            		jp		dec_xoffset
     568.  00:44E6                      	
     569.  00:44E6  AF                  1:		xor	a
     570.  00:44E7  32 41 CB            		ld		(_dxchng),a
     571.  00:44EA  CB 79               		bit		7,c
     572.  00:44EC  CA FF 44            		jp		z,.right
     573.  00:44EF                      .left
     574.  00:44EF  CD B9 57            		call	plot_line_lft1
     575.  00:44F2  1E E0               		ld		e,240-16
     576.  00:44F4  16 F0               		ld		d,240
     577.  00:44F6  CD 8A 58            		call	move_block
     578.  00:44F9  CD C1 57            		call	plot_line_lft2
     579.  00:44FC  C3 16 44            		jp		newxmap
     580.  00:44FF                      
     581.  00:44FF                      .right
     582.  00:44FF  CD C9 57            		call	plot_line_rgt1
     583.  00:4502  1E 10               		ld		e,16
     584.  00:4504  16 00               		ld		d,0
     585.  00:4506  CD 8A 58            		call	move_block
     586.  00:4509  CD D5 57            		call	plot_line_rgt2
     587.  00:450C  C3 16 44            		jp		newxmap
     588.  00:450F                      
     589.  00:450F                      ;-------------------------------------
      62   00:450F                      		
      63   00:450F                      		include checkkbd.asm
       1.  00:450F                      
       2.  00:450F                      ; // Line Bit_7 Bit_6 Bit_5 Bit_4 Bit_3 Bit_2 Bit_1 Bit_0
       3.  00:450F                      ; // 0 "7" "6" "5" "4" "3" "2" "1" "0"
       4.  00:450F                      ; // 1 ";" "]" "[" "\" "=" "-" "9" "8"
       5.  00:450F                      ; // 2 "B" "A" ??? "/" "." "," "'" "`"
       6.  00:450F                      ; // 3 "J" "I" "H" "G" "F" "E" "D" "C"
       7.  00:450F                      ; // 4 "R" "Q" "P" "O" "N" "M" "L" "K"
       8.  00:450F                      ; // 5 "Z" "Y" "X" "W" "V" "U" "T" "S"
       9.  00:450F                      ; // 6 F3 F2 F1 CODE CAP GRAPH CTRL SHIFT
      10.  00:450F                      ; // 7 RET SEL BS STOP TAB ESC F5 F4
      11.  00:450F                      ; // 8 RIGHT DOWN UP LEFT DEL INS HOME SPACE
      12.  00:450F                      
      13.  00:450F                      checkkbd:
      14.  00:450F  F3                  		di
      15.  00:4510  DB AA               		in	a,(0aah)
      16.  00:4512  E6 F0               		and 011110000B			; upper 4 bits contain info to preserve
      17.  00:4514  B3                  		or	e
      18.  00:4515  D3 AA               		out (0aah),a
      19.  00:4517  DB A9               		in	a,(0a9h)
      20.  00:4519  6F                  		ld	l,a
      21.  00:451A  FB                  		ei
      22.  00:451B  C9                  		ret
      64   00:451C                      		include sprts.asm
       1.  00:451C                      
       2.  00:451C                      
       3.  00:451C                      
       4.  00:451C                      _hw_sprite_init:
       5.  00:451C                      
       6.  00:451C  (00:0000)           teller:=0
       7.  00:451C                      		repeat	4				; 4 SPTs, at 0xD800, 0xE000, 0xE800, 0xF000
       8.  00:451C                    < 		ld		c,0
       9.  00:451C                    < 		ld		de,0F000h-64*32*3+64*32*teller
      10.  00:451C                    < 		call	_vdpsetvramwr
      11.  00:451C                    < 		ld		d, :sprtdata
      12.  00:451C                    < 		ld		e, 1
      13.  00:451C                    < 		call	outvram
      14.  00:451C                    < teller:=teller+1
      15.  00:451C                    < 		endrepeat
      15.  00:451C  0E 00 11 00 D8 CD A5 41 16 1B 1E 01 CD CD 71 0E 
      15.  00:452C  00 11 00 E0 CD A5 41 16 1B 1E 01 CD CD 71 0E 00 
      15.  00:453C  11 00 E8 CD A5 41 16 1B 1E 01 CD CD 71 0E 00 11 
      15.  00:454C  00 F0 CD A5 41 16 1B 1E 01 CD CD 71 
      16.  00:4558                      		
      17.  00:4558  0E 00               		ld		c,0
      18.  00:455A  11 00 FA            		ld		de,0FA00h
      19.  00:455D  CD A5 41            		call	_vdpsetvramwr
      20.  00:4560                      
      21.  00:4560  3E D8               		ld		a,0xD8
      22.  00:4562  D3 98               		out 	(0x98),a
      23.  00:4564                      
      24.  00:4564  C9                  		ret
      25.  00:4565                      
      26.  00:4565                      		
      27.  00:4565                      	; load static colors 
      28.  00:4565                      load_colors:
      29.  00:4565  0E 00               		ld		c,0
      30.  00:4567  11 30 F8            		ld		de,0F830h			;	0FA00h-512+3*16
      31.  00:456A  CD A5 41            		call	_vdpsetvramwr
      32.  00:456D  CD 7C 45            		call	bull_color
      33.  00:4570                      		
      34.  00:4570  0E 00               		ld		c,0
      35.  00:4572  11 80 FD            		ld		de,0FD80h		   ;	0FE00h-512+max_enem*16
      36.  00:4575  CD A5 41            		call	_vdpsetvramwr
      37.  00:4578  CD 7C 45            		call	bull_color
      38.  00:457B  C9                  		ret
      39.  00:457C                      		
      40.  00:457C                      
      41.  00:457C                      bull_color:	
      42.  00:457C  06 50               		ld	b,16*(max_bullets+max_enem_bullets)
      43.  00:457E  3E 0F               		ld	a,15
      44.  00:4580                      1:
      45.  00:4580  D3 98               		out	(0x98),a
      46.  00:4582  10 FC               		djnz 1b		
      47.  00:4584  C9                  		ret
      48.  00:4585                      		
      65   00:4585                      		include sat_update.asm
       1.  00:4585                      
       2.  00:4585                      ; _plot_enemy:
       3.  00:4585                      
       4.  00:4585                      ; __sat_update
       5.  00:4585                      	; ld		c,0
       6.  00:4585                      	; ld		de,0FA00h
       7.  00:4585                      	; call	_vdpsetvramwr
       8.  00:4585                      	; ld		hl,_sat
       9.  00:4585                      	; ld		bc,0x8098
      10.  00:4585                      ; 1:	outi
      11.  00:4585                      	; ld	a,(_xoffset)		; set R#18 only if not scrolling
      12.  00:4585                      	; add	a,(hl)
      13.  00:4585                      	; out (0x98),a
      14.  00:4585                      	; inc hl
      15.  00:4585                      ; [2]	outi
      16.  00:4585                      	; djnz 1b
      17.  00:4585                      	; ret
      18.  00:4585                      	
      19.  00:4585                      set_manta:	
      20.  00:4585  01 98 0C            	ld	bc,0x98+4*3*256
      21.  00:4588  21 54 CB            	ld  hl,ram_sat
      22.  00:458B  ED B3               	otir
      23.  00:458D  C9                  	ret
      24.  00:458E                      	
      25.  00:458E                      plot_enemy:
      26.  00:458E  3A 53 CB            	ld	a,(flip_flop)
      27.  00:4591  EE 01               	xor	1
      28.  00:4593  32 53 CB            	ld	(flip_flop),a
      29.  00:4596  C2 5F 46            	jp nz, reverseplot_enemy
      30.  00:4599                      	
      31.  00:4599                      directplot_enemy:
      32.  00:4599                      	; R#5=0xF7 -> sat = FA000
      33.  00:4599  3E F7               	ld 		a,0xF7
      34.  00:459B  D3 99               	out (0x99),a
      35.  00:459D  3E 85               	ld 		a,128+5
      36.  00:459F  D3 99               	out (0x99),a
      37.  00:45A1                      	
      38.  00:45A1  0E 00               	ld		c,0
      39.  00:45A3  11 00 FA            	ld		de,0FA00h	; 3 positions for main ship and its shadow
      40.  00:45A6  CD A5 41            	call	_vdpsetvramwr
      41.  00:45A9  CD 85 45            	call	set_manta	
      42.  00:45AC                      
      43.  00:45AC  DD 21 60 CB         	ld	ix,any_object
      44.  00:45B0                      
      45.  00:45B0                      ; process MS bullets and enemy bullets
      46.  00:45B0                      
      47.  00:45B0  01 98 05            	ld	bc,0x98+256*(max_bullets + max_enem_bullets)
      48.  00:45B3                      	
      49.  00:45B3  DD CB 07 46         1:	bit 0,(ix+enemy_data.status)
      50.  00:45B7  CA 3D 46            	jp	z,.spriteoff1
      51.  00:45BA                      	
      52.  00:45BA  DD 6E 01            	ld	l,(ix+enemy_data.x+0)
      53.  00:45BD  DD 66 02            	ld	h,(ix+enemy_data.x+1)
      54.  00:45C0  ED 5B 44 CB         	ld	de,(xmap)
      55.  00:45C4  AF                  	xor a
      56.  00:45C5  ED 52               	sbc hl,de				; dx = enemy.x - xmap
      57.  00:45C7  FA 3D 46            	jp	m,.spriteoff1		; dx <0
      58.  00:45CA                      
      59.  00:45CA  B4                  	or	h
      60.  00:45CB  C2 3D 46            	jp	nz,.spriteoff1		; dx >255
      61.  00:45CE                      
      62.  00:45CE  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      63.  00:45D1  85                  	add	a,l
      64.  00:45D2  DA 3D 46            	jp	c,.spriteoff1		; remove if off screen i.e. dx + _xoffset > 255
      65.  00:45D5  FE F0               	cp	240
      66.  00:45D7  D2 3D 46            	jp	nc,.spriteoff1		; remove if dx + _xoffset > 240
      67.  00:45DA                      	
      68.  00:45DA  DD 56 00            	ld	d,(ix+enemy_data.y)	; write Y
      69.  00:45DD  ED 51               	out (c),d
      70.  00:45DF  ED 79               	out (c),a				; write X
      71.  00:45E1  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
      72.  00:45E4  D3 98               	out (0x98),a			; write shape
      73.  00:45E6  ED 79               	out (c),a				; write crap
      74.  00:45E8                      	
      75.  00:45E8                      .next1
      76.  00:45E8  11 0F 00            	ld	de,enemy_data
      77.  00:45EB  DD 19               	add ix,de
      78.  00:45ED  10 C4               	djnz	1b
      79.  00:45EF                      
      80.  00:45EF                      ; process two layer enemies
      81.  00:45EF                      
      82.  00:45EF  06 0C               	ld	b,max_enem 
      83.  00:45F1  DD CB 07 46         1:	bit 0,(ix+enemy_data.status)
      84.  00:45F5  CA 4A 46            	jp	z,.spriteoff2
      85.  00:45F8                      
      86.  00:45F8  DD 6E 01            	ld	l,(ix+enemy_data.x+0)
      87.  00:45FB  DD 66 02            	ld	h,(ix+enemy_data.x+1)
      88.  00:45FE  ED 5B 44 CB         	ld	de,(xmap)
      89.  00:4602  AF                  	xor a
      90.  00:4603  ED 52               	sbc hl,de				; dx = enemy.x - xmap
      91.  00:4605  FA 4A 46            	jp	m,.spriteoff2		; dx <0
      92.  00:4608                      
      93.  00:4608  B4                  	or	h
      94.  00:4609  C2 4A 46            	jp	nz,.spriteoff2		; dx >255
      95.  00:460C                      
      96.  00:460C  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      97.  00:460F  85                  	add	a,l
      98.  00:4610  DA 4A 46            	jp	c,.spriteoff2		; remove if off screen i.e. dx + _xoffset > 255
      99.  00:4613  FE F0               	cp	240
     100.  00:4615  D2 4A 46            	jp	nc,.spriteoff2		; remove if dx + _xoffset > 240
     101.  00:4618                      	
     102.  00:4618  DD 56 00            	ld	d,(ix+enemy_data.y)	
     103.  00:461B  ED 51               	out (c),d				; write Y
     104.  00:461D  6F                  	ld  l,a
     105.  00:461E  D3 98               	out (0x98),a			; write X
     106.  00:4620                      
     107.  00:4620  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     108.  00:4623  D3 98               	out (0x98),a			; write shape
     109.  00:4625  ED 79               	out (c),a				; write crap
     110.  00:4627                      
     111.  00:4627  ED 51               	out (c),d				; write Y
     112.  00:4629  ED 69               	out (c),l				; write X
     113.  00:462B  C6 04               	add	a,4
     114.  00:462D  D3 98               	out (0x98),a			; write shape
     115.  00:462F  ED 79               	out (c),a				; write crap
     116.  00:4631                      	
     117.  00:4631                      .next2
     118.  00:4631  11 0F 00            	ld	de,enemy_data
     119.  00:4634  DD 19               	add ix,de
     120.  00:4636  10 B9               	djnz	1b
     121.  00:4638                      	
     122.  00:4638  3E D8               	ld	a,0xD8
     123.  00:463A  D3 98               	out (0x98),a			; SAT terminator
     124.  00:463C  C9                  	ret
     125.  00:463D                      
     126.  00:463D                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     127.  00:463D                      	
     128.  00:463D                      .spriteoff1
     129.  00:463D  3E D9               	ld	a,0xD9
     130.  00:463F                      [4]	out (c),a				; write crap
     130.  00:463F  ED 79 ED 79 ED 79 ED 79 
     131.  00:4647  C3 E8 45            	jp	.next1
     132.  00:464A                      
     133.  00:464A                      .spriteoff2
     134.  00:464A  3E D9               	ld	a,0xD9
     135.  00:464C                      [8]	out (c),a				; write crap
     135.  00:464C  ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 
     136.  00:465C  C3 31 46            	jp	.next2
     137.  00:465F                      
     138.  00:465F                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     139.  00:465F                      
     140.  00:465F                      reverseplot_enemy:
     141.  00:465F                      	; R#5=0xFF -> sat = FE000
     142.  00:465F  3E FF               	ld 		a,0xFF
     143.  00:4661  D3 99               	out (0x99),a
     144.  00:4663  3E 85               	ld 		a,128+5
     145.  00:4665  D3 99               	out (0x99),a
     146.  00:4667                      
     147.  00:4667  0E 00               	ld		c,0
     148.  00:4669  11 00 FE            	ld		de,0FE00h	; 3 positions for main ship and its shadow
     149.  00:466C  CD A5 41            	call	_vdpsetvramwr
     150.  00:466F                      
     151.  00:466F  DD 21 50 CC         	ld	ix,enemies+(max_enem-1)*enemy_data
     152.  00:4673                      
     153.  00:4673                      ; process two layer enemies
     154.  00:4673                      
     155.  00:4673  01 98 0C            	ld	bc,0x98+256*max_enem
     156.  00:4676                      	
     157.  00:4676  DD CB 07 46         1:	bit 0,(ix+enemy_data.status)
     158.  00:467A  CA 10 47            	jp	z,.spriteoff2
     159.  00:467D                      	
     160.  00:467D  DD 6E 01            	ld	l,(ix+enemy_data.x+0)
     161.  00:4680  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     162.  00:4683  ED 5B 44 CB         	ld	de,(xmap)
     163.  00:4687  AF                  	xor a
     164.  00:4688  ED 52               	sbc hl,de				; dx = enemy.x - xmap
     165.  00:468A  FA 10 47            	jp	m,.spriteoff2		; dx <0
     166.  00:468D                      
     167.  00:468D  B4                  	or	h
     168.  00:468E  C2 10 47            	jp	nz,.spriteoff2		; dx >255
     169.  00:4691                      
     170.  00:4691  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
     171.  00:4694  85                  	add	a,l
     172.  00:4695  DA 10 47            	jp	c,.spriteoff2		; remove if off screen i.e. dx + _xoffset > 255
     173.  00:4698  FE F0               	cp	240
     174.  00:469A  D2 10 47            	jp	nc,.spriteoff2		; remove if dx + _xoffset > 240
     175.  00:469D  DD 56 00            	ld	d,(ix+enemy_data.y)	
     176.  00:46A0  ED 51               	out (c),d				; write Y
     177.  00:46A2  6F                  	ld  l,a
     178.  00:46A3  D3 98               	out (0x98),a			; write X
     179.  00:46A5                      
     180.  00:46A5  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     181.  00:46A8  D3 98               	out (0x98),a			; write shape
     182.  00:46AA  ED 79               	out (c),a				; write crap
     183.  00:46AC                      
     184.  00:46AC  ED 51               	out (c),d				; write Y
     185.  00:46AE  ED 69               	out (c),l				; write X
     186.  00:46B0  C6 04               	add	a,4
     187.  00:46B2  D3 98               	out (0x98),a			; write shape
     188.  00:46B4  ED 79               	out (c),a				; write crap
     189.  00:46B6                      	
     190.  00:46B6                      .next2
     191.  00:46B6  11 F1 FF            	ld	de,-enemy_data
     192.  00:46B9  DD 19               	add ix,de
     193.  00:46BB  10 B9               	djnz	1b
     194.  00:46BD                      
     195.  00:46BD                      ; process one layer enemies
     196.  00:46BD                      
     197.  00:46BD  06 05               	ld	b,max_bullets + max_enem_bullets 
     198.  00:46BF  DD CB 07 46         1:	bit 0,(ix+enemy_data.status)
     199.  00:46C3  CA 03 47            	jp	z,.spriteoff1
     200.  00:46C6                      
     201.  00:46C6  DD 6E 01            	ld	l,(ix+enemy_data.x+0)
     202.  00:46C9  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     203.  00:46CC  ED 5B 44 CB         	ld	de,(xmap)
     204.  00:46D0  AF                  	xor a
     205.  00:46D1  ED 52               	sbc hl,de				; dx = enemy.x - xmap
     206.  00:46D3  FA 03 47            	jp	m,.spriteoff1		; dx <0
     207.  00:46D6                      
     208.  00:46D6  B4                  	or	h
     209.  00:46D7  C2 03 47            	jp	nz,.spriteoff1		; dx >255
     210.  00:46DA                      
     211.  00:46DA  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
     212.  00:46DD  85                  	add	a,l
     213.  00:46DE  DA 03 47            	jp	c,.spriteoff1		; remove if off screen i.e. dx + _xoffset > 255
     214.  00:46E1  FE F0               	cp	240
     215.  00:46E3  D2 03 47            	jp	nc,.spriteoff1		; remove if dx + _xoffset > 240
     216.  00:46E6                      	
     217.  00:46E6  DD 56 00            	ld	d,(ix+enemy_data.y)	
     218.  00:46E9  ED 51               	out (c),d				; write Y
     219.  00:46EB  ED 79               	out (c),a				; write X
     220.  00:46ED                      
     221.  00:46ED  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     222.  00:46F0  D3 98               	out (0x98),a			; write shape
     223.  00:46F2  ED 79               	out (c),a				; write crap
     224.  00:46F4                      
     225.  00:46F4                      .next1
     226.  00:46F4  11 F1 FF            	ld	de,-enemy_data
     227.  00:46F7  DD 19               	add ix,de
     228.  00:46F9  10 C4               	djnz	1b
     229.  00:46FB                      
     230.  00:46FB  CD 85 45            	call	set_manta	
     231.  00:46FE                      	
     232.  00:46FE  3E D8               	ld	a,0xD8
     233.  00:4700  D3 98               	out (0x98),a			; SAT terminator
     234.  00:4702  C9                  	ret
     235.  00:4703                      	
     236.  00:4703                      	
     237.  00:4703                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     238.  00:4703                      	
     239.  00:4703                      .spriteoff1
     240.  00:4703  3E D9               	ld	a,0xD9
     241.  00:4705                      [4]	out (c),a				; write crap
     241.  00:4705  ED 79 ED 79 ED 79 ED 79 
     242.  00:470D  C3 F4 46            	jp	.next1
     243.  00:4710                      
     244.  00:4710                      .spriteoff2
     245.  00:4710  3E D9               	ld	a,0xD9
     246.  00:4712                      [8]	out (c),a				; write crap
     246.  00:4712  ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 ED 79 
     247.  00:4722  C3 B6 46            	jp	.next2
     248.  00:4725                      
     249.  00:4725                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      66   00:4725                      		include collision_tst.asm
       1.  00:4725  (00DB)              	align 0x100
       2.  00:4800                      sprite_collision_windows:
       3.  00:4800                      	include sprite_collision_window.asm
       1:  00:4800                      
       2:  00:4800                       ; xoff			db	0 
       3:  00:4800                       ; yoff			db	0 
       4:  00:4800                       ; xsize		db	0 
       5:  00:4800                       ; ysize		db	0 
       6:  00:4800                      
       7:  00:4800                      sprite_0:
       8:  00:4800  00 00 10 10             defb  0, 0,16,16 
       9:  00:4804                      sprite_1:
      10:  00:4804  00 00 10 10             defb  0, 0,16,16 
      11:  00:4808                      sprite_2:
      12:  00:4808  00 00 10 10             defb  0, 0,16,16 
      13:  00:480C                      sprite_3:
      14:  00:480C  00 00 10 10             defb  0, 0,16,16 
      15:  00:4810                      sprite_4:
      16:  00:4810  00 00 10 10             defb  0, 0,16,16 
      17:  00:4814                      sprite_5:
      18:  00:4814  00 00 10 10             defb  0, 0,16,16 
      19:  00:4818                      sprite_6:
      20:  00:4818  00 00 10 10             defb  0, 0,16,16 
      21:  00:481C                      sprite_7:
      22:  00:481C  00 00 10 10             defb  0, 0,16,16 
      23:  00:4820                      sprite_8:
      24:  00:4820  00 03 10 0B             defb  0, 3,16,11 
      25:  00:4824                      sprite_9:
      26:  00:4824  00 03 10 0B             defb  0, 3,16,11 
      27:  00:4828                      sprite_10:
      28:  00:4828  00 00 10 10             defb  0, 0,16,16 
      29:  00:482C                      sprite_11:
      30:  00:482C  00 00 10 10             defb  0, 0,16,16 
      31:  00:4830                      sprite_12:
      32:  00:4830  00 00 10 10             defb  0, 0,16,16 
      33:  00:4834                      sprite_13:
      34:  00:4834  00 00 10 10             defb  0, 0,16,16 
      35:  00:4838                      sprite_14:
      36:  00:4838  00 00 10 10             defb  0, 0,16,16 
      37:  00:483C                      sprite_15:
      38:  00:483C  00 00 10 10             defb  0, 0,16,16 
      39:  00:4840                      sprite_16:
      40:  00:4840  00 01 10 0E             defb  0, 1,16,14 
      41:  00:4844                      sprite_17:
      42:  00:4844  00 00 10 10             defb  0, 0,16,16 
      43:  00:4848                      sprite_18:
      44:  00:4848  00 02 10 0C             defb  0, 2,16,12 
      45:  00:484C                      sprite_19:
      46:  00:484C  00 01 10 0E             defb  0, 1,16,14 
      47:  00:4850                      sprite_20:
      48:  00:4850  00 01 10 0E             defb  0, 1,16,14 
      49:  00:4854                      sprite_21:
      50:  00:4854  00 02 10 0C             defb  0, 2,16,12 
      51:  00:4858                      sprite_22:
      52:  00:4858  00 00 10 10             defb  0, 0,16,16 
      53:  00:485C                      sprite_23:
      54:  00:485C  00 01 10 0E             defb  0, 1,16,14 
       4.  00:4860                      
       5.  00:4860                      ;	in: 
       6.  00:4860                      ;		IX-> current sprite
       7.  00:4860                      ;		(ix+enemy_data.frame) = frame in the SPT
       8.  00:4860                      ;	out;
       9.  00:4860                      ;		IX -> xoff,yoff,xsize,ysize are set
      10.  00:4860                      	
      11.  00:4860                      set_size:
      12.  00:4860  08                   	ex	af,af'
      13.  00:4861  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
      14.  00:4864  D6 40               	sub	a,16*4
      15.  00:4866  0F                  	rrca
      16.  00:4867  D9                  	exx
      17.  00:4868  E6 7C               	and	%01111100
      18.  00:486A  6F                  	ld	l,a
      19.  00:486B  26 48               	ld	h,high sprite_collision_windows		
      20.  00:486D  7E                  	ld	a,(hl)
      21.  00:486E  DD 77 03            	ld	(ix+enemy_data.xoff),a
      22.  00:4871  23                  	inc	hl
      23.  00:4872  7E                  	ld	a,(hl)
      24.  00:4873  DD 77 04            	ld	(ix+enemy_data.yoff),a
      25.  00:4876  23                  	inc	hl
      26.  00:4877  7E                  	ld	a,(hl)
      27.  00:4878  DD 77 05            	ld	(ix+enemy_data.xsize),a
      28.  00:487B  23                  	inc	hl
      29.  00:487C  7E                  	ld	a,(hl)
      30.  00:487D  DD 77 06            	ld	(ix+enemy_data.ysize),a
      31.  00:4880  D9                  	exx
      32.  00:4881  08                  	ex		af,af'
      33.  00:4882  C9                  	ret
      34.  00:4883                      
      35.  00:4883                      ;	in: 
      36.  00:4883                      ;		IY-> current sprite
      37.  00:4883                      ;		(iY+enemy_data.frame) = frame in the SPT
      38.  00:4883                      ;	out;
      39.  00:4883                      ;		IY -> xoff,yoff,xsize,ysize are set
      40.  00:4883                      	
      41.  00:4883                      bullet_set_size2:
      42.  00:4883  D6 20               	sub	a,8*4
      43.  00:4885  D9                  	exx
      44.  00:4886  E6 7C               	and	%01111100
      45.  00:4888  4F                  	ld	c,a
      46.  00:4889  06 00               	ld	b,0
      47.  00:488B  21 A4 48            	ld	hl,bullet_sprite_collision_windows
      48.  00:488E  09                  	add	hl,bc
      49.  00:488F  7E                  	ld	a,(hl)
      50.  00:4890  FD 77 03            	ld	(iy+enemy_data.xoff),a
      51.  00:4893  23                  	inc	hl
      52.  00:4894  7E                  	ld	a,(hl)
      53.  00:4895  FD 77 04            	ld	(iy+enemy_data.yoff),a
      54.  00:4898  23                  	inc	hl
      55.  00:4899  7E                  	ld	a,(hl)
      56.  00:489A  FD 77 05            	ld	(iy+enemy_data.xsize),a
      57.  00:489D  23                  	inc	hl
      58.  00:489E  7E                  	ld	a,(hl)
      59.  00:489F  FD 77 06            	ld	(iy+enemy_data.ysize),a
      60.  00:48A2  D9                  	exx
      61.  00:48A3  C9                  	ret
      62.  00:48A4                      	
      63.  00:48A4                      bullet_sprite_collision_windows:
      64.  00:48A4                      .sprite_8:
      65.  00:48A4  04 01 08 0E             defb  4, 1, 8,14 
      66.  00:48A8                      .sprite_9:
      67.  00:48A8  04 03 08 0B             defb  4, 3, 8,11 
      68.  00:48AC                      .sprite_10:
      69.  00:48AC  04 05 08 07             defb  4, 5, 8, 7 
      70.  00:48B0                      .sprite_11:
      71.  00:48B0  04 06 08 05             defb  4, 6, 8, 5 
      72.  00:48B4                      .sprite_12:
      73.  00:48B4  04 07 08 02             defb  4, 7, 8, 2 
      74.  00:48B8                      .sprite_13:
      75.  00:48B8  04 06 08 05             defb  4, 6, 8, 5 
      76.  00:48BC                      .sprite_14:
      77.  00:48BC  04 05 08 07             defb  4, 5, 8, 7 
      78.  00:48C0                      .sprite_15:
      79.  00:48C0  04 03 08 0B             defb  4, 3, 8,11 
      80.  00:48C4                      
      81.  00:48C4                      ;	in: 
      82.  00:48C4                      ;		IX-> current sprite
      83.  00:48C4                      ;		(ix+enemy_data.frame) = frame in the SPT
      84.  00:48C4                      ;	out;
      85.  00:48C4                      ;		IX -> xoff,yoff,xsize,ysize are set
      86.  00:48C4                      	
      87.  00:48C4                      bullet_set_size:
      88.  00:48C4  D6 20               	sub	a,8*4
      89.  00:48C6  D9                  	exx
      90.  00:48C7  E6 FC               	and	%11111100
      91.  00:48C9  4F                  	ld	c,a
      92.  00:48CA  06 00               	ld	b,0
      93.  00:48CC  21 A4 48            	ld	hl,bullet_sprite_collision_windows
      94.  00:48CF  09                  	add	hl,bc
      95.  00:48D0  7E                  	ld	a,(hl)
      96.  00:48D1  DD 77 03            	ld	(ix+enemy_data.xoff),a
      97.  00:48D4  23                  	inc	hl
      98.  00:48D5  7E                  	ld	a,(hl)
      99.  00:48D6  DD 77 04            	ld	(ix+enemy_data.yoff),a
     100.  00:48D9  23                  	inc	hl
     101.  00:48DA  7E                  	ld	a,(hl)
     102.  00:48DB  DD 77 05            	ld	(ix+enemy_data.xsize),a
     103.  00:48DE  23                  	inc	hl
     104.  00:48DF  7E                  	ld	a,(hl)
     105.  00:48E0  DD 77 06            	ld	(ix+enemy_data.ysize),a
     106.  00:48E3  D9                  	exx
     107.  00:48E4  C9                  	ret
     108.  00:48E5                      
     109.  00:48E5                      
     110.  00:48E5                      ;	in: 
     111.  00:48E5                      ;		IX-> current bullet
     112.  00:48E5                      ;		(iY+enemy_data.frame) = frame in the SPT
     113.  00:48E5                      ;		xship,yship,ms_ysize,ms_xoff ecc ecc
     114.  00:48E5                      ;	out:
     115.  00:48E5                      ;		Carry set = MS is hit
     116.  00:48E5                      ;
     117.  00:48E5                      test_collision_enemy_bullets:
     118.  00:48E5                      	
     119.  00:48E5  DD 7E 00            	ld  a,(ix+enemy_data.y)
     120.  00:48E8  DD 86 04            	add a,(ix+enemy_data.yoff)
     121.  00:48EB  47                  	ld  b,a						; b = y+yoffset
     122.  00:48EC  DD 4E 06            	ld  c,(ix+enemy_data.ysize) ; c = ysize
     123.  00:48EF                      	
     124.  00:48EF                      	;[minx(h) maxx(h) miny(h) maxy(h)]
     125.  00:48EF                      	
     126.  00:48EF  3A 48 CB            	ld  a,(yship)
     127.  00:48F2  FD 86 02            	add	a,(iy+2)
     128.  00:48F5  57                  	ld  d,a				; d = y+ymin
     129.  00:48F6                      	
     130.  00:48F6  FD 7E 03            	ld	a,(iy+3)
     131.  00:48F9  FD 96 02            	sub	a,(iy+2)
     132.  00:48FC  3C                  	inc	a
     133.  00:48FD  5F                  	ld  e,a 		; 	ms_ysize
     134.  00:48FE                      	
     135.  00:48FE  CD 84 49            	call	CollisionCheck_8b
     136.  00:4901  D0                  	ret nc
     137.  00:4902                      	
     138.  00:4902                      	;[minx(h) maxx(h) miny(h) maxy(h)]
     139.  00:4902                      	
     140.  00:4902  DD 6E 01            	ld l,(ix+enemy_data.x)
     141.  00:4905  DD 66 02            	ld h,(ix+enemy_data.x+1)
     142.  00:4908  16 00               	ld d,0
     143.  00:490A  DD 5E 03            	ld e,(ix+enemy_data.xoff)
     144.  00:490D  19                  	add hl,de
     145.  00:490E  EB                  	ex de,hl
     146.  00:490F                      	
     147.  00:490F  44                  	ld b,h
     148.  00:4910  2A 49 CB            	ld hl,(xship)
     149.  00:4913  FD 4E 00            	ld c,(iy+0) ;	ms_xoff
     150.  00:4916  09                  	add hl,bc
     151.  00:4917                      
     152.  00:4917  DD 4E 05            	ld c,(ix+enemy_data.xsize)
     153.  00:491A                      	
     154.  00:491A  FD 7E 01            	ld	a,(iy+1)
     155.  00:491D  FD 96 00            	sub	a,(iy+0)
     156.  00:4920  3C                  	inc	a
     157.  00:4921  47                  	ld  b,a 		; ms_xsize
     158.  00:4922                      
     159.  00:4922  C3 74 49            	jp CalcCollision
     160.  00:4925                      	; call CalcCollision
     161.  00:4925                      	; ret 
     162.  00:4925                      	
     163.  00:4925                      ;	in: 
     164.  00:4925                      ;		ix -> current enemy
     165.  00:4925                      ;	out;
     166.  00:4925                      ; 		Carry set = collision
     167.  00:4925                      	
     168.  00:4925                      test_collision_msbullets:
     169.  00:4925                      
     170.  00:4925  FD 21 60 CB             ld  iy,ms_bullets
     171.  00:4929  11 0F 00            	ld  de,enemy_data
     172.  00:492C  06 02                   ld  b,max_bullets
     173.  00:492E  A7                      and	a
     174.  00:492F                      	
     175.  00:492F  D9                  1:	exx
     176.  00:4930                          
     177.  00:4930  FD CB 07 46         	bit 0,(iy+enemy_data.status)
     178.  00:4934  C4 3E 49            	call	nz,test_collision
     179.  00:4937  D8                  	ret	c
     180.  00:4938                      	
     181.  00:4938  D9                  	exx
     182.  00:4939  FD 19                   add iy,de
     183.  00:493B  10 F2                   djnz   1b
     184.  00:493D  C9                  	ret
     185.  00:493E                      	
     186.  00:493E                      
     187.  00:493E                      ; struct enemy_data
     188.  00:493E                      ; y               db  0
     189.  00:493E                      ; x               dw  0
     190.  00:493E                      ; xoff			db	0
     191.  00:493E                      ; yoff			db	0
     192.  00:493E                      ; xsize			db	0
     193.  00:493E                      ; ysize			db	0
     194.  00:493E                      ; status          db  0
     195.  00:493E                      ; cntr            db  0
     196.  00:493E                      ; kind            db  0
     197.  00:493E                      ; frame			db	0
     198.  00:493E                      ; color			db	0
     199.  00:493E                      ; speed           dw  0
     200.  00:493E                      ; ends
     201.  00:493E                      
     202.  00:493E                      
     203.  00:493E                      ; IN: 
     204.  00:493E                      ; 	ix -> object 1
     205.  00:493E                      ; 	iy -> object 2
     206.  00:493E                      ;
     207.  00:493E                      ; OUT: 
     208.  00:493E                      ; Carry set = collision
     209.  00:493E                      
     210.  00:493E                      test_collision:
     211.  00:493E  DD 7E 00            	ld  a,(ix+enemy_data.y)
     212.  00:4941  DD 86 04            	add a,(ix+enemy_data.yoff)
     213.  00:4944  47                  	ld  b,a
     214.  00:4945  DD 4E 06            	ld  c,(ix+enemy_data.ysize)
     215.  00:4948                      	
     216.  00:4948  FD 7E 00            	ld  a,(iy+enemy_data.y)
     217.  00:494B  FD 86 04            	add	a,(iy+enemy_data.yoff)
     218.  00:494E  57                  	ld  d,a
     219.  00:494F  FD 5E 06            	ld  e,(iy+enemy_data.ysize)
     220.  00:4952                      	
     221.  00:4952  CD 84 49            	call	CollisionCheck_8b
     222.  00:4955  D0                  	ret nc
     223.  00:4956                      	
     224.  00:4956  DD 6E 01            	ld l,(ix+enemy_data.x)
     225.  00:4959  DD 66 02            	ld h,(ix+enemy_data.x+1)
     226.  00:495C  16 00               	ld d,0
     227.  00:495E  42                  	ld b,d
     228.  00:495F  DD 5E 03            	ld e,(ix+enemy_data.xoff)
     229.  00:4962  19                  	add hl,de
     230.  00:4963  EB                  	ex de,hl
     231.  00:4964                      	
     232.  00:4964  FD 6E 01            	ld l,(iy+enemy_data.x)
     233.  00:4967  FD 66 02            	ld h,(iy+enemy_data.x+1)
     234.  00:496A  FD 4E 03            	ld c,(iy+enemy_data.xoff)
     235.  00:496D  09                  	add hl,bc
     236.  00:496E                      
     237.  00:496E  DD 4E 05            	ld c,(ix+enemy_data.xsize)
     238.  00:4971  FD 46 05            	ld b,(iy+enemy_data.xsize)
     239.  00:4974                      
     240.  00:4974                      	; call CalcCollision
     241.  00:4974                      	; ret 
     242.  00:4974                      
     243.  00:4974                      ; CalcCollision
     244.  00:4974                      ;
     245.  00:4974                      ; 1D collision check
     246.  00:4974                      ;
     247.  00:4974                      ; IN: 
     248.  00:4974                      ; 	DE = Location object 1
     249.  00:4974                      ; 	C = Size object 1
     250.  00:4974                      ; 	HL = Location object 2
     251.  00:4974                      ; 	B = Size object 2
     252.  00:4974                      ; OUT: 
     253.  00:4974                      ; Carry set = collision
     254.  00:4974                      ;
     255.  00:4974                      CalcCollision:
     256.  00:4974  AF                  	xor a
     257.  00:4975  ED 52               	sbc hl,de		; x2-x1
     258.  00:4977  57                  	ld  d,a
     259.  00:4978  38 04               	jr  c,.switch 	; jump if x2<x1
     260.  00:497A                      	
     261.  00:497A                      					; x2>=x1
     262.  00:497A  59                  	ld  e,c
     263.  00:497B  ED 52               	sbc hl,de		; C == x2-x1<dx1	
     264.  00:497D  C9                  	ret
     265.  00:497E                      
     266.  00:497E                      
     267.  00:497E                      .switch:			; x2-x1<0
     268.  00:497E  57                  	ld	d,a
     269.  00:497F  58                  	ld	e,b
     270.  00:4980  AF                  	xor	a
     271.  00:4981  ED 52               	sbc hl,de		; x2-x1 - dx2
     272.  00:4983  C9                  	ret				; C == x1-x2<dx2
     273.  00:4984                      
     274.  00:4984                      ;
     275.  00:4984                      ; CollisionCheck
     276.  00:4984                      ;
     277.  00:4984                      ;   Calculates whether a collision occurs between two objects
     278.  00:4984                      ;   of a certain size
     279.  00:4984                      ;
     280.  00:4984                      ; IN: b = coordinate of object 1
     281.  00:4984                      ;     c = size of object 1
     282.  00:4984                      ;     d = coordinate of object 2
     283.  00:4984                      ;     e = size of object 2
     284.  00:4984                      ; OUT: Carry set if collision
     285.  00:4984                      ; CHANGES: AF
     286.  00:4984                      ;
     287.  00:4984                      CollisionCheck_8b:
     288.  00:4984  7A                          ld      a,d             ; get x2                       [5]
     289.  00:4985  90                          sub     b               ; calculate x2-x1              [5]
     290.  00:4986  38 02                       jr      c,.other        ; jump if x2<x1                [13/8]
     291.  00:4988  91                          sub     c               ; compare with size 1          [5]
     292.  00:4989  C9                          ret                     ; return result                [11]
     293.  00:498A                      .other:
     294.  00:498A  ED 44                       neg                     ; use negative value           [10]
     295.  00:498C  93                          sub     e               ; compare with size 1          [5]
     296.  00:498D  C9                          ret                     ; return result                [11]
     297.  00:498E                      
     298.  00:498E                      
     299.  00:498E                      	
     300.  00:498E                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     301.  00:498E                      ; check_obj_collision
     302.  00:498E                      ; (obj *obj1,                          DE
     303.  00:498E                      ;  obj *obj2);                         BC
     304.  00:498E                      ;
     305.  00:498E                      ; obj->
     306.  00:498E                      ;    dw x,y
     307.  00:498E                      ;    db dx,dy
     308.  00:498E                      ;
     309.  00:498E                      ; if collision 
     310.  00:498E                      ;	return HL = -1 
     311.  00:498E                      ; else 
     312.  00:498E                      ;	return HL = 0
     313.  00:498E                      
     314.  00:498E                      	struct obj_data
     315.  00:498E                    < y               db  0
     316.  00:498E                    < x               dw  0
     317.  00:498E                    < xoff			db	0
     318.  00:498E                    < yoff			db	0
     319.  00:498E                    < xsize			db	0
     320.  00:498E                    < ysize			db	0
     321.  00:498E                    <     ends
     322.  00:498E                      
     323.  00:498E                      
     324.  00:498E                      _check_obj_collision:
     325.  00:498E                      
     326.  00:498E                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     327.  00:498E                      
     328.  00:498E  D5                  	push de
     329.  00:498F  DD E1               	pop ix		; ix   -> obj_data1
     330.  00:4991  C5                  	push bc
     331.  00:4992  FD E1               	pop iy		; iy   -> obj_data1
     332.  00:4994                      
     333.  00:4994                      check_obj_collision_8_16:
     334.  00:4994                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     335.  00:4994                      
     336.  00:4994  DD 7E 00            	ld  a,(ix+obj_data.y)        ; TEST Y
     337.  00:4997  DD 86 04            	add	a,(ix+obj_data.yoff)
     338.  00:499A  6F                  	ld	l,a				; HL=vertical pos. object 1 + 256 (i.e. Y1+256)
     339.  00:499B  26 01               	ld	h,1
     340.  00:499D                      	
     341.  00:499D                      	
     342.  00:499D  FD 7E 00            	ld  a,(iy+obj_data.y)
     343.  00:49A0  FD 86 04            	add	a,(iy+obj_data.yoff)
     344.  00:49A3  5F                  	ld	e,a		    	; DE=vertical pos. object 2 + 256 (i.e. Y2+256)
     345.  00:49A4  54                  	ld	d,h               
     346.  00:49A5                      
     347.  00:49A5  FD 46 06            	ld      b,(iy+obj_data.ysize)    ; B=number of pixels, object 2 (i.e. Ysize2)
     348.  00:49A8                      
     349.  00:49A8  AF                  	xor      a
     350.  00:49A9  ED 52               	sbc     hl,de
     351.  00:49AB  30 08               	jr      nc,1f       ; if HL<DE swap objects
     352.  00:49AD                      
     353.  00:49AD                      swap_objects_y:
     354.  00:49AD                      
     355.  00:49AD  DD 46 06            	ld      b,(ix+obj_data.ysize)    ; B=number of pixels, object 1 (i.e. Ysize1)
     356.  00:49B0                      
     357.  00:49B0  EB                  	ex      de,hl
     358.  00:49B1  67                  	ld      h,a			; NB: A is 0
     359.  00:49B2  6F                  	ld      l,a
     360.  00:49B3  ED 52               	sbc     hl,de       ; HL = - HL
     361.  00:49B5                      
     362.  00:49B5  B4                  1:	or      h			; NB: A was 0
     363.  00:49B6  20 30               	jr      nz,9f       ; Delta Y>256 == test failed (NB: CF = 0)
     364.  00:49B8                      
     365.  00:49B8  7D                  	ld      a,l         ; A = abs(Y2+256-(Y1+256)); B = (Y2>Y1) ? Ysize1 : Ysize2;
     366.  00:49B9  B8                  	cp      b
     367.  00:49BA  30 2C               	jr      nc,9f       ; delta Y> B == test failed
     368.  00:49BC                      
     369.  00:49BC                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     370.  00:49BC  06 01               	ld	b,1
     371.  00:49BE                      
     372.  00:49BE  DD 6E 01            	ld  l,(ix+obj_data.x)        ; TEST X
     373.  00:49C1  DD 66 02            	ld  h,(ix+obj_data.x+1)
     374.  00:49C4  DD 4E 03            	ld	c,(ix+obj_data.xoff)
     375.  00:49C7  09                  	add	hl,bc		    ; HL=x pos. object 1 + 256 (i.e. X1+256)
     376.  00:49C8                      
     377.  00:49C8  FD 5E 01            	ld  e,(iy+obj_data.x)
     378.  00:49CB  FD 56 02            	ld  d,(iy+obj_data.x+1)
     379.  00:49CE  FD 4E 03            	ld	c,(iy+obj_data.xoff)
     380.  00:49D1  09                  	add	hl,bc		    ; DE=x pos. object 2 + 256 (i.e. X2+256)
     381.  00:49D2  EB                  	ex	de,hl               
     382.  00:49D3                      
     383.  00:49D3  FD 46 05            	ld      b,(iy+obj_data.xsize)    ; Xsize2 in b
     384.  00:49D6                      
     385.  00:49D6  AF                  	xor      a
     386.  00:49D7  ED 52               	sbc     hl,de       ; x1-x2
     387.  00:49D9  30 08               	jr      nc,1f       ; if (x1-x2>=0) swap objects (NB CF=0)
     388.  00:49DB                      
     389.  00:49DB                      swap_objects_x:
     390.  00:49DB                      
     391.  00:49DB  DD 46 05            	ld      b,(ix+obj_data.xsize)    ; Xsize1 in b
     392.  00:49DE                      
     393.  00:49DE  EB                  	ex      de,hl
     394.  00:49DF  67                  	ld      h,a			; NB: A is 0
     395.  00:49E0  6F                  	ld      l,a
     396.  00:49E1  ED 52               	sbc     hl,de       ; hl=x1-x2
     397.  00:49E3                      
     398.  00:49E3  B4                  1:	or      h
     399.  00:49E4  20 02               	jr      nz,9f       ; if delta X>256 the test on X failed (NB CF=0)
     400.  00:49E6                      
     401.  00:49E6  7D                  	ld      a,l
     402.  00:49E7  B8                  	cp      b           ; CF holds the test result on X
     403.  00:49E8                      
     404.  00:49E8                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     405.  00:49E8                      
     406.  00:49E8                      9:              
     407.  00:49E8  ED 62               	sbc     hl,hl       ; return hl = -1 if obj1 and obj2 collide
     408.  00:49EA                      
     409.  00:49EA  C9                  	ret
     410.  00:49EB                      
     411.  00:49EB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     412.  00:49EB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     413.  00:49EB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     414.  00:49EB                      
     415.  00:49EB                      	
     416.  00:49EB                      	
     417.  00:49EB                      	
      67   00:49EB                      		include enemies.asm
       1.  00:49EB                      
       2.  00:49EB                      ms_ani:
       3.  00:49EB                      	include mship03_ani.asm
       1:  00:49EB                      mship03_ani:
       2:  00:49EB  09                      defb 9 
       3:  00:49EC  1C                      defb 28 
       4:  00:49ED  1E                      defb 30 
       5:  00:49EE  1F                      defb 31 
       6:  00:49EF  1F                      defb 31 
       7:  00:49F0  21                      defb 33 
       8:  00:49F1  1B                      defb 27 
       9:  00:49F2  15                      defb 21 
      10:  00:49F3  15                      defb 21 
      11:  00:49F4  0B                      defb 11 
      12:  00:49F5  10                      defb 16 
      13:  00:49F6  0C                      defb 12 
      14:  00:49F7  11                      defb 17 
      15:  00:49F8  06                      defb 6 
      16:  00:49F9  00                      defb 0 
      17:  00:49FA  17                      defb 23 
      18:  00:49FB  13                      defb 19 
      19:  00:49FC  1A                      defb 26 
      20:  00:49FD  20                      defb 32 
      21:  00:49FE  23                      defb 35 
      22:  00:49FF  23                      defb 35 
      23:  00:4A00  22                      defb 34 
      24:  00:4A01  1D                      defb 29 
      25:  00:4A02  02                      defb 2 
      26:  00:4A03  02                      defb 2 
      27:  00:4A04  0D                      defb 13 
      28:  00:4A05  01                      defb 1 
      29:  00:4A06  0A                      defb 10 
      30:  00:4A07  08                      defb 8 
      31:  00:4A08  03                      defb 3 
      32:  00:4A09  05                      defb 5 
      33:  00:4A0A  04                      defb 4 
      34:  00:4A0B  09                      defb 9 
      35:  00:4A0C  04                      defb 4 
      36:  00:4A0D  05                      defb 5 
      37:  00:4A0E  03                      defb 3 
      38:  00:4A0F  08                      defb 8 
      39:  00:4A10  03                      defb 3 
      40:  00:4A11  05                      defb 5 
      41:  00:4A12  04                      defb 4 
      42:  00:4A13  09                      defb 9 
      43:  00:4A14  12                      defb 18 
      44:  00:4A15  0F                      defb 15 
      45:  00:4A16  0E                      defb 14 
      46:  00:4A17  07                      defb 7 
      47:  00:4A18  0E                      defb 14 
      48:  00:4A19  0F                      defb 15 
      49:  00:4A1A  12                      defb 18 
      50:  00:4A1B  13                      defb 19 
      51:  00:4A1C  18                      defb 24 
      52:  00:4A1D  14                      defb 20 
      53:  00:4A1E  16                      defb 22 
      54:  00:4A1F  19                      defb 25 
      55:  00:4A20  16                      defb 22 
      56:  00:4A21  14                      defb 20 
      57:  00:4A22  18                      defb 24 
      58:  00:4A23  13                      defb 19 
      59:  00:4A24  17                      defb 23 
      60:  00:4A25  00                      defb 0 
      61:  00:4A26  06                      defb 6 
      62:  00:4A27  11                      defb 17 
      63:  00:4A28  06                      defb 6 
      64:  00:4A29  00                      defb 0 
      65:  00:4A2A  17                      defb 23 
      66:  00:4A2B  25                      defb 37 
      67:  00:4A2C  24                      defb 36 
      68:  00:4A2D  26                      defb 38 
      69:  00:4A2E  28                      defb 40 
      70:  00:4A2F  29                      defb 41 
      71:  00:4A30  27                      defb 39 
      72:  00:4A31  2E                      defb 46 
      73:  00:4A32  2F                      defb 47 
      74:  00:4A33  2A                      defb 42 
      75:  00:4A34  30                      defb 48 
      76:  00:4A35  32                      defb 50 
      77:  00:4A36  33                      defb 51 
      78:  00:4A37  2C                      defb 44 
      79:  00:4A38  31                      defb 49 
      80:  00:4A39  2D                      defb 45 
      81:  00:4A3A  2B                      defb 43 
       4.  00:4A3B                      ms_col_win:
       5.  00:4A3B                      	include mship03_frm_coll_wind.asm
       1:  00:4A3B                      mship03_coll_wind:
       2:  00:4A3B  01 0F 03 0D             defb 1,15,3,13 
       3:  00:4A3F  01 0F 04 0D             defb 1,15,4,13 
       4:  00:4A43  01 0F 01 0F             defb 1,15,1,15 
       5:  00:4A47  01 0F 06 0C             defb 1,15,6,12 
       6:  00:4A4B  01 0F 03 0F             defb 1,15,3,15 
       7:  00:4A4F  01 0F 04 0E             defb 1,15,4,14 
       8:  00:4A53  01 0F 05 0B             defb 1,15,5,11 
       9:  00:4A57  01 0F 06 0B             defb 1,15,6,11 
      10:  00:4A5B  01 0F 06 0B             defb 1,15,6,11 
      11:  00:4A5F  01 0F 01 0F             defb 1,15,1,15 
      12:  00:4A63  01 0F 06 0B             defb 1,15,6,11 
      13:  00:4A67  01 0F 02 0D             defb 1,15,2,13 
      14:  00:4A6B  01 0F 05 0A             defb 1,15,5,10 
      15:  00:4A6F  01 0F 02 0E             defb 1,15,2,14 
      16:  00:4A73  01 0F 05 0B             defb 1,15,5,11 
      17:  00:4A77  01 0F 03 0D             defb 1,15,3,13 
      18:  00:4A7B  01 0F 03 0C             defb 1,15,3,12 
      19:  00:4A7F  01 0F 06 0B             defb 1,15,6,11 
      20:  00:4A83  01 0F 02 0E             defb 1,15,2,14 
      21:  00:4A87  01 0F 01 0F             defb 1,15,1,15 
      22:  00:4A8B  01 0F 04 0E             defb 1,15,4,14 
      23:  00:4A8F  01 0F 01 0F             defb 1,15,1,15 
      24:  00:4A93  01 0F 06 0C             defb 1,15,6,12 
      25:  00:4A97  01 0F 02 0E             defb 1,15,2,14 
      26:  00:4A9B  01 0F 03 0F             defb 1,15,3,15 
      27:  00:4A9F  01 0F 06 0B             defb 1,15,6,11 
      28:  00:4AA3  02 0E 01 0F             defb 2,14,1,15 
      29:  00:4AA7  02 0D 01 0F             defb 2,13,1,15 
      30:  00:4AAB  02 0E 01 0F             defb 2,14,1,15 
      31:  00:4AAF  03 0E 01 0F             defb 3,14,1,15 
      32:  00:4AB3  03 0B 01 0F             defb 3,11,1,15 
      33:  00:4AB7  04 0A 01 0F             defb 4,10,1,15 
      34:  00:4ABB  05 0D 01 0F             defb 5,13,1,15 
      35:  00:4ABF  05 0B 01 0F             defb 5,11,1,15 
      36:  00:4AC3  05 0B 01 0F             defb 5,11,1,15 
      37:  00:4AC7  06 0C 01 0F             defb 6,12,1,15 
      38:  00:4ACB  05 0B 04 0A             defb 5,11,4,10 
      39:  00:4ACF  05 09 05 09             defb 5,9,5,9 
      40:  00:4AD3  03 0B 03 0B             defb 3,11,3,11 
      41:  00:4AD7  03 0E 01 0C             defb 3,14,1,12 
      42:  00:4ADB  03 0C 03 0C             defb 3,12,3,12 
      43:  00:4ADF  03 0D 02 0C             defb 3,13,2,12 
      44:  00:4AE3  02 0F 02 0F             defb 2,15,2,15 
      45:  00:4AE7  02 0D 04 0D             defb 2,13,4,13 
      46:  00:4AEB  02 0F 01 0D             defb 2,15,1,13 
      47:  00:4AEF  02 0D 02 0D             defb 2,13,2,13 
      48:  00:4AF3  02 0D 01 0C             defb 2,13,1,12 
      49:  00:4AF7  01 0E 02 0F             defb 1,14,2,15 
      50:  00:4AFB  01 0E 02 0F             defb 1,14,2,15 
      51:  00:4AFF  01 0E 01 0E             defb 1,14,1,14 
      52:  00:4B03  01 0E 02 0F             defb 1,14,2,15 
      53:  00:4B07  01 0E 01 0E             defb 1,14,1,14 
      54:  00:4B0B                      
       6.  00:4B0B                      
       7.  00:4B0B                      ;--------------------------------------------------------------------
       8.  00:4B0B                      ;--------------------------------------------------------------------
       9.  00:4B0B                      add_bc_score_bin
      10.  00:4B0B  C9                  	ret
      11.  00:4B0C                      ;--------------------------------------------------------------------
      12.  00:4B0C                      
      13.  00:4B0C                      ; Fast random number generator using the same method
      14.  00:4B0C                      ; as the CDMA used in cellular telephones
      15.  00:4B0C                      ;--------------------------------------------------------------------
      16.  00:4B0C                      ; init random seed 
      17.  00:4B0C                      
      18.  00:4B0C                      rand8_init:
      19.  00:4B0C  2A 9E FC            	LD      HL,(_jiffy)
      20.  00:4B0F  CB C5               	SET		0,L
      21.  00:4B11  22 39 CB            	LD      (randSeed),HL
      22.  00:4B14  C9                  	RET
      23.  00:4B15                      
      24.  00:4B15                      
      25.  00:4B15                      ; -------------------------------------------------------------------
      26.  00:4B15                      ; rand8
      27.  00:4B15                      ; -------------------------------------------------------------------
      28.  00:4B15                      ;
      29.  00:4B15                      ; choose a random number in the set [0,127] with uniform distribution
      30.  00:4B15                      ; return: A = random value
      31.  00:4B15                      
      32.  00:4B15                      rand8:
      33.  00:4B15  2A 39 CB            	ld      hl,(randSeed)
      34.  00:4B18  29                  	add     hl,hl
      35.  00:4B19  9F                  	sbc     a,a
      36.  00:4B1A  E6 83               	and     083h
      37.  00:4B1C  AD                  	xor     l
      38.  00:4B1D  6F                  	ld      l,a
      39.  00:4B1E  22 39 CB            	ld      (randSeed),hl
      40.  00:4B21  C9                  	ret
      41.  00:4B22                      	
      42.  00:4B22                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      43.  00:4B22                      ;	increase the wave counter
      44.  00:4B22                      ; 	and test for landing permission
      45.  00:4B22                      	
      46.  00:4B22                      land_now_test:
      47.  00:4B22  3A 3C CB            	ld	a,(wave_count)
      48.  00:4B25  3C                  	inc	a
      49.  00:4B26  32 3C CB            	ld	(wave_count),a
      50.  00:4B29  5F                  	ld	e,a
      51.  00:4B2A  3A 3B CB            	ld	a,(cur_level)
      52.  00:4B2D  0F 0F               [2]	rrca
      53.  00:4B2F  E6 0F               	and	15
      54.  00:4B31  C6 19               	add	a,25
      55.  00:4B33  BB                  	cp	e				; 'land now' counter after  25+cur_level/4 waves
      56.  00:4B34  C0                  	ret nz
      57.  00:4B35                      
      58.  00:4B35                      	; ld	hl,land_now
      59.  00:4B35                      	; ld	de,0x1C00+8*3*32
      60.  00:4B35                      	; call	print_strf
      61.  00:4B35  3E FF               	ld	a,-1
      62.  00:4B37  32 3D CB            	ld	(landing_permission),a
      63.  00:4B3A                      	
      64.  00:4B3A  3E 0E               	ld	a,14			; Land Now
      65.  00:4B3C  CD F4 56            	call AFXPLAY
      66.  00:4B3F  C9                  	ret
      67.  00:4B40                      
      68.  00:4B40                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      69.  00:4B40                      ;
      70.  00:4B40                      ; NPC initialization 
      71.  00:4B40                      ; it removes also bullets
      72.  00:4B40                      ;
      73.  00:4B40                      npc_init:
      74.  00:4B40  DD 21 AB CB         	ld  ix,enemies
      75.  00:4B44  06 0C               	ld  b,max_enem
      76.  00:4B46  11 0F 00            	ld	de,enemy_data
      77.  00:4B49  AF                  	xor	a
      78.  00:4B4A                      	
      79.  00:4B4A  DD 77 07            1:  ld  (ix+enemy_data.status),a
      80.  00:4B4D  DD 36 09 FF         	ld  (ix+enemy_data.kind),-1
      81.  00:4B51  DD 77 08            	ld	(ix+enemy_data.cntr),a
      82.  00:4B54  DD 36 0B FF         	ld	(ix+enemy_data.color),-1
      83.  00:4B58  DD 36 00 D9         	ld	(ix+enemy_data.y),0xD9
      84.  00:4B5C                      
      85.  00:4B5C  DD 19               	add ix,de
      86.  00:4B5E  10 EA               	djnz    1b
      87.  00:4B60                      
      88.  00:4B60  21 B4 00            	ld	hl,assault_wave_timer_preset
      89.  00:4B63  22 3E CB            	ld	(assault_wave_timer),hl
      90.  00:4B66  AF                  	xor	a
      91.  00:4B67  32 3C CB            	ld	(wave_count),a
      92.  00:4B6A  32 3D CB            	ld	(landing_permission),a
      93.  00:4B6D                      	
      94.  00:4B6D                      ; turn off MS and enemy bullets
      95.  00:4B6D                      
      96.  00:4B6D                      bull_init:
      97.  00:4B6D  AF                  	xor a
      98.  00:4B6E  32 40 CB            	ld  (bullet_rate),a
      99.  00:4B71                      
     100.  00:4B71  DD 21 60 CB         	ld  ix,ms_bullets
     101.  00:4B75  06 05               	ld	b,max_bullets+max_enem_bullets
     102.  00:4B77  11 0F 00            	ld  de,enemy_data
     103.  00:4B7A                      	
     104.  00:4B7A  DD 77 07            1:	ld  (ix+enemy_data.status),a
     105.  00:4B7D  DD 36 0B 0F         	ld	(ix+enemy_data.color),15
     106.  00:4B81  DD 19               	add ix,de
     107.  00:4B83  10 F5               	djnz	1b
     108.  00:4B85                      
     109.  00:4B85  C9                  	ret
     110.  00:4B86                      
     111.  00:4B86                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     112.  00:4B86                      ; for debug only
     113.  00:4B86                      
     114.  00:4B86                      manual_wave_ctrl:
     115.  00:4B86  1E 06               	ld e,6
     116.  00:4B88  CD 0F 45            	call	checkkbd
     117.  00:4B8B  CB 0D               	rrc	l				; shift
     118.  00:4B8D  D2 94 4B            	jp	nc,levels_8_16
     119.  00:4B90                      levels_0_8:
     120.  00:4B90  16 00               	ld	d,0
     121.  00:4B92  18 02               	jr	1f
     122.  00:4B94                      levels_8_16
     123.  00:4B94  16 08               	ld	d,8
     124.  00:4B96                      1:
     125.  00:4B96  1E 00               	ld e,0
     126.  00:4B98  CD 0F 45            	call	checkkbd
     127.  00:4B9B  7A                  	ld	a,d
     128.  00:4B9C                      	repeat 8
     129.  00:4B9C                    < 11:	rrc	l				 ; <- '0','1','2','3','4','5','6','7'
     130.  00:4B9C                    < 	jr	nc,1f
     131.  00:4B9C                    < 	inc	a
     132.  00:4B9C                    < 	endrepeat
     132.  00:4B9C  CB 0D 30 24 3C CB 0D 30 1F 3C CB 0D 30 1A 3C CB 
     132.  00:4BAC  0D 30 15 3C CB 0D 30 10 3C CB 0D 30 0B 3C CB 0D 
     132.  00:4BBC  30 06 3C CB 0D 30 01 3C 
     133.  00:4BC4  C9                  1:	ret
     134.  00:4BC5                      	
     135.  00:4BC5                      
     136.  00:4BC5                      
     137.  00:4BC5                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     138.  00:4BC5                      ;
     139.  00:4BC5                      ;	timer for wave assaults
     140.  00:4BC5                      ;
     141.  00:4BC5                      wave_timer:
     142.  00:4BC5  2A 3E CB            	ld	hl,(assault_wave_timer)
     143.  00:4BC8  2B                  	dec	hl
     144.  00:4BC9  7C                  	ld	a,h
     145.  00:4BCA  B5                  	or	l
     146.  00:4BCB  22 3E CB            	ld	(assault_wave_timer),hl
     147.  00:4BCE  C0                  	ret	nz
     148.  00:4BCF                      
     149.  00:4BCF  3E 01               	ld	a,1			; wave incoming
     150.  00:4BD1  CD F4 56            	call AFXPLAY
     151.  00:4BD4                      	
     152.  00:4BD4  21 B4 00            	ld	hl,assault_wave_timer_preset
     153.  00:4BD7  3A 3B CB            	ld	a,(cur_level)
     154.  00:4BDA  87                  	add	a,a
     155.  00:4BDB  5F                  	ld	e,a
     156.  00:4BDC  16 00               	ld	d,0
     157.  00:4BDE  A7                  	and	a
     158.  00:4BDF  ED 52               	sbc	hl,de					; at level 15 frequency is a wave each 2,5 seconds
     159.  00:4BE1  22 3E CB            	ld	(assault_wave_timer),hl	; 180 - 2*cur_level
     160.  00:4BE4                      	
     161.  00:4BE4                      
     162.  00:4BE4  CD 22 4B            	call	land_now_test
     163.  00:4BE7                      	
     164.  00:4BE7  CD 15 4B            	call	rand8
     165.  00:4BEA  E6 07               	and	7			
     166.  00:4BEC                      	; call 	manual_wave_ctrl
     167.  00:4BEC                      	
     168.  00:4BEC  CA 0C 4C            	jp	z,wave0
     169.  00:4BEF  3D                  	dec	a
     170.  00:4BF0  CA 0C 4C            	jp	z,wave1
     171.  00:4BF3  3D                  	dec	a
     172.  00:4BF4  CA 98 4C            	jp	z,wave2
     173.  00:4BF7  3D                  	dec	a
     174.  00:4BF8  CA 24 4D            	jp	z,wave3
     175.  00:4BFB  3D                  	dec	a
     176.  00:4BFC  CA 9C 4D            	jp	z,wave4
     177.  00:4BFF  3D                  	dec	a
     178.  00:4C00  CA 30 4E            	jp	z,wave5
     179.  00:4C03  3D                  	dec	a
     180.  00:4C04  CA A4 4E            	jp	z,wave6
     181.  00:4C07  3D                  	dec	a
     182.  00:4C08  CA AF 4E            	jp	z,wave7
     183.  00:4C0B  C9                  	ret		; no wave at all
     184.  00:4C0C                      	
     185.  00:4C0C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     186.  00:4C0C                      
     187.  00:4C0C                      	; align 0x100
     188.  00:4C0C                      ; spritecolors:
     189.  00:4C0C                      	; db       15,14, 9, 7
     190.  00:4C0C                      	; db        9, 3,14,15
     191.  00:4C0C                      
     192.  00:4C0C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     193.  00:4C0C                      ;
     194.  00:4C0C                      ;	enemies n#0 coming frontally
     195.  00:4C0C                      ;
     196.  00:4C0C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     197.  00:4C0C                      	
     198.  00:4C0C                      wave0:
     199.  00:4C0C                      wave1:
     200.  00:4C0C  DD 21 AB CB         	ld  ix,enemies
     201.  00:4C10  FD 26 0C            	ld	iyh,max_enem
     202.  00:4C13                      1:
     203.  00:4C13  CD 15 4B            	call	rand8
     204.  00:4C16  E6 07               	and	7
     205.  00:4C18  C6 04               	add	a,4
     206.  00:4C1A  47                  	ld	b,a			; frame
     207.  00:4C1B                      	
     208.  00:4C1B  3A 43 CB            	ld	a,(dxmap)
     209.  00:4C1E  A7                  	and	a
     210.  00:4C1F  F2 33 4C            	jp	p,.pos
     211.  00:4C22                      .neg
     212.  00:4C22  11 C0 FF            	ld	de,-64
     213.  00:4C25  0E 01               	ld	c,+1		; enemies going right
     214.  00:4C27  78                  	ld	a,b
     215.  00:4C28  87 87 87 87         [4]	add	a,a
     216.  00:4C2C  47                  	ld	b,a
     217.  00:4C2D  D9                  	exx	
     218.  00:4C2E  11 01 00            	ld 	de,1		; enemy speed = 1
     219.  00:4C31  18 10               	jr	1f
     220.  00:4C33                      .pos
     221.  00:4C33  11 20 01            	ld	de,256+32
     222.  00:4C36  0E 41               	ld	c,1+64		; enemies going left
     223.  00:4C38  78                  	ld	a,b
     224.  00:4C39  87                  	add	a,a
     225.  00:4C3A  3C                  	inc	a
     226.  00:4C3B  87 87 87            [3]	add	a,a
     227.  00:4C3E  47                  	ld	b,a
     228.  00:4C3F  D9                  	exx	
     229.  00:4C40  11 FF FF            	ld 	de,-1		; enemy speed = -1
     230.  00:4C43                      1:
     231.  00:4C43  01 0F 00            	ld  bc,enemy_data
     232.  00:4C46  D9                  	exx		
     233.  00:4C47                      
     234.  00:4C47  CD 15 4B            	call	rand8
     235.  00:4C4A  E6 0F               	and	15			; Y off set
     236.  00:4C4C                      	
     237.  00:4C4C  2A 44 CB            	ld	hl,(xmap)
     238.  00:4C4F  19                  	add	hl,de
     239.  00:4C50                      
     240.  00:4C50                      1:
     241.  00:4C50  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     242.  00:4C54  20 38               	jr  nz,.next
     243.  00:4C56                      
     244.  00:4C56  DD 71 07            	ld  (ix+enemy_data.status),c
     245.  00:4C59  DD 70 0A            	ld	(ix+enemy_data.frame),b
     246.  00:4C5C                      
     247.  00:4C5C  DD 36 09 00         	ld  (ix+enemy_data.kind),0
     248.  00:4C60  D9                  	exx
     249.  00:4C61  DD 73 0D            	ld	(ix+enemy_data.speed),e
     250.  00:4C64  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     251.  00:4C67  D9                  	exx
     252.  00:4C68                      
     253.  00:4C68  11 10 00            	ld 		de,16
     254.  00:4C6B  CB 6F               	bit	5,a
     255.  00:4C6D  28 03               	jr	z,2f
     256.  00:4C6F  11 F0 FF            	ld 		de,-16
     257.  00:4C72                      	
     258.  00:4C72  19                  2:	add 	hl,de 
     259.  00:4C73  DD 75 01            	ld  	(ix+enemy_data.x),l
     260.  00:4C76  DD 74 02            	ld  	(ix+enemy_data.x+1),h
     261.  00:4C79  DD 77 00            	ld  	(ix+enemy_data.y),a
     262.  00:4C7C  C6 20               	add		a,32
     263.  00:4C7E  CD 60 48            	call	set_size
     264.  00:4C81  D9                  	exx	
     265.  00:4C82  DD 09               	add ix,bc
     266.  00:4C84  D9                  	exx
     267.  00:4C85  FD 25               	dec	iyh
     268.  00:4C87  C8                  	ret	z
     269.  00:4C88  FE A0               	cp	mapHeight*16-16
     270.  00:4C8A  DA 50 4C            	jp	c,1b
     271.  00:4C8D  C9                  	ret
     272.  00:4C8E                      
     273.  00:4C8E                      .next
     274.  00:4C8E  D9                  	exx	
     275.  00:4C8F  DD 09               	add ix,bc
     276.  00:4C91  D9                  	exx
     277.  00:4C92  FD 25               	dec	iyh
     278.  00:4C94  C8                  	ret	z
     279.  00:4C95  C3 50 4C            	jp	1b
     280.  00:4C98                      	
     281.  00:4C98                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     282.  00:4C98                      ;
     283.  00:4C98                      ;	enemies n#2 coming from back
     284.  00:4C98                      ;
     285.  00:4C98                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     286.  00:4C98                      wave2:
     287.  00:4C98  3A 43 CB            	ld	a,(dxmap)
     288.  00:4C9B  CB 2F               	sra a			; de' = player speed x2
     289.  00:4C9D  F6 01               	or  1
     290.  00:4C9F  5F                  	ld	e,a
     291.  00:4CA0  17                  	rla
     292.  00:4CA1  9F                  	sbc a,a
     293.  00:4CA2  57                  	ld	d,a
     294.  00:4CA3  D9                  	exx
     295.  00:4CA4                      
     296.  00:4CA4  28 15               	jr	z,.pos				
     297.  00:4CA6                      .neg
     298.  00:4CA6  11 20 01            	ld	de,256+32
     299.  00:4CA9  0E 41               	ld	c,1+64		; enemies going left
     300.  00:4CAB                      	
     301.  00:4CAB  CD 15 4B            	call	rand8
     302.  00:4CAE  E6 07               	and	7
     303.  00:4CB0  C6 04               	add	a,4
     304.  00:4CB2  87                  	add	a,a
     305.  00:4CB3  3C                  	inc	a
     306.  00:4CB4  87 87 87            [3]	add	a,a
     307.  00:4CB7  47                  	ld	b,a			; frame
     308.  00:4CB8                      	
     309.  00:4CB8  C3 CC 4C            	jp	1f
     310.  00:4CBB                      .pos
     311.  00:4CBB  11 C0 FF            	ld	de,-64
     312.  00:4CBE  0E 01               	ld	c,+1		; enemies going right
     313.  00:4CC0                      
     314.  00:4CC0  CD 15 4B            	call	rand8
     315.  00:4CC3  E6 07               	and	7
     316.  00:4CC5  C6 04               	add	a,4
     317.  00:4CC7  87 87 87 87         [4]	add	a,a
     318.  00:4CCB  47                  	ld	b,a			; frame
     319.  00:4CCC                      	
     320.  00:4CCC                      1:
     321.  00:4CCC  CD 15 4B            	call	rand8
     322.  00:4CCF  E6 0F               	and	15			; Y off set
     323.  00:4CD1  C6 90               	add	a,mapHeight*16-32
     324.  00:4CD3                      
     325.  00:4CD3  2A 44 CB            	ld	hl,(xmap)
     326.  00:4CD6  19                  	add	hl,de
     327.  00:4CD7                      
     328.  00:4CD7                      	; bit	7,b			; pick up a random bit from frame number
     329.  00:4CD7                      	; ld  ix,enemies1
     330.  00:4CD7                      	; ld	iyh,max_enem1
     331.  00:4CD7                      	; jr	z,1f
     332.  00:4CD7                      	; ld  ix,enemies2
     333.  00:4CD7                      	; ld	iyh,max_enem2
     334.  00:4CD7                      ; 1:
     335.  00:4CD7  DD 21 AB CB         	ld  ix,enemies
     336.  00:4CDB  FD 26 0C            	ld	iyh,max_enem
     337.  00:4CDE                      
     338.  00:4CDE  11 0F 00            	ld  de,enemy_data
     339.  00:4CE1                      1:
     340.  00:4CE1  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     341.  00:4CE5  20 36               	jr  nz,.next
     342.  00:4CE7                      
     343.  00:4CE7  DD 71 07            	ld  (ix+enemy_data.status),c
     344.  00:4CEA  DD 70 0A            	ld	(ix+enemy_data.frame),b
     345.  00:4CED                      
     346.  00:4CED  DD 36 09 02         	ld  (ix+enemy_data.kind),2
     347.  00:4CF1                      
     348.  00:4CF1  D9                  	exx	
     349.  00:4CF2  DD 73 0D            	ld	(ix+enemy_data.speed),e
     350.  00:4CF5  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     351.  00:4CF8  D9                  	exx
     352.  00:4CF9                      	
     353.  00:4CF9  C5                  	push	bc
     354.  00:4CFA  CB 47               	bit	0,a			; pick up a random bit from Y
     355.  00:4CFC  01 08 00            	ld 	bc,8
     356.  00:4CFF  28 03               	jr z,11f
     357.  00:4D01  01 F8 FF            	ld 	bc,-8
     358.  00:4D04  09                  11:	add hl,bc 
     359.  00:4D05  DD 75 01            	ld  (ix+enemy_data.x),l
     360.  00:4D08  DD 74 02            	ld  (ix+enemy_data.x+1),h
     361.  00:4D0B  C1                  	pop		bc
     362.  00:4D0C                      	
     363.  00:4D0C  DD 77 00            	ld  (ix+enemy_data.y),a
     364.  00:4D0F                      
     365.  00:4D0F  CD 60 48            	call	set_size
     366.  00:4D12                      
     367.  00:4D12  DD 19               	add ix,de
     368.  00:4D14  FD 25               	dec	iyh
     369.  00:4D16  C8                  	ret	z
     370.  00:4D17  D6 20               	sub	a,32
     371.  00:4D19  D2 E1 4C            	jp	nc,1b
     372.  00:4D1C  C9                  	ret
     373.  00:4D1D                      
     374.  00:4D1D                      .next
     375.  00:4D1D  DD 19               	add ix,de
     376.  00:4D1F  FD 25               	dec	iyh
     377.  00:4D21  C8                  	ret	z
     378.  00:4D22  18 BD               	jr	1b
     379.  00:4D24                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     380.  00:4D24                      ;
     381.  00:4D24                      ; waving enemies n#5 from back
     382.  00:4D24                      ;
     383.  00:4D24                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     384.  00:4D24                      wave3:
     385.  00:4D24  3A 43 CB            	ld	a,(dxmap)
     386.  00:4D27  CB 2F               	sra a			; de' = player speed x 2
     387.  00:4D29  F6 01               	or  1
     388.  00:4D2B  5F                  	ld	e,a
     389.  00:4D2C  17                  	rla
     390.  00:4D2D  9F                  	sbc a,a
     391.  00:4D2E  57                  	ld	d,a
     392.  00:4D2F  D9                  	exx
     393.  00:4D30                      
     394.  00:4D30  28 08               	jr	z,.pos				
     395.  00:4D32                      .neg
     396.  00:4D32  11 20 01            	ld	de,256+32
     397.  00:4D35  01 41 68            	ld	bc,256*(96+8)+1+64		; enemies going left
     398.  00:4D38  18 06               	jr	1f
     399.  00:4D3A                      .pos
     400.  00:4D3A  11 C0 FF            	ld	de,-64
     401.  00:4D3D  01 01 60            	ld	bc,256*96+1			; enemies going right
     402.  00:4D40                      	
     403.  00:4D40                      1:
     404.  00:4D40  CD 15 4B            	call	rand8
     405.  00:4D43  E6 0F               	and	15					; random Y offset
     406.  00:4D45  C6 80               	add	a,mapHeight*16-48
     407.  00:4D47                      	
     408.  00:4D47  2A 44 CB            	ld	hl,(xmap)
     409.  00:4D4A  19                  	add	hl,de
     410.  00:4D4B                      
     411.  00:4D4B                      	; bit	0,a			; pick up a random bit from Y offset
     412.  00:4D4B                      	; ld  ix,enemies1
     413.  00:4D4B                      	; ld	iyh,max_enem1
     414.  00:4D4B                      	; jr	z,1f
     415.  00:4D4B                      	; ld  ix,enemies2
     416.  00:4D4B                      	; ld	iyh,max_enem2
     417.  00:4D4B                      ; 1:
     418.  00:4D4B  DD 21 AB CB         	ld  ix,enemies
     419.  00:4D4F  FD 26 0C            	ld	iyh,max_enem
     420.  00:4D52  11 0F 00            	ld  de,enemy_data
     421.  00:4D55                      1:
     422.  00:4D55  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     423.  00:4D59  20 3A               	jr  nz,.next
     424.  00:4D5B                      
     425.  00:4D5B  DD 71 07            	ld  (ix+enemy_data.status),c
     426.  00:4D5E  DD 70 0A            	ld	(ix+enemy_data.frame),b
     427.  00:4D61                      
     428.  00:4D61  DD 36 09 05         	ld  (ix+enemy_data.kind),5
     429.  00:4D65  DD 36 08 00         	ld	(ix+enemy_data.cntr),0
     430.  00:4D69                      
     431.  00:4D69  D9                  	exx	
     432.  00:4D6A  DD 73 0D            	ld	(ix+enemy_data.speed),e
     433.  00:4D6D  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     434.  00:4D70  D9                  	exx
     435.  00:4D71                      	
     436.  00:4D71  C5                  	push	bc
     437.  00:4D72  CB 67               	bit	4,a
     438.  00:4D74  01 10 00            	ld bc,16
     439.  00:4D77  28 03               	jr	z,2f
     440.  00:4D79  01 F0 FF            	ld	bc,-16
     441.  00:4D7C                      2:	
     442.  00:4D7C  09                  	add hl,bc 
     443.  00:4D7D  DD 75 01            	ld  (ix+enemy_data.x),l
     444.  00:4D80  DD 74 02            	ld  (ix+enemy_data.x+1),h
     445.  00:4D83  C1                  	pop		bc
     446.  00:4D84                      	
     447.  00:4D84  DD 77 00            	ld  (ix+enemy_data.y),a
     448.  00:4D87                      
     449.  00:4D87  CD 60 48            	call	set_size
     450.  00:4D8A                      
     451.  00:4D8A  DD 19               	add ix,de
     452.  00:4D8C  FD 25               	dec	iyh
     453.  00:4D8E  C8                  	ret	z
     454.  00:4D8F  D6 18               	sub	a,24
     455.  00:4D91  D2 55 4D            	jp	nc,1b
     456.  00:4D94  C9                  	ret
     457.  00:4D95                      
     458.  00:4D95                      .next
     459.  00:4D95  DD 19               	add ix,de
     460.  00:4D97  FD 25               	dec	iyh
     461.  00:4D99  C8                  	ret	z
     462.  00:4D9A  18 B9               	jr	1b
     463.  00:4D9C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     464.  00:4D9C                      ;
     465.  00:4D9C                      ;	enemies n#4 coming from back
     466.  00:4D9C                      ; 
     467.  00:4D9C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     468.  00:4D9C                      wave4:
     469.  00:4D9C  3A 43 CB            	ld	a,(dxmap)
     470.  00:4D9F  CB 2F               	sra a			; de' = player speed x 1.5
     471.  00:4DA1  5F                  	ld	e,a
     472.  00:4DA2  07                  	RLCA
     473.  00:4DA3  9F                  	sbc a,a
     474.  00:4DA4  57                  	ld	d,a
     475.  00:4DA5  3A 43 CB            	ld	a,(dxmap)
     476.  00:4DA8  83                  	add	a,e
     477.  00:4DA9  5F                  	ld	e,a
     478.  00:4DAA  D9                  	exx
     479.  00:4DAB                      	
     480.  00:4DAB                      _wave4_cont:
     481.  00:4DAB                      
     482.  00:4DAB  F2 C2 4D            	jp	p,.pos				
     483.  00:4DAE                      .neg
     484.  00:4DAE  11 60 01            	ld	de,256+96
     485.  00:4DB1  0E 41               	ld	c,+1+64		; enemies going left
     486.  00:4DB3                      	
     487.  00:4DB3  CD 15 4B            	call	rand8
     488.  00:4DB6  E6 07               	and	7
     489.  00:4DB8  C6 04               	add	a,4
     490.  00:4DBA  87                  	add	a,a
     491.  00:4DBB  3C                  	inc	a
     492.  00:4DBC  87 87 87            [3]	add	a,a
     493.  00:4DBF  47                  	ld	b,a			; frame
     494.  00:4DC0                      
     495.  00:4DC0  18 11               	jr	1f
     496.  00:4DC2                      .pos
     497.  00:4DC2  11 80 FF            	ld	de,-128
     498.  00:4DC5  0E 01               	ld	c,+1		; enemies going right
     499.  00:4DC7                      
     500.  00:4DC7  CD 15 4B            	call	rand8
     501.  00:4DCA  E6 07               	and	7
     502.  00:4DCC  3E 04               	ld	a,4
     503.  00:4DCE  87 87 87 87         [4]	add	a,a
     504.  00:4DD2  47                  	ld	b,a			; frame
     505.  00:4DD3                      	
     506.  00:4DD3                      1:
     507.  00:4DD3  CD 15 4B            	call	rand8
     508.  00:4DD6  E6 0F               	and	15			; Y off set
     509.  00:4DD8                      
     510.  00:4DD8  CB 4F               	bit	1,a			; pick up a random bit from Y offset
     511.  00:4DDA  28 02               	jr	z,1f
     512.  00:4DDC  CB F9               	set	7,c			; go up instead of down
     513.  00:4DDE                      1:
     514.  00:4DDE                      		
     515.  00:4DDE  2A 44 CB            	ld	hl,(xmap)
     516.  00:4DE1  19                  	add	hl,de
     517.  00:4DE2                      
     518.  00:4DE2                      	; bit	0,a			; pick up a random bit from Y offset
     519.  00:4DE2                      	; ld  ix,enemies1
     520.  00:4DE2                      	; ld	iyh,max_enem1
     521.  00:4DE2                      	; jr	z,1f
     522.  00:4DE2                      	; ld  ix,enemies2
     523.  00:4DE2                      	; ld	iyh,max_enem2
     524.  00:4DE2                      ; 1:
     525.  00:4DE2  DD 21 AB CB         	ld  ix,enemies
     526.  00:4DE6  FD 26 0C            	ld	iyh,max_enem
     527.  00:4DE9  11 0F 00            	ld  de,enemy_data
     528.  00:4DEC                      1:
     529.  00:4DEC  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     530.  00:4DF0  20 37               	jr  nz,.next
     531.  00:4DF2                      
     532.  00:4DF2  DD 71 07            	ld  (ix+enemy_data.status),c
     533.  00:4DF5  DD 70 0A            	ld	(ix+enemy_data.frame),b
     534.  00:4DF8                      
     535.  00:4DF8  DD 36 09 04         	ld  (ix+enemy_data.kind),4
     536.  00:4DFC                      
     537.  00:4DFC  D9                  	exx	
     538.  00:4DFD  DD 73 0D            	ld	(ix+enemy_data.speed),e
     539.  00:4E00  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     540.  00:4E03  CB 7A               	bit	7,d
     541.  00:4E05  D9                  	exx
     542.  00:4E06                      	
     543.  00:4E06  C5                  	push	bc
     544.  00:4E07  01 10 00            	ld bc,16
     545.  00:4E0A  28 03               	jr	z,11f
     546.  00:4E0C  01 F0 FF            	ld bc,-16
     547.  00:4E0F  09                  11:	add hl,bc 
     548.  00:4E10  DD 75 01            	ld  (ix+enemy_data.x),l
     549.  00:4E13  DD 74 02            	ld  (ix+enemy_data.x+1),h
     550.  00:4E16  C1                  	pop		bc
     551.  00:4E17                      	
     552.  00:4E17  DD 77 00            	ld  (ix+enemy_data.y),a
     553.  00:4E1A  C6 18               	add	a,24
     554.  00:4E1C                      
     555.  00:4E1C  CD 60 48            	call	set_size
     556.  00:4E1F                      
     557.  00:4E1F  DD 19               	add ix,de
     558.  00:4E21  FD 25               	dec	iyh
     559.  00:4E23  C8                  	ret	z
     560.  00:4E24  FE A0               	cp	mapHeight*16-16
     561.  00:4E26  38 C4               	jr	c,1b
     562.  00:4E28  C9                  	ret
     563.  00:4E29                      
     564.  00:4E29                      .next
     565.  00:4E29  DD 19               	add ix,de
     566.  00:4E2B  FD 25               	dec	iyh
     567.  00:4E2D  C8                  	ret	z
     568.  00:4E2E  18 BC               	jr	1b
     569.  00:4E30                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     570.  00:4E30                      ;
     571.  00:4E30                      ; spinning enemy #6 
     572.  00:4E30                      ;
     573.  00:4E30                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     574.  00:4E30                      wave5:
     575.  00:4E30  3A 43 CB            	ld	a,(dxmap)
     576.  00:4E33  CB 2F               	sra a			; de' = player speed x 2
     577.  00:4E35  F6 01               	or  1
     578.  00:4E37  5F                  	ld	e,a
     579.  00:4E38  17                  	rla
     580.  00:4E39  9F                  	sbc a,a
     581.  00:4E3A  57                  	ld	d,a
     582.  00:4E3B  D9                  	exx
     583.  00:4E3C                      
     584.  00:4E3C  28 07               	jr	z,.pos				
     585.  00:4E3E                      .neg
     586.  00:4E3E  11 20 01            	ld	de,256+32
     587.  00:4E41  0E 41               	ld	c,+1+64		; enemies going left
     588.  00:4E43  18 05               	jr	1f
     589.  00:4E45                      .pos
     590.  00:4E45  11 C0 FF            	ld	de,-64
     591.  00:4E48  0E 01               	ld	c,+1		; enemies going right
     592.  00:4E4A                      	
     593.  00:4E4A                      1:
     594.  00:4E4A  CD 15 4B            	call	rand8
     595.  00:4E4D  E6 0F               	and	15
     596.  00:4E4F                      	
     597.  00:4E4F  CB 4F               	bit	1,a			; pick up a random bit from Y offset
     598.  00:4E51  28 02               	jr	z,1f
     599.  00:4E53  CB F9               	set	7,c			; go up instead of down
     600.  00:4E55                      1:
     601.  00:4E55                      	
     602.  00:4E55  2A 44 CB            	ld	hl,(xmap)
     603.  00:4E58  19                  	add	hl,de
     604.  00:4E59                      
     605.  00:4E59                      	; bit	0,a			; pick up a random bit from Y offset
     606.  00:4E59                      	; ld  ix,enemies1
     607.  00:4E59                      	; ld	iyh,max_enem1
     608.  00:4E59                      	; jr	z,1f
     609.  00:4E59                      	; ld  ix,enemies2
     610.  00:4E59                      	; ld	iyh,max_enem2
     611.  00:4E59                      ; 1:
     612.  00:4E59  DD 21 AB CB         	ld  ix,enemies
     613.  00:4E5D  FD 26 0C            	ld	iyh,max_enem
     614.  00:4E60  11 0F 00            	ld  de,enemy_data
     615.  00:4E63                      1:
     616.  00:4E63  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     617.  00:4E67  20 34               	jr  nz,.next
     618.  00:4E69                      
     619.  00:4E69  DD 71 07            	ld  (ix+enemy_data.status),c
     620.  00:4E6C  DD 36 09 06         	ld  (ix+enemy_data.kind),6
     621.  00:4E70                      
     622.  00:4E70  D9                  	exx	
     623.  00:4E71  DD 73 0D            	ld	(ix+enemy_data.speed),e
     624.  00:4E74  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     625.  00:4E77  CB 7A               	bit	7,d
     626.  00:4E79  D9                  	exx
     627.  00:4E7A                      	
     628.  00:4E7A  C5                  	push	bc
     629.  00:4E7B  01 10 00            	ld bc,16
     630.  00:4E7E  28 03               	jr	z,11f
     631.  00:4E80  01 F0 FF            	ld bc,-16
     632.  00:4E83  09                  11:	add hl,bc 
     633.  00:4E84  DD 75 01            	ld  (ix+enemy_data.x),l
     634.  00:4E87  DD 74 02            	ld  (ix+enemy_data.x+1),h
     635.  00:4E8A  C1                  	pop		bc
     636.  00:4E8B                      	
     637.  00:4E8B  DD 77 00            	ld  (ix+enemy_data.y),a
     638.  00:4E8E  C6 18               	add	a,24
     639.  00:4E90                      
     640.  00:4E90  CD 60 48            	call	set_size
     641.  00:4E93                      
     642.  00:4E93  DD 19               	add ix,de
     643.  00:4E95  FD 25               	dec	iyh
     644.  00:4E97  C8                  	ret	z
     645.  00:4E98  FE A0               	cp	mapHeight*16-16
     646.  00:4E9A  38 C7               	jr	c,1b
     647.  00:4E9C  C9                  	ret
     648.  00:4E9D                      
     649.  00:4E9D                      .next
     650.  00:4E9D  DD 19               	add ix,de
     651.  00:4E9F  FD 25               	dec	iyh
     652.  00:4EA1  C8                  	ret	z
     653.  00:4EA2  18 BF               	jr	1b
     654.  00:4EA4                      
     655.  00:4EA4                      
     656.  00:4EA4                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     657.  00:4EA4                      ;
     658.  00:4EA4                      ;	fixed enemies n#4 coming from back double speed
     659.  00:4EA4                      ;
     660.  00:4EA4                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     661.  00:4EA4                      wave6:
     662.  00:4EA4  3A 43 CB            	ld	a,(dxmap)
     663.  00:4EA7  5F                  	ld	e,a			; de' = player speed x 4
     664.  00:4EA8  17                  	rla
     665.  00:4EA9  9F                  	sbc a,a
     666.  00:4EAA  57                  	ld	d,a
     667.  00:4EAB  D9                  	exx
     668.  00:4EAC  C3 AB 4D            	jp _wave4_cont
     669.  00:4EAF                      	
     670.  00:4EAF                      
     671.  00:4EAF                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     672.  00:4EAF                      ;
     673.  00:4EAF                      ;  enemies n#7 (spinning)  coming from back double speed
     674.  00:4EAF                      ;
     675.  00:4EAF                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     676.  00:4EAF                      wave7:
     677.  00:4EAF  3A 43 CB            	ld	a,(dxmap)
     678.  00:4EB2  CB 2F               	sra a			; de' = player speed x 1.5
     679.  00:4EB4  5F                  	ld	e,a
     680.  00:4EB5  07                  	RLCA
     681.  00:4EB6  9F                  	sbc a,a
     682.  00:4EB7  57                  	ld	d,a
     683.  00:4EB8  3A 43 CB            	ld	a,(dxmap)
     684.  00:4EBB  83                  	add	a,e
     685.  00:4EBC  5F                  	ld	e,a
     686.  00:4EBD  D9                  	exx
     687.  00:4EBE                      
     688.  00:4EBE  F2 C8 4E            	jp	p,.pos				
     689.  00:4EC1                      .neg
     690.  00:4EC1  11 70 01            	ld	de,256+112
     691.  00:4EC4  0E 41               	ld	c,1+64				; enemies going left
     692.  00:4EC6  18 05               	jr	1f
     693.  00:4EC8                      .pos
     694.  00:4EC8  11 80 FF            	ld	de,-128
     695.  00:4ECB  0E 01               	ld	c,+1				; enemies going right
     696.  00:4ECD                      	
     697.  00:4ECD                      1:
     698.  00:4ECD  CD 15 4B            	call	rand8
     699.  00:4ED0  E6 0F               	and	15			; Y off set
     700.  00:4ED2                      
     701.  00:4ED2  2A 44 CB            	ld	hl,(xmap)
     702.  00:4ED5  19                  	add	hl,de
     703.  00:4ED6                      
     704.  00:4ED6                      	; bit	0,a			; pick up a random bit from Y offset
     705.  00:4ED6                      	; ld  ix,enemies1
     706.  00:4ED6                      	; ld	iyh,max_enem1
     707.  00:4ED6                      	; jr	z,1f
     708.  00:4ED6                      	; ld  ix,enemies2
     709.  00:4ED6                      	; ld	iyh,max_enem2
     710.  00:4ED6                      ; 1:
     711.  00:4ED6  DD 21 AB CB         	ld  ix,enemies
     712.  00:4EDA  FD 26 0C            	ld	iyh,max_enem
     713.  00:4EDD  11 0F 00            	ld  de,enemy_data
     714.  00:4EE0                      1:
     715.  00:4EE0  DD CB 07 46         	bit	0,(ix+enemy_data.status)
     716.  00:4EE4  20 30               	jr  nz,.next
     717.  00:4EE6                      
     718.  00:4EE6  DD 71 07            	ld  (ix+enemy_data.status),c
     719.  00:4EE9                      
     720.  00:4EE9  DD 36 09 07         	ld  (ix+enemy_data.kind),7
     721.  00:4EED                      	
     722.  00:4EED  D9                  	exx	
     723.  00:4EEE  DD 73 0D            	ld	(ix+enemy_data.speed),e
     724.  00:4EF1  DD 72 0E            	ld	(ix+enemy_data.speed+1),d
     725.  00:4EF4  D9                  	exx
     726.  00:4EF5                      	
     727.  00:4EF5  C5                  	push	bc
     728.  00:4EF6  01 10 00            	ld bc,16
     729.  00:4EF9  09                  	add hl,bc 
     730.  00:4EFA  DD 75 01            	ld  (ix+enemy_data.x),l
     731.  00:4EFD  DD 74 02            	ld  (ix+enemy_data.x+1),h
     732.  00:4F00  DD 75 08            	ld	(ix+enemy_data.cntr),l
     733.  00:4F03  C1                  	pop		bc
     734.  00:4F04                      	
     735.  00:4F04  DD 77 00            	ld  (ix+enemy_data.y),a
     736.  00:4F07  C6 18               	add	a,24
     737.  00:4F09                      
     738.  00:4F09  CD 60 48            	call	set_size
     739.  00:4F0C                      
     740.  00:4F0C  DD 19               	add ix,de
     741.  00:4F0E  FD 25               	dec	iyh
     742.  00:4F10  C8                  	ret	z
     743.  00:4F11  FE A0               	cp	mapHeight*16-16
     744.  00:4F13  38 CB               	jr	c,1b
     745.  00:4F15  C9                  	ret
     746.  00:4F16                      
     747.  00:4F16                      .next
     748.  00:4F16  DD 19               	add ix,de
     749.  00:4F18  FD 25               	dec	iyh
     750.  00:4F1A  C8                  	ret	z
     751.  00:4F1B  18 C3               	jr	1b
     752.  00:4F1D                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     753.  00:4F1D                      ;
     754.  00:4F1D                      ;   logic for enemies 
     755.  00:4F1D                      ;
     756.  00:4F1D                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     757.  00:4F1D                      
     758.  00:4F1D                      npc_loop:
     759.  00:4F1D  DD 21 AB CB         	ld  ix,enemies
     760.  00:4F21  06 0C               	ld  b,max_enem
     761.  00:4F23                      
     762.  00:4F23  C5                  1:	push	bc
     763.  00:4F24  DD 7E 07            	ld  a,(ix+enemy_data.status)
     764.  00:4F27  E6 01               	and 1
     765.  00:4F29  28 22               	jr  z,next
     766.  00:4F2B                      
     767.  00:4F2B  DD 7E 09            	ld	a,(ix+enemy_data.kind)
     768.  00:4F2E  A7                  	and	a
     769.  00:4F2F  CA 99 4F            	jp	z,enemy0
     770.  00:4F32  3D 3D               [2]	dec a	
     771.  00:4F34  CA F4 4F            	jp 	z,enemy2
     772.  00:4F37  3D 3D               [2]	dec a	
     773.  00:4F39  CA 48 50            	jp 	z,enemy4
     774.  00:4F3C  3D                  	dec a			;cp	5
     775.  00:4F3D  CA 40 52            	jp 	z,enemy5
     776.  00:4F40  3D                  	dec a			;cp	6
     777.  00:4F41  CA A7 52            	jp 	z,enemy6
     778.  00:4F44  3D                  	dec a			;cp	7
     779.  00:4F45  CA 2D 53            	jp 	z,enemy7
     780.  00:4F48                      
     781.  00:4F48  FE F8               	cp	255-7
     782.  00:4F4A  CA 7D 4F            	jp z,enemy255
     783.  00:4F4D                      
     784.  00:4F4D                      next:
     785.  00:4F4D  C1                  	pop	bc
     786.  00:4F4E  11 0F 00            	ld  de,enemy_data
     787.  00:4F51  DD 19               	add ix,de
     788.  00:4F53  10 CE               	djnz    1b
     789.  00:4F55  C9                  	ret
     790.  00:4F56                      ;;;;;;;;;;;;;;;;;;;;
     791.  00:4F56                      npcdies:
     792.  00:4F56  FD 36 07 00         	ld  (iy+enemy_data.status),0	; turn off this bullet
     793.  00:4F5A                      
     794.  00:4F5A  DD 36 0B 0A         	ld	(ix+enemy_data.color),10	; start explosion
     795.  00:4F5E  DD 36 09 FF         	ld	(ix+enemy_data.kind),255
     796.  00:4F62  DD 36 08 02         	ld	(ix+enemy_data.cntr),2
     797.  00:4F66  DD 36 0A 0C         	ld	(ix+enemy_data.frame),12
     798.  00:4F6A                      
     799.  00:4F6A  CD 15 4B            	call	rand8
     800.  00:4F6D  E6 03               	and	3
     801.  00:4F6F  C6 02               	add	a,2			; random enemy explosion
     802.  00:4F71  CD F4 56            	call AFXPLAY
     803.  00:4F74                      
     804.  00:4F74  01 64 00            	ld	bc,100		; score for destruction of a flying enemy
     805.  00:4F77  CD 0B 4B            	call	add_bc_score_bin
     806.  00:4F7A  C3 4D 4F            	jp	next
     807.  00:4F7D                      	
     808.  00:4F7D                      ;;;;;;;;;;;;;;;;;;;;
     809.  00:4F7D                      ; explosion
     810.  00:4F7D                      ;;;;;;;;;;;;;;;;;;;;
     811.  00:4F7D                      enemy255:
     812.  00:4F7D  DD 35 08            	dec	(ix+enemy_data.cntr)
     813.  00:4F80  C2 4D 4F            	jp	nz,next
     814.  00:4F83  DD 36 08 02         	ld	(ix+enemy_data.cntr),2
     815.  00:4F87  DD 34 0A            	inc	(ix+enemy_data.frame)
     816.  00:4F8A  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     817.  00:4F8D  FE 1B               	cp	31-4
     818.  00:4F8F  DA 4D 4F            	jp	c,next
     819.  00:4F92  DD 36 07 00         	ld	(ix+enemy_data.status),0
     820.  00:4F96  C3 4D 4F            	jp	next
     821.  00:4F99                      
     822.  00:4F99                      ;;;;;;;;;;;;;;;;;;;;
     823.  00:4F99                      
     824.  00:4F99                      enemy0:
     825.  00:4F99                      enemy1:
     826.  00:4F99  DD CB 07 76         	bit 6,(ix+enemy_data.status)
     827.  00:4F9D  28 23               	jr  z,.go_right
     828.  00:4F9F                      .go_left:
     829.  00:4F9F                      
     830.  00:4F9F  DD 6E 01            	ld	l,(ix+enemy_data.x)
     831.  00:4FA2  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     832.  00:4FA5  2B                  	dec	hl
     833.  00:4FA6  DD 75 01            	ld  (ix+enemy_data.x),l
     834.  00:4FA9  DD 74 02            	ld  (ix+enemy_data.x+1),h
     835.  00:4FAC  ED 5B 44 CB         	ld	de,(xmap)
     836.  00:4FB0  A7                  	and	a
     837.  00:4FB1  ED 52               	sbc	hl,de
     838.  00:4FB3  11 E0 FF            	ld	de,-32
     839.  00:4FB6  A7                  	and	a
     840.  00:4FB7  ED 52               	sbc	hl,de
     841.  00:4FB9  F2 E3 4F            	jp  p,1f
     842.  00:4FBC  DD 36 07 00         	ld	(ix+enemy_data.status),0
     843.  00:4FC0  18 21               	jr  1f
     844.  00:4FC2                      
     845.  00:4FC2                      .go_right:
     846.  00:4FC2                      
     847.  00:4FC2  DD 6E 01            	ld	l,(ix+enemy_data.x)
     848.  00:4FC5  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     849.  00:4FC8  23                  	inc	hl
     850.  00:4FC9  DD 75 01            	ld  (ix+enemy_data.x),l
     851.  00:4FCC  DD 74 02            	ld  (ix+enemy_data.x+1),h
     852.  00:4FCF  ED 5B 44 CB         	ld	de,(xmap)
     853.  00:4FD3  A7                  	and	a
     854.  00:4FD4  ED 52               	sbc	hl,de
     855.  00:4FD6  11 20 01            	ld	de,256+32
     856.  00:4FD9  A7                  	and	a
     857.  00:4FDA  ED 52               	sbc	hl,de
     858.  00:4FDC  FA E3 4F            	jp  m,1f
     859.  00:4FDF  DD 36 07 00         	ld	(ix+enemy_data.status),0
     860.  00:4FE3                      1:
     861.  00:4FE3  CD 15 4B            	call	rand8
     862.  00:4FE6  E6 7F               	and 	127
     863.  00:4FE8  CC A7 53            	call	z,book_enemy_shoot
     864.  00:4FEB                      
     865.  00:4FEB  CD 25 49            	call	test_collision_msbullets
     866.  00:4FEE  D2 4D 4F            	jp	nc,next
     867.  00:4FF1  C3 56 4F            	jp	npcdies
     868.  00:4FF4                      
     869.  00:4FF4                      ;;;;;;;;;;;;;;;;;;;;
     870.  00:4FF4                      enemy2:
     871.  00:4FF4                      enemy3:
     872.  00:4FF4  DD 6E 01            	ld	l,(ix+enemy_data.x)
     873.  00:4FF7  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     874.  00:4FFA  DD 5E 0D            	ld	e,(ix+enemy_data.speed)
     875.  00:4FFD  DD 56 0E            	ld	d,(ix+enemy_data.speed+1)
     876.  00:5000  19                  	add	hl,de
     877.  00:5001  DD 75 01            	ld  (ix+enemy_data.x),l
     878.  00:5004  DD 74 02            	ld  (ix+enemy_data.x+1),h
     879.  00:5007                      	
     880.  00:5007  DD CB 07 76         	bit 6,(ix+enemy_data.status)
     881.  00:500B  28 16               	jr  z,.go_right
     882.  00:500D                      .go_left:
     883.  00:500D                      
     884.  00:500D  ED 5B 44 CB         	ld	de,(xmap)
     885.  00:5011  A7                  	and	a
     886.  00:5012  ED 52               	sbc	hl,de
     887.  00:5014  11 E0 FF            	ld	de,-32
     888.  00:5017  A7                  	and	a
     889.  00:5018  ED 52               	sbc	hl,de
     890.  00:501A  F2 37 50            	jp  p,1f
     891.  00:501D  DD 36 07 00         	ld	(ix+enemy_data.status),0
     892.  00:5021  18 14               	jr  1f
     893.  00:5023                      
     894.  00:5023                      .go_right:
     895.  00:5023                      
     896.  00:5023  ED 5B 44 CB         	ld	de,(xmap)
     897.  00:5027  A7                  	and	a
     898.  00:5028  ED 52               	sbc	hl,de
     899.  00:502A  11 20 01            	ld	de,256+32
     900.  00:502D  A7                  	and	a
     901.  00:502E  ED 52               	sbc	hl,de
     902.  00:5030  FA 37 50            	jp  m,1f
     903.  00:5033  DD 36 07 00         	ld	(ix+enemy_data.status),0
     904.  00:5037                      1:
     905.  00:5037  CD 15 4B            	call	rand8
     906.  00:503A  E6 7F               	and 	127
     907.  00:503C  CC A7 53            	call	z,book_enemy_shoot
     908.  00:503F                      
     909.  00:503F  CD 25 49            	call	test_collision_msbullets
     910.  00:5042  D2 4D 4F            	jp	nc,next
     911.  00:5045  C3 56 4F            	jp 	npcdies
     912.  00:5048                      	
     913.  00:5048                      	
     914.  00:5048                      ;;;;;;;;;;;;;;;;;;;;
     915.  00:5048                      enemy4:
     916.  00:5048  DD 6E 01            	ld	l,(ix+enemy_data.x)
     917.  00:504B  DD 66 02            	ld	h,(ix+enemy_data.x+1)
     918.  00:504E  DD 5E 0D            	ld	e,(ix+enemy_data.speed)
     919.  00:5051  DD 56 0E            	ld	d,(ix+enemy_data.speed+1)
     920.  00:5054  19                  	add	hl,de
     921.  00:5055  DD 75 01            	ld  (ix+enemy_data.x),l
     922.  00:5058  DD 74 02            	ld  (ix+enemy_data.x+1),h
     923.  00:505B                      	
     924.  00:505B  DD CB 07 76         	bit 6,(ix+enemy_data.status)
     925.  00:505F  28 16               	jr  z,.go_right
     926.  00:5061                      .go_left:
     927.  00:5061                      
     928.  00:5061  ED 5B 44 CB         	ld	de,(xmap)
     929.  00:5065  A7                  	and	a
     930.  00:5066  ED 52               	sbc	hl,de
     931.  00:5068  11 E0 FF            	ld	de,-32
     932.  00:506B  A7                  	and	a
     933.  00:506C  ED 52               	sbc	hl,de
     934.  00:506E  F2 8B 50            	jp  p,1f
     935.  00:5071  DD 36 07 00         	ld	(ix+enemy_data.status),0
     936.  00:5075  18 14               	jr  1f
     937.  00:5077                      
     938.  00:5077                      .go_right:
     939.  00:5077                      
     940.  00:5077  ED 5B 44 CB         	ld	de,(xmap)
     941.  00:507B  A7                  	and	a
     942.  00:507C  ED 52               	sbc	hl,de
     943.  00:507E  11 20 01            	ld	de,256+32
     944.  00:5081  A7                  	and	a
     945.  00:5082  ED 52               	sbc	hl,de
     946.  00:5084  FA 8B 50            	jp  m,1f
     947.  00:5087  DD 36 07 00         	ld	(ix+enemy_data.status),0
     948.  00:508B                      1:
     949.  00:508B  DD 7E 00            	ld	a,(ix+enemy_data.y)
     950.  00:508E                      
     951.  00:508E  DD CB 07 7E         	bit 7,(ix+enemy_data.status)
     952.  00:5092  28 0A               	jr  z,.go_dwn
     953.  00:5094                      .go_up:
     954.  00:5094  3D                  	dec	a
     955.  00:5095  C2 A7 50            	jp	nz,1f
     956.  00:5098  DD CB 07 BE         	res	7,(ix+enemy_data.status)
     957.  00:509C  18 09               	jr	1f
     958.  00:509E                      .go_dwn:
     959.  00:509E  3C                  	inc	a
     960.  00:509F  FE A0               	cp	mapHeight*16-16
     961.  00:50A1  20 04               	jr	nz,1f
     962.  00:50A3  DD CB 07 FE         	set	7,(ix+enemy_data.status)
     963.  00:50A7                      	; jr	1f
     964.  00:50A7                      1:
     965.  00:50A7  DD 77 00            	ld	(ix+enemy_data.y),a
     966.  00:50AA                      
     967.  00:50AA  CD 15 4B            	call	rand8
     968.  00:50AD  E6 7F               	and 	127
     969.  00:50AF  CC A7 53            	call	z,book_enemy_shoot
     970.  00:50B2                      
     971.  00:50B2  CD 25 49            	call	test_collision_msbullets
     972.  00:50B5  D2 4D 4F            	jp	nc,next
     973.  00:50B8  C3 56 4F            	jp 	npcdies
     974.  00:50BB                      	
     975.  00:50BB                      	
     976.  00:50BB                      ;;;;;;;;;;;;;;;;;;;;
     977.  00:50BB  (0045)              	align 0x100
     978.  00:5100                      rotation:
     979.  00:5100  00 10 20 30         	db 0,16,32,48;,48,32,16,0
     980.  00:5104                      ;;;;;;;;;;
     981.  00:5104                      rotate:
     982.  00:5104  DD 7E 08            	ld	a,(ix+enemy_data.cntr)
     983.  00:5107  3C                  	inc a
     984.  00:5108  DD 77 08            	ld	(ix+enemy_data.cntr),a
     985.  00:510B  D9                  	exx
     986.  00:510C  26 51               	ld h, high rotation
     987.  00:510E  0F 0F 0F 0F         [4]	rrca
     988.  00:5112  E6 03               	and 3
     989.  00:5114  6F                  	ld	l,a
     990.  00:5115  7E                  	ld a,(hl)
     991.  00:5116  D9                  	exx
     992.  00:5117  C9                  	ret
     993.  00:5118                      	
     994.  00:5118                      
     995.  00:5118  (00E8)              	align 0x100
     996.  00:5200                      sinewave:
     997.  00:5200                      	db 2,1,2,1,2,1,1,1,1,1,1,1,0,1,0,0,0,0,-1,0,-1,-1,-1,-1,-1,-1,-1,-2,-1,-2,-1,-2,-2,-1,-2,-1,-2,-1,-1,-1,-1,-1,-1,-1,0,-1,0,0,0,0,1,0,1,1,1,1,1,1,1,2,1,2,1,2
     997.  00:5200  02 01 02 01 02 01 01 01 01 01 01 01 00 01 00 00 
     997.  00:5210  00 00 FF 00 FF FF FF FF FF FF FF FE FF FE FF FE 
     997.  00:5220  FE FF FE FF FE FF FF FF FF FF FF FF 00 FF 00 00 
     997.  00:5230  00 00 01 00 01 01 01 01 01 01 01 02 01 02 01 02 
     998.  00:5240                      
     999.  00:5240                      	
    1000.  00:5240                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1001.  00:5240                      enemy5:
    1002.  00:5240  DD 6E 01            	ld	l,(ix+enemy_data.x)
    1003.  00:5243  DD 66 02            	ld	h,(ix+enemy_data.x+1)
    1004.  00:5246  DD 5E 0D            	ld	e,(ix+enemy_data.speed)
    1005.  00:5249  DD 56 0E            	ld	d,(ix+enemy_data.speed+1)
    1006.  00:524C  19                  	add	hl,de
    1007.  00:524D  DD 75 01            	ld  (ix+enemy_data.x),l
    1008.  00:5250  DD 74 02            	ld  (ix+enemy_data.x+1),h
    1009.  00:5253                      	
    1010.  00:5253  DD CB 07 76         	bit 6,(ix+enemy_data.status)
    1011.  00:5257  28 16               	jr  z,.go_right
    1012.  00:5259                      .go_left:
    1013.  00:5259                      
    1014.  00:5259  ED 5B 44 CB         	ld	de,(xmap)
    1015.  00:525D  A7                  	and	a
    1016.  00:525E  ED 52               	sbc	hl,de
    1017.  00:5260  11 E0 FF            	ld	de,-32
    1018.  00:5263  A7                  	and	a
    1019.  00:5264  ED 52               	sbc	hl,de
    1020.  00:5266  F2 83 52            	jp  p,1f
    1021.  00:5269  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1022.  00:526D  18 14               	jr  1f
    1023.  00:526F                      
    1024.  00:526F                      .go_right:
    1025.  00:526F                      
    1026.  00:526F  ED 5B 44 CB         	ld	de,(xmap)
    1027.  00:5273  A7                  	and	a
    1028.  00:5274  ED 52               	sbc	hl,de
    1029.  00:5276  11 20 01            	ld	de,256+32
    1030.  00:5279  A7                  	and	a
    1031.  00:527A  ED 52               	sbc	hl,de
    1032.  00:527C  FA 83 52            	jp  m,1f
    1033.  00:527F  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1034.  00:5283                      1:
    1035.  00:5283                      
    1036.  00:5283  DD 7E 08            	ld	a,(ix+enemy_data.cntr)
    1037.  00:5286  3C                  	inc	a
    1038.  00:5287  DD 77 08            	ld	(ix+enemy_data.cntr),a
    1039.  00:528A  E6 3F               	and	63
    1040.  00:528C  6F                  	ld	l,a
    1041.  00:528D  26 52               	ld	h,high sinewave
    1042.  00:528F  7E                  	ld	a,(hl)
    1043.  00:5290  DD 86 00            	add	a,(ix+enemy_data.y)
    1044.  00:5293  DD 77 00            	ld	(ix+enemy_data.y),a
    1045.  00:5296                      	
    1046.  00:5296  CD 15 4B            	call	rand8
    1047.  00:5299  E6 7F               	and	127
    1048.  00:529B  CC A7 53            	call	z,book_enemy_shoot
    1049.  00:529E                      
    1050.  00:529E  CD 25 49            	call	test_collision_msbullets
    1051.  00:52A1  D2 4D 4F            	jp	nc,next
    1052.  00:52A4  C3 56 4F            	jp 	npcdies
    1053.  00:52A7                      
    1054.  00:52A7                      
    1055.  00:52A7                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1056.  00:52A7                      enemy6:
    1057.  00:52A7  DD 6E 01            	ld	l,(ix+enemy_data.x)
    1058.  00:52AA  DD 66 02            	ld	h,(ix+enemy_data.x+1)
    1059.  00:52AD  DD 5E 0D            	ld	e,(ix+enemy_data.speed)
    1060.  00:52B0  DD 56 0E            	ld	d,(ix+enemy_data.speed+1)
    1061.  00:52B3  19                  	add	hl,de
    1062.  00:52B4  DD 75 01            	ld  (ix+enemy_data.x),l
    1063.  00:52B7  DD 74 02            	ld  (ix+enemy_data.x+1),h
    1064.  00:52BA                      	
    1065.  00:52BA  DD CB 07 76         	bit 6,(ix+enemy_data.status)
    1066.  00:52BE  28 1E               	jr  z,.go_right
    1067.  00:52C0                      .go_left:
    1068.  00:52C0  CD 04 51            	call	rotate
    1069.  00:52C3  C6 C8               	add	a,192+8
    1070.  00:52C5  DD 77 0A            	ld	(ix+enemy_data.frame),a
    1071.  00:52C8                      	
    1072.  00:52C8  ED 5B 44 CB         	ld	de,(xmap)
    1073.  00:52CC  A7                  	and	a
    1074.  00:52CD  ED 52               	sbc	hl,de
    1075.  00:52CF  11 E0 FF            	ld	de,-32
    1076.  00:52D2  A7                  	and	a
    1077.  00:52D3  ED 52               	sbc	hl,de
    1078.  00:52D5  F2 FA 52            	jp  p,1f
    1079.  00:52D8  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1080.  00:52DC  18 1C               	jr  1f
    1081.  00:52DE                      
    1082.  00:52DE                      .go_right:
    1083.  00:52DE  CD 04 51            	call	rotate
    1084.  00:52E1  C6 C0               	add	a,192
    1085.  00:52E3  DD 77 0A            	ld	(ix+enemy_data.frame),a
    1086.  00:52E6                      
    1087.  00:52E6  ED 5B 44 CB         	ld	de,(xmap)
    1088.  00:52EA  A7                  	and	a
    1089.  00:52EB  ED 52               	sbc	hl,de
    1090.  00:52ED  11 20 01            	ld	de,256+32
    1091.  00:52F0  A7                  	and	a
    1092.  00:52F1  ED 52               	sbc	hl,de
    1093.  00:52F3  FA FA 52            	jp  m,1f
    1094.  00:52F6  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1095.  00:52FA                      1:
    1096.  00:52FA  CD 60 48            	call	set_size	; size varies with frame
    1097.  00:52FD                      		
    1098.  00:52FD  DD 7E 00            	ld	a,(ix+enemy_data.y)
    1099.  00:5300                      
    1100.  00:5300  DD CB 07 7E         	bit 7,(ix+enemy_data.status)
    1101.  00:5304  28 0A               	jr  z,.go_dwn
    1102.  00:5306                      .go_up:
    1103.  00:5306  3D                  	dec	a
    1104.  00:5307  C2 19 53            	jp	nz,1f
    1105.  00:530A  DD CB 07 BE         	res	7,(ix+enemy_data.status)
    1106.  00:530E  18 09               	jr	1f
    1107.  00:5310                      .go_dwn:
    1108.  00:5310  3C                  	inc	a
    1109.  00:5311  FE A0               	cp	mapHeight*16-16
    1110.  00:5313  20 04               	jr	nz,1f
    1111.  00:5315  DD CB 07 FE         	set	7,(ix+enemy_data.status)
    1112.  00:5319                      1:
    1113.  00:5319  DD 77 00            	ld	(ix+enemy_data.y),a
    1114.  00:531C                      
    1115.  00:531C  CD 15 4B            	call	rand8
    1116.  00:531F  E6 7F               	and 	127
    1117.  00:5321  CC A7 53            	call	z,book_enemy_shoot
    1118.  00:5324                      
    1119.  00:5324  CD 25 49            	call	test_collision_msbullets
    1120.  00:5327  D2 4D 4F            	jp	nc,next
    1121.  00:532A  C3 56 4F            	jp	npcdies
    1122.  00:532D                      	
    1123.  00:532D                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1124.  00:532D                      enemy7:	
    1125.  00:532D  DD 6E 01            	ld	l,(ix+enemy_data.x)
    1126.  00:5330  DD 66 02            	ld	h,(ix+enemy_data.x+1)
    1127.  00:5333  DD 5E 0D            	ld	e,(ix+enemy_data.speed)
    1128.  00:5336  DD 56 0E            	ld	d,(ix+enemy_data.speed+1)
    1129.  00:5339  19                  	add	hl,de
    1130.  00:533A  DD 75 01            	ld  (ix+enemy_data.x),l
    1131.  00:533D  DD 74 02            	ld  (ix+enemy_data.x+1),h
    1132.  00:5340                      	
    1133.  00:5340  DD CB 07 76         	bit 6,(ix+enemy_data.status)
    1134.  00:5344  28 1E               	jr  z,.go_right
    1135.  00:5346                      .go_left:
    1136.  00:5346  CD 04 51            	call	rotate
    1137.  00:5349  C6 C8               	add	a,192+8
    1138.  00:534B  DD 77 0A            	ld	(ix+enemy_data.frame),a
    1139.  00:534E                      
    1140.  00:534E  ED 5B 44 CB         	ld	de,(xmap)
    1141.  00:5352  A7                  	and	a
    1142.  00:5353  ED 52               	sbc	hl,de
    1143.  00:5355  11 E0 FF            	ld	de,-32
    1144.  00:5358  A7                  	and	a
    1145.  00:5359  ED 52               	sbc	hl,de
    1146.  00:535B  F2 80 53            	jp  p,1f
    1147.  00:535E  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1148.  00:5362  18 1C               	jr  1f
    1149.  00:5364                      
    1150.  00:5364                      .go_right:
    1151.  00:5364  CD 04 51            	call	rotate
    1152.  00:5367  C6 C0               	add	a,192
    1153.  00:5369  DD 77 0A            	ld	(ix+enemy_data.frame),a
    1154.  00:536C                      	
    1155.  00:536C  ED 5B 44 CB         	ld	de,(xmap)
    1156.  00:5370  A7                  	and	a
    1157.  00:5371  ED 52               	sbc	hl,de
    1158.  00:5373  11 20 01            	ld	de,256+32
    1159.  00:5376  A7                  	and	a
    1160.  00:5377  ED 52               	sbc	hl,de
    1161.  00:5379  FA 80 53            	jp  m,1f
    1162.  00:537C  DD 36 07 00         	ld	(ix+enemy_data.status),0
    1163.  00:5380                      1:
    1164.  00:5380  CD 60 48            	call	set_size	; size varies with frame
    1165.  00:5383                      
    1166.  00:5383  DD 7E 08            	ld	a,(ix+enemy_data.cntr)
    1167.  00:5386  3C                  	inc	a
    1168.  00:5387  DD 77 08            	ld	(ix+enemy_data.cntr),a
    1169.  00:538A  E6 3F               	and	63
    1170.  00:538C  6F                  	ld	l,a
    1171.  00:538D  26 52               	ld	h,high sinewave
    1172.  00:538F  7E                  	ld	a,(hl)
    1173.  00:5390  DD 86 00            	add	a,(ix+enemy_data.y)
    1174.  00:5393  DD 77 00            	ld	(ix+enemy_data.y),a
    1175.  00:5396                      
    1176.  00:5396  CD 15 4B            	call	rand8
    1177.  00:5399  E6 7F               	and 	127
    1178.  00:539B  CC A7 53            	call	z,book_enemy_shoot
    1179.  00:539E                      
    1180.  00:539E  CD 25 49            	call	test_collision_msbullets
    1181.  00:53A1  D2 4D 4F            	jp	nc,next
    1182.  00:53A4  C3 56 4F            	jp 	npcdies
    1183.  00:53A7                      	
    1184.  00:53A7                      
    1185.  00:53A7                      
    1186.  00:53A7                      ; enemy3:
    1187.  00:53A7                      	; bit 6,(ix+enemy_data.status)
    1188.  00:53A7                      	; jr  z,.go_right
    1189.  00:53A7                      ; .go_left:
    1190.  00:53A7                      	; call	rotate
    1191.  00:53A7                      	; add	a,224
    1192.  00:53A7                      	; ld	(ix+enemy_data.frame),a
    1193.  00:53A7                      	; dec (ix+enemy_data.x)
    1194.  00:53A7                      	; ld  a,64-1
    1195.  00:53A7                      	; cp  (ix+enemy_data.x)
    1196.  00:53A7                      	; jr  nz,1f
    1197.  00:53A7                      	; res 6,(ix+enemy_data.status)
    1198.  00:53A7                      	; jr  1f
    1199.  00:53A7                      ; .go_right:
    1200.  00:53A7                      	; call	rotate
    1201.  00:53A7                      	; add	a,240
    1202.  00:53A7                      	; ld	(ix+enemy_data.frame),a
    1203.  00:53A7                      	; inc (ix+enemy_data.x)
    1204.  00:53A7                      	; ld  a,192-16
    1205.  00:53A7                      	; cp  (ix+enemy_data.x)
    1206.  00:53A7                      	; jr  nz,1f
    1207.  00:53A7                      	; set 6,(ix+enemy_data.status)
    1208.  00:53A7                      ; 1:
    1209.  00:53A7                      	; ld	(ix+enemy_data.color),14
    1210.  00:53A7                      	; jp	next
    1211.  00:53A7                      
    1212.  00:53A7                      
    1213.  00:53A7                      
    1214.  00:53A7                      
    1215.  00:53A7                      ; in
    1216.  00:53A7                      ;	IX -> enemy ship
    1217.  00:53A7                      ; out
    1218.  00:53A7                      ;	active bullet in list enem_bullets
    1219.  00:53A7                      
    1220.  00:53A7                      book_enemy_shoot:
    1221.  00:53A7                      	; aim to the manta
    1222.  00:53A7  0E 20               	ld	c,32
    1223.  00:53A9  59                  	ld	e,c
    1224.  00:53AA  3A 48 CB            	ld	a,(yship)
    1225.  00:53AD  47                  	ld	b,a
    1226.  00:53AE  DD 56 00            	ld	d,(ix+enemy_data.y)
    1227.  00:53B1  CD 84 49            	call	CollisionCheck_8b
    1228.  00:53B4  D0                  	ret		nc
    1229.  00:53B5                      
    1230.  00:53B5                      	; avoid shooting from outside the screen	
    1231.  00:53B5  06 00               	ld	b,0
    1232.  00:53B7  DD 6E 01            	ld	l,(ix+enemy_data.x)
    1233.  00:53BA  DD 66 02            	ld	h,(ix+enemy_data.x+1)
    1234.  00:53BD  DD 4E 03            	ld 	c,(ix+enemy_data.xoff)
    1235.  00:53C0  09                  	add hl,bc
    1236.  00:53C1  DD 46 05            	ld 	b,(ix+enemy_data.xsize)
    1237.  00:53C4                      	
    1238.  00:53C4  ED 5B 44 CB         	ld	de,(xmap)
    1239.  00:53C8  0E FF               	ld 	c,255
    1240.  00:53CA  CD 74 49            	call	CalcCollision
    1241.  00:53CD  D0                  	ret		nc
    1242.  00:53CE                      	
    1243.  00:53CE                      
    1244.  00:53CE  FD 21 7E CB         	ld  iy,enem_bullets
    1245.  00:53D2  11 0F 00            	ld  de,enemy_data
    1246.  00:53D5                      	
    1247.  00:53D5                      	repeat	max_enem_bullets
    1248.  00:53D5                    < 
    1249.  00:53D5                    < 	bit	0,(iy+enemy_data.status)
    1250.  00:53D5                    < 	jr  z,.activate_this
    1251.  00:53D5                    < 	add iy,de
    1252.  00:53D5                    < 
    1253.  00:53D5                    < 	endrepeat
    1253.  00:53D5  FD CB 07 46 28 13 FD 19 FD CB 07 46 28 0B FD 19 
    1253.  00:53E5  FD CB 07 46 28 03 FD 19 
    1254.  00:53ED  C9                  	ret
    1255.  00:53EE                      
    1256.  00:53EE                      .activate_this:
    1257.  00:53EE  DD CB 07 76         	bit 6,(ix+enemy_data.status)
    1258.  00:53F2  20 0F               	jr  nz,.shootsx
    1259.  00:53F4                      .shootdx
    1260.  00:53F4  FD 36 07 01         	ld  (iy+enemy_data.status),1
    1261.  00:53F8                      	; ld  hl,enemy_bullet_speed
    1262.  00:53F8                      	; ld	e,(ix+enemy_data.speed)
    1263.  00:53F8                      	; ld	d,(ix+enemy_data.speed+1)
    1264.  00:53F8                      	; add	hl,de
    1265.  00:53F8  DD 6E 0D            	ld	l,(ix+enemy_data.speed)
    1266.  00:53FB  DD 66 0E            	ld	h,(ix+enemy_data.speed+1)
    1267.  00:53FE  23 23               [enemy_bullet_speed]	inc hl
    1268.  00:5400  C3 0F 54            	jp  1f
    1269.  00:5403                      
    1270.  00:5403                      .shootsx
    1271.  00:5403  FD 36 07 41         	ld  (iy+enemy_data.status),1 + 64
    1272.  00:5407                      	; ld  hl,-enemy_bullet_speed
    1273.  00:5407                      	; ld	e,(ix+enemy_data.speed)
    1274.  00:5407                      	; ld	d,(ix+enemy_data.speed+1)
    1275.  00:5407                      	; add	hl,de
    1276.  00:5407  DD 6E 0D            	ld	l,(ix+enemy_data.speed)
    1277.  00:540A  DD 66 0E            	ld	h,(ix+enemy_data.speed+1)
    1278.  00:540D  2B 2B               [enemy_bullet_speed]	dec hl
    1279.  00:540F                      	
    1280.  00:540F                      1:
    1281.  00:540F  FD 75 0D            	ld  (iy+enemy_data.speed),l
    1282.  00:5412  FD 74 0E            	ld  (iy+enemy_data.speed+1),h
    1283.  00:5415                      
    1284.  00:5415  3E 30               	ld  a,12*4			; it could depend on enemy ship
    1285.  00:5417  FD 77 0A            	ld  (iy+enemy_data.frame),a
    1286.  00:541A                      
    1287.  00:541A  CD 83 48            	call	bullet_set_size2	; set  xoff,yoff,xsize,ysize for sprite collision
    1288.  00:541D                      
    1289.  00:541D  DD 6E 01            	ld	l,(ix+enemy_data.x)
    1290.  00:5420  DD 66 02            	ld	h,(ix+enemy_data.x+1)
    1291.  00:5423  FD 75 01            	ld  (iy+enemy_data.x),l
    1292.  00:5426  FD 74 02            	ld  (iy+enemy_data.x+1),h
    1293.  00:5429                      
    1294.  00:5429  DD 7E 00            	ld  a,(ix+enemy_data.y)
    1295.  00:542C  FD 77 00            	ld  (iy+enemy_data.y),a
    1296.  00:542F  FD 36 08 9C         	ld  (iy+enemy_data.cntr),(256+32+24)/enemy_bullet_speed
    1297.  00:5433                      
    1298.  00:5433                      	; ld  (iy+enemy_data.color),11
    1299.  00:5433                      	
    1300.  00:5433  3E 08               	ld a,8			; enemy shoot
    1301.  00:5435  CD F4 56            	call AFXPLAY
    1302.  00:5438  C9                  	ret
    1303.  00:5439                      
    1304.  00:5439                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1305.  00:5439                      ;
    1306.  00:5439                      ; manage active enemy bullets
    1307.  00:5439                      ;
    1308.  00:5439                      
    1309.  00:5439                      enemy_bullet_loop:
    1310.  00:5439                      
    1311.  00:5439  21 EB 49            	ld	hl,ms_ani
    1312.  00:543C  3A 4B CB            	ld  a,(aniframe)
    1313.  00:543F  4F                  	ld	c,a
    1314.  00:5440  06 00               	ld	b,0
    1315.  00:5442  09                  	add	hl,bc
    1316.  00:5443  7E                  	ld	a,(hl)
    1317.  00:5444  87                  	add	a,a
    1318.  00:5445  87                  	add	a,a
    1319.  00:5446  FD 21 3B 4A         	ld	iy,ms_col_win
    1320.  00:544A  4F                  	ld	c,a
    1321.  00:544B  06 00               	ld	b,0
    1322.  00:544D  FD 09               	add	iy,bc	; iy aims to MS size for current frame
    1323.  00:544F                      
    1324.  00:544F                      	;iy -> [minx(h) maxx(h) miny(h) maxy(h)]
    1325.  00:544F                      
    1326.  00:544F  DD 21 7E CB         	ld  ix,enem_bullets
    1327.  00:5453  11 0F 00            	ld  de,enemy_data
    1328.  00:5456                      	repeat	max_enem_bullets
    1329.  00:5456                    < 2:
    1330.  00:5456                    < 	exx
    1331.  00:5456                    < 	bit  0,(ix+enemy_data.status)
    1332.  00:5456                    < 	jp  z,1f
    1333.  00:5456                    < 
    1334.  00:5456                    < 	ld  l,(ix+enemy_data.x)
    1335.  00:5456                    < 	ld  h,(ix+enemy_data.x+1)
    1336.  00:5456                    < 	ld  e,(ix+enemy_data.speed)
    1337.  00:5456                    < 	ld  d,(ix+enemy_data.speed+1)
    1338.  00:5456                    < 	add hl,de						; move right or  left
    1339.  00:5456                    < 	ld  (ix+enemy_data.x),l
    1340.  00:5456                    < 	ld  (ix+enemy_data.x+1),h
    1341.  00:5456                    < 
    1342.  00:5456                    < 	ld	a,(ms_state)				; MS is immune to bullets while looping
    1343.  00:5456                    < 	cp	ms_loop_right2left
    1344.  00:5456                    < 	jr	z,3f
    1345.  00:5456                    < 	cp	ms_loop_left2right
    1346.  00:5456                    < 	jr	z,3f
    1347.  00:5456                    < 
    1348.  00:5456                    < 	ld	a,(god_mode)
    1349.  00:5456                    < 	and 	a						
    1350.  00:5456                    < 	call	z,test_collision_enemy_bullets
    1351.  00:5456                    < 	jp	nc,3f
    1352.  00:5456                    < 	res 0,(ix+enemy_data.status)	; turn off this bullet
    1353.  00:5456                    < 	jp	test_obstacles.found		; start ms explosion
    1354.  00:5456                    < 3:
    1355.  00:5456                    < 	dec	(ix+enemy_data.cntr)
    1356.  00:5456                    < 	jp  nz,1f
    1357.  00:5456                    < 	res 0,(ix+enemy_data.status)
    1358.  00:5456                    < 1:
    1359.  00:5456                    < 	exx
    1360.  00:5456                    < 	add ix,de
    1361.  00:5456                    < 	endrepeat
    1361.  00:5456  D9 DD CB 07 46 CA 97 54 DD 6E 01 DD 66 02 DD 5E 
    1361.  00:5466  0D DD 56 0E 19 DD 75 01 DD 74 02 3A 4C CB FE 08 
    1361.  00:5476  28 15 FE 09 28 11 3A 51 CB A7 CC E5 48 D2 8D 54 
    1361.  00:5486  DD CB 07 86 C3 23 55 DD 35 08 C2 97 54 DD CB 07 
    1361.  00:5496  86 D9 DD 19 D9 DD CB 07 46 CA DB 54 DD 6E 01 DD 
    1361.  00:54A6  66 02 DD 5E 0D DD 56 0E 19 DD 75 01 DD 74 02 3A 
    1361.  00:54B6  4C CB FE 08 28 15 FE 09 28 11 3A 51 CB A7 CC E5 
    1361.  00:54C6  48 D2 D1 54 DD CB 07 86 C3 23 55 DD 35 08 C2 DB 
    1361.  00:54D6  54 DD CB 07 86 D9 DD 19 D9 DD CB 07 46 CA 1F 55 
    1361.  00:54E6  DD 6E 01 DD 66 02 DD 5E 0D DD 56 0E 19 DD 75 01 
    1361.  00:54F6  DD 74 02 3A 4C CB FE 08 28 15 FE 09 28 11 3A 51 
    1361.  00:5506  CB A7 CC E5 48 D2 15 55 DD CB 07 86 C3 23 55 DD 
    1361.  00:5516  35 08 C2 1F 55 DD CB 07 86 D9 DD 19 
    1362.  00:5522  C9                  	ret
    1363.  00:5523                      
    1364.  00:5523                      
    1365.  00:5523                      test_obstacles.found
    1366.  00:5523  3A 4C CB            	ld	a,(ms_state)
    1367.  00:5526  FE 0A               	cp	ms_explode
    1368.  00:5528  C8                  	ret	z
    1369.  00:5529  3E 0A               	ld	a,ms_explode
    1370.  00:552B  32 4C CB            	ld	(ms_state),a
    1371.  00:552E  3E 40               	ld	a,64
    1372.  00:5530  32 4B CB            	ld	(aniframe),a
    1373.  00:5533  AF                  	xor	a
    1374.  00:5534  32 43 CB            	ld	(dxmap),a
    1375.  00:5537                      
    1376.  00:5537  3E 09               	ld	a,9			; ms explosion
    1377.  00:5539  CD F4 56            	call AFXPLAY
    1378.  00:553C                      
    1379.  00:553C  C9                  	ret
      68   00:553D                      		include plot_distrucable.asm
       1.  00:553D                      
       2.  00:553D                      _plot_distrucable:
       3.  00:553D                      
       4.  00:553D  F3                  		di
       5.  00:553E  3E 20               		ld 		a, 32
       6.  00:5540  D3 99               		out 	(0x99),a
       7.  00:5542  3E 91               		ld 		a, 17+128
       8.  00:5544  D3 99               		out 	(0x99),a
       9.  00:5546  FB                  		ei
      10.  00:5547                      
      11.  00:5547  0E 9B               		ld 		c, 0x9B
      12.  00:5549                      	
      13.  00:5549  CD 1F 42            		call _waitvdp
      14.  00:554C                      
      15.  00:554C  7D                  		ld		a,l
      16.  00:554D  87 87 87 87         [4]		add		a,a
      17.  00:5551  D3 9B               		out		(0x9B), a 		; sx
      18.  00:5553  AF                  		xor a
      19.  00:5554  D3 9B               		out		(0x9B), a 		; sx (high)
      20.  00:5556                      		
      21.  00:5556  3E D0               		ld		a,mapHeight*16+32
      22.  00:5558  D3 9B               		out		(0x9B), a 		; sy
      23.  00:555A  3E 01               		ld		a,1				; source page for animated tiles
      24.  00:555C  D3 9B               		out 	(0x9B), a 		; sy (high-> page 3)
      25.  00:555E                      		
      26.  00:555E  7B                  		ld		a,e
      27.  00:555F  D3 9B               		out 	(0x9B), a 	; dx	
      28.  00:5561  AF                  		xor a
      29.  00:5562  D3 9B               		out 	(0x9B), a	; dx (high)
      30.  00:5564                      	
      31.  00:5564  7A                  		ld		a,d
      32.  00:5565  D3 9B               		out 	(0x9B), a	; dy
      33.  00:5567  7C                  		ld 		a,h			; destination page
      34.  00:5568  D3 9B               		out 	(0x9B), a	; dy (high-> page 0 or 1)
      35.  00:556A                      
      36.  00:556A  21 10 10            		ld 		hl,16*257 	; block size
      37.  00:556D                      
      38.  00:556D  ED 69               		out 	(c), l
      39.  00:556F  AF                  		xor a
      40.  00:5570  D3 9B               		out 	(0x9B), a
      41.  00:5572  ED 61               		out 	(c), h
      42.  00:5574  D3 9B               		out 	(0x9B), a
      43.  00:5576  D3 9B               		out 	(0x9B), a
      44.  00:5578  D3 9B               		out 	(0x9B), a
      45.  00:557A                      
      46.  00:557A  3E D0               		ld		a,11010000B
      47.  00:557C  D3 9B               		out 	(0x9B), a		; command HMMM
      48.  00:557E  C9                  		ret
      49.  00:557F                      
      69   00:557F                      		
      70   00:557F                      ;-------------------------------------
      71   00:557F                      ; Entry point
      72   00:557F                      ;-------------------------------------
      73   00:557F                      START:
      74   00:557F  1E 06               		ld e,6
      75   00:5581  CD 0F 45            		call	checkkbd
      76   00:5584  3E 01               		ld	a,1
      77   00:5586  CB 0D               		rrc	l				; shift
      78   00:5588  D2 8C 55            		jp	nc,_ntsc
      79   00:558B  AF                  		xor	a
      80   00:558C  32 02 CB            _ntsc:	ld	(SEL_NTSC),a	; if set NSTC, if reset PAL
      81   00:558F                      
      82   00:558F  CD 0C 4B            		call 	rand8_init								
      83   00:5592  CD EA 41            		call	set_scr
      84   00:5595                      
      85   00:5595  1E 06               		ld e,6
      86   00:5597  CD 0F 45            		call	checkkbd
      87   00:559A  E6 02               		and	00000010B		; CRTL
      88   00:559C  C4 2E 42            		call nz,_set_r800	; if CRTL is pressed do not test for turbo
      89   00:559F                      		
      90   00:559F                      ;-------------------------------------
      91   00:559F                      ;   Power-up routine for 32K ROM
      92   00:559F                      ;   set pages and sub slot
      93   00:559F                      ;-------------------------------------
      94   00:559F  CD 10 40                    call    search_slot
      95   00:55A2  CD 2F 40                    call    search_slotram
      96   00:55A5  CD 61 40            		call	setrompage2
      97   00:55A8  CD 5B 40            		call	setrampage0
      98   00:55AB                      
      99   00:55AB                      
     100   00:55AB  AF                  		xor	a
     101   00:55AC  32 00 50            		ld	(_kBank1),a
     102   00:55AF  3C                  		inc	a
     103   00:55B0  32 00 70            		ld	(_kBank2),a
     104   00:55B3  3C                  		inc	a
     105   00:55B4  32 00 90            		ld	(_kBank3),a
     106   00:55B7                      		
     107   00:55B7                      		;--- initialise demo song
     108   00:55B7  01 CE 02            		ld	bc,	end_ttreplayRAM-ttreplayRAM
     109   00:55BA  21 00 01            		ld	hl,	ttreplayRAM
     110   00:55BD  11 01 01            		ld	de,	ttreplayRAM+1
     111   00:55C0  36 00               		ld	(hl),0
     112   00:55C2  ED B0               		ldir
     113   00:55C4  CD 98 43            		call	_replay_init
     114   00:55C7  CD AE 42            		call	_intreset
     115   00:55CA                      		
     116   00:55CA  0E 00               		ld		c,0
     117   00:55CC  51                  		ld		d,c
     118   00:55CD  59                  		ld		e,c
     119   00:55CE  CD A5 41            		call	_vdpsetvramwr
     120   00:55D1                      
     121   00:55D1  11 07 10            		ld	de,256*:_opening+7
     122   00:55D4  CD CD 71            		call	outvram
     123   00:55D7                      		
     124   00:55D7  1E 08               1:		ld e,8
     125   00:55D9  CD 0F 45            		call	checkkbd
     126   00:55DC  E6 01               		and		00000001B
     127   00:55DE  20 F7               		jr		nz,1b
     128   00:55E0                      
     129   00:55E0  CD 78 41            		call	_cls
     130   00:55E3  F3                  		di
     131   00:55E4  3A E8 FF            		ld		a,(RG9SAV)		
     132   00:55E7  E6 7F               		and		01111111B		; Set 192 lines
     133   00:55E9  32 E8 FF            		ld		(RG9SAV),a
     134   00:55EC  D3 99               		out		(0x99),a
     135   00:55EE  3E 89               		ld		a,128+9
     136   00:55F0  D3 99               		out		(0x99),a
     137   00:55F2  FB                  		ei
     138   00:55F3                      
     139   00:55F3  CD 1C 45            		call 	_hw_sprite_init
     140   00:55F6                      
     141   00:55F6  0E 00               		ld		c,0
     142   00:55F8  11 00 B3            		ld		de,256*(mapHeight*16+3)
     143   00:55FB  CD A5 41            		call	_vdpsetvramwr
     144   00:55FE                      
     145   00:55FE  11 01 18            		ld		de, 256*:_scorebar+1
     146   00:5601  CD CD 71            		call	outvram
     147   00:5604                      		
     148   00:5604  0E 01               		ld		c,1
     149   00:5606  11 00 B0            		ld		de,256*mapHeight*16
     150   00:5609  CD A5 41            		call	_vdpsetvramwr
     151   00:560C                      
     152   00:560C  11 02 19            		ld		de, 256*:_animated+2
     153   00:560F  CD CD 71            		call	outvram
     154   00:5612                      
     155   00:5612                      	
     156   00:5612                      		; ld	a,:demo_song
     157   00:5612                      		; setpage_a
     158   00:5612                      		
     159   00:5612                      		; ld	bc,	end_demo_song-musbuff
     160   00:5612                      		; ld	hl,	demo_song
     161   00:5612                      		; ld	de,	musbuff
     162   00:5612                      		; ldir
     163   00:5612                      			
     164   00:5612                      		; call	replay_init
     165   00:5612                      		; ld		hl,musbuff
     166   00:5612                      		; call	replay_loadsong
     167   00:5612                      
     168   00:5612                      
     169   00:5612  1E 00               		ld		e,0
     170   00:5614  CD D9 41            		call	_setpage
     171   00:5617                      				
     172   00:5617  3E 0F               		ld	a, :_level
     173   00:5619  32 00 B0            		ld	(_kBank4),a
     174   00:561C                      		
     175   00:561C  21 00 A0            		ld		hl,_level
     176   00:561F  11 00 C0            		ld		de,_levelmap
     177   00:5622  01 00 0B            		ld		bc,mapWidth*mapHeight
     178   00:5625  ED B0               		ldir
     179   00:5627                      
     180   00:5627                      
     181   00:5627                      		; call	init_page0
     182   00:5627                      
     183   00:5627  3E 00               		ld		a,0
     184   00:5629  32 3B CB            		ld		(cur_level),a
     185   00:562C                      
     186   00:562C  21 00 A0            		ld		hl,demo_song
     187   00:562F  CD 85 43            		call	_replay_loadsong
     188   00:5632  FB                  		ei
     189   00:5633                      ; 1:		jp      1b
     190   00:5633                      
     191   00:5633                      restart:
     192   00:5633  CD 98 43            		call	_replay_init
     193   00:5636  CD AE 42            		call	_intreset
     194   00:5639                      
     195   00:5639                      		;--- initialise demo song
     196   00:5639  01 CE 02            		ld	bc,	end_ttreplayRAM-ttreplayRAM
     197   00:563C  21 00 01            		ld	hl,	ttreplayRAM
     198   00:563F  11 01 01            		ld	de,	ttreplayRAM+1
     199   00:5642  36 00               		ld	(hl),0
     200   00:5644  ED B0               		ldir
     201   00:5646                      		
     202   00:5646                      
     203   00:5646  3E 01               		ld		a,1
     204   00:5648  32 33 CB            		ld		(_displaypage),a		
     205   00:564B  CD 90 41            		call 	_cls0
     206   00:564E  21 00 C0            		ld		hl,_levelmap
     207   00:5651  22 2F CB            		ld		(_levelmap_pos),hl
     208   00:5654                      		
     209   00:5654  AF                  		xor		a
     210   00:5655  67                  		ld		h,a
     211   00:5656  6F                  		ld		l,a
     212   00:5657  32 53 CB            		ld		(flip_flop),a
     213   00:565A  32 51 CB            		ld		(god_mode),a
     214   00:565D  32 2C CB            		ld		(_ymappos),a
     215   00:5660  22 2D CB            		ld		(_xmappos),hl
     216   00:5663                      		
     217   00:5663  22 28 CB            		ld		(_nframes),hl
     218   00:5666  22 0F CB            		ld		(_mcdx),hl
     219   00:5669  32 0D CB            		ld		(_mcframe),a
     220   00:566C                      		
     221   00:566C  32 36 CB            		ld		(_yoffset),a		;  0 tutto su
     222   00:566F  32 35 CB            		ld		(_xoffset),a		;  0 tutto su
     223   00:5672                      								
     224   00:5672  32 4B CB            		ld	(aniframe),a
     225   00:5675  32 4E CB            		ld	(anispeed),a
     226   00:5678  32 4C CB            		ld	(ms_state),a
     227   00:567B  3C                  		inc a
     228   00:567C  32 4D CB            		ld	(old_aniframe),a		; old_aniframe!=aniframe
     229   00:567F                      	
     230   00:567F  32 43 CB            		ld		(dxmap),a		; moving right
     231   00:5682  32 42 CB            		ld		(_dxmap),a		; moving right
     232   00:5685                      
     233   00:5685  22 44 CB            		ld		(xmap),hl
     234   00:5688  22 46 CB            		ld		(_xmapx4),hl
     235   00:568B  01 78 00            		ld		bc,xship_rel
     236   00:568E  09                  		add 	hl,bc
     237   00:568F  22 49 CB            		ld		(xship),hl
     238   00:5692  3E 50               		ld		a,80
     239   00:5694  32 48 CB            		ld		(yship),a
     240   00:5697                      
     241   00:5697  CD 40 4B            		call 	npc_init								
     242   00:569A  CD 65 45            		call 	load_colors
     243   00:569D                      
     244   00:569D  AF                  		xor	a
     245   00:569E  32 00 50            		ld	(_kBank1),a
     246   00:56A1  3C                  		inc	a
     247   00:56A2  32 00 70            		ld	(_kBank2),a
     248   00:56A5  3C                  		inc	a
     249   00:56A6  32 00 90            		ld	(_kBank3),a
     250   00:56A9                      		
     251   00:56A9  21 00 A0            		ld		hl,demo_song
     252   00:56AC  CD 85 43            		call	_replay_loadsong
     253   00:56AF                      
     254   00:56AF  CD 8A 42            		call	_isrinit
     255   00:56B2                      
     256   00:56B2                      main_loop: 
     257   00:56B2                      				
     258   00:56B2  21 00 00            		ld	hl,0
     259   00:56B5  22 9E FC            		ld	(_jiffy),hl
     260   00:56B8                      
     261   00:56B8                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     262   00:56B8                      ; run ms FSM and place its sprites in the SAT in RAM
     263   00:56B8  CD BD 6C            		call	ms_ctrl
     264   00:56BB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     265   00:56BB                      ; test for game restart
     266   00:56BB  3A 4C CB            		ld	a,(ms_state)
     267   00:56BE  FE 0C               		cp	ms_reset
     268   00:56C0  CA 33 56            		jp	z,restart
     269   00:56C3                      
     270   00:56C3                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     271   00:56C3                      ; place MS in the SAT and test for collision
     272   00:56C3  CD 17 70            		call	put_ms_sprt
     273   00:56C6  3A 51 CB            		ld		a,(god_mode)
     274   00:56C9  A7                  		and 	a
     275   00:56CA                      		; call	z,test_obstacles
     276   00:56CA                      
     277   00:56CA                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     278   00:56CA                      ; run NCPS FSM
     279   00:56CA  CD C5 4B            		call	wave_timer
     280   00:56CD  CD 1D 4F            		call	npc_loop
     281   00:56D0  CD 39 54            		call	enemy_bullet_loop
     282   00:56D3                      
     283   00:56D3                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     284   00:56D3                      ; run MS bullets FSM
     285   00:56D3  CD 10 5C            		call	bullet_loop
     286   00:56D6                      
     287   00:56D6                      		; ld	a,00100101B			; random colour
     288   00:56D6                      		; out		(0x99),a
     289   00:56D6                      		; ld		a,7+128
     290   00:56D6                      		; out		(0x99),a
     291   00:56D6                      		
     292   00:56D6                      		; call	_waitvdp
     293   00:56D6                      
     294   00:56D6                      		; ld	a,10100101B			; random colour
     295   00:56D6                      		; out		(0x99),a
     296   00:56D6                      		; ld		a,7+128
     297   00:56D6                      		; out		(0x99),a
     298   00:56D6                      				
     299   00:56D6  3A 03 CB            		ld	a,(joystick)
     300   00:56D9  E6 20               		and	32
     301   00:56DB                      		; call	z,_plot_distrucable
     302   00:56DB                      
     303   00:56DB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     304   00:56DB                      		; ld		a,3
     305   00:56DB                      		; out		(0x99),a
     306   00:56DB                      		; ld		a,7+128
     307   00:56DB                      		; out		(0x99),a
     308   00:56DB                      		
     309   00:56DB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     310   00:56DB                      		; call	test_star
     311   00:56DB                      
     312   00:56DB                      		; xor		a
     313   00:56DB                      		; out		(0x99),a
     314   00:56DB                      		; ld		a,7+128
     315   00:56DB                      		; out		(0x99),a
     316   00:56DB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     317   00:56DB                      
     318   00:56DB                      		
     319   00:56DB  3A 9E FC            1:		ld	a,(_jiffy)		; wait for vblank (and not for linit)
     320   00:56DE  B7                  		or	a
     321   00:56DF  28 FA               		jr	z,1b
     322   00:56E1                      	
     323   00:56E1  2A 44 CB            		ld	hl,(xmap)
     324   00:56E4  01 78 00            		ld	bc,xship_rel
     325   00:56E7  09                  		add hl,bc
     326   00:56E8  22 49 CB            		ld	(xship),hl
     327   00:56EB                      
     328   00:56EB  3A 43 CB            		ld		a,(dxmap)
     329   00:56EE  32 42 CB            		ld		(_dxmap),a
     330   00:56F1                      
     331   00:56F1  C3 B2 56            		jp      main_loop
     332   00:56F4                      
     333   00:56F4                      ;-------------------------------------
     334   00:56F4                      AFXPLAY:
     335   00:56F4  C9                  		ret
     336   00:56F5                      ;	include vuitpakker.asm
     337   00:56F5                      	include print.asm
       1.  00:56F5                      
       2.  00:56F5                      	
       3.  00:56F5                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       4.  00:56F5                      
       5.  00:56F5                      _print_probe
       6.  00:56F5  3A 14 CB            	ld	a,(_mcprobeb)
       7.  00:56F8  5F                  	ld	e,a
       8.  00:56F9  16 00               	ld	d,0
       9.  00:56FB  21 C0 07            	ld	hl,32*(64-2)
      10.  00:56FE  19                  	add	hl,de
      11.  00:56FF  EB                  	ex	de,hl
      12.  00:5700  21 C0 05            	ld	hl,2*(23*32+0)
      13.  00:5703                      	; call 	plot_foreground
      14.  00:5703                      	
      15.  00:5703  ED 5B 15 CB         	ld	de,(_ticxframe)
      16.  00:5707  16 00               	ld	d,0
      17.  00:5709  01 16 CB            	ld	bc,_buffer
      18.  00:570C  CD 5E 57            	call	int2ascii
      19.  00:570F                      	
      20.  00:570F  3A 18 CB            	ld	a,(_buffer+2)
      21.  00:5712  5F                  	ld	e,a
      22.  00:5713  16 00               	ld	d,0
      23.  00:5715  21 90 07            	ld	hl,32*(64-2)-'0'
      24.  00:5718  19                  	add	hl,de
      25.  00:5719  EB                  	ex	de,hl
      26.  00:571A  21 80 05            	ld	hl,2*(22*32)
      27.  00:571D                      	; call 	plot_foreground
      28.  00:571D                      
      29.  00:571D  3A 19 CB            	ld	a,(_buffer+3)
      30.  00:5720  5F                  	ld	e,a
      31.  00:5721  16 00               	ld	d,0
      32.  00:5723  21 90 07            	ld	hl,32*(64-2)-'0'
      33.  00:5726  19                  	add	hl,de
      34.  00:5727  EB                  	ex	de,hl
      35.  00:5728  21 82 05            	ld	hl,2*(22*32+1)
      36.  00:572B                      	; call 	plot_foreground
      37.  00:572B                      
      38.  00:572B  3A 1A CB            	ld	a,(_buffer+4)
      39.  00:572E  5F                  	ld	e,a
      40.  00:572F  16 00               	ld	d,0
      41.  00:5731  21 90 07            	ld	hl,32*(64-2)-'0'
      42.  00:5734  19                  	add	hl,de
      43.  00:5735  EB                  	ex	de,hl
      44.  00:5736  21 84 05            	ld	hl,2*(22*32+2)
      45.  00:5739                      	; call 	plot_foreground
      46.  00:5739  C9                  	ret
      47.  00:573A                      	
      48.  00:573A                      	
      49.  00:573A                      _print_fps:
      50.  00:573A  3A 19 CB            	ld	a,(_buffer+3)
      51.  00:573D  5F                  	ld	e,a
      52.  00:573E  16 00               	ld	d,0
      53.  00:5740  21 90 07            	ld	hl,32*(64-2)-'0'
      54.  00:5743  19                  	add	hl,de
      55.  00:5744  EB                  	ex	de,hl
      56.  00:5745                      	
      57.  00:5745  21 FC 05            	ld	hl,2*(23*32+30)
      58.  00:5748                      	; call 	plot_foreground
      59.  00:5748                      
      60.  00:5748  3A 1A CB            	ld	a,(_buffer+4)
      61.  00:574B  5F                  	ld	e,a
      62.  00:574C  16 00               	ld	d,0
      63.  00:574E  21 90 07            	ld	hl,32*(64-2)-'0'
      64.  00:5751  19                  	add	hl,de
      65.  00:5752  EB                  	ex	de,hl
      66.  00:5753                      	
      67.  00:5753  21 FE 05            	ld	hl,2*(23*32+31)
      68.  00:5756                      	; call 	plot_foreground
      69.  00:5756  C9                  	ret
      70.  00:5757                      
      71.  00:5757                      ;-------------------------------------
      72.  00:5757                      _compute_fps:
      73.  00:5757  ED 5B 26 CB         	ld	de,(_fps)
      74.  00:575B  01 16 CB            	ld	bc,_buffer
      75.  00:575E                      
      76.  00:575E                      int2ascii:
      77.  00:575E                      	
      78.  00:575E                      ; in de input 
      79.  00:575E                      ; in bc output
      80.  00:575E                      
      81.  00:575E  EB                  	ex  de,hl
      82.  00:575F  59                  	ld  e,c
      83.  00:5760  50                  	ld  d,b
      84.  00:5761                      
      85.  00:5761                      Num2asc:
      86.  00:5761  01 F0 D8            	ld  bc,-10000
      87.  00:5764  CD 7A 57            	call    Num1
      88.  00:5767  01 18 FC            	ld  bc,-1000
      89.  00:576A  CD 7A 57            	call    Num1
      90.  00:576D  01 9C FF            	ld  bc,-100
      91.  00:5770  CD 7A 57            	call    Num1
      92.  00:5773  0E F6               	ld  c,-10
      93.  00:5775  CD 7A 57            	call    Num1
      94.  00:5778  0E FF               	ld  c,-1
      95.  00:577A                      
      96.  00:577A                      Num1:   
      97.  00:577A  3E 2F               	ld  a,'0'-1  ; '0' in the tileset
      98.  00:577C                      
      99.  00:577C                      Num2:   
     100.  00:577C  3C                  	inc a
     101.  00:577D  09                  	add hl,bc
     102.  00:577E  38 FC               	jr  c,Num2
     103.  00:5780  ED 42               	sbc hl,bc
     104.  00:5782                      
     105.  00:5782  12                  	ld  (de),a
     106.  00:5783  13                  	inc de
     107.  00:5784  C9                  	ret
     338   00:5785                      	include plot_line.asm
       1.  00:5785                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       2.  00:5785                      ; no input
       3.  00:5785                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       4.  00:5785                      
       5.  00:5785                      	
       6.  00:5785                      
       7.  00:5785                      blank_line:
       8.  00:5785  F3                  	di
       9.  00:5786  3E 24               	ld 		a, 36
      10.  00:5788  D3 99               	out 	(0x99),a
      11.  00:578A  3E 91               	ld 		a, 17+128
      12.  00:578C  D3 99               	out 	(0x99),a
      13.  00:578E                      
      14.  00:578E  CD 1F 42            	call _waitvdp		; no need ATM
      15.  00:5791                      	
      16.  00:5791  3A 35 CB            	ld		a,(_xoffset)
      17.  00:5794  83                  	add		a,e
      18.  00:5795  D3 9B               	out 	(0x9B), a 			; dx
      19.  00:5797  AF                  	xor a
      20.  00:5798  D3 9B               	out 	(0x9B), a			; dx (high)
      21.  00:579A                      	
      22.  00:579A  D3 9B               	out 	(0x9B), a			; dy
      23.  00:579C  3A 33 CB            	ld 		a,(_displaypage)	; destination page
      24.  00:579F  D3 9B               	out 	(0x9B), a			; dy (high-> page 0 or 1)
      25.  00:57A1                      	
      26.  00:57A1  3E 01               	ld		a,1
      27.  00:57A3  D3 9B               	out 	(0x9B), a			; x block size
      28.  00:57A5  AF                  	xor a
      29.  00:57A6  D3 9B               	out 	(0x9B), a
      30.  00:57A8                      
      31.  00:57A8  3E B0               	ld		a,mapHeight*16
      32.  00:57AA  D3 9B               	out 	(0x9B), a			; y block size
      33.  00:57AC  AF                  	xor a
      34.  00:57AD  D3 9B               	out 	(0x9B), a
      35.  00:57AF                      
      36.  00:57AF  D3 9B               	out 	(0x9B), a			; color
      37.  00:57B1  D3 9B               	out 	(0x9B), a
      38.  00:57B3                      
      39.  00:57B3  3E C0               	ld		a,11000000B
      40.  00:57B5  D3 9B               	out 	(0x9B), a		; command HMMV
      41.  00:57B7  FB                  	ei
      42.  00:57B8  C9                  	ret
      43.  00:57B9                      
      44.  00:57B9                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      45.  00:57B9                      ; no input
      46.  00:57B9                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      47.  00:57B9                      
      48.  00:57B9                      plot_line_lft1:
      49.  00:57B9  2A 2F CB            	ld	hl,(_levelmap_pos)
      50.  00:57BC  1E 00               	ld	e,0
      51.  00:57BE  C3 CA 58            	jp plot_line1
      52.  00:57C1                      plot_line_lft2:
      53.  00:57C1  2A 2F CB            	ld	hl,(_levelmap_pos)
      54.  00:57C4  1E 00               	ld	e,0
      55.  00:57C6  C3 E1 58            	jp plot_line2
      56.  00:57C9                      
      57.  00:57C9                      
      58.  00:57C9                      ; plot_line_lft:
      59.  00:57C9                      	; ld	hl,(_levelmap_pos)
      60.  00:57C9                      	; ld	e,0
      61.  00:57C9                      	; jp plot_line
      62.  00:57C9                      	
      63.  00:57C9                      plot_line_rgt1:
      64.  00:57C9  2A 2F CB            	ld	hl,(_levelmap_pos)
      65.  00:57CC  11 0F 00            	ld	de,15
      66.  00:57CF  19                  	add	hl,de
      67.  00:57D0  1E F0               	ld	e,240
      68.  00:57D2  C3 CA 58            	jp plot_line1
      69.  00:57D5                      plot_line_rgt2:
      70.  00:57D5  2A 2F CB            	ld	hl,(_levelmap_pos)
      71.  00:57D8  11 0F 00            	ld	de,15
      72.  00:57DB  19                  	add	hl,de
      73.  00:57DC  1E F0               	ld	e,240
      74.  00:57DE  C3 E1 58            	jp plot_line2
      75.  00:57E1                      	
      76.  00:57E1                      ; plot_line_rgt:
      77.  00:57E1                      	; ld	hl,(_levelmap_pos)
      78.  00:57E1                      	; ld	de,15
      79.  00:57E1                      	; add	hl,de
      80.  00:57E1                      	; ld	e,240
      81.  00:57E1                      	; jp plot_line
      82.  00:57E1                      	
      83.  00:57E1                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      84.  00:57E1                      ; input
      85.  00:57E1                      ; de = y,x configured in window map 256x256
      86.  00:57E1                      ; a  tile to be plot
      87.  00:57E1                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      88.  00:57E1                      plot_tile:
      89.  00:57E1  D5                  		push	de
      90.  00:57E2  D9                  		exx
      91.  00:57E3  D1                  		pop		de
      92.  00:57E4                      		
      93.  00:57E4  67                  		ld	h,a
      94.  00:57E5  07 07 07            [3]		rlca
      95.  00:57E8  E6 07               		and	00000111B
      96.  00:57EA  C6 04               		add	a,:_tiles0
      97.  00:57EC  32 00 B0            		ld	(_kBank4),a
      98.  00:57EF  7C                  		ld	a,h
      99.  00:57F0  E6 1F               		and	00011111B
     100.  00:57F2  C6 A0               		add	a,high _tiles0
     101.  00:57F4  67                  		ld	h,a
     102.  00:57F5  2E 00               		ld	l,0
     103.  00:57F7                      
     104.  00:57F7  3A 33 CB            		ld	a,(_displaypage)
     105.  00:57FA                      					; de = y*256+x
     106.  00:57FA  CB 02               		rlc d		; set VDP for writing at address ADE (17-bit) ;
     107.  00:57FC  17                  		rla
     108.  00:57FD  CB 02               		rlc d
     109.  00:57FF  17                  		rla
     110.  00:5800  CB 3A               		srl d 		 ; first shift
     111.  00:5802  F3                  		di
     112.  00:5803  D3 99               		out (0x99),a	; set bits 14-16
     113.  00:5805  3E 8E               		ld a,14+128
     114.  00:5807  D3 99               		out (0x99),a
     115.  00:5809  FB                  		ei
     116.  00:580A  CB 3A               		srl d 		 ;  second shift.     
     117.  00:580C  CB F2               		set 6,d		 ;  write access
     118.  00:580E                      
     119.  00:580E  01 98 10            		ld	bc,16*256+0x98
     120.  00:5811                      	
     121.  00:5811  C5                  2:		push	bc
     122.  00:5812  06 10               		ld	b,16
     123.  00:5814  F3                  		di
     124.  00:5815  7B                  1:		ld a,e 		;set bits 0-7
     125.  00:5816  D3 99               		out (0x99),a
     126.  00:5818  7A                  		ld a,d 		;set bits 8-13
     127.  00:5819  D3 99               		out (0x99),a
     128.  00:581B  14                  		inc	d
     129.  00:581C  ED A3               		outi
     130.  00:581E  C2 15 58            		jp nz,1b
     131.  00:5821  FB                  		ei
     132.  00:5822  3E F0               		ld	a,-16
     133.  00:5824  82                  		add	a,d
     134.  00:5825  57                  		ld	d,a
     135.  00:5826  1C                  		inc	e
     136.  00:5827  C1                  		pop	bc
     137.  00:5828  10 E7               		djnz 2b
     138.  00:582A  D9                  		exx
     139.  00:582B  C9                  		ret
     140.  00:582C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     141.  00:582C                      ; 		
     142.  00:582C                      init_page0:
     143.  00:582C  3A 33 CB            		ld		a,(_displaypage)
     144.  00:582F  57                  		ld		d,a
     145.  00:5830  1E F0               		ld		e,240
     146.  00:5832  CD 58 58            		call	clrboder
     147.  00:5835  2A 2F CB            		ld		hl,(_levelmap_pos)
     148.  00:5838  11 00 00            		ld		de,0x0000			; e=x=0, d=y=0
     149.  00:583B                      		
     150.  00:583B  06 0B               		ld		b,11
     151.  00:583D  C5                  2:		push	bc
     152.  00:583E  06 0F               		ld		b,15
     153.  00:5840  7E                  1:		ld		a,(hl)
     154.  00:5841  CD E1 57            		call 	plot_tile
     155.  00:5844  23                  		inc		hl
     156.  00:5845  3E 10               		ld	a,16
     157.  00:5847  83                  		add	a,e
     158.  00:5848  5F                  		ld	e,a
     159.  00:5849  10 F5               		djnz	1b
     160.  00:584B                      				
     161.  00:584B  58                  		ld	e,b
     162.  00:584C  3E 10               		ld	a,16
     163.  00:584E  82                  		add	a,d
     164.  00:584F  57                  		ld	d,a
     165.  00:5850  01 F1 00            		ld	bc,mapWidth-15
     166.  00:5853  09                  		add	hl,bc
     167.  00:5854  C1                  		pop	bc
     168.  00:5855  10 E6               		djnz	2b
     169.  00:5857  C9                  		ret
     170.  00:5858                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     171.  00:5858                      ; 		
     172.  00:5858                      ; init_page1:
     173.  00:5858                      		; ld		a,(_displaypage)
     174.  00:5858                      		; ld		d,a
     175.  00:5858                      		; ld		e,0
     176.  00:5858                      		; call	clrboder
     177.  00:5858                      		; ld		hl,(_levelmap_pos)
     178.  00:5858                      		; ld		de,0x0010			; e=x=16, d=y=0
     179.  00:5858                      		
     180.  00:5858                      		; ld		b,11
     181.  00:5858                      ; 2:		push	bc
     182.  00:5858                      		; ld		b,15
     183.  00:5858                      ; 1:		ld		a,(hl)
     184.  00:5858                      		; call 	plot_tile
     185.  00:5858                      		; inc		hl
     186.  00:5858                      		; ld	a,16
     187.  00:5858                      		; add	a,e
     188.  00:5858                      		; ld	e,a
     189.  00:5858                      		; djnz	1b
     190.  00:5858                      		
     191.  00:5858                      		; ld	e,0x10
     192.  00:5858                      		; ld	a,e
     193.  00:5858                      		; add	a,d
     194.  00:5858                      		; ld	d,a
     195.  00:5858                      		; ld	bc,mapWidth-15
     196.  00:5858                      		; add	hl,bc
     197.  00:5858                      		; pop	bc
     198.  00:5858                      		; djnz	2b
     199.  00:5858                      		; ret
     200.  00:5858                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     201.  00:5858                      ; input
     202.  00:5858                      ; d = page
     203.  00:5858                      ; e = dx
     204.  00:5858                      ; l = background color
     205.  00:5858                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     206.  00:5858                      		
     207.  00:5858                      clrboder:
     208.  00:5858  F3                  	di
     209.  00:5859  3E 24               	ld 		a, 36
     210.  00:585B  D3 99               	out 	(0x99),a
     211.  00:585D  3E 91               	ld 		a, 17+128
     212.  00:585F  D3 99               	out 	(0x99),a
     213.  00:5861                      	
     214.  00:5861  CD 1F 42            	call _waitvdp
     215.  00:5864                      	
     216.  00:5864  7B                  	ld		a,e
     217.  00:5865  D3 9B               	out 	(0x9B), a 			; dx
     218.  00:5867  AF                  	xor		a
     219.  00:5868  D3 9B               	out 	(0x9B), a			; dx (high)
     220.  00:586A                      	
     221.  00:586A  D3 9B               	out 	(0x9B), a			; dy
     222.  00:586C  7A                  	ld 		a,d					; destination page
     223.  00:586D  D3 9B               	out 	(0x9B), a			; dy (high-> page 0 or 1)
     224.  00:586F                      	
     225.  00:586F  3E 10               	ld a,16
     226.  00:5871  D3 9B               	out 	(0x9B), a			; x block size
     227.  00:5873  AF                  	xor	a
     228.  00:5874  D3 9B               	out 	(0x9B), a
     229.  00:5876                      
     230.  00:5876  3E B0               	ld		a,mapHeight*16
     231.  00:5878  D3 9B               	out 	(0x9B), a			; y block size
     232.  00:587A  AF                  	xor a
     233.  00:587B  D3 9B               	out 	(0x9B), a
     234.  00:587D                      
     235.  00:587D  3E 00               	ld		a,border_color
     236.  00:587F  D3 9B               	out 	(0x9B), a			; color
     237.  00:5881  AF                  	xor a
     238.  00:5882  D3 9B               	out 	(0x9B), a
     239.  00:5884                      
     240.  00:5884  3E C0               	ld		a,11000000B
     241.  00:5886  D3 9B               	out 	(0x9B), a		; command HMMV
     242.  00:5888  FB                  	ei
     243.  00:5889  C9                  	ret
     244.  00:588A                      
     245.  00:588A                      
     246.  00:588A                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     247.  00:588A                      ; input
     248.  00:588A                      ; e = sx	from not _displaypage
     249.  00:588A                      ; d = dx	to _displaypage
     250.  00:588A                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     251.  00:588A                      
     252.  00:588A                      move_block:
     253.  00:588A  F3                  	di
     254.  00:588B  3E 20               	ld 		a, 32
     255.  00:588D  D3 99               	out 	(0x99),a
     256.  00:588F  3E 91               	ld 		a, 17+128
     257.  00:5891  D3 99               	out 	(0x99),a
     258.  00:5893                      
     259.  00:5893  0E 9B               	ld 		c, 0x9B
     260.  00:5895                      	
     261.  00:5895  CD 1F 42            	call _waitvdp		; no need ATM
     262.  00:5898                      	
     263.  00:5898  ED 59               	out		(c), e 		; sx
     264.  00:589A  AF                  	xor a
     265.  00:589B  D3 9B               	out		(0x9B), a 	; sx (high)
     266.  00:589D                      	
     267.  00:589D  D3 9B               	out		(0x9B), a 	; sy
     268.  00:589F  3A 33 CB            	ld 		a,(_displaypage)	; source page
     269.  00:58A2  D3 9B               	out 	(0x9B), a 	; sy 	(high-> page 0 or 1)
     270.  00:58A4                      
     271.  00:58A4  ED 51               	out 	(c), d 		; dx
     272.  00:58A6  AF                  	xor a
     273.  00:58A7  D3 9B               	out 	(0x9B), a	; dx (high)
     274.  00:58A9                      	
     275.  00:58A9  D3 9B               	out 	(0x9B), a 		; dy
     276.  00:58AB  3A 33 CB            	ld 		a,(_displaypage)	; destination page
     277.  00:58AE  EE 01               	xor	1				
     278.  00:58B0  D3 9B               	out 	(0x9B), a	; dy 	(high-> page 0 or 1)
     279.  00:58B2                      
     280.  00:58B2  3E 10               	ld 		a,16 		; block size
     281.  00:58B4  D3 9B               	out 	(0x9B), a
     282.  00:58B6  AF                  	xor a
     283.  00:58B7  D3 9B               	out 	(0x9B), a	
     284.  00:58B9  3E B0               	ld		a,mapHeight*16
     285.  00:58BB  D3 9B               	out 	(0x9B), a
     286.  00:58BD  AF                  	xor		a
     287.  00:58BE  D3 9B               	out 	(0x9B), a
     288.  00:58C0  D3 9B               	out 	(0x9B), a
     289.  00:58C2  D3 9B               	out 	(0x9B), a
     290.  00:58C4                      
     291.  00:58C4  3E D0               	ld		a,11010000B
     292.  00:58C6  D3 9B               	out 	(0x9B), a		; command HMMM
     293.  00:58C8  FB                  	ei
     294.  00:58C9  C9                  	ret
     295.  00:58CA                      	
     339   00:58CA                      	include plot_line2.asm
       1.  00:58CA                      plot_line1:
       2.  00:58CA  3A 35 CB            	ld	a,(_xoffset)
       3.  00:58CD  83                  	add a,e
       4.  00:58CE  5F                  	ld	e,a		; de = y*256+x
       5.  00:58CF                      
       6.  00:58CF  3A 33 CB            	ld	a,(_displaypage)
       7.  00:58D2  87 87               [2] add a,a
       8.  00:58D4  F3                  	di
       9.  00:58D5  D3 99               	out (0x99),a 	; set bits 14-16
      10.  00:58D7  3E 8E               	ld a,14+128
      11.  00:58D9  D3 99               	out (0x99),a
      12.  00:58DB  FB                  	ei
      13.  00:58DC  16 40               	ld	d,0x40		; write access
      14.  00:58DE  C3 22 59            	jp	_1stblock	; trace 16 pixels
      15.  00:58E1                      
      16.  00:58E1                      plot_line2:
      17.  00:58E1  24                  	inc	h
      18.  00:58E2  3A 35 CB            	ld	a,(_xoffset)
      19.  00:58E5  83                  	add a,e
      20.  00:58E6  5F                  	ld	e,a		; de = y*256+x
      21.  00:58E7                      
      22.  00:58E7  3A 33 CB            	ld	a,(_displaypage)
      23.  00:58EA  87 87               [2] add a,a
      24.  00:58EC  F3                  	di
      25.  00:58ED  D3 99               	out (0x99),a 	; set bits 14-16
      26.  00:58EF  3E 8E               	ld a,14+128
      27.  00:58F1  D3 99               	out (0x99),a
      28.  00:58F3  FB                  	ei
      29.  00:58F4  16 50               	ld	d,0x50		; write access
      30.  00:58F6  CD 7A 59            	call	_2nd	; trace 48 pixels
      31.  00:58F9                      	
      32.  00:58F9  3A 33 CB            	ld	a,(_displaypage)
      33.  00:58FC  87 87               [2] add a,a
      34.  00:58FE  F6 01               	or	1
      35.  00:5900  F3                  	di
      36.  00:5901  D3 99               	out (0x99),a 	; set bits 14-16
      37.  00:5903  3E 8E               	ld a,14+128
      38.  00:5905  D3 99               	out (0x99),a
      39.  00:5907  FB                  	ei
      40.  00:5908  16 40               	ld	d,0x40		; write access
      41.  00:590A  CD 4D 59            	call	_1st	; trace 64 pixels
      42.  00:590D                      	
      43.  00:590D  3A 33 CB            	ld	a,(_displaypage)
      44.  00:5910  87 87               [2] add a,a
      45.  00:5912  F6 02               	or	2
      46.  00:5914  F3                  	di
      47.  00:5915  D3 99               	out (0x99),a 	; set bits 14-16
      48.  00:5917  3E 8E               	ld a,14+128
      49.  00:5919  D3 99               	out (0x99),a
      50.  00:591B  FB                  	ei
      51.  00:591C  16 40               	ld	d,0x40		; write access
      52.  00:591E  CD 7A 59            	call	_2nd	; trace 48 pixels
      53.  00:5921                      
      54.  00:5921  C9                  	ret
      55.  00:5922                      
      56.  00:5922                      
      57.  00:5922                      ; plot_line:
      58.  00:5922                      	; ld	a,(_xoffset)
      59.  00:5922                      	; add a,e
      60.  00:5922                      	; ld	e,a		; de = y*256+x
      61.  00:5922                      
      62.  00:5922                      	; ld	a,(_displaypage)
      63.  00:5922                      ; [2] add a,a
      64.  00:5922                      	; di
      65.  00:5922                      	; out (0x99),a 	; set bits 14-16
      66.  00:5922                      	; ld a,14+128
      67.  00:5922                      	; out (0x99),a
      68.  00:5922                      	; ei
      69.  00:5922                      	; ld	d,0x40		; write access
      70.  00:5922                      	; call	_1st
      71.  00:5922                      	
      72.  00:5922                      	; ld	a,(_displaypage)
      73.  00:5922                      ; [2] add a,a
      74.  00:5922                      	; or	1
      75.  00:5922                      	; di
      76.  00:5922                      	; out (0x99),a 	; set bits 14-16
      77.  00:5922                      	; ld a,14+128
      78.  00:5922                      	; out (0x99),a
      79.  00:5922                      	; ei
      80.  00:5922                      	; ld	d,0x40		; write access
      81.  00:5922                      	; call	_1st	
      82.  00:5922                      	
      83.  00:5922                      	; ld	a,(_displaypage)
      84.  00:5922                      ; [2] add a,a
      85.  00:5922                      	; or	2
      86.  00:5922                      	; di
      87.  00:5922                      	; out (0x99),a 	; set bits 14-16
      88.  00:5922                      	; ld a,14+128
      89.  00:5922                      	; out (0x99),a
      90.  00:5922                      	; ei
      91.  00:5922                      	; ld	d,0x40		; write access
      92.  00:5922                      	; call	_2nd
      93.  00:5922                      
      94.  00:5922                      	; ret
      95.  00:5922                      	
      96.  00:5922                      _1stblock:
      97.  00:5922                      ; hl ->   Map in RAM
      98.  00:5922  7E                  	ld	a,(hl)
      99.  00:5923  07 07 07            [3]	rlca
     100.  00:5926  E6 07               	and	00000111B
     101.  00:5928  C6 04               	add	a,:_tiles0
     102.  00:592A  32 00 B0            	ld	(_kBank4),a
     103.  00:592D  7E                  	ld	a,(hl)
     104.  00:592E  E6 1F               	and	00011111B
     105.  00:5930  C6 A0               	add	a,high _tiles0
     106.  00:5932  67                  	ld	h,a
     107.  00:5933  3A 35 CB            	ld	a,(_xoffset)
     108.  00:5936  87 87 87 87         [4]	add	a,a
     109.  00:593A  6F                  	ld	l,a
     110.  00:593B                      
     111.  00:593B                      	; hl -> tile column
     112.  00:593B                      
     113.  00:593B  01 98 10            	ld	bc,16*256+0x98
     114.  00:593E  F3                  	di
     115.  00:593F  7B                  1:	ld a,e 		;set bits 0-7
     116.  00:5940  D3 99               	out (0x99),a
     117.  00:5942  7A                  	ld a,d 		;set bits 8-13
     118.  00:5943  D3 99               	out (0x99),a
     119.  00:5945  14                  	inc	d
     120.  00:5946  ED A3               	outi
     121.  00:5948  C2 3F 59            	jp	nz,1b
     122.  00:594B  FB                  	ei
     123.  00:594C  C9                  	ret
     124.  00:594D                      	
     125.  00:594D                      _1st:
     126.  00:594D                      ; hl ->   Map in RAM
     127.  00:594D  E5                  	push	hl
     128.  00:594E                      		
     129.  00:594E  7E                  	ld	a,(hl)
     130.  00:594F  07 07 07            [3]	rlca
     131.  00:5952  E6 07               	and	00000111B
     132.  00:5954  C6 04               	add	a,:_tiles0
     133.  00:5956  32 00 B0            	ld	(_kBank4),a
     134.  00:5959  7E                  	ld	a,(hl)
     135.  00:595A  E6 1F               	and	00011111B
     136.  00:595C  C6 A0               	add	a,high _tiles0
     137.  00:595E  67                  	ld	h,a
     138.  00:595F  3A 35 CB            	ld	a,(_xoffset)
     139.  00:5962  87 87 87 87         [4]	add	a,a
     140.  00:5966  6F                  	ld	l,a
     141.  00:5967                      
     142.  00:5967                      	; hl -> tile column
     143.  00:5967                      
     144.  00:5967  01 98 10            	ld	bc,16*256+0x98
     145.  00:596A  F3                  	di
     146.  00:596B  7B                  1:	ld a,e 		;set bits 0-7
     147.  00:596C  D3 99               	out (0x99),a
     148.  00:596E  7A                  	ld a,d 		;set bits 8-13
     149.  00:596F  D3 99               	out (0x99),a
     150.  00:5971  14                  	inc	d
     151.  00:5972  ED A3               	outi
     152.  00:5974  C2 6B 59            	jp	nz,1b
     153.  00:5977  FB                  	ei
     154.  00:5978                      	
     155.  00:5978  E1                  	pop	hl
     156.  00:5979  24                  	inc h
     157.  00:597A                      _2nd:
     158.  00:597A                      	repeat 3
     159.  00:597A                    < 	push	hl
     160.  00:597A                    < 		
     161.  00:597A                    < 	ld	a,(hl)
     162.  00:597A                    < [3]	rlca
     163.  00:597A                    < 	and	00000111B
     164.  00:597A                    < 	add	a,:_tiles0
     165.  00:597A                    < 	ld	(_kBank4),a
     166.  00:597A                    < 	ld	a,(hl)
     167.  00:597A                    < 	and	00011111B
     168.  00:597A                    < 	add	a,high _tiles0
     169.  00:597A                    < 	ld	h,a
     170.  00:597A                    < 	ld	a,(_xoffset)
     171.  00:597A                    < [4]	add	a,a
     172.  00:597A                    < 	ld	l,a
     173.  00:597A                    < 
     174.  00:597A                    < 	; hl -> tile column
     175.  00:597A                    < 
     176.  00:597A                    < 	ld	bc,16*256+0x98
     177.  00:597A                    < 	di
     178.  00:597A                    < 1:	ld a,e 		;set bits 0-7
     179.  00:597A                    < 	out (0x99),a
     180.  00:597A                    < 	ld a,d 		;set bits 8-13
     181.  00:597A                    < 	out (0x99),a
     182.  00:597A                    < 	inc	d
     183.  00:597A                    < 	outi
     184.  00:597A                    < 	jp	nz,1b
     185.  00:597A                    < 	ei
     186.  00:597A                    < 	
     187.  00:597A                    < 	pop	hl
     188.  00:597A                    < 	inc h
     189.  00:597A                    < 	endrepeat
     189.  00:597A  E5 7E 07 07 07 E6 07 C6 04 32 00 B0 7E E6 1F C6 
     189.  00:598A  A0 67 3A 35 CB 87 87 87 87 6F 01 98 10 F3 7B D3 
     189.  00:599A  99 7A D3 99 14 ED A3 C2 98 59 FB E1 24 E5 7E 07 
     189.  00:59AA  07 07 E6 07 C6 04 32 00 B0 7E E6 1F C6 A0 67 3A 
     189.  00:59BA  35 CB 87 87 87 87 6F 01 98 10 F3 7B D3 99 7A D3 
     189.  00:59CA  99 14 ED A3 C2 C5 59 FB E1 24 E5 7E 07 07 07 E6 
     189.  00:59DA  07 C6 04 32 00 B0 7E E6 1F C6 A0 67 3A 35 CB 87 
     189.  00:59EA  87 87 87 6F 01 98 10 F3 7B D3 99 7A D3 99 14 ED 
     189.  00:59FA  A3 C2 F2 59 FB E1 24 
     190.  00:5A01  C9                  	ret
     191.  00:5A02                      	
     340   00:5A02                      	include color_update.asm
       1.  00:5A02                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       2.  00:5A02                      ; update main ship
       3.  00:5A02                      ;
       4.  00:5A02                      	
       5.  00:5A02                      _plot_spt:
       6.  00:5A02  0E 00               	ld		c,0
       7.  00:5A04  11 00 F0            	ld		de,0F000h
       8.  00:5A07  CD A5 41            	call	_vdpsetvramwr
       9.  00:5A0A                      	
      10.  00:5A0A  3E 03               	ld	a, :ms_spt
      11.  00:5A0C  32 00 B0            	ld	(_kBank4),a
      12.  00:5A0F                      
      13.  00:5A0F  2A 4B CB            	ld	hl,(aniframe)
      14.  00:5A12  7D                  	ld	a,l
      15.  00:5A13  BC                  	cp	h
      16.  00:5A14  C8                  	ret	z
      17.  00:5A15  32 4D CB            	ld	(old_aniframe),a
      18.  00:5A18  21 EB 49            	ld	hl,ms_ani
      19.  00:5A1B  4F                  	ld	c,a
      20.  00:5A1C  06 00               	ld	b,0
      21.  00:5A1E  09                  	add	hl,bc
      22.  00:5A1F  6E                  	ld	l,(hl)
      23.  00:5A20  60                  	ld	h,b
      24.  00:5A21  29 29 29 29 29      [5]	add hl,hl
      25.  00:5A26  5D                  	ld	e,l
      26.  00:5A27  54                  	ld	d,h
      27.  00:5A28  29                  	add	hl,hl
      28.  00:5A29  19                  	add	hl,de
      29.  00:5A2A  11 80 A6            	ld	de,ms_spt
      30.  00:5A2D  19                  	add hl,de
      31.  00:5A2E  0E 98               	ld	c,0x98
      32.  00:5A30  CD 38 5A            	call	out48
      33.  00:5A33  3E FF               	ld	a,-1
      34.  00:5A35  32 34 CB            	ld	(_mccolorchange),a
      35.  00:5A38                      out48:
      36.  00:5A38                      [16]	outi
      36.  00:5A38  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      36.  00:5A48  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      37.  00:5A58                      out32:
      38.  00:5A58                      [16]	outi
      38.  00:5A58  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      38.  00:5A68  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      39.  00:5A78                      out16:
      40.  00:5A78                      [16]	outi
      40.  00:5A78  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      40.  00:5A88  ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 ED A3 
      41.  00:5A98  C9                  	ret
      42.  00:5A99                      	
      43.  00:5A99                      
      44.  00:5A99                      set_manta_color
      45.  00:5A99  3A 34 CB            	ld	a,(_mccolorchange)
      46.  00:5A9C  A7                  	and	a
      47.  00:5A9D  C8                  	ret z
      48.  00:5A9E  F3                  	di
      49.  00:5A9F  7B                  	ld a,e 					; set bits 0-7
      50.  00:5AA0  D3 99               	out (0x99),a
      51.  00:5AA2  7A                  	ld a,d 					; set bits 8-13 with write access
      52.  00:5AA3  D3 99               	out (0x99),a
      53.  00:5AA5                      
      54.  00:5AA5  AF                  	xor	a
      55.  00:5AA6  32 34 CB            	ld	(_mccolorchange),a
      56.  00:5AA9  F3                  	di
      57.  00:5AAA  3E 03               	ld	a, :manta_color
      58.  00:5AAC  32 00 B0            	ld	(_kBank4),a
      59.  00:5AAF                      	
      60.  00:5AAF  ED 4B 4B CB         	ld	bc,(aniframe)
      61.  00:5AB3  06 00               	ld	b,0
      62.  00:5AB5  21 EB 49            	ld	hl,ms_ani
      63.  00:5AB8  09                  	add	hl,bc
      64.  00:5AB9  6E                  	ld	l,(hl)
      65.  00:5ABA  60                  	ld	h,b
      66.  00:5ABB  29 29 29 29 29      [5]	add hl,hl
      67.  00:5AC0  01 00 A0            	ld  bc,manta_color
      68.  00:5AC3  09                  	add	hl,bc
      69.  00:5AC4  0E 98               	ld	c,0x98
      70.  00:5AC6  CD 58 5A            	call	out32
      71.  00:5AC9  C9                  	ret
      72.  00:5ACA                      		
      73.  00:5ACA                      
      74.  00:5ACA                      color_enemy:
      75.  00:5ACA  CD 02 5A            	call 	_plot_spt
      76.  00:5ACD  3A 53 CB            	ld	a,(flip_flop)
      77.  00:5AD0  E6 01               	and	1
      78.  00:5AD2  C2 28 5B            	jp nz, reversecolor_enemy
      79.  00:5AD5                      	
      80.  00:5AD5                      directcolor_enemy:		
      81.  00:5AD5                      		
      82.  00:5AD5  3E 03               	ld	a,3
      83.  00:5AD7  D3 99               	out (0x99),a 		;set bits 14-16 of F800h
      84.  00:5AD9  3E 8E               	ld a,14+128
      85.  00:5ADB  D3 99               	out (0x99),a
      86.  00:5ADD                      		
      87.  00:5ADD  11 00 78            	ld		de,07800h	; F800h 3 positions  for bullets and manta
      88.  00:5AE0                      	
      89.  00:5AE0  CD 99 5A            	call	set_manta_color
      90.  00:5AE3                      
      91.  00:5AE3  3E 1C               	ld	a, :color_base
      92.  00:5AE5  32 00 B0            	ld	(_kBank4),a
      93.  00:5AE8                      
      94.  00:5AE8  11 80 78            	ld		de,16*(3+max_bullets+max_enem_bullets)+07800h	; F800h 6 positions for bullets
      95.  00:5AEB                      	
      96.  00:5AEB  DD 21 AB CB         	ld	ix,enemies		; process two layer enemies
      97.  00:5AEF                      
      98.  00:5AEF  01 98 0C            	ld	bc,256*max_enem+0x98
      99.  00:5AF2                      		
     100.  00:5AF2  DD CB 07 46         1:	bit	0,(ix+enemy_data.status)
     101.  00:5AF6  CA 19 5B            	jp	z,.next
     102.  00:5AF9                      		
     103.  00:5AF9  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     104.  00:5AFC  DD BE 0B            	cp  (ix+enemy_data.color)
     105.  00:5AFF  CA 19 5B            	jp	z,.next
     106.  00:5B02                      	
     107.  00:5B02  DD 77 0B            	ld   (ix+enemy_data.color),a
     108.  00:5B05                      	
     109.  00:5B05  6F                  	ld	l,a					; color x 4
     110.  00:5B06  26 00               	ld	h,0
     111.  00:5B08  29 29               [2]	add hl,hl				; color x 16
     112.  00:5B0A                      		
     113.  00:5B0A  3E A0               	ld	a,high color_base	; nb: the first 16 patterns reserved to mship, explosions and bullets
     114.  00:5B0C  84                  	add	a,h
     115.  00:5B0D  67                  	ld	h,a
     116.  00:5B0E                      	
     117.  00:5B0E  7B                  	ld a,e 					; set bits 0-7
     118.  00:5B0F  D3 99               	out (0x99),a
     119.  00:5B11  7A                  	ld a,d 					; set bits 8-13 with write access
     120.  00:5B12  D3 99               	out (0x99),a
     121.  00:5B14  78                  	ld	a,b
     122.  00:5B15  CD 58 5A            	call out32
     123.  00:5B18  47                  	ld b,a
     124.  00:5B19                      
     125.  00:5B19                      .next
     126.  00:5B19  C5                  	push bc
     127.  00:5B1A  01 0F 00            	ld	bc,enemy_data
     128.  00:5B1D  DD 09               	add ix,bc
     129.  00:5B1F  C1                  	pop bc
     130.  00:5B20  21 20 00            	ld hl,32
     131.  00:5B23  19                  	add hl,de
     132.  00:5B24  EB                  	ex de,hl
     133.  00:5B25                      	
     134.  00:5B25  10 CB               	djnz	1b
     135.  00:5B27  C9                  	ret
     136.  00:5B28                      
     137.  00:5B28                      reversecolor_enemy:
     138.  00:5B28  11 00 7C            	ld		de,07C00h	; FC00h 6 positions for bullets
     139.  00:5B2B                      
     140.  00:5B2B  3E 03               	ld	a,3
     141.  00:5B2D  D3 99               	out (0x99),a 		;set bits 14-16 of F800h
     142.  00:5B2F  3E 8E               	ld a,14+128
     143.  00:5B31  D3 99               	out (0x99),a
     144.  00:5B33                      	
     145.  00:5B33  3E 1C               	ld	a, :color_base
     146.  00:5B35  32 00 B0            	ld	(_kBank4),a
     147.  00:5B38                      	
     148.  00:5B38  DD 21 50 CC         	ld	ix,enemies+(max_enem-1)*enemy_data
     149.  00:5B3C                      	
     150.  00:5B3C  01 98 0C            	ld	bc,0x98+256*max_enem
     151.  00:5B3F                      	
     152.  00:5B3F  DD CB 07 46         1:	bit	0,(ix+enemy_data.status)
     153.  00:5B43  CA 66 5B            	jp	z,.next
     154.  00:5B46                      	
     155.  00:5B46  DD 7E 0A            	ld	a,(ix+enemy_data.frame)
     156.  00:5B49  DD BE 0C            	cp  (ix+enemy_data.color2)
     157.  00:5B4C  CA 66 5B            	jp	z,.next
     158.  00:5B4F                      	
     159.  00:5B4F  DD 77 0C            	ld   (ix+enemy_data.color2),a
     160.  00:5B52                      	
     161.  00:5B52  6F                  	ld	l,a					; color x 4
     162.  00:5B53  26 00               	ld	h,0
     163.  00:5B55  29 29               [2]	add hl,hl				; color x 16
     164.  00:5B57                      	
     165.  00:5B57  3E A0               	ld	a,high color_base	; nb: the first 16 patterns reserved to mship, explosions and bullets
     166.  00:5B59  84                  	add	a,h
     167.  00:5B5A  67                  	ld	h,a
     168.  00:5B5B                      	
     169.  00:5B5B  7B                  	ld a,e 					; set bits 0-7
     170.  00:5B5C  D3 99               	out (0x99),a
     171.  00:5B5E  7A                  	ld a,d 					; set bits 8-13 with write access
     172.  00:5B5F  D3 99               	out (0x99),a
     173.  00:5B61  78                  	ld	a,b
     174.  00:5B62  CD 58 5A            	call out32
     175.  00:5B65  47                  	ld b,a
     176.  00:5B66                      
     177.  00:5B66                      .next
     178.  00:5B66  C5                  	push bc
     179.  00:5B67  01 F1 FF            	ld	bc,-enemy_data
     180.  00:5B6A  DD 09               	add ix,bc
     181.  00:5B6C  C1                  	pop bc
     182.  00:5B6D  21 20 00            	ld hl,32
     183.  00:5B70  19                  	add hl,de
     184.  00:5B71  EB                  	ex de,hl
     185.  00:5B72                      	
     186.  00:5B72  10 CB               	djnz	1b
     187.  00:5B74                      		
     188.  00:5B74                      	
     189.  00:5B74  11 D0 7D            	ld	de,07C00h+16*(2*max_enem+max_bullets + max_enem_bullets)	; FC00h 6 positions for bullets
     190.  00:5B77                      
     191.  00:5B77  C3 99 5A            	jp	set_manta_color
     192.  00:5B7A                      
     193.  00:5B7A                      
     341   00:5B7A                      ms_bllts_col_win:
     342   00:5B7A                      	include ms_bllts_frm_coll_wind.asm
       1.  00:5B7A                      ms_bllts_coll_wind:
       2.  00:5B7A  05 0B 02 0E             defb 5,11,2,14 ; xmin,xmax,ymin,ymax
       3.  00:5B7E  05 0B 04 0D             defb 5,11,4,13 
       4.  00:5B82  05 0B 06 0B             defb 5,11,6,11 
       5.  00:5B86  05 0B 07 0A             defb 5,11,7,10 
       6.  00:5B8A  05 0B 08 08             defb 5,11,8,8 
       7.  00:5B8E  05 0B 07 0A             defb 5,11,7,10 
       8.  00:5B92  05 0B 06 0B             defb 5,11,6,11 
       9.  00:5B96  05 0B 04 0D             defb 5,11,4,13 
      10.  00:5B9A                      
     343   00:5B9A                      	include	ms_bllts.asm
       1.  00:5B9A                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       2.  00:5B9A                      ; activate ms bullets
       3.  00:5B9A                      ;
       4.  00:5B9A  (00:0005)           max_bullet_rate equ 5
       5.  00:5B9A                      
       6.  00:5B9A                      ms_shoot:
       7.  00:5B9A  3A 40 CB            	ld	a,(bullet_rate)
       8.  00:5B9D  A7                  	and a
       9.  00:5B9E  CA A6 5B            	jp	z,.book_bullet
      10.  00:5BA1  3D                  	dec a
      11.  00:5BA2  32 40 CB            	ld	(bullet_rate),a
      12.  00:5BA5  C9                  	ret
      13.  00:5BA6                      .book_bullet:
      14.  00:5BA6  3E 05               	ld	a,max_bullet_rate
      15.  00:5BA8  32 40 CB            	ld	(bullet_rate),a
      16.  00:5BAB                      
      17.  00:5BAB  DD 21 60 CB         	ld	ix,ms_bullets
      18.  00:5BAF  06 02               	ld	b,max_bullets
      19.  00:5BB1  11 0F 00            	ld	de,enemy_data
      20.  00:5BB4  DD CB 07 46         1:	bit	0,(ix+enemy_data.status)
      21.  00:5BB8  28 05               	jr	z,.activate_this
      22.  00:5BBA  DD 19               	add ix,de
      23.  00:5BBC  10 F6               	djnz   1b
      24.  00:5BBE  C9                  	ret
      25.  00:5BBF                      
      26.  00:5BBF                      .activate_this:
      27.  00:5BBF  AF                  	xor	a				; ms bullet
      28.  00:5BC0  CD F4 56            	call AFXPLAY
      29.  00:5BC3                      
      30.  00:5BC3  3A 4C CB            	ld	a,(ms_state)	; in states 0-3 ms faces right
      31.  00:5BC6  E6 04               	and 0x04
      32.  00:5BC8  20 0A               	jr	nz,.shootsx
      33.  00:5BCA                      .shootdx
      34.  00:5BCA  DD 36 07 01         	ld	(ix+enemy_data.status),1
      35.  00:5BCE  21 08 00            	ld	hl,8
      36.  00:5BD1  C3 DB 5B            	jp	1f
      37.  00:5BD4                      
      38.  00:5BD4                      .shootsx
      39.  00:5BD4  DD 36 07 41         	ld	(ix+enemy_data.status),1 + 64
      40.  00:5BD8  21 F8 FF            	ld	hl,-8
      41.  00:5BDB                      1:
      42.  00:5BDB  3A 4B CB            	ld	a,(aniframe)
      43.  00:5BDE  E6 07               	and 7
      44.  00:5BE0  C6 08               	add a,8
      45.  00:5BE2  87                  	add a,a
      46.  00:5BE3  87                  	add a,a
      47.  00:5BE4  DD 77 0A            	ld	(ix+enemy_data.frame),a
      48.  00:5BE7                      
      49.  00:5BE7  CD C4 48            	call	bullet_set_size	; set  xoff,yoff,xsize,ysize for sprite collision
      50.  00:5BEA                      
      51.  00:5BEA  3A 43 CB            	ld	a,(dxmap)
      52.  00:5BED  CB 2F CB 2F         [2] sra a
      53.  00:5BF1  5F                  	ld	e,a
      54.  00:5BF2  17                  	rla
      55.  00:5BF3  9F                  	sbc a,a
      56.  00:5BF4  57                  	ld	d,a
      57.  00:5BF5                      
      58.  00:5BF5  19                  	add hl,de
      59.  00:5BF6  DD 75 0D            	ld	(ix+enemy_data.speed),l
      60.  00:5BF9  DD 74 0E            	ld	(ix+enemy_data.speed+1),h
      61.  00:5BFC                      
      62.  00:5BFC  2A 49 CB            	ld	hl,(xship)
      63.  00:5BFF  DD 75 01            	ld	(ix+enemy_data.x),l
      64.  00:5C02  DD 74 02            	ld	(ix+enemy_data.x+1),h
      65.  00:5C05                      
      66.  00:5C05  3A 48 CB            	ld	a,(yship)
      67.  00:5C08  DD 77 00            	ld	(ix+enemy_data.y),a
      68.  00:5C0B  DD 36 08 11         	ld	(ix+enemy_data.cntr),17
      69.  00:5C0F  C9                  	ret
      70.  00:5C10                      
      71.  00:5C10                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      72.  00:5C10                      ; manage active ms bullets
      73.  00:5C10                      ;
      74.  00:5C10                      
      75.  00:5C10                      bullet_loop:
      76.  00:5C10  DD 21 60 CB         	ld	ix,ms_bullets
      77.  00:5C14                      	
      78.  00:5C14                      	repeat	max_bullets
      79.  00:5C14                    < 	bit	 0,(ix+enemy_data.status)
      80.  00:5C14                    < 	jr	z,1f
      81.  00:5C14                    < 
      82.  00:5C14                    < 	; move right or	 left
      83.  00:5C14                    < 
      84.  00:5C14                    < 	ld	l,(ix+enemy_data.x)
      85.  00:5C14                    < 	ld	h,(ix+enemy_data.x+1)
      86.  00:5C14                    < 	ld	e,(ix+enemy_data.speed)
      87.  00:5C14                    < 	ld	d,(ix+enemy_data.speed+1)
      88.  00:5C14                    < 	add hl,de
      89.  00:5C14                    < 	ld	(ix+enemy_data.x),l
      90.  00:5C14                    < 	ld	(ix+enemy_data.x+1),h
      91.  00:5C14                    < 
      92.  00:5C14                    < 	ld	a,(ix+enemy_data.y)
      93.  00:5C14                    < 
      94.  00:5C14                    < 	call	.test_obstacles
      95.  00:5C14                    < 	jr		z,.blocked
      96.  00:5C14                    < 	
      97.  00:5C14                    < 	dec	(ix+enemy_data.cntr)
      98.  00:5C14                    < 	jr	nz,1f
      99.  00:5C14                    < .blocked
     100.  00:5C14                    < 	res 0,(ix+enemy_data.status)
     101.  00:5C14                    < 1:
     102.  00:5C14                    < 	ld	de,enemy_data
     103.  00:5C14                    < 	add ix,de
     104.  00:5C14                    < 	
     105.  00:5C14                    < 	endrepeat
     105.  00:5C14  DD CB 07 46 28 24 DD 6E 01 DD 66 02 DD 5E 0D DD 
     105.  00:5C24  56 0E 19 DD 75 01 DD 74 02 DD 7E 00 CD 73 5C 28 
     105.  00:5C34  05 DD 35 08 20 04 DD CB 07 86 11 0F 00 DD 19 DD 
     105.  00:5C44  CB 07 46 28 24 DD 6E 01 DD 66 02 DD 5E 0D DD 56 
     105.  00:5C54  0E 19 DD 75 01 DD 74 02 DD 7E 00 CD 73 5C 28 05 
     105.  00:5C64  DD 35 08 20 04 DD CB 07 86 11 0F 00 DD 19 
     106.  00:5C72  C9                  	ret
     107.  00:5C73                      
     108.  00:5C73                      ; hl  = X, a = Y
     109.  00:5C73                      ; de = x_speed
     110.  00:5C73                      ;
     111.  00:5C73                      ; return Z is an obstacle is found
     112.  00:5C73                      .test_obstacles:
     113.  00:5C73  DD 4E 0A            	ld	c,(ix+enemy_data.frame)
     114.  00:5C76  06 00               	ld	b,0
     115.  00:5C78  FD 21 5A 5B         	ld	iy,ms_bllts_col_win-32	; bullet frames go from 32 to 60 step 4
     116.  00:5C7C  FD 09               	add	iy,bc					; here iy points to the collision window of the current frame of the bullet
     117.  00:5C7E                      
     118.  00:5C7E  CB 7A               	bit	7,d						; test direction of the bullet
     119.  00:5C80  28 06               	jr	z,2f					
     120.  00:5C82  FD 5E 00            	ld	e,(iy+0)				; direction x negative -> take xmin of the frame
     121.  00:5C85  C3 8B 5C            	jp	3f
     122.  00:5C88                      
     123.  00:5C88  FD 5E 01            2:	ld	e,(iy+1)				; direction x positive  -> take xmax of the frame
     124.  00:5C8B                      	
     125.  00:5C8B  16 00               3:	ld	d,0
     126.  00:5C8D  19                  	add hl,de
     127.  00:5C8E                      	
     128.  00:5C8E  FD 86 02            	add	a,(iy+2)				; add ymin to y
     129.  00:5C91                      	
     130.  00:5C91  57                  	ld	d,a						; HL is x, A is y
     131.  00:5C92                      	
     132.  00:5C92  01 00 C0            	ld	bc,_levelmap
     133.  00:5C95  0F 0F 0F 0F         [4]	rrca
     134.  00:5C99  E6 0F               	and 15
     135.  00:5C9B  29 29 29 29         [4]	add	hl,hl
     136.  00:5C9F  6C                  	ld	l,h
     137.  00:5CA0  67                  	ld	h,a
     138.  00:5CA1  09                  	add	hl,bc
     139.  00:5CA2  7E                  	ld	a,(hl)
     140.  00:5CA3                      	;XXXXXXX add actual test for obstacles
     141.  00:5CA3  FE F0               	cp 	240
     142.  00:5CA5  C8                  	ret	z
     143.  00:5CA6  FE F1               	cp 	241
     144.  00:5CA8  C8                  	ret	z						; skip the rest if already hit
     145.  00:5CA9                      
     146.  00:5CA9  7A                  	ld	a,d
     147.  00:5CAA  E6 F0               	and	0xF0
     148.  00:5CAC  57                  	ld	d,a
     149.  00:5CAD  DD 7E 00            	ld	a,(ix+enemy_data.y)
     150.  00:5CB0  FD 86 03            	add	a,(iy+3)
     151.  00:5CB3  E6 F0               	and	0xF0
     152.  00:5CB5  BA                  	cp	d
     153.  00:5CB6  CA C1 5C            	jp	z,1f					; avoid testing twice the same 16x16 tile
     154.  00:5CB9  24                  	inc	h
     155.  00:5CBA  7E                  	ld	a,(hl)
     156.  00:5CBB                      	;XXXXXXX add actual test for obstacles
     157.  00:5CBB  FE F0               	cp 	240
     158.  00:5CBD  C8                  	ret	z
     159.  00:5CBE  FE F1               	cp 	241
     160.  00:5CC0  C9                  	ret
     161.  00:5CC1                      1:	
     162.  00:5CC1  3C                  	inc	a
     163.  00:5CC2  BA                  	cp	d				; ret with nz
     164.  00:5CC3  C9                  	ret
     165.  00:5CC4                      	
     166.  00:5CC4                      
     167.  00:5CC4                      	
     168.  00:5CC4                      
     169.  00:5CC4                      
     170.  00:5CC4                      	
     171.  00:5CC4                      	
     172.  00:5CC4                      ; .tst_block:
     173.  00:5CC4                      	; call test_obstacles.meta_tile_peek
     174.  00:5CC4                      	; ld	e,a
     175.  00:5CC4                      	; dec	a					; deal with space apart
     176.  00:5CC4                      	; cp	nblock-1
     177.  00:5CC4                      	
     178.  00:5CC4                      	; jp	nc,.no_blocking		; a>22
     179.  00:5CC4                      	
     180.  00:5CC4                      ; .blocking:	
     181.  00:5CC4                      	; res 0,(ix+enemy_data.status)
     182.  00:5CC4                      	; ld	a,10			; hit solid wall
     183.  00:5CC4                      	; call AFXPLAY
     184.  00:5CC4                      	; xor	a
     185.  00:5CC4                      	; ret					; obstacle found - return Z
     186.  00:5CC4                      	
     187.  00:5CC4                      ; .no_blocking:
     188.  00:5CC4                      	; cp	nblock+n_d2x1-1
     189.  00:5CC4                      	; jp	nc,.no_2x1		; a>26
     190.  00:5CC4                      	
     191.  00:5CC4                      	; cp	nblock+1
     192.  00:5CC4                      	; jr	c,.left2x1		; two 2x1 items
     193.  00:5CC4                      	
     194.  00:5CC4                      ; .right2x1:
     195.  00:5CC4                      	; ld	a,(hl)
     196.  00:5CC4                      	; add	a,n_d2x1
     197.  00:5CC4                      	; ld	(hl),a
     198.  00:5CC4                      	; dec	hl
     199.  00:5CC4                      	; jr	1f
     200.  00:5CC4                      	
     201.  00:5CC4                      ; .left2x1:
     202.  00:5CC4                      	; ld	a,(hl)
     203.  00:5CC4                      	; add	a,n_d2x1
     204.  00:5CC4                      	; ld	(hl),a
     205.  00:5CC4                      	; inc	hl
     206.  00:5CC4                      ; 1:	ld	a,(hl)
     207.  00:5CC4                      	; add	a,n_d2x1
     208.  00:5CC4                      	; ld	(hl),a
     209.  00:5CC4                      
     210.  00:5CC4                      	; res 0,(ix+enemy_data.status)
     211.  00:5CC4                      	; ld	a,11			; destroy small ground item
     212.  00:5CC4                      	; call AFXPLAY
     213.  00:5CC4                      	; ld	bc,5			; score for destruction of a small ground item
     214.  00:5CC4                      	; call	add_bc_score_bin
     215.  00:5CC4                      	
     216.  00:5CC4                      	; call	land_now_test	; make LAND NOW arrive sooner
     217.  00:5CC4                      	; ret
     218.  00:5CC4                      	
     219.  00:5CC4                      ; .no_2x1:
     220.  00:5CC4                      	
     221.  00:5CC4                      	; cp	nblock+n_d2x1*2-1
     222.  00:5CC4                      	; jr	z,.left_up3x2
     223.  00:5CC4                      	; cp	nblock+n_d2x1*2+0
     224.  00:5CC4                      	; jr	z,.left_dw3x2
     225.  00:5CC4                      	; cp	nblock+n_d2x1*2+1
     226.  00:5CC4                      	; jr	z,.left_up3x2
     227.  00:5CC4                      	; cp	nblock+n_d2x1*2+2
     228.  00:5CC4                      	; jr	z,.left_dw3x2
     229.  00:5CC4                      
     230.  00:5CC4                      	; cp	nblock+n_d2x1*2+7
     231.  00:5CC4                      	; jr	z,.right_up3x2
     232.  00:5CC4                      	; cp	nblock+n_d2x1*2+8
     233.  00:5CC4                      	; jr	z,.right_dw3x2
     234.  00:5CC4                      	; cp	nblock+n_d2x1*2+9
     235.  00:5CC4                      	; jr	z,.right_up3x2
     236.  00:5CC4                      	; cp	nblock+n_d2x1*2+10
     237.  00:5CC4                      	; jr	z,.right_dw3x2
     238.  00:5CC4                      	
     239.  00:5CC4                      	; ret				; obstacle not found - return NZ
     240.  00:5CC4                      	
     241.  00:5CC4                      ; .left_dw3x2:
     242.  00:5CC4                      	; ld	bc,-LvlWidth
     243.  00:5CC4                      	; add hl,bc
     244.  00:5CC4                      	; jr	.left_up3x2
     245.  00:5CC4                      
     246.  00:5CC4                      ; .right_up3x2:
     247.  00:5CC4                      ; [2]	dec hl
     248.  00:5CC4                      	; jr	.left_up3x2
     249.  00:5CC4                      
     250.  00:5CC4                      ; .right_dw3x2:
     251.  00:5CC4                      	; ld	bc,-LvlWidth-2
     252.  00:5CC4                      	; add hl,bc
     253.  00:5CC4                      
     254.  00:5CC4                      ; .left_up3x2:
     255.  00:5CC4                      	; repeat 3
     256.  00:5CC4                      	; ld	a,(hl)
     257.  00:5CC4                      	; add	a,n_d3x2
     258.  00:5CC4                      	; ld	(hl),a
     259.  00:5CC4                      	; inc	hl
     260.  00:5CC4                      	; endrepeat
     261.  00:5CC4                      	; ld	bc,LvlWidth-3
     262.  00:5CC4                      	; add hl,bc
     263.  00:5CC4                      	; repeat 3
     264.  00:5CC4                      	; ld	a,(hl)
     265.  00:5CC4                      	; add	a,n_d3x2
     266.  00:5CC4                      	; ld	(hl),a
     267.  00:5CC4                      	; inc	hl
     268.  00:5CC4                      	; endrepeat
     269.  00:5CC4                      	
     270.  00:5CC4                      	; res 0,(ix+enemy_data.status)
     271.  00:5CC4                      	; ld	a,12				; destroy large ground item
     272.  00:5CC4                      	; call AFXPLAY
     273.  00:5CC4                      	; ld	bc,50				; score for destruction of a large ground item
     274.  00:5CC4                      	; call	add_bc_score_bin
     275.  00:5CC4                      	
     276.  00:5CC4                      	; call	land_now_test	; make LAND NOW arrive sooner
     277.  00:5CC4                      	; ret
     278.  00:5CC4                      	
     279.  00:5CC4                      
     280.  00:5CC4                      	
     344   00:5CC4                      		
     345   00:5CC4                      ;-------------------------------------
     346   00:5CC4                      
     347   00:5CC4                      	
     348   00:5CC4  (01)                		page 1
     349   01:6000                      
     350   01:6000                      		include	"..\TTplayer\code\ttreplay.asm"
       1.  01:6000                      ;=================================
       2.  01:6000                      ; TriloTracker re-player v0.3.1
       3.  01:6000                      ;
       4.  01:6000                      ; 
       5.  01:6000                      ; Also expects the code to run as a cartridge with SCC mapper
       6.  01:6000                      ;================================
       7.  01:6000                      	
       8.  01:6000                      ;===============================
       9.  01:6000                      ; todo:
      10.  01:6000                      ; - add external SCC support through conditional code.
      11.  01:6000                      ; - add replayer speed up through conditional code.
      12.  01:6000                      ; - optimize replayer code
      13.  01:6000                      ; - instructions for external usage of the RAM variables (setting PSG/SCC base volumes etc)
      14.  01:6000                      
      15.  01:6000                      	
      16.  01:6000                      ;define EXTERNAL_SCC 
      17.  01:6000                      define INTERNAL_SCC	
      18.  01:6000                      	
      19.  01:6000                      	
      20.  01:6000                      ;===========================================================
      21.  01:6000                      ; ---	replay_init
      22.  01:6000                      ; Initialize replayer data
      23.  01:6000                      ; 
      24.  01:6000                      ; Input: none
      25.  01:6000                      ;===========================================================
      26.  01:6000                      replay_init:
      27.  01:6000  3E 08               	ld	a,8
      28.  01:6002  CD 3E 60            	call	replay_set_SCC_balance
      29.  01:6005  3E 08               	ld	a,8
      30.  01:6007  CD 45 60            	call	replay_set_PSG_balance
      31.  01:600A                      
      32.  01:600A  AF                  	xor	a
      33.  01:600B  32 10 01            	ld	(replay_mode),a	
      34.  01:600E                      	
      35.  01:600E  C9                  	ret
      36.  01:600F                      
      37.  01:600F                      ;===========================================================
      38.  01:600F                      ; ---	replay_pause
      39.  01:600F                      ; Stop/Restart music playback
      40.  01:600F                      ; 
      41.  01:600F                      ; Input: none
      42.  01:600F                      ;===========================================================
      43.  01:600F                      replay_pause:
      44.  01:600F  3A 10 01            	ld	a,(replay_mode)
      45.  01:6012  A7                  	and	a
      46.  01:6013  CA 24 60            	jp	z,_replay_pause_r
      47.  01:6016                      	;-- stop decding and processing music data
      48.  01:6016  AF                  	xor	a
      49.  01:6017  32 10 01            	ld	(replay_mode),a
      50.  01:601A                      	;-- set mixers to silence.
      51.  01:601A  3E 3F               	ld 	a,0x3F
      52.  01:601C  32 A7 02            	ld	(AY_regMIXER),a 
      53.  01:601F  AF                  	xor	a
      54.  01:6020  32 3D 03            	ld	(SCC_regMIXER),a
      55.  01:6023  C9                  	ret
      56.  01:6024                      _replay_pause_r:	
      57.  01:6024                      	;-- enable music decoding and processing
      58.  01:6024  3E 01               	ld	a,1
      59.  01:6026  32 10 01            	ld	(replay_mode),a
      60.  01:6029  C9                  	ret
      61.  01:602A                      
      62.  01:602A                      	
      63.  01:602A                      ;===========================================================
      64.  01:602A                      ; ---	replay_fade_out
      65.  01:602A                      ; Fade out the music. 
      66.  01:602A                      ; Once the sound is silence the replayer is paused.
      67.  01:602A                      ;
      68.  01:602A                      ; in: [A] fade speed (1 - 255)
      69.  01:602A                      ;===========================================================	
      70.  01:602A                      replay_fade_out:
      71.  01:602A  32 11 01            	ld	(replay_fade),a
      72.  01:602D  32 12 01            	ld	(replay_fade_timer),a
      73.  01:6030  AF                  	xor	a
      74.  01:6031  32 13 01            	ld	(replay_fade_vol),a
      75.  01:6034  C9                  	ret
      76.  01:6035                      
      77.  01:6035                      
      78.  01:6035                      ;===========================================================
      79.  01:6035                      ; ---	replay_transpose
      80.  01:6035                      ; Transposes the whole song. 
      81.  01:6035                      ; TT effect command 'E8y - Global transpose' will undo 
      82.  01:6035                      ; this effect.
      83.  01:6035                      ;
      84.  01:6035                      ; in: [DE] number of halve tones (pos or neg) to transpose. 
      85.  01:6035                      ;===========================================================
      86.  01:6035                      replay_transpose:
      87.  01:6035  21 98 AD            	ld	hl,TRACK_ToneTable;(replay_Tonetable)
      88.  01:6038  19                  	add	hl,de	
      89.  01:6039  19                  	add	hl,de
      90.  01:603A  22 19 01            	ld	(replay_Tonetable),hl	
      91.  01:603D  C9                  	ret
      92.  01:603E                      	
      93.  01:603E                      ;===========================================================
      94.  01:603E                      ; ---	replay_set_SCC_balance
      95.  01:603E                      ; Set the main volume for the SCC chip. This enables for
      96.  01:603E                      ; setting the balance between SCC en PSG as some MSX models 
      97.  01:603E                      ; default balance differs. 
      98.  01:603E                      ;
      99.  01:603E                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     100.  01:603E                      ;===========================================================	
     101.  01:603E                      replay_set_SCC_balance:
     102.  01:603E  CD 4C 60            	call	_getnewbalancebase
     103.  01:6041  22 05 01            	ld	(replay_mainSCCvol),hl	
     104.  01:6044  C9                  	ret
     105.  01:6045                      	
     106.  01:6045                      ;===========================================================
     107.  01:6045                      ; ---	replay_set_PSG_balance
     108.  01:6045                      ; Set the main volume for the PSG chip. This enables for
     109.  01:6045                      ; setting the balance between SCC en PSG as some MSX models 
     110.  01:6045                      ; default balance differs. 
     111.  01:6045                      ;
     112.  01:6045                      ; in: [A] master volume (0-7) 0=halve volume, 7=full volume. 
     113.  01:6045                      ;===========================================================	
     114.  01:6045                      replay_set_PSG_balance:
     115.  01:6045  CD 4C 60            	call	_getnewbalancebase
     116.  01:6048  22 03 01            	ld	(replay_mainPSGvol),hl	
     117.  01:604B  C9                  	ret
     118.  01:604C                      	
     119.  01:604C                      _getnewbalancebase:
     120.  01:604C  07                  	rlca
     121.  01:604D  07                  	rlca
     122.  01:604E  07                  	rlca
     123.  01:604F  07                  	rlca
     124.  01:6050  21 18 AC            	ld	hl,_VOLUME_TABLE-128
     125.  01:6053  E6 F0               	and	$f0
     126.  01:6055  85                  	add	a,l
     127.  01:6056  6F                  	ld	l,a
     128.  01:6057  D0                  	ret 	nc
     129.  01:6058  24                  	inc	h
     130.  01:6059  C9                  	ret
     131.  01:605A                      	
     132.  01:605A                      	
     133.  01:605A                      	
     134.  01:605A                      	
     135.  01:605A                      	
     136.  01:605A                      	
     137.  01:605A                      ;===========================================================
     138.  01:605A                      ; ---	replay_loadsong
     139.  01:605A                      ; Initialize a song for playback
     140.  01:605A                      ; 
     141.  01:605A                      ; Input [HL] points to start song
     142.  01:605A                      ;===========================================================
     143.  01:605A                      replay_loadsong:
     144.  01:605A                      	;--- Get the start speed.
     145.  01:605A  7E                  	ld	a,(hl)	
     146.  01:605B  23                  	inc	hl
     147.  01:605C  32 0D 01            	ld	(replay_speed),a
     148.  01:605F                      
     149.  01:605F                      	;--- Set waveform start
     150.  01:605F  5E                  	ld	e,(hl)
     151.  01:6060  23                  	inc	hl
     152.  01:6061  56                  	ld 	d,(hl)
     153.  01:6062  23                  	inc	hl
     154.  01:6063  7B                  	ld	a,e				; check for external waveforms
     155.  01:6064  B2                  	or	d
     156.  01:6065  CA 6C 60            	jp	z,.nwu			; is address is $0000 then do not update
     157.  01:6068  ED 53 07 01         	ld	(replay_wavebase),de
     158.  01:606C                      .nwu:	
     159.  01:606C                      	;--- Set the instrument start
     160.  01:606C  5E                  	ld	e,(hl)
     161.  01:606D  23                  	inc	hl
     162.  01:606E  56                  	ld 	d,(hl)
     163.  01:606F  23                  	inc	hl
     164.  01:6070  7B                  	ld	a,e				; check for external instruments
     165.  01:6071  B2                  	or	d
     166.  01:6072  CA 79 60            	jp	z,.niu			; is address is $0000 then do not update
     167.  01:6075  ED 53 09 01         	ld	(replay_insbase),de
     168.  01:6079                      .niu:
     169.  01:6079                      	;--- Set track pointers to start
     170.  01:6079  11 90 02            	ld	de,TRACK_pointer1
     171.  01:607C  01 10 00            	ld	bc,16
     172.  01:607F  ED B0               	ldir
     173.  01:6081  22 0B 01            	ld	(replay_orderpointer),hl		; store pointer for next set
     174.  01:6084                      								; of track pointers
     175.  01:6084                      	;--- Initialize replayer variables.
     176.  01:6084  AF                  	xor	a
     177.  01:6085  32 0E 01            	ld	(replay_speed_subtimer),a
     178.  01:6088  32 1B 01            	ld	(replay_morph_active),a
     179.  01:608B  32 5F 01            	ld	(replay_morph_waveform),a
     180.  01:608E                      	
     181.  01:608E                      	;--- Erase channel data	in RAM
     182.  01:608E  01 2F 01            	ld	bc,TRACK_REC_SIZE*8-1
     183.  01:6091  21 60 01            	ld	hl,TRACK_Chan1
     184.  01:6094  11 61 01            	ld	de,TRACK_Chan1+1
     185.  01:6097  77                  	ld	(hl),a
     186.  01:6098  ED B0               	ldir
     187.  01:609A                      	
     188.  01:609A                      	;--- Silence the chips
     189.  01:609A  32 3D 03            	ld	(SCC_regMIXER),a
     190.  01:609D  32 A8 02            	ld	(AY_regVOLA),a
     191.  01:60A0  32 A9 02            	ld	(AY_regVOLB),a	
     192.  01:60A3  32 AA 02            	ld	(AY_regVOLC),a
     193.  01:60A6  32 A6 02            	ld	(AY_regNOISE),a
     194.  01:60A9  3E 3F               	ld	a,0x3f
     195.  01:60AB  32 A7 02            	ld	(AY_regMIXER),a
     196.  01:60AE                      
     197.  01:60AE                      	;--- Set vibrato table
     198.  01:60AE  21 58 AE            	ld	hl,TRACK_Vibrato_sine
     199.  01:60B1  22 17 01            	ld	(replay_vib_table),hl
     200.  01:60B4                      	
     201.  01:60B4                      	;--- Set the tone table base
     202.  01:60B4  21 98 AD            	ld	hl,TRACK_ToneTable
     203.  01:60B7  22 19 01            	ld	(replay_Tonetable),hl
     204.  01:60BA                      
     205.  01:60BA  3E 01               	ld	a,1
     206.  01:60BC  32 0F 01            	ld	(replay_speed_timer),a
     207.  01:60BF  32 1C 01            	ld	(replay_morph_timer),a
     208.  01:60C2  32 1D 01            	ld	(replay_morph_speed),a
     209.  01:60C5  32 82 01            	ld	(TRACK_Chan1+17+TRACK_Delay),a	
     210.  01:60C8  32 A8 01            	ld	(TRACK_Chan2+17+TRACK_Delay),a		
     211.  01:60CB  32 CE 01            	ld	(TRACK_Chan3+17+TRACK_Delay),a	
     212.  01:60CE  32 F4 01            	ld	(TRACK_Chan4+17+TRACK_Delay),a	
     213.  01:60D1  32 1A 02            	ld	(TRACK_Chan5+17+TRACK_Delay),a		
     214.  01:60D4  32 40 02            	ld	(TRACK_Chan6+17+TRACK_Delay),a		
     215.  01:60D7  32 66 02            	ld	(TRACK_Chan7+17+TRACK_Delay),a		
     216.  01:60DA  32 8C 02            	ld	(TRACK_Chan8+17+TRACK_Delay),a	
     217.  01:60DD                      	
     218.  01:60DD  3E FE               	ld	a,254
     219.  01:60DF  32 60 01            	ld	(TRACK_Chan1+17+TRACK_Instrument),a	
     220.  01:60E2  32 86 01            	ld	(TRACK_Chan2+17+TRACK_Instrument),a		
     221.  01:60E5  32 AC 01            	ld	(TRACK_Chan3+17+TRACK_Instrument),a	
     222.  01:60E8  32 D2 01            	ld	(TRACK_Chan4+17+TRACK_Instrument),a	
     223.  01:60EB  32 F8 01            	ld	(TRACK_Chan5+17+TRACK_Instrument),a		
     224.  01:60EE  32 1E 02            	ld	(TRACK_Chan6+17+TRACK_Instrument),a		
     225.  01:60F1  32 44 02            	ld	(TRACK_Chan7+17+TRACK_Instrument),a		
     226.  01:60F4  32 6A 02            	ld	(TRACK_Chan8+17+TRACK_Instrument),a	
     227.  01:60F7                      
     228.  01:60F7                      IFDEF	EXTERNAL_SCC	
     229.  01:60F7                    ~ 	;--- Init the SCC	(waveforms too)
     230.  01:60F7                    ~ 	ld	a,(SCC_slot)
     231.  01:60F7                    ~ 	ld	h,0x80
     232.  01:60F7                    ~ 	call enaslt
     233.  01:60F7                    ~ ENDIF
     234.  01:60F7                      	
     235.  01:60F7  3E FF               	ld	a,255
     236.  01:60F9  32 DB 01            	ld	(TRACK_Chan4+17+TRACK_Waveform),a
     237.  01:60FC  32 01 02            	ld	(TRACK_Chan5+17+TRACK_Waveform),a
     238.  01:60FF  32 27 02            	ld	(TRACK_Chan6+17+TRACK_Waveform),a	
     239.  01:6102  32 4D 02            	ld	(TRACK_Chan7+17+TRACK_Waveform),a	
     240.  01:6105  3E 80               	ld	a,128
     241.  01:6107  32 DC 01            	ld	(TRACK_Chan4+17+TRACK_Flags),a
     242.  01:610A  32 02 02            	ld	(TRACK_Chan5+17+TRACK_Flags),a
     243.  01:610D  32 28 02            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     244.  01:6110  32 4E 02            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     245.  01:6113                      	
     246.  01:6113  CD BC 6B            	call scc_reg_update
     247.  01:6116                      	
     248.  01:6116                      IFDEF	EXTERNAL_SCC	
     249.  01:6116                    ~ 	ld	a,(mapper_slot)				
     250.  01:6116                    ~ 	ld	h,0x80
     251.  01:6116                    ~ 	call enaslt
     252.  01:6116                    ~ ENDIF	
     253.  01:6116                      
     254.  01:6116  CD 33 6B            	call	replay_route
     255.  01:6119                      	
     256.  01:6119                      	; end	is here
     257.  01:6119  3E 01               	ld	a,1
     258.  01:611B  32 10 01            	ld	(replay_mode),a	
     259.  01:611E  C9                  	ret
     260.  01:611F                      
     261.  01:611F                      
     262.  01:611F                      
     263.  01:611F                      _replay_check_patternend:
     264.  01:611F  3A 82 01            	ld 	a,(TRACK_Chan1+17+TRACK_Delay)
     265.  01:6122  3D                  	dec	a
     266.  01:6123  C2 ED 62            	jp	nz,replay_decodedata_NO
     267.  01:6126                      	
     268.  01:6126  2A 90 02            	ld	hl,(TRACK_pointer1)
     269.  01:6129  7E                  	ld	a,(hl)
     270.  01:612A                      	
     271.  01:612A                      	;--- check for end of pattern
     272.  01:612A  FE BF               	cp	191	
     273.  01:612C  C2 ED 62            	jp	nz,replay_decodedata_NO
     274.  01:612F                      
     275.  01:612F                      	;--- Set track pointers to start
     276.  01:612F  2A 0B 01            	ld	hl,(replay_orderpointer)
     277.  01:6132  AF                  	xor	a
     278.  01:6133  BE                  	cp	(hl)
     279.  01:6134  C2 43 61            	jp	nz,.no_restart
     280.  01:6137  23                  	inc	hl
     281.  01:6138  BE                  	cp	(hl)
     282.  01:6139  2B                  	dec	hl
     283.  01:613A  C2 43 61            	jp	nz,.no_restart
     284.  01:613D                      	;--- next is restart order
     285.  01:613D  23                  	inc	hl
     286.  01:613E  23                  	inc	hl
     287.  01:613F  7E                  	ld	a,(hl)
     288.  01:6140  23                  	inc	hl
     289.  01:6141  66                  	ld	h,(hl)
     290.  01:6142  6F                  	ld	l,a
     291.  01:6143                      .no_restart:	
     292.  01:6143  11 90 02            	ld	de,TRACK_pointer1
     293.  01:6146  01 10 00            	ld	bc,16
     294.  01:6149  ED B0               	ldir
     295.  01:614B  22 0B 01            	ld	(replay_orderpointer),hl		; store pointer for next set
     296.  01:614E                      								; of strack pointers
     297.  01:614E  C3 ED 62            	jp	replay_decodedata_NO
     298.  01:6151                      
     299.  01:6151                      
     300.  01:6151                      ;===========================================================
     301.  01:6151                      ; ---	replay_play
     302.  01:6151                      ; Decode music data and process instruments and effects. 
     303.  01:6151                      ; Music chip registers will be prepared for replay_route 
     304.  01:6151                      ;
     305.  01:6151                      ; Input none
     306.  01:6151                      ;===========================================================	
     307.  01:6151                      replay_play:
     308.  01:6151  3A 10 01            	ld	a,(replay_mode)
     309.  01:6154  A7                  	and	a
     310.  01:6155  C8                  	ret	z		; replay mode = 0	; halted
     311.  01:6156                      				
     312.  01:6156                      				; replay mode = 1	; active
     313.  01:6156                      	;--- The speed timer
     314.  01:6156  21 0F 01            	ld	hl,replay_speed_timer
     315.  01:6159  35                  	dec	(hl)
     316.  01:615A                      
     317.  01:615A  C2 1F 61            	jp	nz,_replay_check_patternend	
     318.  01:615D                      	
     319.  01:615D                      	;--- Re-init Timer == 0
     320.  01:615D  AF                  	xor	a
     321.  01:615E  ED 4B 0D 01         	ld	bc,(replay_speed)		; [b]	subtimer [c] speed
     322.  01:6162  CB 39               	srl	c				; bit	0 is halve speedstep
     323.  01:6164  8F                  	adc	a,a
     324.  01:6165  A8                  	xor	b				; alternate	speed	to have halve speed.
     325.  01:6166  32 0E 01            	ld	(replay_speed_subtimer),a
     326.  01:6169  81                  	add	c
     327.  01:616A  32 0F 01            	ld	(replay_speed_timer),a
     328.  01:616D                      ;===========================================================
     329.  01:616D                      ; ---	replay_decodedata
     330.  01:616D                      ; Process the patterndata 
     331.  01:616D                      ;===========================================================
     332.  01:616D                      replay_decodedata:
     333.  01:616D                      	;--- process the channels (tracks)
     334.  01:616D  21 83 01            	ld 	hl,TRACK_Chan1+17+TRACK_Retrig
     335.  01:6170  35                  	dec	(hl)				;Check if retrig has ended
     336.  01:6171  C2 7C 61            	jp	nz,.retrig_skip1
     337.  01:6174  3A 6A 01            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     338.  01:6177  CB 9F               	res	B_TRGCMD,a
     339.  01:6179  32 6A 01            	ld	(TRACK_Chan1+17+TRACK_Flags),a
     340.  01:617C                      	
     341.  01:617C                      .retrig_skip1:	
     342.  01:617C  2B                  	dec	hl
     343.  01:617D                      ;	ld 	hl,TRACK_Chan1+17+TRACK_Delay
     344.  01:617D  35                  	dec	(hl)
     345.  01:617E  C2 9D 61            	jp	nz,.decode2
     346.  01:6181                      
     347.  01:6181  3A 6A 01            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     348.  01:6184  E6 FB               	and	11111011b		; reset B_TRGENV
     349.  01:6186  57                  	ld	d,a
     350.  01:6187  3A 67 01            	ld	a,(TRACK_Chan1+17+TRACK_Note)	
     351.  01:618A  DD 21 71 01         	ld	ix,TRACK_Chan1+17
     352.  01:618E  ED 4B 90 02         	ld	bc,(TRACK_pointer1)
     353.  01:6192  CD 14 64            	call	replay_decode_chan
     354.  01:6195  ED 43 90 02         	ld	(TRACK_pointer1),bc
     355.  01:6199  7A                  	ld	a,d
     356.  01:619A  32 6A 01            	ld	(TRACK_Chan1+17+TRACK_Flags),a	
     357.  01:619D                      
     358.  01:619D                      .decode2:	
     359.  01:619D  21 A9 01            	ld 	hl,TRACK_Chan2+17+TRACK_Retrig
     360.  01:61A0  35                  	dec	(hl)				;Check if retrig has ended
     361.  01:61A1  C2 AC 61            	jp	nz,.retrig_skip2
     362.  01:61A4  3A 90 01            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     363.  01:61A7  CB 9F               	res	B_TRGCMD,a
     364.  01:61A9  32 90 01            	ld	(TRACK_Chan2+17+TRACK_Flags),a
     365.  01:61AC                      	
     366.  01:61AC                      .retrig_skip2:	
     367.  01:61AC  2B                  	dec	hl
     368.  01:61AD                      ;	ld 	hl,TRACK_Chan2+17+TRACK_Delay
     369.  01:61AD  35                  	dec	(hl)
     370.  01:61AE  C2 CD 61            	jp	nz,.decode3
     371.  01:61B1                      
     372.  01:61B1  3A 90 01            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     373.  01:61B4  E6 FB               	and	11111011b		; reset B_TRGENV
     374.  01:61B6  57                  	ld	d,a
     375.  01:61B7  3A 8D 01            	ld	a,(TRACK_Chan2+17+TRACK_Note)	
     376.  01:61BA  DD 21 97 01         	ld	ix,TRACK_Chan2+17
     377.  01:61BE  ED 4B 92 02         	ld	bc,(TRACK_pointer2)
     378.  01:61C2  CD 14 64            	call	replay_decode_chan
     379.  01:61C5  ED 43 92 02         	ld	(TRACK_pointer2),bc
     380.  01:61C9  7A                  	ld	a,d				;'
     381.  01:61CA  32 90 01            	ld	(TRACK_Chan2+17+TRACK_Flags),a	
     382.  01:61CD                      
     383.  01:61CD                      .decode3:
     384.  01:61CD  21 CF 01            	ld 	hl,TRACK_Chan3+17+TRACK_Retrig
     385.  01:61D0  35                  	dec	(hl)				;Check if retrig has ended
     386.  01:61D1  C2 DC 61            	jp	nz,.retrig_skip3
     387.  01:61D4  3A B6 01            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     388.  01:61D7  CB 9F               	res	B_TRGCMD,a
     389.  01:61D9  32 B6 01            	ld	(TRACK_Chan3+17+TRACK_Flags),a
     390.  01:61DC                      	
     391.  01:61DC                      .retrig_skip3:	
     392.  01:61DC  2B                  	dec	hl
     393.  01:61DD                      ;	ld 	hl,TRACK_Chan3+17+TRACK_Delay
     394.  01:61DD  35                  	dec	(hl)
     395.  01:61DE  C2 FD 61            	jp	nz,.decode4
     396.  01:61E1                      
     397.  01:61E1  3A B6 01            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     398.  01:61E4  E6 FB               	and	11111011b		; reset B_TRGENV
     399.  01:61E6  57                  	ld	d,a		;'
     400.  01:61E7  3A B3 01            	ld	a,(TRACK_Chan3+17+TRACK_Note)	
     401.  01:61EA  DD 21 BD 01         	ld	ix,TRACK_Chan3+17
     402.  01:61EE  ED 4B 94 02         	ld	bc,(TRACK_pointer3)
     403.  01:61F2  CD 14 64            	call	replay_decode_chan
     404.  01:61F5  ED 43 94 02         	ld	(TRACK_pointer3),bc
     405.  01:61F9  7A                  	ld	a,d				;'
     406.  01:61FA  32 B6 01            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     407.  01:61FD                      
     408.  01:61FD                      .decode4:
     409.  01:61FD  21 F5 01            	ld 	hl,TRACK_Chan4+17+TRACK_Retrig
     410.  01:6200  35                  	dec	(hl)				;Check if retrig has ended
     411.  01:6201  C2 0C 62            	jp	nz,.retrig_skip4
     412.  01:6204  3A DC 01            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     413.  01:6207  CB 9F               	res	B_TRGCMD,a
     414.  01:6209  32 DC 01            	ld	(TRACK_Chan4+17+TRACK_Flags),a
     415.  01:620C                      	
     416.  01:620C                      .retrig_skip4:	
     417.  01:620C  2B                  	dec	hl
     418.  01:620D                      ;	ld 	hl,TRACK_Chan4+17+TRACK_Delay
     419.  01:620D  35                  	dec	(hl)
     420.  01:620E  C2 2D 62            	jp	nz,.decode5
     421.  01:6211                      
     422.  01:6211  3A DC 01            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     423.  01:6214  E6 FB               	and	11111011b		; reset B_TRGENV
     424.  01:6216  57                  	ld 	d,a		;'
     425.  01:6217  3A D9 01            	ld	a,(TRACK_Chan4+17+TRACK_Note)	
     426.  01:621A  DD 21 E3 01         	ld	ix,TRACK_Chan4+17
     427.  01:621E  ED 4B 96 02         	ld	bc,(TRACK_pointer4)
     428.  01:6222  CD 14 64            	call	replay_decode_chan
     429.  01:6225  ED 43 96 02         	ld	(TRACK_pointer4),bc
     430.  01:6229  7A                  	ld	a,d			;'
     431.  01:622A  32 DC 01            	ld	(TRACK_Chan4+17+TRACK_Flags),a	
     432.  01:622D                      
     433.  01:622D                      
     434.  01:622D                      .decode5:
     435.  01:622D  21 1B 02            	ld 	hl,TRACK_Chan5+17+TRACK_Retrig
     436.  01:6230  35                  	dec	(hl)				;Check if retrig has ended
     437.  01:6231  C2 3C 62            	jp	nz,.retrig_skip5
     438.  01:6234  3A 02 02            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     439.  01:6237  CB 9F               	res	B_TRGCMD,a
     440.  01:6239  32 02 02            	ld	(TRACK_Chan5+17+TRACK_Flags),a
     441.  01:623C                      	
     442.  01:623C                      .retrig_skip5:	
     443.  01:623C  2B                  	dec	hl
     444.  01:623D                      ;	ld 	hl,TRACK_Chan5+17+TRACK_Delay
     445.  01:623D  35                  	dec	(hl)
     446.  01:623E  C2 5D 62            	jp	nz,.decode6
     447.  01:6241                      
     448.  01:6241  3A 02 02            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     449.  01:6244  E6 FB               	and	11111011b		; reset B_TRGENV
     450.  01:6246  57                  	ld	d,a		;'
     451.  01:6247  3A FF 01            	ld	a,(TRACK_Chan5+17+TRACK_Note)	
     452.  01:624A  DD 21 09 02         	ld	ix,TRACK_Chan5+17
     453.  01:624E  ED 4B 98 02         	ld	bc,(TRACK_pointer5)
     454.  01:6252  CD 14 64            	call	replay_decode_chan
     455.  01:6255  ED 43 98 02         	ld	(TRACK_pointer5),bc
     456.  01:6259  7A                  	ld	a,d			;'
     457.  01:625A  32 02 02            	ld	(TRACK_Chan5+17+TRACK_Flags),a	
     458.  01:625D                      
     459.  01:625D                      
     460.  01:625D                      .decode6:
     461.  01:625D  21 41 02            	ld 	hl,TRACK_Chan6+17+TRACK_Retrig
     462.  01:6260  35                  	dec	(hl)				;Check if retrig has ended
     463.  01:6261  C2 6C 62            	jp	nz,.retrig_skip6
     464.  01:6264  3A 28 02            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     465.  01:6267  CB 9F               	res	B_TRGCMD,a
     466.  01:6269  32 28 02            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     467.  01:626C                      .retrig_skip6:	
     468.  01:626C  2B                  	dec	hl
     469.  01:626D                      ;	ld 	hl,TRACK_Chan6+17+TRACK_Delay
     470.  01:626D  35                  	dec	(hl)
     471.  01:626E  C2 8D 62            	jp	nz,.decode7
     472.  01:6271                      
     473.  01:6271  3A 28 02            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     474.  01:6274  E6 FB               	and	11111011b		; reset B_TRGENV
     475.  01:6276  57                  	ld	d,a		;'
     476.  01:6277  3A 25 02            	ld	a,(TRACK_Chan6+17+TRACK_Note)	
     477.  01:627A  DD 21 2F 02         	ld	ix,TRACK_Chan6+17
     478.  01:627E  ED 4B 9A 02         	ld	bc,(TRACK_pointer6)
     479.  01:6282  CD 14 64            	call	replay_decode_chan
     480.  01:6285  ED 43 9A 02         	ld	(TRACK_pointer6),bc
     481.  01:6289  7A                  	ld	a,d				;'
     482.  01:628A  32 28 02            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     483.  01:628D                      
     484.  01:628D                      
     485.  01:628D                      .decode7:
     486.  01:628D  21 67 02            	ld 	hl,TRACK_Chan7+17+TRACK_Retrig
     487.  01:6290  35                  	dec	(hl)				;Check if retrig has ended
     488.  01:6291  C2 9C 62            	jp	nz,.retrig_skip7
     489.  01:6294  3A 4E 02            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     490.  01:6297  CB 9F               	res	B_TRGCMD,a
     491.  01:6299  32 4E 02            	ld	(TRACK_Chan7+17+TRACK_Flags),a
     492.  01:629C                      	
     493.  01:629C                      .retrig_skip7:	
     494.  01:629C  2B                  	dec	hl
     495.  01:629D                      ;	ld 	hl,TRACK_Chan7+17+TRACK_Delay
     496.  01:629D  35                  	dec	(hl)
     497.  01:629E  C2 BD 62            	jp	nz,.decode8
     498.  01:62A1                      
     499.  01:62A1  3A 4E 02            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     500.  01:62A4  E6 FB               	and	11111011b		; reset B_TRGENV
     501.  01:62A6  57                  	ld	d,a		;'
     502.  01:62A7  3A 4B 02            	ld	a,(TRACK_Chan7+17+TRACK_Note)	
     503.  01:62AA  DD 21 55 02         	ld	ix,TRACK_Chan7+17
     504.  01:62AE  ED 4B 9C 02         	ld	bc,(TRACK_pointer7)
     505.  01:62B2  CD 14 64            	call	replay_decode_chan
     506.  01:62B5  ED 43 9C 02         	ld	(TRACK_pointer7),bc
     507.  01:62B9  7A                  	ld	a,d				;'
     508.  01:62BA  32 4E 02            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     509.  01:62BD                      
     510.  01:62BD                      
     511.  01:62BD                      .decode8:
     512.  01:62BD  21 8D 02            	ld 	hl,TRACK_Chan8+17+TRACK_Retrig
     513.  01:62C0  35                  	dec	(hl)				;Check if retrig has ended
     514.  01:62C1  C2 CC 62            	jp	nz,.retrig_skip8
     515.  01:62C4  3A 74 02            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     516.  01:62C7  CB 9F               	res	B_TRGCMD,a
     517.  01:62C9  32 74 02            	ld	(TRACK_Chan8+17+TRACK_Flags),a
     518.  01:62CC                      	
     519.  01:62CC                      .retrig_skip8:	
     520.  01:62CC  2B                  	dec	hl
     521.  01:62CD                      ;	ld 	hl,TRACK_Chan8+17+TRACK_Delay
     522.  01:62CD  35                  	dec	(hl)
     523.  01:62CE  C2 ED 62            	jp	nz,.decode_end
     524.  01:62D1                      
     525.  01:62D1  3A 74 02            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     526.  01:62D4  E6 FB               	and	11111011b		; reset B_TRGENV
     527.  01:62D6  57                  	ld	d,a		;'
     528.  01:62D7  3A 71 02            	ld	a,(TRACK_Chan8+17+TRACK_Note)	
     529.  01:62DA  DD 21 7B 02         	ld	ix,TRACK_Chan8+17
     530.  01:62DE  ED 4B 9E 02         	ld	bc,(TRACK_pointer8)
     531.  01:62E2  CD 14 64            	call	replay_decode_chan
     532.  01:62E5  ED 43 9E 02         	ld	(TRACK_pointer8),bc
     533.  01:62E9  7A                  	ld	a,d				;'
     534.  01:62EA  32 74 02            	ld	(TRACK_Chan8+17+TRACK_Flags),a
     535.  01:62ED                      		
     536.  01:62ED                      .decode_end:
     537.  01:62ED                      	; continue to process data
     538.  01:62ED                      ;===========================================================
     539.  01:62ED                      ; ---	replay_decodedata_NO
     540.  01:62ED                      ; Process changes.
     541.  01:62ED                      ; 
     542.  01:62ED                      ; 
     543.  01:62ED                      ;===========================================================
     544.  01:62ED                      replay_decodedata_NO:
     545.  01:62ED                      	;---- morph routine here
     546.  01:62ED  3A 1B 01            	ld	a,(replay_morph_active)
     547.  01:62F0  A7                  	and	a
     548.  01:62F1  C4 16 6C            	call	nz,replay_process_morph
     549.  01:62F4                      
     550.  01:62F4                      	;--- Initialize PSG Mixer and volume
     551.  01:62F4  AF                  	xor	a
     552.  01:62F5  32 3D 03            	ld	(SCC_regMIXER),a
     553.  01:62F8                      
     554.  01:62F8                      	;--- PSG balance
     555.  01:62F8  2A 03 01            	ld	hl,(replay_mainPSGvol)
     556.  01:62FB  22 15 01            	ld	(replay_mainvol),hl
     557.  01:62FE                      
     558.  01:62FE                      	;--- Process track 1
     559.  01:62FE  DD 21 71 01         	ld	ix,TRACK_Chan1+17
     560.  01:6302  3A 6A 01            	ld	a,(TRACK_Chan1+17+TRACK_Flags)
     561.  01:6305  57                  	ld	d,a
     562.  01:6306  CD 59 67            	call	replay_process_chan_AY
     563.  01:6309  22 A0 02            	ld	(AY_regToneA),hl
     564.  01:630C  7A                  	ld	a,d
     565.  01:630D  32 6A 01            	ld	(TRACK_Chan1+17+TRACK_Flags),a	
     566.  01:6310  3A 3C 03            	ld	a,(SCC_regVOLE)
     567.  01:6313  32 A8 02            	ld	(AY_regVOLA),a	
     568.  01:6316                      
     569.  01:6316                      	;--- Process track 2
     570.  01:6316  DD 21 97 01         	ld	ix,TRACK_Chan2+17
     571.  01:631A  3A 90 01            	ld	a,(TRACK_Chan2+17+TRACK_Flags)
     572.  01:631D  57                  	ld	d,a
     573.  01:631E  CD 59 67            	call	replay_process_chan_AY
     574.  01:6321  22 A2 02            	ld	(AY_regToneB),hl
     575.  01:6324  7A                  	ld	a,d
     576.  01:6325  32 90 01            	ld	(TRACK_Chan2+17+TRACK_Flags),a	
     577.  01:6328  3A 3C 03            	ld	a,(SCC_regVOLE)
     578.  01:632B  32 A9 02            	ld	(AY_regVOLB),a	
     579.  01:632E                      
     580.  01:632E                      	;--- Process track 3	
     581.  01:632E  DD 21 BD 01         	ld	ix,TRACK_Chan3+17
     582.  01:6332  3A B6 01            	ld	a,(TRACK_Chan3+17+TRACK_Flags)
     583.  01:6335  57                  	ld	d,a
     584.  01:6336  CD 59 67            	call	replay_process_chan_AY
     585.  01:6339  22 A4 02            	ld	(AY_regToneC),hl
     586.  01:633C  7A                  	ld	a,d
     587.  01:633D  32 B6 01            	ld	(TRACK_Chan3+17+TRACK_Flags),a	
     588.  01:6340  3A 3C 03            	ld	a,(SCC_regVOLE)
     589.  01:6343  32 AA 02            	ld	(AY_regVOLC),a
     590.  01:6346                      	
     591.  01:6346                      	;--- To disable track 3 just comment above lines (9 lines) and enable below 2 lines.
     592.  01:6346                      	;    This can be done for all tracks.
     593.  01:6346                      ;	ld	hl,SCC_regMIXER   
     594.  01:6346                      ;	srl	(hl)
     595.  01:6346                      
     596.  01:6346                      	
     597.  01:6346                      
     598.  01:6346                      	;-- Convert mixer to AY
     599.  01:6346  3A 3D 03            	ld	a,(SCC_regMIXER)		
     600.  01:6349  CB 3F               	srl	a
     601.  01:634B  CB 3F               	srl	a
     602.  01:634D  EE 3F               	xor	0x3f
     603.  01:634F  32 A7 02            	ld	(AY_regMIXER),a
     604.  01:6352                      
     605.  01:6352                      
     606.  01:6352                      	;--- set SCC balance
     607.  01:6352  2A 05 01            	ld	hl,(replay_mainSCCvol)
     608.  01:6355  22 15 01            	ld	(replay_mainvol),hl
     609.  01:6358                      
     610.  01:6358                      	
     611.  01:6358  FD 26 00            	ld	iyh,0			; iyh stores the SCC chan#
     612.  01:635B                      					; used for waveform updates
     613.  01:635B                      	;--- Process track 4
     614.  01:635B  DD 21 E3 01         	ld	ix,TRACK_Chan4+17
     615.  01:635F  3A DC 01            	ld	a,(TRACK_Chan4+17+TRACK_Flags)
     616.  01:6362  57                  	ld	d,a
     617.  01:6363  CD 59 67            	call	replay_process_chan_AY
     618.  01:6366  22 2E 03            	ld	(SCC_regToneA),hl
     619.  01:6369  7A                  	ld	a,d
     620.  01:636A  32 DC 01            	ld	(TRACK_Chan4+17+TRACK_Flags),a	
     621.  01:636D  3A 3C 03            	ld	a,(SCC_regVOLE)
     622.  01:6370  32 38 03            	ld	(SCC_regVOLA),a	
     623.  01:6373                      
     624.  01:6373                      	;--- Process track 5
     625.  01:6373  FD 24               	inc	iyh
     626.  01:6375                      	
     627.  01:6375  DD 21 09 02         	ld	ix,TRACK_Chan5+17
     628.  01:6379  3A 02 02            	ld	a,(TRACK_Chan5+17+TRACK_Flags)
     629.  01:637C  57                  	ld	d,a
     630.  01:637D  CD 59 67            	call	replay_process_chan_AY
     631.  01:6380  22 30 03            	ld	(SCC_regToneB),hl
     632.  01:6383  7A                  	ld	a,d
     633.  01:6384  32 02 02            	ld	(TRACK_Chan5+17+TRACK_Flags),a	
     634.  01:6387  3A 3C 03            	ld	a,(SCC_regVOLE)
     635.  01:638A  32 39 03            	ld	(SCC_regVOLB),a	
     636.  01:638D                      
     637.  01:638D                      	;--- Process track 6
     638.  01:638D  FD 24               	inc	iyh
     639.  01:638F                      		
     640.  01:638F  DD 21 2F 02         	ld	ix,TRACK_Chan6+17
     641.  01:6393  3A 28 02            	ld	a,(TRACK_Chan6+17+TRACK_Flags)
     642.  01:6396  57                  	ld	d,a
     643.  01:6397  CD 59 67            	call	replay_process_chan_AY
     644.  01:639A  22 32 03            	ld	(SCC_regToneC),hl
     645.  01:639D  7A                  	ld	a,d
     646.  01:639E  32 28 02            	ld	(TRACK_Chan6+17+TRACK_Flags),a	
     647.  01:63A1  3A 3C 03            	ld	a,(SCC_regVOLE)
     648.  01:63A4  32 3A 03            	ld	(SCC_regVOLC),a	
     649.  01:63A7                      
     650.  01:63A7                      	;--- Process track 7
     651.  01:63A7  FD 24               	inc	iyh
     652.  01:63A9                      		
     653.  01:63A9  DD 21 55 02         	ld	ix,TRACK_Chan7+17
     654.  01:63AD  3A 4E 02            	ld	a,(TRACK_Chan7+17+TRACK_Flags)
     655.  01:63B0  57                  	ld	d,a
     656.  01:63B1  CD 59 67            	call	replay_process_chan_AY
     657.  01:63B4  22 34 03            	ld	(SCC_regToneD),hl
     658.  01:63B7  7A                  	ld	a,d
     659.  01:63B8  32 4E 02            	ld	(TRACK_Chan7+17+TRACK_Flags),a	
     660.  01:63BB  3A 3C 03            	ld	a,(SCC_regVOLE)
     661.  01:63BE  32 3B 03            	ld	(SCC_regVOLD),a		
     662.  01:63C1                      
     663.  01:63C1                      	;--- Process track 8
     664.  01:63C1                      ;	inc	iyh			; no waveform for SCC channel 5
     665.  01:63C1                      		
     666.  01:63C1  DD 21 7B 02         	ld	ix,TRACK_Chan8+17
     667.  01:63C5  3A 74 02            	ld	a,(TRACK_Chan8+17+TRACK_Flags)
     668.  01:63C8  57                  	ld	d,a
     669.  01:63C9  CD 59 67            	call	replay_process_chan_AY
     670.  01:63CC  22 36 03            	ld	(SCC_regToneE),hl
     671.  01:63CF  7A                  	ld	a,d
     672.  01:63D0  32 74 02            	ld	(TRACK_Chan8+17+TRACK_Flags),a	
     673.  01:63D3                      
     674.  01:63D3                      	;-- Fade out processing
     675.  01:63D3  3A 11 01            	ld	a,(replay_fade)
     676.  01:63D6  A7                  	and	a
     677.  01:63D7  C8                  	ret	z	; if replay fade = 0 then no fade active
     678.  01:63D8                      	
     679.  01:63D8                      	; decrease fade timer
     680.  01:63D8  3A 12 01            	ld	a,(replay_fade_timer)
     681.  01:63DB  3D                  	dec	a
     682.  01:63DC  C2 F5 63            	jp	nz,.no_new_step
     683.  01:63DF                      
     684.  01:63DF  3A 13 01            	ld	a,(replay_fade_vol)
     685.  01:63E2  3C                  	inc	a
     686.  01:63E3  FE 10               	cp	16
     687.  01:63E5  DA EF 63            	jp	c,.cont_fadeing
     688.  01:63E8  AF                  	xor	a
     689.  01:63E9  32 11 01            	ld	(replay_fade),a
     690.  01:63EC  C3 0F 60            	jp	replay_pause
     691.  01:63EF                      .cont_fadeing:	
     692.  01:63EF  32 13 01            	ld	(replay_fade_vol),a
     693.  01:63F2  3A 11 01            	ld	a,(replay_fade)
     694.  01:63F5                      .no_new_step:
     695.  01:63F5  32 12 01            	ld	(replay_fade_timer),a
     696.  01:63F8                      
     697.  01:63F8  3A 13 01            	ld	a,(replay_fade_vol)
     698.  01:63FB  4F                  	ld	c,a
     699.  01:63FC  06 03               	ld	b,3
     700.  01:63FE  21 A8 02            	ld	hl,AY_regVOLA
     701.  01:6401  CD 09 64            	call	.calc_vol
     702.  01:6404  06 05               	ld	b,5
     703.  01:6406  21 38 03            	ld	hl,SCC_regVOLA
     704.  01:6409                      
     705.  01:6409                      .calc_vol:	
     706.  01:6409  7E                  	ld	a,(hl)
     707.  01:640A  91                  	sub	c
     708.  01:640B  D2 0F 64            	jp	nc,.no_carry
     709.  01:640E  AF                  	xor	a
     710.  01:640F                      .no_carry:	
     711.  01:640F  77                  	ld	(hl),a
     712.  01:6410  23                  	inc	hl
     713.  01:6411  10 F6               	djnz	.calc_vol
     714.  01:6413  C9                  	ret
     715.  01:6414                      
     716.  01:6414                      
     717.  01:6414                      	
     718.  01:6414                      replay_decode_chan:
     719.  01:6414                      	;--- initialize data
     720.  01:6414                      ;	ld	a,(ix+TRACK_Note)
     721.  01:6414  32 14 01            	ld	(replay_previous_note),a
     722.  01:6417                      
     723.  01:6417                      ;	;--- Check if retrig has ended
     724.  01:6417                      ;	dec	(ix+TRACK_Retrig)
     725.  01:6417                      ;	jp	nz,.skip_retrig_reset
     726.  01:6417                      ;	res 	B_TRGCMD,(ix+TRACK_Flags)
     727.  01:6417                      ;
     728.  01:6417                      ;.skip_retrig_reset:
     729.  01:6417                      	;=============
     730.  01:6417                      	; Note 
     731.  01:6417                      	;=============
     732.  01:6417  0A                  	ld	a,(bc)
     733.  01:6418  FE 60               	cp	96
     734.  01:641A                      
     735.  01:641A  DA 5B 64            	jp	c,_replay_decode_note
     736.  01:641D  CA 67 64            	jp	z,_replay_decode_rest
     737.  01:6420  FE 70               _rdn2:cp	112;128
     738.  01:6422  DA A9 64            	jp	c,_replay_decode_vol
     739.  01:6425  FE 8F               _rdv2:cp	143
     740.  01:6427  DA 70 64            	jp	c,_replay_decode_ins
     741.  01:642A                      _rdi2:
     742.  01:642A  FE BF               	cp	191
     743.  01:642C  D2 BE 64            	jp	nc,_replay_decode_delay
     744.  01:642F  DA CB 64            	jp	c,_replay_decode_cmd
     745.  01:6432                      
     746.  01:6432                      _rdn:
     747.  01:6432  FE 61               	cp	97
     748.  01:6434  DA 54 64            	jp	c,_rd_delay
     749.  01:6437  C3 20 64            	jp	_rdn2
     750.  01:643A                      
     751.  01:643A                      _rdi:
     752.  01:643A  FE 8F               	cp	143
     753.  01:643C  DA 54 64            	jp	c,_rd_delay
     754.  01:643F  C3 2A 64            	jp	_rdi2
     755.  01:6442                      
     756.  01:6442                      _rdv:
     757.  01:6442  FE 70               	cp	112
     758.  01:6444  DA 54 64            	jp	c,_rd_delay
     759.  01:6447  C3 25 64            	jp	_rdv2
     760.  01:644A                      _rdc:
     761.  01:644A  03                  	inc	bc
     762.  01:644B  0A                  	ld	a,(bc)
     763.  01:644C  FE BF               	cp	191
     764.  01:644E  DA 54 64            	jp	c,_rd_delay
     765.  01:6451  C3 BE 64            	jp	_replay_decode_delay
     766.  01:6454                      
     767.  01:6454                      	;--- re-init previous delay
     768.  01:6454                      _rd_delay:
     769.  01:6454  DD 7E 13            	ld	a,(ix+TRACK_prevDelay)
     770.  01:6457  DD 77 11            	ld	(ix+TRACK_Delay),a
     771.  01:645A                      
     772.  01:645A  C9                  	ret
     773.  01:645B                      
     774.  01:645B                      
     775.  01:645B                      
     776.  01:645B                      _replay_decode_note:
     777.  01:645B  DD 77 F6            	ld	(ix+TRACK_Note),a
     778.  01:645E  CB C2               	set 	B_TRGNOT,d
     779.  01:6460  CB A2               	res	B_ACTMOR,d
     780.  01:6462                      
     781.  01:6462  03                  	inc	bc
     782.  01:6463  0A                  	ld	a,(bc)
     783.  01:6464  C3 32 64            	jp	_rdn
     784.  01:6467                      	
     785.  01:6467                      _replay_decode_rest:
     786.  01:6467  CB 8A               	res	B_ACTNOT,d				; set	note bit to	0
     787.  01:6469  CB A2               	res	B_ACTMOR,d				; reset morph slave mode
     788.  01:646B                      
     789.  01:646B  03                  	inc	bc
     790.  01:646C  0A                  	ld	a,(bc)
     791.  01:646D  C3 32 64            	jp	_rdn
     792.  01:6470                      
     793.  01:6470                      _replay_decode_ins:
     794.  01:6470  CB A2               	res	B_ACTMOR,d				; reset morph slave mode
     795.  01:6472  D6 70               	sub	112;97
     796.  01:6474  DD BE EF            	cp	(ix+TRACK_Instrument)
     797.  01:6477  CA A4 64            	jp	z,.skip_ins
     798.  01:647A                      	
     799.  01:647A  DD 77 EF            	ld	(ix+TRACK_Instrument),a
     800.  01:647D                      
     801.  01:647D                      	;--- set instrument pointer
     802.  01:647D  87                  	add	a
     803.  01:647E  2A 09 01            	ld	hl,(replay_insbase)
     804.  01:6481  85                  	add	a,l
     805.  01:6482  6F                  	ld	l,a
     806.  01:6483  D2 87 64            	jp	nc,.skip
     807.  01:6486  24                  	inc	h
     808.  01:6487                      .skip:
     809.  01:6487  7E                  	ld	a,(hl)
     810.  01:6488  23                  	inc	hl
     811.  01:6489  66                  	ld	h,(hl)
     812.  01:648A  6F                  	ld	l,a
     813.  01:648B                      
     814.  01:648B                      	;-- get waveform
     815.  01:648B  7E                  	ld	a,(hl)
     816.  01:648C  23                  	inc	hl
     817.  01:648D                      	
     818.  01:648D                      ;	ld	e,(hl)
     819.  01:648D                      ;	inc	hl
     820.  01:648D                      
     821.  01:648D                      	;---- Store the restart offset
     822.  01:648D                      ;	ld	(ix+TRACK_MacroRestart),e
     823.  01:648D                      	;--- Store the macro start
     824.  01:648D  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
     825.  01:6490  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
     826.  01:6493                      	;--- Store the macro re-start
     827.  01:6493  DD 75 F3            	ld	(ix+TRACK_MacroStart),l
     828.  01:6496  DD 74 F4            	ld	(ix+TRACK_MacroStart+1),h		
     829.  01:6499                      	;--- Set the waveform  (if needed)
     830.  01:6499  DD BE F8            	cp	(ix+TRACK_Waveform)
     831.  01:649C  CA A4 64            	jp	z,.skip_ins
     832.  01:649F                      	
     833.  01:649F                      	;--- this is a new waveform
     834.  01:649F  DD 77 F8            	ld	(ix+TRACK_Waveform),a
     835.  01:64A2  CB F2               	set	B_TRGWAV,d
     836.  01:64A4                      	
     837.  01:64A4                      .skip_ins:	
     838.  01:64A4  03                  	inc	bc
     839.  01:64A5  0A                  	ld	a,(bc)
     840.  01:64A6  C3 3A 64            	jp	_rdi
     841.  01:64A9                      
     842.  01:64A9                      _replay_decode_vol:
     843.  01:64A9  D6 60               	sub	96;127
     844.  01:64AB  87                  	add	a
     845.  01:64AC  87                  	add	a
     846.  01:64AD  87                  	add	a
     847.  01:64AE  87                  	add	a
     848.  01:64AF                      	
     849.  01:64AF                      	;--- Set new base	volume (high byte) but keep relative offset (low byte)
     850.  01:64AF  5F                  	ld	e,a
     851.  01:64B0  DD 7E F7            	ld	a,(ix+TRACK_Volume)
     852.  01:64B3  E6 0F               	and	0xf
     853.  01:64B5  B3                  	or	e
     854.  01:64B6  DD 77 F7            	ld	(ix+TRACK_Volume),a
     855.  01:64B9                      
     856.  01:64B9  03                  	inc	bc
     857.  01:64BA  0A                  	ld	a,(bc)
     858.  01:64BB  C3 42 64            	jp	_rdv
     859.  01:64BE                      
     860.  01:64BE                      
     861.  01:64BE                      _replay_decode_delay:
     862.  01:64BE  D6 BF               	sub	191
     863.  01:64C0  CA 54 64            	jp	z,_rd_delay		; EOT found
     864.  01:64C3  DD 77 11            	ld	(ix+TRACK_Delay),a
     865.  01:64C6  DD 77 13            	ld	(ix+TRACK_prevDelay),a
     866.  01:64C9                      
     867.  01:64C9  03                  	inc	bc
     868.  01:64CA  C9                  	ret
     869.  01:64CB                      
     870.  01:64CB                      
     871.  01:64CB                      _replay_decode_cmd:
     872.  01:64CB                      
     873.  01:64CB  D6 8E               	sub	142
     874.  01:64CD  DD 77 F0            	ld	(ix+TRACK_Command),a
     875.  01:64D0  21 E1 64            	ld	hl,DECODE_CMDLIST
     876.  01:64D3  87                  	add	a,a
     877.  01:64D4  85                  	add	a,l
     878.  01:64D5  6F                  	ld	l,a
     879.  01:64D6  D2 DA 64            	jp	nc,.skip
     880.  01:64D9  24                  	inc	h
     881.  01:64DA                      .skip:
     882.  01:64DA  7E                  	ld	a,(hl)
     883.  01:64DB  23                  	inc	hl
     884.  01:64DC  66                  	ld	h,(hl)
     885.  01:64DD  6F                  	ld	l,a
     886.  01:64DE                      	
     887.  01:64DE  03                  	inc	bc
     888.  01:64DF  0A                  	ld	a,(bc)
     889.  01:64E0  E9                  	jp	(hl)
     890.  01:64E1                      
     891.  01:64E1                      DECODE_CMDLIST:
     892.  01:64E1                      	; These effects are only processed 1 once in decoding
     893.  01:64E1  EC 65               	dw	_CHIPcmdA_env_mul			;0
     894.  01:64E3  01 66               	dw	_CHIPcmdB_wave_res		;1
     895.  01:64E5  13 66               	dw	_CHIPcmdF_wave_set		;2
     896.  01:64E7  1D 66               	dw	_CHIPcmd10_morph_slave		;3
     897.  01:64E9  23 66               	dw	_CHIPcmd11_morph_start		;4
     898.  01:64EB  49 66               	dw	_CHIPcmd12_morph_cont		;5
     899.  01:64ED  78 66               	dw	_CHIPcmd16_vib_ctrl		;6
     900.  01:64EF  9E 66               	dw	_CHIPcmd17_track_detune		;7
     901.  01:64F1  BD 66               	dw	_CHIPcmd18_transpose		;8
     902.  01:64F3  0A 67               	dw	_CHIPcmd1A_trigger		;9
     903.  01:64F5  10 67               	dw	_CHIPcmd1B_speed			;a
     904.  01:64F7  23 67               	dw	_CHIPcmd1C_notelink		;b
     905.  01:64F9                      ;	dw	_CHIPcmd1C_call			;b	
     906.  01:64F9  29 67               	dw	_CHIPcmd1D_ret			;c
     907.  01:64FB                      	
     908.  01:64FB                      	; These effects are also processed in the processing
     909.  01:64FB  09 66               	dw	_CHIPcmdC_wave_duty		;d
     910.  01:64FD  09 66               	dw	_CHIPcmdD_wave_cut		;e
     911.  01:64FF  09 66               	dw	_CHIPcmdE_wave_compr		;f
     912.  01:6501  60 66               	dw	_CHIPcmd13_short_arp		;10
     913.  01:6503  6C 66               	dw	_CHIPcmd14_fine_up		;11
     914.  01:6505  6C 66               	dw	_CHIPcmd15_fine_down		;12
     915.  01:6507  EC 66               	dw	_CHIPcmd19_note_delay		;13
     916.  01:6509  E3 66               	dw	_CHIPcmdXX_note_cut		;14
     917.  01:650B                      
     918.  01:650B                      	; These effects can be retriggered
     919.  01:650B  33 65               	dw	_CHIPcmd0_arpeggio		;15
     920.  01:650D  43 65               	dw	_CHIPcmd1_port_up			;16
     921.  01:650F  4F 65               	dw	_CHIPcmd2_port_down		;17
     922.  01:6511  61 65               	dw	_CHIPcmd3_port_tone		;18
     923.  01:6513  AF 65               	dw	_CHIPcmd4_vibrato			;19
     924.  01:6515  CD 65               	dw	_CHIPcmd5_vibrato_port_tone	;1a
     925.  01:6517  CD 65               	dw	_CHIPcmd6_vibrato_vol		;1b
     926.  01:6519  CD 65               	dw	_CHIPcmd7_vol_slide		;1c
     927.  01:651B  DD 65               	dw	_CHIPcmd8_macro_offset		;1d
     928.  01:651D  E0 65               	dw	_CHIPcmd9_env_shape		;1e
     929.  01:651F                      
     930.  01:651F  2D 67               	dw	_CHIPcmd0_RE_arpeggio		;1f
     931.  01:6521  31 67               	dw	_CHIPcmd1_RE_port_up		;20
     932.  01:6523  31 67               	dw	_CHIPcmd2_RE_port_down		;21
     933.  01:6525  5B 65               	dw	_CHIPcmd3_RE_port_tone		;22
     934.  01:6527  31 67               	dw	_CHIPcmd4_RE_vibrato		;23
     935.  01:6529  39 67               	dw	_CHIPcmd5_RE_vibrato_port_tone ;24
     936.  01:652B  39 67               	dw	_CHIPcmd6_RE_vibrato_vol	;25
     937.  01:652D  39 67               	dw	_CHIPcmd7_RE_vol_slide		;26
     938.  01:652F  45 67               	dw	_CHIPcmd8_RE_macro_offset	;27
     939.  01:6531  51 67               	dw	_CHIPcmd9_RE_env_shape		;28
     940.  01:6533                      
     941.  01:6533                      
     942.  01:6533                      
     943.  01:6533                      _CHIPcmd0_arpeggio:
     944.  01:6533                      	; in:	[A] contains the paramvalue
     945.  01:6533                      	; 
     946.  01:6533                      	; ! do not change	[BC] this is the data pointer
     947.  01:6533                      	;--------------------------------------------------
     948.  01:6533                      	; Cycles between note, note+x	halftones, note+y
     949.  01:6533                      	; halftones. 
     950.  01:6533                      	; Ex:	(MOD/XM: C-4 01 .. 037)	This will play 
     951.  01:6533                      	; C-4, C-4+3 semitones andC-4+7 semitones. 
     952.  01:6533  DD 77 05            	ld	(ix+TRACK_cmd_0),a
     953.  01:6536  CB DA               	set	B_TRGCMD,d
     954.  01:6538  DD 36 0F 00         	ld	(ix+TRACK_Timer),0
     955.  01:653C  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
     956.  01:6540  C3 4A 64            	jp	_rdc
     957.  01:6543                      	
     958.  01:6543                      _CHIPcmd1_port_up:
     959.  01:6543                      	; in:	[A] contains the paramvalue
     960.  01:6543                      	; 
     961.  01:6543                      	; ! do not change	[BC] this is the data pointer
     962.  01:6543                      	;--------------------------------------------------
     963.  01:6543                      	; This will	slide	up the pitch of the current note
     964.  01:6543                      	; being played by	the given speed. 
     965.  01:6543  DD 77 06            	ld	(ix+TRACK_cmd_1),a
     966.  01:6546  CB DA               	set	B_TRGCMD,d
     967.  01:6548  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
     968.  01:654C  C3 4A 64            	jp	_rdc
     969.  01:654F                      	
     970.  01:654F                      	
     971.  01:654F                      	 
     972.  01:654F                      _CHIPcmd2_port_down:
     973.  01:654F                      	; in:	[A] contains the paramvalue
     974.  01:654F                      	; 
     975.  01:654F                      	; ! do not change	[BC] this is the data pointer
     976.  01:654F                      	;--------------------------------------------------
     977.  01:654F                      	; This will	slide	down the pitch of	the current	note
     978.  01:654F                      	; being played by	the given speed.	
     979.  01:654F  DD 77 07            	ld	(ix+TRACK_cmd_2),a
     980.  01:6552  CB DA               	set	B_TRGCMD,d
     981.  01:6554  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
     982.  01:6558  C3 4A 64            	jp	_rdc
     983.  01:655B                      	
     984.  01:655B                      
     985.  01:655B                      _CHIPcmd3_RE_port_tone:
     986.  01:655B  DD 77 12            	ld	(ix+TRACK_Retrig),a
     987.  01:655E  C3 6C 65            	jp	_CHIPcmd3_port_tone_cont	
     988.  01:6561                      _CHIPcmd3_port_tone:
     989.  01:6561                      	; in:	[A] contains the paramvalue
     990.  01:6561                      	; 
     991.  01:6561                      	; ! do not change	[BC] this is the data pointer
     992.  01:6561                      	;--------------------------------------------------
     993.  01:6561                      	; This command is	used together with a note, and 
     994.  01:6561                      	; will bend	the current	pitch	at the given speed
     995.  01:6561                      	; towards the specified	note.	Example:
     996.  01:6561                      	;	C-4 1....
     997.  01:6561                      	;	F-4 ..305 (bend the note up towards	F-4)
     998.  01:6561                      	;	... ..300 (continue to slide up, until F-4
     999.  01:6561                      	;						  is reached
    1000.  01:6561                      
    1001.  01:6561                      
    1002.  01:6561  DD 77 08            	ld	(ix+TRACK_cmd_3),a
    1003.  01:6564  DD 36 0F 02         	ld	(ix+TRACK_Timer),2
    1004.  01:6568  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
    1005.  01:656C                      _CHIPcmd3_port_tone_cont:
    1006.  01:656C  CB DA               	set	B_TRGCMD,d
    1007.  01:656E  CB CA               	set	B_ACTNOT,d
    1008.  01:6570                      	;--- Check if we have a	note on the	same event
    1009.  01:6570  CB 42               	bit	B_TRGNOT,d
    1010.  01:6572  CA 4A 64            	jp	z,_rdc
    1011.  01:6575                      
    1012.  01:6575                      	;-- get the	previous note freq
    1013.  01:6575  3A 14 01            	ld	a,(replay_previous_note)
    1014.  01:6578  87                  	add	a
    1015.  01:6579                      
    1016.  01:6579  D9                  	exx
    1017.  01:657A  2A 19 01            	ld	hl,(replay_Tonetable)	;TRACK_ToneTable
    1018.  01:657D  85                  	add	a,l
    1019.  01:657E  6F                  	ld	l,a
    1020.  01:657F  D2 83 65            	jp	nc,.skip
    1021.  01:6582  24                  	inc	h
    1022.  01:6583                      .skip:
    1023.  01:6583  5E                  	ld	e,(hl)
    1024.  01:6584  23                  	inc	hl
    1025.  01:6585  56                  	ld	d,(hl)
    1026.  01:6586                      
    1027.  01:6586                      	; add	the toneadd
    1028.  01:6586  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1029.  01:6589  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1030.  01:658C                      
    1031.  01:658C  19                  	add	hl,de	
    1032.  01:658D  EB                  	ex	de,hl				; store current freq in	[de]
    1033.  01:658E                      
    1034.  01:658E                      	;--- get the current note freq
    1035.  01:658E  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1036.  01:6591  87                  	add	a
    1037.  01:6592  2A 19 01            	ld	hl,(replay_Tonetable)	;TRACK_ToneTable
    1038.  01:6595  85                  	add	a,l
    1039.  01:6596  6F                  	ld	l,a
    1040.  01:6597  D2 9B 65            	jp	nc,.skip2
    1041.  01:659A  24                  	inc	h
    1042.  01:659B                      .skip2:
    1043.  01:659B  7E                  	ld	a,(hl)
    1044.  01:659C  23                  	inc	hl
    1045.  01:659D  66                  	ld	h,(hl)
    1046.  01:659E  6F                  	ld	l,a				; destination freq in [hl]
    1047.  01:659F                      	
    1048.  01:659F                      	;--- Calculate the delta
    1049.  01:659F  AF                  	xor	a
    1050.  01:65A0  EB                  	ex	de,hl
    1051.  01:65A1  ED 52               	sbc	hl,de				; results in pos/neg delta
    1052.  01:65A3                      	
    1053.  01:65A3  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1054.  01:65A6  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h	
    1055.  01:65A9  D9                  	exx
    1056.  01:65AA                      	
    1057.  01:65AA  CB 82               	res	B_TRGNOT,d
    1058.  01:65AC                      
    1059.  01:65AC  C3 4A 64            	jp	_rdc	
    1060.  01:65AF                      
    1061.  01:65AF                      	
    1062.  01:65AF                      _CHIPcmd4_vibrato:
    1063.  01:65AF                      	; in:	[A] contains the paramvalue
    1064.  01:65AF                      	; 
    1065.  01:65AF                      	; ! do not change	[BC] this is the data pointer
    1066.  01:65AF                      	;--------------------------------------------------
    1067.  01:65AF                      	; Vibrato with speed x and depth y.	This command 
    1068.  01:65AF                      	; will oscillate the frequency of the current note
    1069.  01:65AF                      	; with a sine wave. (You can change	the vibrato
    1070.  01:65AF                      	; waveform to a triangle wave, a square wave, or a
    1071.  01:65AF                      	; random table by	using	the E4x command).
    1072.  01:65AF                      	;--- Init values
    1073.  01:65AF  5F                  	ld	e,a
    1074.  01:65B0  E6 07               	and	$07
    1075.  01:65B2                      
    1076.  01:65B2  DD 77 09            	ld	(ix+TRACK_cmd_4_depth),a
    1077.  01:65B5  7B                  	ld	a,e
    1078.  01:65B6  1F                  	rra
    1079.  01:65B7  1F                  	rra
    1080.  01:65B8  1F                  	rra
    1081.  01:65B9  1F                  	rra
    1082.  01:65BA  E6 0F               	and	$0f
    1083.  01:65BC  DD 77 0A            	ld	(ix+TRACK_cmd_4_step),a
    1084.  01:65BF  ED 44               	neg	
    1085.  01:65C1  DD 77 10            	ld	(ix+TRACK_Step),a
    1086.  01:65C4                      	
    1087.  01:65C4  CB DA               	set	B_TRGCMD,d
    1088.  01:65C6  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
    1089.  01:65CA  C3 4A 64            	jp	_rdc	
    1090.  01:65CD                      
    1091.  01:65CD                      
    1092.  01:65CD                      _CHIPcmd5_vibrato_port_tone:
    1093.  01:65CD                      	; in:	[A] contains the paramvalue
    1094.  01:65CD                      	; 
    1095.  01:65CD                      	; ! do not change	[BC] this is the data pointer
    1096.  01:65CD                      	;--------------------------------------------------
    1097.  01:65CD                      	; portTone	+ volumeslide
    1098.  01:65CD                      	;--- Init values
    1099.  01:65CD                      _CHIPcmd6_vibrato_vol:
    1100.  01:65CD                      	; in:	[A] contains the paramvalue
    1101.  01:65CD                      	; 
    1102.  01:65CD                      	; ! do not change	[BC] this is the data pointer
    1103.  01:65CD                      	;--------------------------------------------------
    1104.  01:65CD                      _CHIPcmd7_vol_slide:
    1105.  01:65CD                      	; in:	[A] contains the paramvalue
    1106.  01:65CD                      	; 
    1107.  01:65CD                      	; ! do not change	[BC] this is the data pointer
    1108.  01:65CD                      	;--------------------------------------------------
    1109.  01:65CD                      	; slide the	volume up or down	1 step.
    1110.  01:65CD                      	; The	x or y param  set	the delay*2	(x=up,y=down)
    1111.  01:65CD                      	; With A00 the previous	value	is used.
    1112.  01:65CD                      	
    1113.  01:65CD  DD 77 0C            	ld	(ix+TRACK_cmd_A),a
    1114.  01:65D0  CB DA               	set	B_TRGCMD,d
    1115.  01:65D2  DD 36 0F 01         	ld	(ix+TRACK_Timer),1
    1116.  01:65D6  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
    1117.  01:65DA  C3 4A 64            	jp	_rdc
    1118.  01:65DD                      
    1119.  01:65DD                      
    1120.  01:65DD                      
    1121.  01:65DD                      _CHIPcmd8_macro_offset:
    1122.  01:65DD                      	; in:	[A] contains the paramvalue
    1123.  01:65DD                      	; 
    1124.  01:65DD                      	; ! do not change	[BC] this is the data pointer
    1125.  01:65DD                      	;--------------------------------------------------
    1126.  01:65DD                      	; This command, when used together with a	note,	
    1127.  01:65DD                      	; will start playing the sample at the position	xx 
    1128.  01:65DD                      	; (instead of position 0). If	xx is	00 (900), the 
    1129.  01:65DD                      	; previous value will be used.
    1130.  01:65DD                      
    1131.  01:65DD                      	;--- Init values
    1132.  01:65DD                      	; NOT SUPPORTED ANYMORE
    1133.  01:65DD  C3 4A 64            	jp	_rdc
    1134.  01:65E0                      
    1135.  01:65E0                      
    1136.  01:65E0                      
    1137.  01:65E0                      
    1138.  01:65E0                      _CHIPcmd9_env_shape:
    1139.  01:65E0  CB D2               	set	B_TRGENV,d
    1140.  01:65E2  32 AD 02            	ld	(AY_regEnvShape),a
    1141.  01:65E5  DD 36 12 01         	ld	(ix+TRACK_Retrig),1
    1142.  01:65E9  C3 4A 64            	jp	_rdc
    1143.  01:65EC                      
    1144.  01:65EC                      
    1145.  01:65EC                      	; in:	[A] contains the paramvalue
    1146.  01:65EC                      	; 
    1147.  01:65EC                      	; ! do not change	[BC] this is the data pointer
    1148.  01:65EC                      	;--------------------------------------------------
    1149.  01:65EC                      	; This command set the envelope frequency using a
    1150.  01:65EC                      	; multiplier value (00-ff)
    1151.  01:65EC                      _CHIPcmdA_env_mul:
    1152.  01:65EC  57                  	ld	d,a
    1153.  01:65ED  AF                  	xor	a
    1154.  01:65EE  CB 3A               	srl	d
    1155.  01:65F0  1F                  	rra	
    1156.  01:65F1  CB 3A               	srl	d
    1157.  01:65F3  1F                  	rra		
    1158.  01:65F4  CB 3A               	srl	d
    1159.  01:65F6  1F                  	rra	
    1160.  01:65F7  32 AB 02            	ld	(AY_regEnvL),a
    1161.  01:65FA  7A                  	ld	a,d
    1162.  01:65FB  32 AC 02            	ld	(AY_regEnvH),a
    1163.  01:65FE                      	
    1164.  01:65FE  C3 4A 64            	jp	_rdc	
    1165.  01:6601                      
    1166.  01:6601                      
    1167.  01:6601                      
    1168.  01:6601                      _CHIPcmdB_wave_res:
    1169.  01:6601  CB F2               	set	B_TRGWAV,d
    1170.  01:6603  CB A2               	res	B_ACTMOR,d
    1171.  01:6605                      
    1172.  01:6605  0B                  	dec 	bc
    1173.  01:6606  C3 4A 64            	jp	_rdc
    1174.  01:6609                      
    1175.  01:6609                      
    1176.  01:6609                      _CHIPcmdC_wave_duty:
    1177.  01:6609                      _CHIPcmdD_wave_cut:
    1178.  01:6609                      _CHIPcmdE_wave_compr:
    1179.  01:6609  DD 77 0D            	ld	(ix+TRACK_cmd_B),a
    1180.  01:660C  CB DA               	set	B_TRGCMD,d
    1181.  01:660E  CB A2               	res	B_ACTMOR,d
    1182.  01:6610                      
    1183.  01:6610  C3 4A 64            	jp	_rdc	
    1184.  01:6613                      
    1185.  01:6613                      
    1186.  01:6613                      _CHIPcmdF_wave_set:
    1187.  01:6613  DD 77 F8            	ld	(ix+TRACK_Waveform),a
    1188.  01:6616  CB F2               	set	B_TRGWAV,d
    1189.  01:6618  CB A2               	res	B_ACTMOR,d
    1190.  01:661A                      
    1191.  01:661A  C3 4A 64            	jp	_rdc	
    1192.  01:661D                      
    1193.  01:661D                      
    1194.  01:661D                      _CHIPcmd10_morph_slave:
    1195.  01:661D  CB E2               	set	B_ACTMOR,d
    1196.  01:661F                      	
    1197.  01:661F  0B                  	dec 	bc
    1198.  01:6620  C3 4A 64            	jp	_rdc	
    1199.  01:6623                      	
    1200.  01:6623                      _CHIPcmd11_morph_start:
    1201.  01:6623  E6 0F               	and	0x0f
    1202.  01:6625  32 1D 01            	ld	(replay_morph_speed),a
    1203.  01:6628                      	
    1204.  01:6628  D9                  	exx
    1205.  01:6629                      	;--- load the waveformbuffer
    1206.  01:6629  DD 7E F8            	ld	a,(ix+TRACK_Waveform)
    1207.  01:662C                      ;	add	a,a
    1208.  01:662C                      ;	add	a,a
    1209.  01:662C                      ;	add	a,a	
    1210.  01:662C                      
    1211.  01:662C  6F                  	ld	l,a
    1212.  01:662D  26 00               	ld	h,0
    1213.  01:662F  29                  	add	hl,hl
    1214.  01:6630  29                  	add	hl,hl
    1215.  01:6631                      		
    1216.  01:6631  ED 5B 07 01         	ld	de,(replay_wavebase)
    1217.  01:6635  19                  	add	hl,de
    1218.  01:6636                      
    1219.  01:6636  11 1F 01            	ld	de,replay_morph_buffer
    1220.  01:6639  3E 20               	ld	a,32
    1221.  01:663B                      .loop:
    1222.  01:663B  08                  	ex	af,af'	;'
    1223.  01:663C  7E                  	ld	a,(hl)
    1224.  01:663D  12                  	ld	(de),a		; copy value to both wave and delta pos
    1225.  01:663E  13                  	inc	de
    1226.  01:663F  12                  	ld	(de),a
    1227.  01:6640  23                  	inc	hl
    1228.  01:6641  13                  	inc	de
    1229.  01:6642  08                  	ex	af,af'	;'
    1230.  01:6643  3D                  	dec	a
    1231.  01:6644  C2 3B 66            	jp	nz,.loop
    1232.  01:6647  D9                  	exx
    1233.  01:6648                      	
    1234.  01:6648  0A                  	ld	a,(bc)
    1235.  01:6649                      
    1236.  01:6649                      _CHIPcmd12_morph_cont:
    1237.  01:6649                      	;---- init new morph
    1238.  01:6649  E6 F0               	and	0xf0	
    1239.  01:664B  32 5F 01            	ld	(replay_morph_waveform),a	; store dest form offset
    1240.  01:664E                      	
    1241.  01:664E  AF                  	xor	a
    1242.  01:664F  32 1E 01            	ld	(replay_morph_counter),a
    1243.  01:6652  3C                  	inc	a
    1244.  01:6653  32 1C 01            	ld	(replay_morph_timer),a
    1245.  01:6656                      
    1246.  01:6656                      	;--- calculate the delta's	
    1247.  01:6656  3E FF               	ld	a,255				; 255 triggers calc init
    1248.  01:6658  32 1B 01            	ld	(replay_morph_active),a	
    1249.  01:665B                      
    1250.  01:665B  CB E2               	set	B_ACTMOR,d
    1251.  01:665D  C3 4A 64            	jp	_rdc		
    1252.  01:6660                      	
    1253.  01:6660                      
    1254.  01:6660                      _CHIPcmd13_short_arp:
    1255.  01:6660  DD 77 0E            	ld	(ix+TRACK_cmd_E),a		; store the halve not to add
    1256.  01:6663  DD 36 0F 00         	ld	(ix+TRACK_Timer),0
    1257.  01:6667                      
    1258.  01:6667  CB DA               	set	B_TRGCMD,d		; command active
    1259.  01:6669  C3 4A 64            	jp	_rdc	
    1260.  01:666C                      	
    1261.  01:666C                      	
    1262.  01:666C                      _CHIPcmd14_fine_up:
    1263.  01:666C                      _CHIPcmd15_fine_down:
    1264.  01:666C  DD 77 0E            	ld	(ix+TRACK_cmd_E),a
    1265.  01:666F  DD 36 0F 02         	ld	(ix+TRACK_Timer),2
    1266.  01:6673  CB DA               	set	B_TRGCMD,d		; command active
    1267.  01:6675                      
    1268.  01:6675  C3 4A 64            	jp	_rdc	
    1269.  01:6678                      
    1270.  01:6678                      
    1271.  01:6678                      _CHIPcmd16_vib_ctrl:
    1272.  01:6678  21 58 AE            	ld	hl,TRACK_Vibrato_sine
    1273.  01:667B  FE 01               	cp	1
    1274.  01:667D  DA 95 66            	jp	c,_cmd16_sine
    1275.  01:6680  CA 8C 66            	jp	z,_cmd16_tri
    1276.  01:6683                      _cmd16_pulse:
    1277.  01:6683  21 98 AE            	ld	hl,TRACK_Vibrato_pulse
    1278.  01:6686  22 17 01            	ld	(replay_vib_table),hl
    1279.  01:6689  C3 4A 64            	jp	_rdc
    1280.  01:668C                      _cmd16_tri:
    1281.  01:668C  21 78 AE            	ld	hl,TRACK_Vibrato_triangle
    1282.  01:668F  22 17 01            	ld	(replay_vib_table),hl
    1283.  01:6692  C3 4A 64            	jp	_rdc	
    1284.  01:6695                      
    1285.  01:6695                      _cmd16_sine:
    1286.  01:6695  21 58 AE            	ld	hl,TRACK_Vibrato_sine
    1287.  01:6698  22 17 01            	ld	(replay_vib_table),hl
    1288.  01:669B  C3 4A 64            	jp	_rdc
    1289.  01:669E                      
    1290.  01:669E                      
    1291.  01:669E                      
    1292.  01:669E                      _CHIPcmd17_track_detune:
    1293.  01:669E                      	; This command sets the	detune of the track.
    1294.  01:669E  5F                  	ld	e,a
    1295.  01:669F  E6 07               	and	0x07		; low	4 bits is value
    1296.  01:66A1  CB 5B               	bit	3,e		; Center around 8
    1297.  01:66A3  CA B3 66            	jp	z,.pos
    1298.  01:66A6  3C                  	inc	a
    1299.  01:66A7  ED 44               	neg			; make correct value
    1300.  01:66A9  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1301.  01:66AC  DD 36 05 FF         	ld	(ix+TRACK_cmd_detune+1),0xff
    1302.  01:66B0                      
    1303.  01:66B0  C3 4A 64            	jp	_rdc	
    1304.  01:66B3                      
    1305.  01:66B3                      .pos:
    1306.  01:66B3  DD 77 04            	ld	(ix+TRACK_cmd_detune),a
    1307.  01:66B6  DD 36 05 00         	ld	(ix+TRACK_cmd_detune+1),0x00	
    1308.  01:66BA                      
    1309.  01:66BA  C3 4A 64            	jp	_rdc	
    1310.  01:66BD                      
    1311.  01:66BD                      
    1312.  01:66BD                      ; This command sets the	detune of the track.	
    1313.  01:66BD                      _CHIPcmd18_transpose:
    1314.  01:66BD  5F                  	ld	e,a
    1315.  01:66BE  87                  	add	a
    1316.  01:66BF  21 98 AD            	ld	hl,TRACK_ToneTable		;(replay_Tonetable)
    1317.  01:66C2  E6 0F               	and	15		; low	4 bits is value
    1318.  01:66C4  CB 5B               	bit	3,e		; Center around 8
    1319.  01:66C6  CA D7 66            	jp	z,.pos
    1320.  01:66C9                      
    1321.  01:66C9                      	;neg	
    1322.  01:66C9  ED 44               	neg	
    1323.  01:66CB  85                  	add	a,l
    1324.  01:66CC  6F                  	ld	l,a
    1325.  01:66CD  D2 D1 66            	jp	nc,.skip1
    1326.  01:66D0  25                  	dec	h
    1327.  01:66D1                      .skip1:
    1328.  01:66D1  22 19 01            	ld	(replay_Tonetable),hl
    1329.  01:66D4  C3 4A 64            	jp	_rdc
    1330.  01:66D7                      ; pos
    1331.  01:66D7                      .pos:	
    1332.  01:66D7  85                  	add	a,l
    1333.  01:66D8  6F                  	ld	l,a
    1334.  01:66D9  D2 DD 66            	jp	nc,.skip2
    1335.  01:66DC  24                  	inc	h
    1336.  01:66DD                      .skip2:
    1337.  01:66DD  22 19 01            	ld	(replay_Tonetable),hl
    1338.  01:66E0  C3 4A 64            	jp	_rdc
    1339.  01:66E3                      
    1340.  01:66E3                      _CHIPcmdXX_note_cut:
    1341.  01:66E3  CB DA               	set	B_TRGCMD,d
    1342.  01:66E5  3C                  	inc	a
    1343.  01:66E6  DD 77 0F            	ld	(ix+TRACK_Timer),a		; set	the timer to param y
    1344.  01:66E9  C3 4A 64            	jp 	_rdc
    1345.  01:66EC                      
    1346.  01:66EC                      
    1347.  01:66EC                      _CHIPcmd19_note_delay:
    1348.  01:66EC  CB 42               	bit	B_TRGNOT,d		; is there a note	in this eventstep?
    1349.  01:66EE  CA 4A 64            	jp	z,_rdc
    1350.  01:66F1                      
    1351.  01:66F1  CB DA               	set	B_TRGCMD,d					; command active
    1352.  01:66F3  3C                  	inc	a
    1353.  01:66F4  DD 77 0F            	ld	(ix+TRACK_Timer),a			; set	the timer to param y
    1354.  01:66F7  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1355.  01:66FA  DD 77 0E            	ld	(ix+TRACK_cmd_E),a			; store the	new note
    1356.  01:66FD  3A 14 01            	ld	a,(replay_previous_note)
    1357.  01:6700  DD 77 F6            	ld	(ix+TRACK_Note),a				; restore the old	note
    1358.  01:6703  DD CB F9 86         	res	B_TRGNOT,(ix+TRACK_Flags)		; reset any	triggernote
    1359.  01:6707                      
    1360.  01:6707  C3 4A 64            	jp	_rdc	
    1361.  01:670A                      
    1362.  01:670A                      
    1363.  01:670A                      
    1364.  01:670A                      _CHIPcmd1A_trigger:
    1365.  01:670A  32 02 01            	ld	(replay_trigger),a
    1366.  01:670D  C3 4A 64            	jp	_rdc		
    1367.  01:6710                      
    1368.  01:6710                      
    1369.  01:6710                      _CHIPcmd1B_speed:
    1370.  01:6710  32 0D 01            	ld	(replay_speed),a
    1371.  01:6713                      	;--- Reset Timer == 0
    1372.  01:6713  CB 3F               	srl	a				; divide speed with 2
    1373.  01:6715  5F                  	ld	e,a
    1374.  01:6716  3E 00               	ld	a,0				
    1375.  01:6718  8F                  	adc	a				; store carry of shift as subtimer
    1376.  01:6719  32 0E 01            	ld	(replay_speed_subtimer),a
    1377.  01:671C  83                  	add	a,e
    1378.  01:671D  32 0F 01            	ld	(replay_speed_timer),a
    1379.  01:6720                      
    1380.  01:6720  C3 4A 64            	jp	_rdc	
    1381.  01:6723                      	
    1382.  01:6723                      _CHIPcmd1C_notelink:
    1383.  01:6723  CB 82               	res	B_TRGNOT,d
    1384.  01:6725  0B                  	dec 	bc
    1385.  01:6726  C3 4A 64            	jp	_rdc	
    1386.  01:6729                      _CHIPcmd1C_call:
    1387.  01:6729                      _CHIPcmd1D_ret:
    1388.  01:6729                      	;< not implemented yet>
    1389.  01:6729  0B                  	dec 	bc
    1390.  01:672A  C3 4A 64            	jp	_rdc	
    1391.  01:672D                      
    1392.  01:672D                      
    1393.  01:672D                      
    1394.  01:672D                      
    1395.  01:672D                      _CHIPcmd0_RE_arpeggio:
    1396.  01:672D  DD 36 0F 00         	ld	(ix+TRACK_Timer),0
    1397.  01:6731                      	
    1398.  01:6731                      _CHIPcmd1_RE_port_up:	
    1399.  01:6731                      _CHIPcmd2_RE_port_down:
    1400.  01:6731                      _CHIPcmd4_RE_vibrato:
    1401.  01:6731  CB DA               	set	B_TRGCMD,d
    1402.  01:6733  DD 77 12            	ld	(ix+TRACK_Retrig),a
    1403.  01:6736  C3 4A 64            	jp	_rdc		
    1404.  01:6739                      	
    1405.  01:6739                      _CHIPcmd5_RE_vibrato_port_tone:
    1406.  01:6739                      _CHIPcmd6_RE_vibrato_vol:
    1407.  01:6739                      _CHIPcmd7_RE_vol_slide:
    1408.  01:6739  CB DA               	set	B_TRGCMD,d
    1409.  01:673B  DD 36 0F 01         	ld	(ix+TRACK_Timer),1
    1410.  01:673F  DD 77 12            	ld	(ix+TRACK_Retrig),a
    1411.  01:6742  C3 4A 64            	jp	_rdc
    1412.  01:6745                      		
    1413.  01:6745                      _CHIPcmd8_RE_macro_offset:	
    1414.  01:6745  CB DA               	set	B_TRGCMD,d
    1415.  01:6747  DD 36 0F 02         	ld	(ix+TRACK_Timer),2
    1416.  01:674B  DD 77 12            	ld	(ix+TRACK_Retrig),a
    1417.  01:674E  C3 4A 64            	jp	_rdc			
    1418.  01:6751                      
    1419.  01:6751                      _CHIPcmd9_RE_env_shape:
    1420.  01:6751  CB D2               	set	B_TRGENV,d
    1421.  01:6753  DD 77 12            	ld	(ix+TRACK_Retrig),a
    1422.  01:6756  C3 4A 64            	jp	_rdc	
    1423.  01:6759                      
    1424.  01:6759                      
    1425.  01:6759                      
    1426.  01:6759                      ;===========================================================
    1427.  01:6759                      ; ---replay_route
    1428.  01:6759                      ; Output the data	to the CHIP	registers
    1429.  01:6759                      ; 
    1430.  01:6759                      ; in HL is the current tone freq
    1431.  01:6759                      ; in D is TRACK_FLAGS  
    1432.  01:6759                      ;===========================================================
    1433.  01:6759                      replay_process_chan_AY:
    1434.  01:6759                      
    1435.  01:6759                      	;-- set the	mixer	right
    1436.  01:6759  21 3D 03            	ld	hl,SCC_regMIXER   
    1437.  01:675C  CB 3E               	srl	(hl)
    1438.  01:675E                      
    1439.  01:675E                      	;=====
    1440.  01:675E                      	; COMMAND
    1441.  01:675E                      	;=====
    1442.  01:675E  CB 5A               	bit	B_TRGCMD,d	;(ix+TRACK_Flags)
    1443.  01:6760  CA 75 67            	jp	z,_pcAY_noCommand
    1444.  01:6763                      	
    1445.  01:6763  21 91 68            	ld	hl,_pcAY_cmdlist-26
    1446.  01:6766  DD 7E F0            	ld	a,(ix+TRACK_Command)
    1447.  01:6769  87                  	add	a
    1448.  01:676A  85                  	add	a,l
    1449.  01:676B  6F                  	ld	l,a
    1450.  01:676C  D2 70 67            	jp	nc,.skip
    1451.  01:676F  24                  	inc	h
    1452.  01:6770                      .skip:
    1453.  01:6770  7E                  	ld	a,(hl)
    1454.  01:6771  23                  	inc	hl
    1455.  01:6772  66                  	ld	h,(hl)
    1456.  01:6773  6F                  	ld	l,a	
    1457.  01:6774  E9                  	jp	(hl)
    1458.  01:6775                      	
    1459.  01:6775                      _pcAY_noCommand:	
    1460.  01:6775                      _pcAY_commandEND:
    1461.  01:6775                      
    1462.  01:6775                      	;=====
    1463.  01:6775                      	; NOTE
    1464.  01:6775                      	;=====
    1465.  01:6775                      	;--- Check if we need to trigger a new note
    1466.  01:6775  CB 42               	bit	B_TRGNOT,d	;(ix+TRACK_Flags)
    1467.  01:6777  CA 9E 67            	jp	z,_pcAY_noNoteTrigger
    1468.  01:677A                      	
    1469.  01:677A                      
    1470.  01:677A                      _pcAY_triggerNote:	
    1471.  01:677A                      	;--- get new Note
    1472.  01:677A  CB 82               	res	B_TRGNOT,d		;(ix+TRACK_Flags)		; reset trigger note flag
    1473.  01:677C  CB CA               	set	B_ACTNOT,d		;(ix+TRACK_Flags)		; set	note active	flag
    1474.  01:677E                      
    1475.  01:677E  DD 6E F3            	ld	l,(ix+TRACK_MacroStart)
    1476.  01:6781  DD 66 F4            	ld	h,(ix+TRACK_MacroStart+1)
    1477.  01:6784                      	;--- Store the macro start	
    1478.  01:6784  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l
    1479.  01:6787  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1480.  01:678A                      
    1481.  01:678A  21 00 00            	ld	hl,0
    1482.  01:678D  ED 73 00 01         	ld	(_SP_Storage),sp
    1483.  01:6791  DD F9               	ld	sp,ix
    1484.  01:6793  F1                  	pop	af
    1485.  01:6794  F1                  	pop	af
    1486.  01:6795  E5                  	push	hl
    1487.  01:6796  E5                  	push	hl		
    1488.  01:6797  E5                  	push	hl
    1489.  01:6798  E5                  	push	hl
    1490.  01:6799  E5                  	push	hl
    1491.  01:679A  ED 7B 00 01         	ld	sp,(_SP_Storage)
    1492.  01:679E                      
    1493.  01:679E                      ;	ld	(ix+TRACK_ToneAdd),0
    1494.  01:679E                      ;	ld	(ix+TRACK_ToneAdd+1),0
    1495.  01:679E                      ;	ld	(ix+TRACK_VolumeAdd),0	
    1496.  01:679E                      ;	ld	(ix+TRACK_cmd_ToneAdd),0
    1497.  01:679E                      ;	ld	(ix+TRACK_cmd_ToneAdd+1),0
    1498.  01:679E                      ;	ld	(ix+TRACK_cmd_VolumeAdd),0
    1499.  01:679E                      ;	ld	(ix+TRACK_Noise),0
    1500.  01:679E                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1501.  01:679E                      ;	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0
    1502.  01:679E                      
    1503.  01:679E                      _pcAY_noNoteTrigger:
    1504.  01:679E                      	;Get note freq
    1505.  01:679E  DD 7E F6            	ld	a,(ix+TRACK_Note)
    1506.  01:67A1  DD 86 0B            	add	a,(ix+TRACK_cmd_NoteAdd)
    1507.  01:67A4  87                  	add	a
    1508.  01:67A5  08                  	ex	af,af'			;'store the	note offset
    1509.  01:67A6  DD 36 0B 00         	ld	(ix+TRACK_cmd_NoteAdd),0	
    1510.  01:67AA                      	
    1511.  01:67AA                      
    1512.  01:67AA                      	;==============
    1513.  01:67AA                      	; Macro instrument
    1514.  01:67AA                      	;==============
    1515.  01:67AA  CB 4A               	bit	B_ACTNOT,d			;(ix+TRACK_Flags)
    1516.  01:67AC  CA A6 68            	jp	z,_pcAY_noNoteActive
    1517.  01:67AF                      	
    1518.  01:67AF                      	;--- Get the macro len and loop
    1519.  01:67AF  DD 6E F1            	ld	l,(ix+TRACK_MacroPointer)
    1520.  01:67B2  DD 66 F2            	ld	h,(ix+TRACK_MacroPointer+1)
    1521.  01:67B5                      
    1522.  01:67B5  5E                  	ld	e,(hl)				; info byte
    1523.  01:67B6  23                  	inc	hl
    1524.  01:67B7  CB 43               	bit	0,e					; Volume change
    1525.  01:67B9  C2 C2 67            	jp	nz,_vol_change
    1526.  01:67BC  DD 7E FD            	ld	a,(ix+TRACK_VolumeAdd)
    1527.  01:67BF  C3 EC 67            	jp	_noEnv
    1528.  01:67C2                      	
    1529.  01:67C2                      	;--- Volume change
    1530.  01:67C2                      _vol_change:
    1531.  01:67C2  7E                  	ld	a,(hl)
    1532.  01:67C3  23                  	inc	hl
    1533.  01:67C4                      	
    1534.  01:67C4  CB 4B               	bit	1,e
    1535.  01:67C6  CA DC 67            	jp	z,_vol_base
    1536.  01:67C9                      _vol_rel:
    1537.  01:67C9  DD 86 FD            	add	 (ix+TRACK_VolumeAdd)
    1538.  01:67CC  FE 10               	cp	16
    1539.  01:67CE  DA DC 67            	jp	c,_vol_base
    1540.  01:67D1  FE 80               	cp	128
    1541.  01:67D3  D2 DB 67            	jp	nc,.skip
    1542.  01:67D6  3E 0F               	ld	a,$0f
    1543.  01:67D8  C3 DC 67            	jp	_vol_base
    1544.  01:67DB                      .skip:	
    1545.  01:67DB  AF                  	xor	a
    1546.  01:67DC                      	
    1547.  01:67DC                      _vol_base:
    1548.  01:67DC  DD 77 FD            	ld	(ix+TRACK_VolumeAdd),a
    1549.  01:67DF                      
    1550.  01:67DF                      	;---- envelope check
    1551.  01:67DF                      	; is done here to be able to continue
    1552.  01:67DF                      	; macro volume values.
    1553.  01:67DF  CB 52               	bit	B_TRGENV,d		;'(IX+TRACK_Flags)
    1554.  01:67E1  CA EC 67            	jp	z,_noEnv		; if not set then normal volume calculation
    1555.  01:67E4  3E 10               	ld	a,16			; set volume to 16 == envelope
    1556.  01:67E6  32 3C 03            	ld	(SCC_regVOLE),a
    1557.  01:67E9  C3 26 68            	jp	_noVolume	
    1558.  01:67EC                      	
    1559.  01:67EC                      _noEnv:
    1560.  01:67EC  DD B6 F7            	or	(ix+TRACK_Volume)
    1561.  01:67EF  4F                  	ld	c,a			; store volume add
    1562.  01:67F0                      
    1563.  01:67F0  DD 7E FF            	ld 	a,(ix+TRACK_cmd_VolumeAdd)
    1564.  01:67F3  17                  	rla				; shift to detect shift
    1565.  01:67F4  DA 01 68            	jp 	c,.sub_Vadd		
    1566.  01:67F7                      .add_Vadd:  
    1567.  01:67F7  81                  	add	a,c
    1568.  01:67F8  D2 0D 68            	jp	nc,_Vadd
    1569.  01:67FB  79                  	ld	a,c
    1570.  01:67FC  F6 F0               	or	0xf0
    1571.  01:67FE  C3 0D 68            	jp	_Vadd	
    1572.  01:6801                      .sub_Vadd:	
    1573.  01:6801  47                  	ld	b,a
    1574.  01:6802  AF                  	xor	a
    1575.  01:6803  90                  	sub 	b
    1576.  01:6804  47                  	ld	b,a
    1577.  01:6805  79                  	ld	a,c
    1578.  01:6806  90                  	sub	a,b
    1579.  01:6807  D2 0D 68            	jp 	nc,.skip2
    1580.  01:680A  79                  	ld	a,c
    1581.  01:680B  E6 0F                	and	0x0f
    1582.  01:680D                      .skip2:
    1583.  01:680D                      
    1584.  01:680D                      	
    1585.  01:680D                      	;-- next is _Vadd
    1586.  01:680D                      _Vadd:
    1587.  01:680D                      	;--- apply main volume balance
    1588.  01:680D  ED 4B 15 01         	ld	bc,(replay_mainvol)
    1589.  01:6811  81                  	add	a,c
    1590.  01:6812  4F                  	ld	c,a
    1591.  01:6813  D2 17 68            	jp	nc,.skip
    1592.  01:6816  04                  	inc	b
    1593.  01:6817                      .skip:
    1594.  01:6817  0A                  	ld	a,(bc)	
    1595.  01:6818                      	; Test which CHIP.
    1596.  01:6818  CB 7A               	bit	B_PSGSCC,d		;(ix+TRACK_Flags)
    1597.  01:681A  C2 21 68            	jp	nz,.skip2
    1598.  01:681D  1F                  	rra
    1599.  01:681E  1F                  	rra
    1600.  01:681F  1F                  	rra
    1601.  01:6820  1F                  	rra
    1602.  01:6821                      .skip2:
    1603.  01:6821  E6 0F               	and	0x0f
    1604.  01:6823  32 3C 03            	ld	(SCC_regVOLE),a
    1605.  01:6826                      
    1606.  01:6826                      _noVolume:
    1607.  01:6826                      	;-------------------------------
    1608.  01:6826                      	;
    1609.  01:6826                      	; NOISE
    1610.  01:6826                      	;
    1611.  01:6826                      	;-------------------------------
    1612.  01:6826  CB 7B               	bit 	7,e			; test if noise
    1613.  01:6828  CA 4D 68            	jp	z,_noNoise
    1614.  01:682B                      	
    1615.  01:682B                      	;--- prevent SCC and noise
    1616.  01:682B  CB 7A               	bit	B_PSGSCC,d		;(ix+TRACK_Flags)
    1617.  01:682D  C2 4D 68            	jp	nz,_noNoise
    1618.  01:6830                      
    1619.  01:6830                      	;--- Set the mixer for noise
    1620.  01:6830  3A 3D 03            	ld	a,(SCC_regMIXER)
    1621.  01:6833  F6 80               	or	128
    1622.  01:6835  32 3D 03            	ld	(SCC_regMIXER),a
    1623.  01:6838                      
    1624.  01:6838  CB 6B               	bit	5,e
    1625.  01:683A  CA 4D 68            	jp	z,_noNoise
    1626.  01:683D  7E                  	ld	a,(hl)	; get	the deviation	
    1627.  01:683E  23                  	inc	hl
    1628.  01:683F  CB 73               	bit	6,e
    1629.  01:6841  CA 47 68            	jp	z,.skip
    1630.  01:6844  DD 86 FE            	add	(ix+TRACK_Noise)
    1631.  01:6847  DD 77 FE            .skip:	ld	(ix+TRACK_Noise),a
    1632.  01:684A  32 A6 02            	ld	(AY_regNOISE),a
    1633.  01:684D                      	
    1634.  01:684D                      _noNoise:
    1635.  01:684D                      	;-------------------------------
    1636.  01:684D                      	;
    1637.  01:684D                      	; TONE
    1638.  01:684D                      	;
    1639.  01:684D                      	;-------------------------------
    1640.  01:684D  CB 63               	bit	4,e		; do we have tone?
    1641.  01:684F  CA 5A 68            	jp	z,_pcAY_noTone
    1642.  01:6852                      
    1643.  01:6852                      	;-- enable tone output
    1644.  01:6852  3A 3D 03            	ld	a,(SCC_regMIXER)
    1645.  01:6855  F6 10               	or	16
    1646.  01:6857  32 3D 03            	ld	(SCC_regMIXER),a
    1647.  01:685A                      _pcAY_noTone:
    1648.  01:685A  DD 46 FB            	ld	b,(ix+TRACK_ToneAdd)	; get	the current	deviation	
    1649.  01:685D  DD 4E FC            	ld	c,(ix+TRACK_ToneAdd+1)
    1650.  01:6860                      
    1651.  01:6860  CB 53               	bit	2,e
    1652.  01:6862  CA 77 68            	jp	z,_pcAY_noToneAdd
    1653.  01:6865  7E                  	ld	a,(hl)
    1654.  01:6866  23                  	inc	hl
    1655.  01:6867  81                  	add	c
    1656.  01:6868  4F                  	ld	c,a
    1657.  01:6869  DD 71 FC            	ld	(ix+TRACK_ToneAdd+1),c
    1658.  01:686C  D2 70 68            	jp	nc,.skip
    1659.  01:686F  04                  	inc	b
    1660.  01:6870                      .skip:
    1661.  01:6870  7E                  	ld	a,(hl)
    1662.  01:6871  23                  	inc	hl
    1663.  01:6872  80                  	add	b
    1664.  01:6873  47                  	ld	b,a
    1665.  01:6874  DD 70 FB            	ld	(ix+TRACK_ToneAdd),b
    1666.  01:6877                      _pcAY_noToneAdd:	
    1667.  01:6877                      	;---- check for macro end
    1668.  01:6877  CB 5B               	bit	3,e		
    1669.  01:6879  CA 80 68            	jp	z,.noend
    1670.  01:687C                      	
    1671.  01:687C  7E                  	ld	a,(hl)
    1672.  01:687D  23                  	inc	hl
    1673.  01:687E  66                  	ld	h,(hl)
    1674.  01:687F  6F                  	ld	l,a
    1675.  01:6880                      	
    1676.  01:6880                      
    1677.  01:6880                      .noend:
    1678.  01:6880  DD 75 F1            	ld	(ix+TRACK_MacroPointer),l	;--- store pointer for next time
    1679.  01:6883  DD 74 F2            	ld	(ix+TRACK_MacroPointer+1),h	
    1680.  01:6886                      
    1681.  01:6886  08                  	ex	af,af'			;';restore note offset
    1682.  01:6887  2A 19 01            	ld	hl,(replay_Tonetable)
    1683.  01:688A  85                  	add	a,l
    1684.  01:688B  6F                  	ld	l,a
    1685.  01:688C  D2 90 68            	jp	nc,.skip
    1686.  01:688F  24                  	inc	h
    1687.  01:6890                      .skip:
    1688.  01:6890  7E                  	ld	a,(hl)	;--- Store the note tone value in hl
    1689.  01:6891  23                  	inc	hl
    1690.  01:6892  66                  	ld	h,(hl)
    1691.  01:6893  6F                  	ld	l,a
    1692.  01:6894                      		
    1693.  01:6894  09                  	add	hl,bc		;--- Store tone deviation		
    1694.  01:6895                      
    1695.  01:6895                      	; set	the detune.
    1696.  01:6895  ED 73 00 01         	ld	(_SP_Storage),sp
    1697.  01:6899  DD F9               	ld	sp,ix
    1698.  01:689B  C1                  	pop	bc		; cmd detume
    1699.  01:689C  09                  	add	hl,bc
    1700.  01:689D  C1                  	pop	bc		; cmd toneadd
    1701.  01:689E  09                  	add	hl,bc
    1702.  01:689F  C1                  	pop	bc		; cmd tone slide add
    1703.  01:68A0  09                  	add	hl,bc
    1704.  01:68A1  ED 7B 00 01         	ld	sp,(_SP_Storage)
    1705.  01:68A5                      
    1706.  01:68A5  C9                  	ret
    1707.  01:68A6                      	
    1708.  01:68A6                      	
    1709.  01:68A6                      ;	ld	c,(ix+TRACK_cmd_detune)
    1710.  01:68A6                      ;	ld	b,(ix+TRACK_cmd_detune+1)
    1711.  01:68A6                      ;	add	hl,bc
    1712.  01:68A6                      ;
    1713.  01:68A6                      ;	ld	c,(ix+TRACK_cmd_ToneAdd)
    1714.  01:68A6                      ;	ld	b,(ix+TRACK_cmd_ToneAdd+1)
    1715.  01:68A6                      ;	add	hl,bc
    1716.  01:68A6                      ;	
    1717.  01:68A6                      ;	ld	c,(ix+TRACK_cmd_ToneSlideAdd)
    1718.  01:68A6                      ;	ld	b,(ix+TRACK_cmd_ToneSlideAdd+1)
    1719.  01:68A6                      ;	
    1720.  01:68A6                      ;	add	hl,bc
    1721.  01:68A6                      
    1722.  01:68A6                      	;-------------------------------
    1723.  01:68A6                      	;
    1724.  01:68A6                      	; END of macro?
    1725.  01:68A6                      	;
    1726.  01:68A6                      	;-------------------------------
    1727.  01:68A6                      ;	bit	3,e		
    1728.  01:68A6                      ;	ret	z
    1729.  01:68A6                      	
    1730.  01:68A6                      	;--- now get new pointer
    1731.  01:68A6                      	
    1732.  01:68A6                      ;	ld	c,(ix+TRACK_MacroStart)
    1733.  01:68A6                      ;	ld	b,(ix+TRACK_MacroStart+1)
    1734.  01:68A6                      ;	
    1735.  01:68A6                      ;	ld	a,(ix+TRACK_MacroRestart)	
    1736.  01:68A6                      ;	add	a,c
    1737.  01:68A6                      ;	ld	c,a
    1738.  01:68A6                      ;	jp	nc,.skip2
    1739.  01:68A6                      ;	inc	b
    1740.  01:68A6                      ;.skip2:		
    1741.  01:68A6                      	;--- Store the macro start	
    1742.  01:68A6                      ;	ld	(ix+TRACK_MacroPointer),c
    1743.  01:68A6                      ;	ld	(ix+TRACK_MacroPointer+1),b		
    1744.  01:68A6                      
    1745.  01:68A6                      ;	ret
    1746.  01:68A6                      	
    1747.  01:68A6                      _pcAY_noNoteActive:
    1748.  01:68A6  AF                  	xor	a
    1749.  01:68A7  32 3C 03            	ld	(SCC_regVOLE),a
    1750.  01:68AA  C9                  	ret	
    1751.  01:68AB                      
    1752.  01:68AB                      ;---- This is for debugging only	
    1753.  01:68AB                      ;stop_debug:
    1754.  01:68AB                      ;	halt
    1755.  01:68AB                      ;	jp	stop_debug	
    1756.  01:68AB                      ;	
    1757.  01:68AB                      ;PROCESS_CMDLIST:	
    1758.  01:68AB                      ;[13]	dw 	stop_debug
    1759.  01:68AB                      
    1760.  01:68AB                      _pcAY_cmdlist:
    1761.  01:68AB  0F 6A               	dw	_pcAY_cmdc_wave_duty		;d
    1762.  01:68AD  3C 6A               	dw	_pcAY_cmdd_wave_cut		;e
    1763.  01:68AF  7D 6A               	dw	_pcAY_cmde_wave_compr		;f
    1764.  01:68B1  CE 6A               	dw	_pcAY_cmd13_short_arp		;10
    1765.  01:68B3  DF 6A               	dw	_pcAY_cmd14_fine_up		;11
    1766.  01:68B5  F9 6A               	dw	_pcAY_cmd15_fine_down		;12
    1767.  01:68B7  20 6B               	dw	_pcAY_cmd19_note_delay		;13
    1768.  01:68B9  13 6B               	dw	_pcAY_cmdXX_note_cut		;14
    1769.  01:68BB                      	
    1770.  01:68BB  E1 68               	dw	_pcAY_cmd0_arpeggio		;15
    1771.  01:68BD  18 69               	dw	_pcAY_cmd1_port_up		;16
    1772.  01:68BF  2C 69               	dw	_pcAY_cmd2_port_down		;17
    1773.  01:68C1  40 69               	dw	_pcAY_cmd3_port_tone		;18
    1774.  01:68C3  81 69               	dw	_pcAY_cmd4_vibrato		;19
    1775.  01:68C5  CB 69               	dw	_pcAY_cmd5_vibrato_port_tone	;1a
    1776.  01:68C7  D1 69               	dw	_pcAY_cmd6_vibrato_vol		;1b
    1777.  01:68C9  D7 69               	dw	_pcAY_cmd7_vol_slide		;1c
    1778.  01:68CB  04 6A               	dw	_pcAY_cmd8_macro_offset		;1d
    1779.  01:68CD  00 00               	dw	0	;env shape
    1780.  01:68CF                      
    1781.  01:68CF  E1 68               	dw	_pcAY_cmd0_arpeggio		;1e
    1782.  01:68D1  18 69               	dw	_pcAY_cmd1_port_up		;1f
    1783.  01:68D3  2C 69               	dw	_pcAY_cmd2_port_down		;20
    1784.  01:68D5  40 69               	dw	_pcAY_cmd3_port_tone		;21
    1785.  01:68D7  81 69               	dw	_pcAY_cmd4_vibrato
    1786.  01:68D9  CB 69               	dw	_pcAY_cmd5_vibrato_port_tone
    1787.  01:68DB  D1 69               	dw	_pcAY_cmd6_vibrato_vol
    1788.  01:68DD  D7 69               	dw	_pcAY_cmd7_vol_slide
    1789.  01:68DF  04 6A               	dw	_pcAY_cmd8_macro_offset
    1790.  01:68E1                      
    1791.  01:68E1                      			
    1792.  01:68E1                      _pcAY_cmd0_arpeggio:
    1793.  01:68E1  DD 7E 0F            	ld	a,(ix+TRACK_Timer)
    1794.  01:68E4  CB 47               	bit	0,a
    1795.  01:68E6  CA FD 68            	jp	z,.step2
    1796.  01:68E9                      
    1797.  01:68E9                      	;--- set x
    1798.  01:68E9  DD 36 0F 02         	ld	(ix+TRACK_Timer),2
    1799.  01:68ED  AF                  	xor	a
    1800.  01:68EE  DD 7E 05            	ld	a,(ix+TRACK_cmd_0)
    1801.  01:68F1  E6 F0               	and	0xf0
    1802.  01:68F3  1F                  	rra
    1803.  01:68F4  1F                  	rra
    1804.  01:68F5  1F                  	rra
    1805.  01:68F6  1F                  	rra
    1806.  01:68F7  DD 77 0B            	ld	(ix+TRACK_cmd_NoteAdd),a		
    1807.  01:68FA  C3 75 67            	jp	_pcAY_commandEND
    1808.  01:68FD                      
    1809.  01:68FD                      	
    1810.  01:68FD                      .step2:
    1811.  01:68FD  CB 4F               	bit	1,a
    1812.  01:68FF  CA 11 69            	jp	z,.step3
    1813.  01:6902                      
    1814.  01:6902                      	;--- set y
    1815.  01:6902  DD 36 0F 00         	ld	(ix+TRACK_Timer),0
    1816.  01:6906  DD 7E 05            	ld	a,(ix+TRACK_cmd_0)
    1817.  01:6909  E6 0F               	and	0x0f
    1818.  01:690B  DD 77 0B            	ld	(ix+TRACK_cmd_NoteAdd),a		
    1819.  01:690E  C3 75 67            	jp	_pcAY_commandEND
    1820.  01:6911                      	
    1821.  01:6911                      .step3:
    1822.  01:6911                      	;--- set none
    1823.  01:6911  DD 36 0F 01         	ld	(ix+TRACK_Timer),1
    1824.  01:6915  C3 75 67            	jp	_pcAY_commandEND
    1825.  01:6918                      	
    1826.  01:6918                      	
    1827.  01:6918                      _pcAY_cmd1_port_up:
    1828.  01:6918  DD 7E 06            	ld	a,(ix+TRACK_cmd_1)
    1829.  01:691B  47                  	ld	b,a
    1830.  01:691C  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1831.  01:691F  90                  	sub	b
    1832.  01:6920  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1833.  01:6923  D2 75 67            	jp	nc,_pcAY_commandEND
    1834.  01:6926  DD 35 01            	dec	(ix+TRACK_cmd_ToneSlideAdd+1)
    1835.  01:6929  C3 75 67            	jp	_pcAY_commandEND
    1836.  01:692C                      	
    1837.  01:692C                      _pcAY_cmd2_port_down:
    1838.  01:692C  DD 7E 07            	ld	a,(ix+TRACK_cmd_2)
    1839.  01:692F  47                  	ld	b,a
    1840.  01:6930  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    1841.  01:6933  80                  	add	b
    1842.  01:6934  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1843.  01:6937  D2 75 67            	jp	nc,_pcAY_commandEND
    1844.  01:693A  DD 34 01            	inc	(ix+TRACK_cmd_ToneSlideAdd+1)
    1845.  01:693D  C3 75 67            	jp	_pcAY_commandEND
    1846.  01:6940                      
    1847.  01:6940                      
    1848.  01:6940                      _pcAY_cmd3_port_tone:
    1849.  01:6940  DD 7E 08            	ld	a,(ix+TRACK_cmd_3)
    1850.  01:6943  DD 6E 00            	ld	l,(ix+TRACK_cmd_ToneSlideAdd)
    1851.  01:6946  DD 66 01            	ld	h,(ix+TRACK_cmd_ToneSlideAdd+1)
    1852.  01:6949  CB 7C               	bit	7,h
    1853.  01:694B  CA 61 69            	jp	z,_pcAY_cmd3_sub
    1854.  01:694E                      _pcAY_cmd3_add:
    1855.  01:694E                      	;pos slide
    1856.  01:694E  85                  	add	a,l
    1857.  01:694F  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    1858.  01:6952  D2 75 67            	jp	nc,_pcAY_commandEND
    1859.  01:6955  24                  	inc	h					
    1860.  01:6956  CB 7C               	bit	7,h
    1861.  01:6958  CA 74 69            	jp	z,_pcAY_cmd3_stop			; delta turned pos ?
    1862.  01:695B  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1863.  01:695E  C3 75 67            	jp	_pcAY_commandEND
    1864.  01:6961                      _pcAY_cmd3_sub:
    1865.  01:6961                      	;negative slide	
    1866.  01:6961  4F                  	ld	c,a
    1867.  01:6962  AF                  	xor	a
    1868.  01:6963  47                  	ld	b,a
    1869.  01:6964  ED 42               	sbc	hl,bc
    1870.  01:6966  CB 7C               	bit	7,h
    1871.  01:6968  C2 74 69            	jp	nz,_pcAY_cmd3_stop			; delta turned neg ?
    1872.  01:696B  DD 75 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),l
    1873.  01:696E  DD 74 01            	ld	(ix+TRACK_cmd_ToneSlideAdd+1),h
    1874.  01:6971  C3 75 67            	jp	_pcAY_commandEND
    1875.  01:6974                      _pcAY_cmd3_stop:	
    1876.  01:6974  CB 9A               	res	B_TRGCMD,d		;(ix+TRACK_Flags)
    1877.  01:6976  DD 36 00 00         	ld	(ix+TRACK_cmd_ToneSlideAdd),0
    1878.  01:697A  DD 36 01 00         	ld	(ix+TRACK_cmd_ToneSlideAdd+1),0	
    1879.  01:697E  C3 75 67            	jp	_pcAY_commandEND
    1880.  01:6981                      
    1881.  01:6981                      
    1882.  01:6981                      	;-- vibrato	
    1883.  01:6981                      _pcAY_cmd4_vibrato:
    1884.  01:6981  2A 17 01            	ld	hl,(replay_vib_table)
    1885.  01:6984                      	;--- Get next step
    1886.  01:6984  DD 7E 10            	ld	a,(IX+TRACK_Step)
    1887.  01:6987  DD 86 0A            	add	(ix+TRACK_cmd_4_step)
    1888.  01:698A  E6 3F               	and	$3F			; max	32
    1889.  01:698C  DD 77 10            	ld	(ix+TRACK_Step),a
    1890.  01:698F                      	
    1891.  01:698F  CB 6F               	bit	5,a			; step 32-63 the neg	
    1892.  01:6991  CA B3 69            	jp	z,_pcAY_cmd4pos
    1893.  01:6994                      
    1894.  01:6994                      ; neg	
    1895.  01:6994  E6 1F               	and	$1f
    1896.  01:6996  85                  	add	l
    1897.  01:6997  6F                  	ld	l,a
    1898.  01:6998  D2 9C 69            	jp	nc,.skip
    1899.  01:699B  24                  	inc	h
    1900.  01:699C                      .skip:
    1901.  01:699C  7E                  	ld	a,(hl)
    1902.  01:699D                      	;apply depth
    1903.  01:699D  DD 46 09            	ld	b,(ix+TRACK_cmd_4_depth)
    1904.  01:69A0                      .loop:
    1905.  01:69A0  CB 3F               	srl	a
    1906.  01:69A2  10 FC               	djnz	.loop
    1907.  01:69A4                      ;	and	$0f
    1908.  01:69A4                      
    1909.  01:69A4  ED 44               	neg
    1910.  01:69A6  CA C1 69            	jp	z,_pcAY_cmd4_zero			; $ff00 gives strange result ;)	
    1911.  01:69A9  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    1912.  01:69AC  DD 36 03 FF         	ld	(ix+TRACK_cmd_ToneAdd+1),0xff
    1913.  01:69B0  C3 75 67            	jp	_pcAY_commandEND
    1914.  01:69B3                      
    1915.  01:69B3                      _pcAY_cmd4pos:	
    1916.  01:69B3                      ;	and	$1f
    1917.  01:69B3  85                  	add	l
    1918.  01:69B4  6F                  	ld	l,a
    1919.  01:69B5  D2 B9 69            	jp	nc,.skip
    1920.  01:69B8  24                  	inc	h
    1921.  01:69B9                      .skip:
    1922.  01:69B9  7E                  	ld	a,(hl)
    1923.  01:69BA                      	;apply depth
    1924.  01:69BA  DD 46 09            	ld	b,(ix+TRACK_cmd_4_depth)
    1925.  01:69BD                      .loop:
    1926.  01:69BD  CB 3F               	srl	a
    1927.  01:69BF  10 FC               	djnz	.loop
    1928.  01:69C1                      _pcAY_cmd4_zero:
    1929.  01:69C1  DD 77 02            	ld	(ix+TRACK_cmd_ToneAdd),a
    1930.  01:69C4  DD 36 03 00         	ld	(ix+TRACK_cmd_ToneAdd+1),0
    1931.  01:69C8  C3 75 67            	jp	_pcAY_commandEND
    1932.  01:69CB                      		
    1933.  01:69CB                      	
    1934.  01:69CB                      
    1935.  01:69CB                      _pcAY_cmd5_vibrato_port_tone:
    1936.  01:69CB  CD DD 69            	call	_pcAY_cmdasub
    1937.  01:69CE  C3 40 69            	jp	_pcAY_cmd3_port_tone
    1938.  01:69D1                      	
    1939.  01:69D1                      _pcAY_cmd6_vibrato_vol:
    1940.  01:69D1  CD DD 69            	call	_pcAY_cmdasub
    1941.  01:69D4  C3 81 69            	jp	_pcAY_cmd4_vibrato	
    1942.  01:69D7                      
    1943.  01:69D7                      _pcAY_cmd7_vol_slide:
    1944.  01:69D7  CD DD 69            	call	_pcAY_cmdasub
    1945.  01:69DA  C3 75 67            	jp	_pcAY_commandEND
    1946.  01:69DD                      
    1947.  01:69DD                      _pcAY_cmdasub:
    1948.  01:69DD  DD 35 0F            	dec	(ix+TRACK_Timer)
    1949.  01:69E0  C0                  	ret	nz
    1950.  01:69E1                      		
    1951.  01:69E1                      	; vol	slide
    1952.  01:69E1  DD 7E 0C            	ld	a,(ix+TRACK_cmd_A)
    1953.  01:69E4  4F                  	ld	c,a
    1954.  01:69E5  E6 7F               	and	$7f
    1955.  01:69E7  DD 77 0F            	ld	(ix+TRACK_Timer),a
    1956.  01:69EA                      
    1957.  01:69EA  DD 7E FF            	ld	a,(IX+TRACK_cmd_VolumeAdd)
    1958.  01:69ED  CB 79               	bit	7,c
    1959.  01:69EF  CA FB 69            	jp	z,_pcAY_cmda_inc
    1960.  01:69F2                      _pcAY_cmda_dec:
    1961.  01:69F2  FE 88               	cp	0x88
    1962.  01:69F4  C8                  	ret	z
    1963.  01:69F5  D6 08               	sub	8
    1964.  01:69F7  DD 77 FF            	ld	(ix+TRACK_cmd_VolumeAdd),a
    1965.  01:69FA  C9                  	ret
    1966.  01:69FB                      _pcAY_cmda_inc:
    1967.  01:69FB  FE 78               	cp	0x78
    1968.  01:69FD  C8                  	ret	z
    1969.  01:69FE  C6 08               	add	8	
    1970.  01:6A00  DD 77 FF            	ld	(ix+TRACK_cmd_VolumeAdd),a
    1971.  01:6A03  C9                  	ret
    1972.  01:6A04                      	
    1973.  01:6A04                      _pcAY_cmd8_macro_offset:
    1974.  01:6A04  DD 35 0F            	dec	(ix+TRACK_Timer)
    1975.  01:6A07  C2 75 67            	jp	nz,_pcAY_commandEND
    1976.  01:6A0A  CB 9A               	res	B_TRGCMD,d			;(ix+TRACK_Flags)
    1977.  01:6A0C  C3 75 67            	jp	_pcAY_commandEND
    1978.  01:6A0F                      
    1979.  01:6A0F                      
    1980.  01:6A0F                      _pcAY_cmdc_wave_duty:
    1981.  01:6A0F                      	;=================
    1982.  01:6A0F                      	; Waveform PWM / Duty Cycle
    1983.  01:6A0F                      	;=================
    1984.  01:6A0F  CB 9A               	res	B_TRGCMD,d			;(ix+TRACK_Flags)	; reset command
    1985.  01:6A11  CB F2               	set	B_TRGWAV,d			;(ix+TRACK_Flags)	; reset normal wave update
    1986.  01:6A13                      
    1987.  01:6A13                      	;get the waveform	start	in [DE]
    1988.  01:6A13  21 AE 02            	ld	hl,_0x9800
    1989.  01:6A16  FD 7C               	ld	a,iyh		;ixh contains chan#
    1990.  01:6A18  0F                  	rrca			; a mac value is 4 so
    1991.  01:6A19  0F                  	rrca			; 3 times rrca is	X32
    1992.  01:6A1A  0F                  	rrca			; max	result is 128.
    1993.  01:6A1B  85                  	add	a,l
    1994.  01:6A1C  6F                  	ld	l,a
    1995.  01:6A1D  D2 21 6A            	jp	nc,.skip
    1996.  01:6A20  24                  	inc	h
    1997.  01:6A21                      .skip:
    1998.  01:6A21  DD 46 0D            	ld	b,(ix+TRACK_cmd_B)
    1999.  01:6A24  04                  	inc	b
    2000.  01:6A25                      
    2001.  01:6A25  0E 60               	ld	c,96	
    2002.  01:6A27  3E 20               	ld	a,32
    2003.  01:6A29  90                  	sub	b
    2004.  01:6A2A                      _wspw_loop_h:
    2005.  01:6A2A  71                  	ld	(hl),c
    2006.  01:6A2B  23                  	inc	hl
    2007.  01:6A2C  10 FC               	djnz	_wspw_loop_h
    2008.  01:6A2E                      	
    2009.  01:6A2E  A7                  	and	a
    2010.  01:6A2F  CA 75 67            	jp	z,_pcAY_commandEND
    2011.  01:6A32                      	
    2012.  01:6A32  0E A0               	ld	c,-96
    2013.  01:6A34  47                  	ld	b,a
    2014.  01:6A35                      _wspw_loop_l:
    2015.  01:6A35  71                  	ld	(hl),c
    2016.  01:6A36  23                  	inc	hl
    2017.  01:6A37  10 FC               	djnz	_wspw_loop_l
    2018.  01:6A39                      
    2019.  01:6A39  C3 75 67            	jp	_pcAY_commandEND
    2020.  01:6A3C                      	
    2021.  01:6A3C                      	
    2022.  01:6A3C                      	
    2023.  01:6A3C                      _pcAY_cmdd_wave_cut:
    2024.  01:6A3C                      	;=================
    2025.  01:6A3C                      	; Waveform Cut
    2026.  01:6A3C                      	;=================
    2027.  01:6A3C                      
    2028.  01:6A3C  CB 9A               	res	B_TRGCMD,d		;(ix+TRACK_Flags)	; reset command
    2029.  01:6A3E  CB F2               	set	B_TRGWAV,d		;(ix+TRACK_Flags)	; reset normal wave update
    2030.  01:6A40  7A                  	ld	a,d
    2031.  01:6A41  08                  	ex	af,af'		;'
    2032.  01:6A42                      
    2033.  01:6A42                      	;get the waveform	start	in [DE]
    2034.  01:6A42  11 AE 02            	ld	de,_0x9800
    2035.  01:6A45  FD 7C               	ld	a,iyh		;ixh contains chan#
    2036.  01:6A47  0F                  	rrca			; a mac value is 4 so
    2037.  01:6A48  0F                  	rrca			; 3 times rrca is	X32
    2038.  01:6A49  0F                  	rrca			; max	result is 128.
    2039.  01:6A4A  83                  	add	a,e
    2040.  01:6A4B  5F                  	ld	e,a
    2041.  01:6A4C  D2 50 6A            	jp	nc,.skip
    2042.  01:6A4F  14                  	inc	d
    2043.  01:6A50                      .skip:
    2044.  01:6A50  DD 7E F8            	ld	a,(ix+TRACK_Waveform)
    2045.  01:6A53  3C                  	inc	a	
    2046.  01:6A54  DD 77 F8            	ld	(ix+TRACK_Waveform),a
    2047.  01:6A57  3D                  	dec	a
    2048.  01:6A58                      
    2049.  01:6A58                      ;	add	a,a
    2050.  01:6A58                      ;	add	a,a
    2051.  01:6A58                      ;	add	a,a	
    2052.  01:6A58                      
    2053.  01:6A58  6F                  	ld	l,a
    2054.  01:6A59  26 00               	ld	h,0
    2055.  01:6A5B  29                  	add	hl,hl
    2056.  01:6A5C  29                  	add	hl,hl
    2057.  01:6A5D                      		
    2058.  01:6A5D  ED 4B 07 01         	ld	  bc,(replay_wavebase)
    2059.  01:6A61  09                  	add	  hl,bc
    2060.  01:6A62                      
    2061.  01:6A62  DD 7E 0D            	ld	a,(ix+TRACK_cmd_B)
    2062.  01:6A65                      ;	inc	a
    2063.  01:6A65                      ;	add	a
    2064.  01:6A65  4F                  	ld	c,a
    2065.  01:6A66  06 00               	ld	b,0
    2066.  01:6A68  ED B0               	ldir
    2067.  01:6A6A                      	
    2068.  01:6A6A  EB                  	EX	DE,HL
    2069.  01:6A6B                      
    2070.  01:6A6B                      	
    2071.  01:6A6B  D6 20               	sub	32
    2072.  01:6A6D  ED 44               	neg	
    2073.  01:6A6F  47                  	ld	b,a
    2074.  01:6A70  08                  	EX	AF,AF'		;'
    2075.  01:6A71  57                  	LD	D,A
    2076.  01:6A72  CA 75 67            	jp	z,_pcAY_commandEND	
    2077.  01:6A75                      	
    2078.  01:6A75  AF                  	xor	a
    2079.  01:6A76                      _wsc_l:
    2080.  01:6A76  77                  	ld	(HL),a
    2081.  01:6A77  23                  	inc	HL
    2082.  01:6A78  10 FC               	djnz	_wsc_l
    2083.  01:6A7A                      	
    2084.  01:6A7A  C3 75 67            	jp	_pcAY_commandEND
    2085.  01:6A7D                      		
    2086.  01:6A7D                      	
    2087.  01:6A7D                      	
    2088.  01:6A7D                      _pcAY_cmde_wave_compr:
    2089.  01:6A7D                      	;=================
    2090.  01:6A7D                      	; Waveform Compress
    2091.  01:6A7D                      	;=================
    2092.  01:6A7D  CB 9A               	res	B_TRGCMD,d	;(ix+TRACK_Flags)	; reset command
    2093.  01:6A7F  CB F2               	set	B_TRGWAV,d	;(ix+TRACK_Flags)	; reset normal wave update
    2094.  01:6A81  7A                  	ld	a,d
    2095.  01:6A82  08                  	ex	af,af'	;'
    2096.  01:6A83                      	
    2097.  01:6A83                      	;get the waveform	start	in [DE]
    2098.  01:6A83  11 AE 02            	ld	de,_0x9800
    2099.  01:6A86  FD 7C               	ld	a,iyh		;ixh contains chan#
    2100.  01:6A88  0F                  	rrca			; a mac value is 4 so
    2101.  01:6A89  0F                  	rrca			; 3 times rrca is	X32
    2102.  01:6A8A  0F                  	rrca			; max	result is 128.
    2103.  01:6A8B  83                  	add	a,e
    2104.  01:6A8C  5F                  	ld	e,a
    2105.  01:6A8D  D2 91 6A            	jp	nc,.skip
    2106.  01:6A90  14                  	inc	d
    2107.  01:6A91                      .skip:
    2108.  01:6A91  DD 7E F8            	ld	a,(ix+TRACK_Waveform)
    2109.  01:6A94  3C                  	inc	a
    2110.  01:6A95  DD 77 F8            	ld	(ix+TRACK_Waveform),a
    2111.  01:6A98  3D                  	dec	a
    2112.  01:6A99                      
    2113.  01:6A99                      ;	add	a,a
    2114.  01:6A99                      ;	add	a,a
    2115.  01:6A99                      ;	add	a,a	
    2116.  01:6A99                      
    2117.  01:6A99  6F                  	ld	l,a
    2118.  01:6A9A  26 00               	ld	h,0
    2119.  01:6A9C  29                  	add	hl,hl
    2120.  01:6A9D  29                  	add	hl,hl
    2121.  01:6A9E                      		
    2122.  01:6A9E  ED 4B 07 01         	ld	  bc,(replay_wavebase)
    2123.  01:6AA2  09                  	add	  hl,bc
    2124.  01:6AA3                      
    2125.  01:6AA3  DD 7E 0D            	ld	a,(ix+TRACK_cmd_B)
    2126.  01:6AA6  01 40 00            	ld	bc,0x0040
    2127.  01:6AA9  0F                  	rrca	; x32
    2128.  01:6AAA  0F                  	rrca
    2129.  01:6AAB  0F                  	rrca
    2130.  01:6AAC  C6 1F               	add	31
    2131.  01:6AAE  FD 6F               	ld	iyl,a		; fraction
    2132.  01:6AB0  AF                  	xor	a	
    2133.  01:6AB1                      _wcomp_loop:
    2134.  01:6AB1  ED A0               	ldi			
    2135.  01:6AB3  0D                  	dec	c
    2136.  01:6AB4  CA C3 6A            	jp	z,.skip
    2137.  01:6AB7  FD 85               	add	iyl
    2138.  01:6AB9  D2 B1 6A            	jp	nc,_wcomp_loop
    2139.  01:6ABC  23                  	inc	hl
    2140.  01:6ABD  04                  	inc	b
    2141.  01:6ABE  0D                  	dec	c
    2142.  01:6ABF  0D                  	dec	c
    2143.  01:6AC0  C2 B1 6A            	jp	nz,_wcomp_loop
    2144.  01:6AC3                      	
    2145.  01:6AC3                      	;--- remaining data
    2146.  01:6AC3                      .skip:
    2147.  01:6AC3  2B                  	dec	hl
    2148.  01:6AC4  7E                  	ld	a,(hl)
    2149.  01:6AC5                      .loop:
    2150.  01:6AC5  12                  	ld	(de),a
    2151.  01:6AC6  13                  	inc	de
    2152.  01:6AC7  10 FC               	djnz	.loop
    2153.  01:6AC9                      	
    2154.  01:6AC9  08                  	EX	AF,AF'		;'
    2155.  01:6ACA  57                  	LD	D,A	
    2156.  01:6ACB  C3 75 67            	jp	_pcAY_commandEND		
    2157.  01:6ACE                      	
    2158.  01:6ACE                      
    2159.  01:6ACE                      _pcAY_cmd13_short_arp:
    2160.  01:6ACE  DD 35 0F            	dec	(ix+TRACK_Timer)
    2161.  01:6AD1  CB 42               	bit	B_TRGNOT,d		;(ix+TRACK_Timer)
    2162.  01:6AD3  CA 75 67            	jp	z,_pcAY_commandEND
    2163.  01:6AD6  DD 7E 0E            	ld	a,(ix+TRACK_cmd_E)
    2164.  01:6AD9  DD 77 0B            	ld	(ix+TRACK_cmd_NoteAdd),a		
    2165.  01:6ADC  C3 75 67            	jp	_pcAY_commandEND
    2166.  01:6ADF                      
    2167.  01:6ADF                      _pcAY_cmd14_fine_up:
    2168.  01:6ADF  DD 35 0F            	dec	(ix+TRACK_Timer)
    2169.  01:6AE2  C2 75 67            	jp	nz,_pcAY_commandEND
    2170.  01:6AE5                      
    2171.  01:6AE5  CB 9A               	res	B_TRGCMD,d			;(ix+TRACK_Flags)
    2172.  01:6AE7  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    2173.  01:6AEA  DD 86 0E            	add	(ix+TRACK_cmd_E)
    2174.  01:6AED  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    2175.  01:6AF0  D2 75 67            	jp	nc,_pcAY_commandEND	
    2176.  01:6AF3  DD 34 01            	inc	(ix+TRACK_cmd_ToneSlideAdd+1)
    2177.  01:6AF6  C3 75 67            	jp	_pcAY_commandEND	
    2178.  01:6AF9                      
    2179.  01:6AF9                      _pcAY_cmd15_fine_down:
    2180.  01:6AF9  DD 35 0F            	dec	(ix+TRACK_Timer)
    2181.  01:6AFC  C2 75 67            	jp	nz,_pcAY_commandEND
    2182.  01:6AFF                      
    2183.  01:6AFF  CB 9A               	res	B_TRGCMD,d		;(ix+TRACK_Flags)
    2184.  01:6B01  DD 7E 00            	ld	a,(ix+TRACK_cmd_ToneSlideAdd)
    2185.  01:6B04  DD 96 0E            	sub	(ix+TRACK_cmd_E)
    2186.  01:6B07  DD 77 00            	ld	(ix+TRACK_cmd_ToneSlideAdd),a
    2187.  01:6B0A  D2 75 67            	jp	nc,_pcAY_commandEND	
    2188.  01:6B0D  DD 35 01            	dec	(ix+TRACK_cmd_ToneSlideAdd+1)
    2189.  01:6B10  C3 75 67            	jp	_pcAY_commandEND	
    2190.  01:6B13                      
    2191.  01:6B13                      
    2192.  01:6B13                      _pcAY_cmdXX_note_cut:
    2193.  01:6B13  DD 35 0F            	dec	(ix+TRACK_Timer)
    2194.  01:6B16  C2 75 67            	jp	nz,_pcAY_commandEND
    2195.  01:6B19                      	
    2196.  01:6B19                      	; stop note
    2197.  01:6B19  CB 9A               	res	B_TRGCMD,d	; set	note bit to	0
    2198.  01:6B1B  CB 82               	res	B_TRGNOT,d
    2199.  01:6B1D  C3 75 67            	jp	_pcAY_commandEND		
    2200.  01:6B20                      	
    2201.  01:6B20                      _pcAY_cmd19_note_delay:
    2202.  01:6B20                      	; note delay
    2203.  01:6B20  DD 35 0F            	dec	(ix+TRACK_Timer)
    2204.  01:6B23  C2 75 67            	jp	nz,_pcAY_commandEND	; no delay yet
    2205.  01:6B26                      
    2206.  01:6B26                      	; trigger note
    2207.  01:6B26  DD 7E 0E            	ld	a,(ix+TRACK_cmd_E)		
    2208.  01:6B29  DD 77 F6            	ld	(ix+TRACK_Note),a		; set	the note val
    2209.  01:6B2C  CB C2               	set	B_TRGNOT,d	;(ix+TRACK_Flags)		; set	trigger note flag
    2210.  01:6B2E  CB 9A               	res	B_TRGCMD,d	;(ix+TRACK_Flags)		; reset tiggger cmd flag
    2211.  01:6B30                      	
    2212.  01:6B30  C3 75 67            	jp	_pcAY_commandEND	
    2213.  01:6B33                      
    2214.  01:6B33                      
    2215.  01:6B33                      
    2216.  01:6B33                      ;===========================================================
    2217.  01:6B33                      ; ---replay_route
    2218.  01:6B33                      ; Output the data	to the CHIP	registers
    2219.  01:6B33                      ; 
    2220.  01:6B33                      ; 
    2221.  01:6B33                      ;===========================================================
    2222.  01:6B33                      replay_route:
    2223.  01:6B33                      ;---------------
    2224.  01:6B33                      ; P S	G 
    2225.  01:6B33                      ;---------------
    2226.  01:6B33                      	;--- Push values to AY HW
    2227.  01:6B33  06 00               	ld	b,0
    2228.  01:6B35  0E A0               	ld	c,0xa0
    2229.  01:6B37  21 A0 02            	ld	hl,AY_registers
    2230.  01:6B3A                      _comp_loop:	
    2231.  01:6B3A  ED 41               	out	(c),b
    2232.  01:6B3C  7E                  	ld	a,(hl)
    2233.  01:6B3D  C6 01               	add	1
    2234.  01:6B3F  D3 A1               	out	(0xa1),a
    2235.  01:6B41  23                  	inc	hl
    2236.  01:6B42  7E                  	ld	a,(hl)
    2237.  01:6B43  CE 00               	adc	a,0
    2238.  01:6B45  04                  	inc	b
    2239.  01:6B46  ED 41               	out	(c),b	
    2240.  01:6B48  23                  	inc	hl
    2241.  01:6B49  D3 A1               	out	(0xa1),a	
    2242.  01:6B4B  04                  	inc	b
    2243.  01:6B4C  3E 06               	ld	a,6
    2244.  01:6B4E  B8                  	cp	b
    2245.  01:6B4F  C2 3A 6B            	jp	nz,_comp_loop
    2246.  01:6B52                      	
    2247.  01:6B52  78                  	ld	a,b	
    2248.  01:6B53                      	
    2249.  01:6B53                      	
    2250.  01:6B53                      _ptAY_loop:
    2251.  01:6B53  ED 79               	out	(c),a
    2252.  01:6B55  0C                  	inc	c
    2253.  01:6B56  ED A3               	outi
    2254.  01:6B58  0D                  	dec	c
    2255.  01:6B59  3C                  	inc	a
    2256.  01:6B5A  FE 0D               	cp	13
    2257.  01:6B5C  20 F5               	jr	nz,_ptAY_loop
    2258.  01:6B5E                      
    2259.  01:6B5E  47                  	ld	b,a
    2260.  01:6B5F  7E                  	ld	a,(hl)
    2261.  01:6B60  A7                  	and	a
    2262.  01:6B61  CA 6B 6B            	jp	z,_ptAY_noEnv
    2263.  01:6B64  ED 41               	out	(c),b
    2264.  01:6B66  0C                  	inc	c
    2265.  01:6B67  ED 79               	out 	(c),a
    2266.  01:6B69  36 00               	ld	(hl),0	;reset the envwrite
    2267.  01:6B6B                      	
    2268.  01:6B6B                      	
    2269.  01:6B6B                      _ptAY_noEnv:
    2270.  01:6B6B                      ;--------------
    2271.  01:6B6B                      ; S C	C 
    2272.  01:6B6B                      ;--------------
    2273.  01:6B6B  3E 3F               	ld  a,03Fh				; enable SCC
    2274.  01:6B6D  32 00 90            	ld  (0x9000),a
    2275.  01:6B70                      
    2276.  01:6B70                      	
    2277.  01:6B70                      	;--- This for the ttsfxplayer!!!
    2278.  01:6B70                      ;	ld	a,(sfx_SCC_WAVE)
    2279.  01:6B70                      ;	cp	255
    2280.  01:6B70                      ;	jp	z,.nosfx		; if a == 255 there is no waveform
    2281.  01:6B70                      ;
    2282.  01:6B70                      ;	ld	de,0x9800
    2283.  01:6B70                      ;	call	_write_SFX_wave	
    2284.  01:6B70                      ;	jp	.skip	
    2285.  01:6B70                      	
    2286.  01:6B70                      .nosfx:	
    2287.  01:6B70                      	;--- Set the waveforms
    2288.  01:6B70  21 DC 01            	ld	hl,TRACK_Chan4+17+TRACK_Flags
    2289.  01:6B73  CB 76               	bit	B_TRGWAV,(hl)
    2290.  01:6B75  CA 83 6B            	jp	z,.skip
    2291.  01:6B78                      	;--- set wave form
    2292.  01:6B78  CB B6               	res	B_TRGWAV,(hl)
    2293.  01:6B7A  3A DB 01            	ld	a,(TRACK_Chan4+17+TRACK_Waveform)
    2294.  01:6B7D  11 00 98            	ld	de,0x9800
    2295.  01:6B80  CD DB 6B            	call	_write_SCC_wave
    2296.  01:6B83                      .skip:
    2297.  01:6B83  21 02 02            	ld	hl,TRACK_Chan5+17+TRACK_Flags
    2298.  01:6B86  CB 76               	bit	B_TRGWAV,(hl)
    2299.  01:6B88  CA 96 6B            	jp	z,.skip2
    2300.  01:6B8B                      	;--- set wave form
    2301.  01:6B8B  CB B6               	res	B_TRGWAV,(hl)
    2302.  01:6B8D  3A 01 02            	ld	a,(TRACK_Chan5+17+TRACK_Waveform)
    2303.  01:6B90  11 20 98            	ld	de,0x9820
    2304.  01:6B93  CD DB 6B            	call	_write_SCC_wave
    2305.  01:6B96                      .skip2:
    2306.  01:6B96  21 28 02            	ld	hl,TRACK_Chan6+17+TRACK_Flags
    2307.  01:6B99  CB 76               	bit	B_TRGWAV,(hl)
    2308.  01:6B9B  CA A9 6B            	jp	z,.skip3
    2309.  01:6B9E                      	;--- set wave form
    2310.  01:6B9E  CB B6               	res	B_TRGWAV,(hl)
    2311.  01:6BA0  3A 27 02            	ld	a,(TRACK_Chan6+17+TRACK_Waveform)
    2312.  01:6BA3  11 40 98            	ld	de,0x9840
    2313.  01:6BA6  CD DB 6B            	call	_write_SCC_wave
    2314.  01:6BA9                      .skip3:
    2315.  01:6BA9  21 4E 02            	ld	hl,TRACK_Chan7+17+TRACK_Flags
    2316.  01:6BAC  CB 76               	bit	B_TRGWAV,(hl)
    2317.  01:6BAE  CA BC 6B            	jp	z,.skip4
    2318.  01:6BB1                      	;--- set wave form
    2319.  01:6BB1  CB B6               	res	B_TRGWAV,(hl)
    2320.  01:6BB3  3A 4D 02            	ld	a,(TRACK_Chan7+17+TRACK_Waveform)
    2321.  01:6BB6  11 60 98            	ld	de,0x9860
    2322.  01:6BB9  CD DB 6B            	call	_write_SCC_wave
    2323.  01:6BBC                      .skip4:
    2324.  01:6BBC                      
    2325.  01:6BBC                      scc_reg_update:
    2326.  01:6BBC                      
    2327.  01:6BBC  3E 3F               	ld  a,03Fh				; enable SCC
    2328.  01:6BBE  32 00 90            	ld  (0x9000),a
    2329.  01:6BC1                      
    2330.  01:6BC1                      	;--- Update changed SCC registers.
    2331.  01:6BC1  21 3E 03            	ld hl,oldregs
    2332.  01:6BC4  11 2E 03            	ld de,SCC_registers
    2333.  01:6BC7  01 80 98            	ld bc,0x9880
    2334.  01:6BCA  3E 10               	ld a,3*5+1
    2335.  01:6BCC                      loop:
    2336.  01:6BCC  08                  	ex af,af'	;'
    2337.  01:6BCD  1A                  	ld a,(de)
    2338.  01:6BCE  BE                  	cp (hl)
    2339.  01:6BCF  28 02               	jr z,.skip
    2340.  01:6BD1  77                  	ld (hl),a	     ; update old	registers in ram
    2341.  01:6BD2  02                  	ld (bc),a	     ; update scc	registers
    2342.  01:6BD3                      .skip:	    
    2343.  01:6BD3  23                  	inc hl
    2344.  01:6BD4  13                  	inc de
    2345.  01:6BD5  03                  	inc bc
    2346.  01:6BD6  08                  	ex af,af'		;'
    2347.  01:6BD7  3D                  	dec a
    2348.  01:6BD8  20 F2               	jr nz, loop
    2349.  01:6BDA  C9                  	ret
    2350.  01:6BDB                      
    2351.  01:6BDB                      	
    2352.  01:6BDB                      	
    2353.  01:6BDB                      ;==================
    2354.  01:6BDB                      ; _write_SCC_wave
    2355.  01:6BDB                      ;
    2356.  01:6BDB                      ; Writes waveform	data.	[DE] contains location for data
    2357.  01:6BDB                      ; [A]	contains waveform	number + flags for special actions
    2358.  01:6BDB                      ; Data is not written to SCC but into RAM	shadow registers.
    2359.  01:6BDB                      ;==================
    2360.  01:6BDB                      _write_SCC_wave:
    2361.  01:6BDB  CB 66               	bit	B_ACTMOR,(hl)
    2362.  01:6BDD  C2 09 6C            	jp	nz,_write_SCC_special
    2363.  01:6BE0                      	
    2364.  01:6BE0  CB 47               	bit	0,a
    2365.  01:6BE2  C2 F5 6B            	jp	nz,.ramwave
    2366.  01:6BE5                      ;	add	a,a
    2367.  01:6BE5                      ;	add	a,a
    2368.  01:6BE5                      ;	add	a,a
    2369.  01:6BE5                      
    2370.  01:6BE5                      .normalwave:
    2371.  01:6BE5  6F                  	ld	l,a
    2372.  01:6BE6  26 00               	ld	h,0
    2373.  01:6BE8  29                  	add	hl,hl
    2374.  01:6BE9  29                  	add	hl,hl
    2375.  01:6BEA                      		
    2376.  01:6BEA  ED 4B 07 01         	ld	  bc,(replay_wavebase)
    2377.  01:6BEE  09                  	add	  hl,bc
    2378.  01:6BEF  01 20 00            	ld	  bc,32
    2379.  01:6BF2  ED B0               	ldir
    2380.  01:6BF4  C9                  	ret
    2381.  01:6BF5                      	
    2382.  01:6BF5                      	
    2383.  01:6BF5                      .ramwave:
    2384.  01:6BF5  2B                  	dec	hl		; reset the special flag in the wave form number
    2385.  01:6BF6  E6 FE               	and	$fe
    2386.  01:6BF8  77                  	ld	(hl),a
    2387.  01:6BF9                      
    2388.  01:6BF9  21 AE 02            	ld	hl,_0x9800
    2389.  01:6BFC  7B                  	ld	a,e
    2390.  01:6BFD  85                  	add	a,l
    2391.  01:6BFE  6F                  	ld	l,a
    2392.  01:6BFF  D2 03 6C            	jp	nc,.skip
    2393.  01:6C02  24                  	inc	h
    2394.  01:6C03                      .skip:
    2395.  01:6C03  01 20 00            	ld	  bc,32
    2396.  01:6C06  ED B0               	ldir
    2397.  01:6C08  C9                  	ret	
    2398.  01:6C09                      	
    2399.  01:6C09                      	
    2400.  01:6C09                      	
    2401.  01:6C09                      
    2402.  01:6C09                      
    2403.  01:6C09                      _write_SCC_special:
    2404.  01:6C09  21 20 01            	ld	hl,replay_morph_buffer+1
    2405.  01:6C0C  06 20               	ld	b,32
    2406.  01:6C0E                      _wss_l:
    2407.  01:6C0E  7E                  	ld	a,(hl)
    2408.  01:6C0F  12                  	ld	(de),a
    2409.  01:6C10  23                  	inc	hl
    2410.  01:6C11  23                  	inc	hl
    2411.  01:6C12  13                  	inc	de
    2412.  01:6C13  10 F9               	djnz	_wss_l
    2413.  01:6C15                      	 
    2414.  01:6C15                      	
    2415.  01:6C15  C9                  	ret
    2416.  01:6C16                      
    2417.  01:6C16                      	
    2418.  01:6C16                      ;=============
    2419.  01:6C16                      ; in [A] the morph active status	
    2420.  01:6C16                      replay_process_morph:
    2421.  01:6C16  21 1C 01            	ld	hl,replay_morph_timer
    2422.  01:6C19  35                  	dec	(hl)
    2423.  01:6C1A  C0                  	ret	nz
    2424.  01:6C1B                      	
    2425.  01:6C1B                      	;---- not sure what to do with this.
    2426.  01:6C1B                      	; trigger any waveform updates
    2427.  01:6C1B  06 04               	ld	b,4
    2428.  01:6C1D  11 26 00            	ld	de,TRACK_REC_SIZE
    2429.  01:6C20  21 DC 01            	ld	hl,TRACK_Chan4+17+TRACK_Flags
    2430.  01:6C23                      .loop:	
    2431.  01:6C23  CB 66               	bit 	B_ACTMOR,(hl)
    2432.  01:6C25  CA 2A 6C            	jp	z,.skip
    2433.  01:6C28  CB F6               	set	B_TRGWAV,(hl)
    2434.  01:6C2A                      .skip:
    2435.  01:6C2A  19                  	add	hl,de
    2436.  01:6C2B  10 F6               	djnz	.loop	
    2437.  01:6C2D                      	
    2438.  01:6C2D                      	
    2439.  01:6C2D                      	;---- timer ended.
    2440.  01:6C2D  3C                  	inc	a
    2441.  01:6C2E  C2 7C 6C            	jp	nz,_rpm_next_step		; if status was !=255 then skip init
    2442.  01:6C31                      
    2443.  01:6C31                      	;---- calculate offset
    2444.  01:6C31  3C                  	inc	a		
    2445.  01:6C32  32 1B 01            	ld	(replay_morph_active),a		; set status to 1
    2446.  01:6C35                      ;	ld	(replay_morph_update),a		; after this update the waveforms of the SCC
    2447.  01:6C35                      
    2448.  01:6C35  3A 1D 01            	ld	a,(replay_morph_speed)
    2449.  01:6C38  32 1C 01            	ld	(replay_morph_timer),a
    2450.  01:6C3B                      	
    2451.  01:6C3B                      
    2452.  01:6C3B                      	;--- calculate the delta's
    2453.  01:6C3B  11 1F 01            	ld	de,replay_morph_buffer
    2454.  01:6C3E  2A 07 01            	ld	hl,(replay_wavebase)
    2455.  01:6C41  3A 5F 01            	ld	a,(replay_morph_waveform)
    2456.  01:6C44  87                  	add	a
    2457.  01:6C45  D2 49 6C            	jp	nc,.skip2
    2458.  01:6C48  24                  	inc	h
    2459.  01:6C49                      .skip2:
    2460.  01:6C49  85                  	add	a,l
    2461.  01:6C4A  6F                  	ld	l,a
    2462.  01:6C4B  D2 4F 6C            	jp	nc,.skip3
    2463.  01:6C4E  24                  	inc	h
    2464.  01:6C4F                      .skip3:	
    2465.  01:6C4F                      	;---- start calculating
    2466.  01:6C4F  06 20               	ld	b,32		; 32 values
    2467.  01:6C51                      _rpm_loop:	
    2468.  01:6C51  13                  	inc	de
    2469.  01:6C52  1A                  	ld	a,(de)
    2470.  01:6C53  1B                  	dec	de
    2471.  01:6C54  C6 80               	add	a,128
    2472.  01:6C56  4F                  	ld	c,a
    2473.  01:6C57  7E                  	ld	a,(hl)
    2474.  01:6C58  C6 80               	add	a,128
    2475.  01:6C5A  B9                  	cp	c
    2476.  01:6C5B  DA 6C 6C            	jp	c,_rpm_smaller		; dest is smaller
    2477.  01:6C5E                      
    2478.  01:6C5E                      	
    2479.  01:6C5E                      _rpm_larger:
    2480.  01:6C5E  91                  	sub	c
    2481.  01:6C5F  0F                  	rrca
    2482.  01:6C60  0F                  	rrca
    2483.  01:6C61  0F                  	rrca
    2484.  01:6C62  0F                  	rrca
    2485.  01:6C63  E6 EF               	and	$ef		; reset bit 5
    2486.  01:6C65  12                  	ld	(de),a
    2487.  01:6C66                      	
    2488.  01:6C66  13                  	inc	de
    2489.  01:6C67  13                  	inc	de
    2490.  01:6C68  23                  	inc	hl
    2491.  01:6C69  10 E6               	djnz	_rpm_loop
    2492.  01:6C6B  C9                  	ret	
    2493.  01:6C6C                      	
    2494.  01:6C6C                      _rpm_smaller:
    2495.  01:6C6C  91                  	sub	c
    2496.  01:6C6D  ED 44               	neg	
    2497.  01:6C6F  0F                  	rrca
    2498.  01:6C70  0F                  	rrca
    2499.  01:6C71  0F                  	rrca
    2500.  01:6C72  0F                  	rrca
    2501.  01:6C73  F6 10               	or	$10		; set bit 5
    2502.  01:6C75  12                  	ld	(de),a
    2503.  01:6C76                      	
    2504.  01:6C76  13                  	inc	de
    2505.  01:6C77  13                  	inc	de
    2506.  01:6C78  23                  	inc	hl
    2507.  01:6C79  10 D6               	djnz	_rpm_loop
    2508.  01:6C7B  C9                  	ret		
    2509.  01:6C7C                      	
    2510.  01:6C7C                      ;============================
    2511.  01:6C7C                      _rpm_next_step:
    2512.  01:6C7C  3A 1D 01            	ld	a,(replay_morph_speed)
    2513.  01:6C7F  32 1C 01            	ld	(replay_morph_timer),a
    2514.  01:6C82                      
    2515.  01:6C82                      	;-- apply the delta's
    2516.  01:6C82  3A 1E 01            	ld	a,(replay_morph_counter)
    2517.  01:6C85  4F                  	ld	c,a
    2518.  01:6C86  C6 10               	add	16
    2519.  01:6C88  32 1E 01            	ld	(replay_morph_counter),a
    2520.  01:6C8B  C2 91 6C            	jp	nz,.skip
    2521.  01:6C8E                      	;--- end morph
    2522.  01:6C8E  32 1B 01            	ld	(replay_morph_active),a
    2523.  01:6C91                      
    2524.  01:6C91                      .skip:
    2525.  01:6C91  0D                  	dec c
    2526.  01:6C92  21 1F 01            	ld	hl,replay_morph_buffer
    2527.  01:6C95  06 20               	ld	b,32
    2528.  01:6C97                      _rpm_ns_loop:	
    2529.  01:6C97  7E                  	ld	a,(hl)
    2530.  01:6C98  CB 67               	bit 	4,a
    2531.  01:6C9A  CA AF 6C            	jp	z,_rmp_ns_add
    2532.  01:6C9D                      _rmp_ns_sub:
    2533.  01:6C9D                      	;--- handle corection
    2534.  01:6C9D  E6 EF               	and	$ef
    2535.  01:6C9F  B9                  	cp	c		; correction < counteR?
    2536.  01:6CA0  DA A4 6C            	jp	c,.skip
    2537.  01:6CA3  3C                  	inc	a		; if smaller C was set
    2538.  01:6CA4                      .skip:
    2539.  01:6CA4  E6 1F               	and	00011111b	; keep lower 5 bits
    2540.  01:6CA6  23                  	inc	hl
    2541.  01:6CA7  57                  	ld	d,a
    2542.  01:6CA8  7E                  	ld	a,(hl)
    2543.  01:6CA9  92                  	sub	d
    2544.  01:6CAA  77                  	ld	(hl),a	; load new value
    2545.  01:6CAB  23                  	inc	hl
    2546.  01:6CAC  10 E9               	djnz	_rpm_ns_loop
    2547.  01:6CAE  C9                  	ret	
    2548.  01:6CAF                      _rmp_ns_add:
    2549.  01:6CAF                      	;--- handle corection
    2550.  01:6CAF  B9                  	cp	c		; correction < counter?
    2551.  01:6CB0  DA B4 6C            	jp	c,.skip
    2552.  01:6CB3  3C                  	inc	a		; if smaller C was set
    2553.  01:6CB4                      .skip:
    2554.  01:6CB4  E6 1F               	and	00011111b	; keep lower 5 bits
    2555.  01:6CB6  23                  	inc	hl
    2556.  01:6CB7  86                  	add	(hl)		; subtract waveform value
    2557.  01:6CB8  77                  	ld	(hl),a	; load new value
    2558.  01:6CB9  23                  	inc	hl
    2559.  01:6CBA  10 DB               	djnz	_rpm_ns_loop
    2560.  01:6CBC  C9                  	ret		
    2561.  01:6CBD                      	
    2562.  01:6CBD                      
    2563.  01:6CBD                      
     351   01:6CBD                      		include	"ms_crtl.asm"
       1.  01:6CBD                      	
       2.  01:6CBD  (01:0000)           ms_fly__right				equ	0
       3.  01:6CBD  (01:0001)           ms_spin_face_right			equ	1
       4.  01:6CBD  (01:0002)           ms_side_dwn_face_right		equ	2
       5.  01:6CBD  (01:0003)           ms_side_up__face_right		equ	3
       6.  01:6CBD                      
       7.  01:6CBD  (01:0004)           ms_fly__left				equ	4
       8.  01:6CBD  (01:0005)           ms_spin_face_left			equ	5
       9.  01:6CBD  (01:0006)           ms_side_dwn_face_left		equ	6
      10.  01:6CBD  (01:0007)           ms_side_up__face_left		equ	7
      11.  01:6CBD                      
      12.  01:6CBD  (01:0008)           ms_loop_right2left			equ	8
      13.  01:6CBD  (01:0009)           ms_loop_left2right			equ	9
      14.  01:6CBD                      
      15.  01:6CBD  (01:000A)           ms_explode					equ	10
      16.  01:6CBD  (01:000B)           ms_landing					equ	11
      17.  01:6CBD  (01:000C)           ms_reset					equ	12
      18.  01:6CBD                      
      19.  01:6CBD                      ;%%%%%%%%%%%%%%%%%%%%%%
      20.  01:6CBD                      ms_ctrl:
      21.  01:6CBD  3A 04 CB            		ld	a,(_mcdivider)
      22.  01:6CC0  3C                  		inc	a
      23.  01:6CC1  32 04 CB            		ld	(_mcdivider),a
      24.  01:6CC4  E6 01               		and	1
      25.  01:6CC6  C0                  		ret	nz
      26.  01:6CC7  3A 4C CB            		ld	a,(ms_state)
      27.  01:6CCA  FE 09               		cp	ms_explode-1		; ms cannot move while exploding landing or at level reset
      28.  01:6CCC  DC 1A 6D            		call	c,.ms_directions
      29.  01:6CCF                      
      30.  01:6CCF                      .intro:
      31.  01:6CCF  3A 4C CB            		ld	a,(ms_state)
      32.  01:6CD2  FE 00               		cp	ms_fly__right
      33.  01:6CD4  CA 0C 6E            		jp	z,.ms_fly__right
      34.  01:6CD7                      	
      35.  01:6CD7  FE 08               		cp	ms_loop_right2left
      36.  01:6CD9  CA 5B 6E            		jp	z,.ms_loop_right2left
      37.  01:6CDC                      		
      38.  01:6CDC  FE 05               		cp	ms_spin_face_left
      39.  01:6CDE  CA 71 6E            		jp	z,.ms_spin_face_left
      40.  01:6CE1                      		
      41.  01:6CE1  FE 04               		cp	ms_fly__left
      42.  01:6CE3  CA 87 6E            		jp	z,.ms_fly__left
      43.  01:6CE6                      		
      44.  01:6CE6  FE 09               		cp	ms_loop_left2right
      45.  01:6CE8  CA D9 6E            		jp	z,.ms_loop_left2right
      46.  01:6CEB                      
      47.  01:6CEB  FE 01               		cp	ms_spin_face_right
      48.  01:6CED  CA EF 6E            		jp	z,.ms_spin_face_right
      49.  01:6CF0                      		
      50.  01:6CF0  FE 02               		cp	ms_side_dwn_face_right
      51.  01:6CF2  CA 05 6F            		jp	z,.ms_side_dwn_face_right
      52.  01:6CF5                      
      53.  01:6CF5  FE 03               		cp	ms_side_up__face_right
      54.  01:6CF7  CA 3C 6F            		jp	z,.ms_side_up__face_right
      55.  01:6CFA                      		
      56.  01:6CFA  FE 06               		cp	ms_side_dwn_face_left
      57.  01:6CFC  CA 73 6F            		jp	z,.ms_side_dwn_face_left
      58.  01:6CFF                      
      59.  01:6CFF  FE 07               		cp	ms_side_up__face_left
      60.  01:6D01  CA AB 6F            		jp	z,.ms_side_up__face_left
      61.  01:6D04                      
      62.  01:6D04  FE 0A               		cp	ms_explode
      63.  01:6D06  CA E3 6F            		jp	z,.ms_explode
      64.  01:6D09                      		
      65.  01:6D09  FE 0B               		cp	ms_landing
      66.  01:6D0B  CA 19 6D            		jp	z,.ms_landing
      67.  01:6D0E                      
      68.  01:6D0E  FE 0C               		cp	ms_reset
      69.  01:6D10  CA 19 6D            		jp	z,.ms_reset
      70.  01:6D13                      	
      71.  01:6D13                      ;	abnormal end
      72.  01:6D13  3E 00               		ld	a,ms_fly__right
      73.  01:6D15  32 4C CB            		ld	(ms_state),a
      74.  01:6D18  C9                  		ret
      75.  01:6D19                      	
      76.  01:6D19                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      77.  01:6D19                      ;	FAKE FOR TEST
      78.  01:6D19                      .ms_landing	
      79.  01:6D19                      .ms_reset 
      80.  01:6D19  C9                  	ret
      81.  01:6D1A                      	
      82.  01:6D1A                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      83.  01:6D1A                          ;	control X and Y 
      84.  01:6D1A                      
      85.  01:6D1A                      .ms_directions:
      86.  01:6D1A                          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      87.  01:6D1A                      	; read joystick and keyboard
      88.  01:6D1A  CD 8A 6D            		call	.rd_joy
      89.  01:6D1D                          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      90.  01:6D1D                          ; x speed control of the screen and of the main ship
      91.  01:6D1D  CD 06 6E            		call    .right
      92.  01:6D20  CC 50 6D            		call	z,.test_move_right
      93.  01:6D23                      
      94.  01:6D23  CD 00 6E            		call    .left
      95.  01:6D26  CC 63 6D            		call	z,.test_move_left
      96.  01:6D29                      
      97.  01:6D29                          ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
      98.  01:6D29                          ; y control of the main ship
      99.  01:6D29                      
     100.  01:6D29  CD EE 6D            		call    .up
     101.  01:6D2C  20 0D               		jr  nz,1f
     102.  01:6D2E  CD 81 6D            		call	._up
     103.  01:6D31  3A 48 CB            		ld  a,(yship)
     104.  01:6D34  D6 04               		sub	a,4
     105.  01:6D36  38 03               		jr  c,1f
     106.  01:6D38  32 48 CB            		ld  (yship),a
     107.  01:6D3B                      1:
     108.  01:6D3B  CD FA 6D            		call    .dwn
     109.  01:6D3E  20 0F               		jr  nz,1f
     110.  01:6D40  CD 76 6D            		call	._dw
     111.  01:6D43  3A 48 CB            		ld  a,(yship)
     112.  01:6D46  C6 04               		add	a,4
     113.  01:6D48  FE A1               		cp  mapHeight*16-16+1
     114.  01:6D4A  30 03               		jr  nc,1f
     115.  01:6D4C  32 48 CB            		ld  (yship),a
     116.  01:6D4F                      1:
     117.  01:6D4F  C9                  		ret
     118.  01:6D50                      
     119.  01:6D50                      ;-------------------------------------
     120.  01:6D50                      .test_move_right:
     121.  01:6D50  3A 43 CB            		ld		a,(dxmap)
     122.  01:6D53  3C                  		inc		a
     123.  01:6D54  CA 5E 6D            		jp      z,1f
     124.  01:6D57  FE 05               		cp 		maxspeed+1
     125.  01:6D59  F0                  		ret		p
     126.  01:6D5A  32 43 CB            		ld		(dxmap),a			; moving right
     127.  01:6D5D  C9                  		ret
     128.  01:6D5E  3C                  1:		inc     a
     129.  01:6D5F  32 43 CB            		ld		(dxmap),a			; moving right
     130.  01:6D62  C9                  		ret
     131.  01:6D63                      		
     132.  01:6D63                      .test_move_left
     133.  01:6D63  3A 43 CB            		ld		a,(dxmap)
     134.  01:6D66  3D                  		dec		a
     135.  01:6D67  CA 71 6D            		jp      z,1f
     136.  01:6D6A  FE FC               		cp		-maxspeed
     137.  01:6D6C  F8                  		ret		m
     138.  01:6D6D  32 43 CB            		ld		(dxmap),a			; moving left
     139.  01:6D70  C9                  		ret
     140.  01:6D71  3D                  1:		dec     a
     141.  01:6D72  32 43 CB            		ld		(dxmap),a			; moving left
     142.  01:6D75  C9                  		ret
     143.  01:6D76                      ;-------------------------------------
     144.  01:6D76                      
     145.  01:6D76  3A 36 CB            ._dw:	ld		a,(_yoffset)
     146.  01:6D79  3C                  		inc		a
     147.  01:6D7A  FE 08               		cp		mapHeight*16-YSIZE
     148.  01:6D7C  F0                  		ret 	p
     149.  01:6D7D  32 36 CB            		ld		(_yoffset),a
     150.  01:6D80  C9                  		ret
     151.  01:6D81                      
     152.  01:6D81  3A 36 CB            ._up:	ld		a,(_yoffset)
     153.  01:6D84  3D                  		dec		a
     154.  01:6D85  F8                  		ret		m
     155.  01:6D86  32 36 CB            		ld		(_yoffset),a
     156.  01:6D89  C9                  		ret
     157.  01:6D8A                      
     158.  01:6D8A                      ;-------------------------------------
     159.  01:6D8A                      	
     160.  01:6D8A                      ; PSG I/O port A (r#14)  read-only
     161.  01:6D8A                      ; Bit	Description	Comment
     162.  01:6D8A                      ; 0	Input joystick pin 1	(up)
     163.  01:6D8A                      ; 1	Input joystick pin 2	(down)
     164.  01:6D8A                      ; 2	Input joystick pin 3	(left)
     165.  01:6D8A                      ; 3	Input joystick pin 4	(right)
     166.  01:6D8A                      ; 4	Input joystick pin 6	(trigger A)
     167.  01:6D8A                      ; 5	Input joystick pin 7	(trigger B)
     168.  01:6D8A                      ; 6	Japanese keyboard layout bit	(1=JIS, 0=ANSI)
     169.  01:6D8A                      ; 7	Cassette input signal	
     170.  01:6D8A                      
     171.  01:6D8A                      .rd_joy:
     172.  01:6D8A  3E 0F               	ld	a,#0f
     173.  01:6D8C  D3 A0               	out	(#a0),a
     174.  01:6D8E  3E 8F               	ld	a,0x8F
     175.  01:6D90  D3 A1               	out	(#a1),a		; select port A
     176.  01:6D92  3E 0E               	ld	a,#0e
     177.  01:6D94  D3 A0               	out	(#a0),a
     178.  01:6D96  DB A2               	in	a,(#a2)
     179.  01:6D98                      .rd_key:	
     180.  01:6D98  DD 21 03 CB         	ld	ix,joystick
     181.  01:6D9C  DD 77 00            	ld	(ix),a
     182.  01:6D9F                      	
     183.  01:6D9F  1E 08               	ld  e,8
     184.  01:6DA1  CD 0F 45                call    checkkbd
     185.  01:6DA4  CB 47               	bit	0,a				; space
     186.  01:6DA6  20 04               	jr	nz,1f
     187.  01:6DA8  DD CB 00 A6         	res	4,(ix)			; (trigger A)
     188.  01:6DAC                      1:
     189.  01:6DAC  CB 7F               	bit	7,a				; RIGHT
     190.  01:6DAE  20 04               	jr	nz,1f
     191.  01:6DB0  DD CB 00 9E         	res	3,(ix)			; (right joy)
     192.  01:6DB4                      1:
     193.  01:6DB4  CB 77               	bit	6,a				; DOWN
     194.  01:6DB6  20 04               	jr	nz,1f
     195.  01:6DB8  DD CB 00 8E         	res	1,(ix)			; (down joy)
     196.  01:6DBC                      1:
     197.  01:6DBC  CB 6F               	bit	5,a				; UP
     198.  01:6DBE  20 04               	jr	nz,1f
     199.  01:6DC0  DD CB 00 86         	res	0,(ix)			; (up joy)
     200.  01:6DC4                      1:
     201.  01:6DC4  CB 67               	bit	4,a				; LEFT
     202.  01:6DC6  20 04               	jr	nz,1f
     203.  01:6DC8  DD CB 00 96         	res	2,(ix)			; (left joy)
     204.  01:6DCC                      1:
     205.  01:6DCC  1E 05               	ld  e,5
     206.  01:6DCE  CD 0F 45                call    checkkbd
     207.  01:6DD1  CB 6F               	bit	5,a				; X
     208.  01:6DD3  20 04               	jr	nz,1f
     209.  01:6DD5  DD CB 00 AE         	res	5,(ix)			; (trigger B)
     210.  01:6DD9                      1:
     211.  01:6DD9  CB 7F               	bit	7,a				; Z
     212.  01:6DDB  20 04               	jr	nz,1f
     213.  01:6DDD  DD CB 00 A6         	res	4,(ix)			; (trigger A)
     214.  01:6DE1                      1:
     215.  01:6DE1  C9                  	ret
     216.  01:6DE2                      
     217.  01:6DE2                      	
     218.  01:6DE2                      	
     219.  01:6DE2                      ;    5   |    Z     Y     X     W     V     U     T     S
     220.  01:6DE2                      ;    6   |   F3    F2    F1   CODE   CAP  GRAPH CTRL  SHIFT
     221.  01:6DE2                      ;    7   |   RET   SEL   BS   STOP   TAB   ESC   F5    F4
     222.  01:6DE2                      ;    8   |  RIGHT DOWN   UP   LEFT   DEL   INS  HOME  SPACE
     223.  01:6DE2                      .z_or_space:
     224.  01:6DE2  3A 03 CB            	ld	a,(joystick)
     225.  01:6DE5  E6 10               	and	16
     226.  01:6DE7  C9                  	ret
     227.  01:6DE8                      .x_and_up:
     228.  01:6DE8  3A 03 CB            	ld	a,(joystick)
     229.  01:6DEB  E6 20               	and	32
     230.  01:6DED  C0                  	ret	nz
     231.  01:6DEE                      .up:
     232.  01:6DEE  3A 03 CB            	ld	a,(joystick)
     233.  01:6DF1  E6 01               	and	1
     234.  01:6DF3  C9                  	ret
     235.  01:6DF4                      .x_and_dwn:
     236.  01:6DF4  3A 03 CB            	ld	a,(joystick)
     237.  01:6DF7  E6 20               	and	32
     238.  01:6DF9  C0                  	ret	nz
     239.  01:6DFA                      .dwn:
     240.  01:6DFA  3A 03 CB            	ld	a,(joystick)
     241.  01:6DFD  E6 02               	and	2
     242.  01:6DFF  C9                  	ret
     243.  01:6E00                      .left:
     244.  01:6E00  3A 03 CB            	ld	a,(joystick)
     245.  01:6E03  E6 04               	and	4
     246.  01:6E05  C9                  	ret
     247.  01:6E06                      .right:
     248.  01:6E06  3A 03 CB            	ld	a,(joystick)
     249.  01:6E09  E6 08               	and	8
     250.  01:6E0B  C9                  	ret
     251.  01:6E0C                      
     252.  01:6E0C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     253.  01:6E0C                      .ms_fly__right:		
     254.  01:6E0C  3A 43 CB            	ld  a,(dxmap)
     255.  01:6E0F  CB 7F               	bit	7,a
     256.  01:6E11  28 0A               	jr z,1f
     257.  01:6E13                      	
     258.  01:6E13  AF                  	xor	a
     259.  01:6E14  32 4B CB            	ld  (aniframe),a
     260.  01:6E17  3E 08               	ld	a,ms_loop_right2left
     261.  01:6E19  32 4C CB            	ld	(ms_state),a
     262.  01:6E1C  C9                  	ret
     263.  01:6E1D                      1:
     264.  01:6E1D  3E 20               	ld	a,32
     265.  01:6E1F  32 4B CB            	ld  (aniframe),a
     266.  01:6E22  CD E8 6D            	call	.x_and_up
     267.  01:6E25  C2 33 6E            	jp	nz,1f
     268.  01:6E28  3E 20               	ld	a,32
     269.  01:6E2A  32 4B CB            	ld  (aniframe),a
     270.  01:6E2D  3E 03               	ld	a,ms_side_up__face_right
     271.  01:6E2F  32 4C CB            	ld	(ms_state),a
     272.  01:6E32  C9                  	ret
     273.  01:6E33  CD F4 6D            1:	call	.x_and_dwn
     274.  01:6E36  C2 44 6E            	jp	nz,1f
     275.  01:6E39  3E 28               	ld	a,40
     276.  01:6E3B  32 4B CB            	ld  (aniframe),a
     277.  01:6E3E  3E 02               	ld	a,ms_side_dwn_face_right
     278.  01:6E40  32 4C CB            	ld	(ms_state),a
     279.  01:6E43  C9                  	ret
     280.  01:6E44  CD 00 6E            1:	call	.left
     281.  01:6E47  C2 54 6E            	jp	nz,1f
     282.  01:6E4A  AF                  	xor	a
     283.  01:6E4B  32 4B CB            	ld  (aniframe),a
     284.  01:6E4E  3E 08               	ld	a,ms_loop_right2left
     285.  01:6E50  32 4C CB            	ld	(ms_state),a
     286.  01:6E53  C9                  	ret
     287.  01:6E54  CD E2 6D            1:	call	.z_or_space
     288.  01:6E57  CA 9A 5B            	jp		z,ms_shoot
     289.  01:6E5A  C9                  	ret
     290.  01:6E5B                      	
     291.  01:6E5B                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     292.  01:6E5B                      .ms_loop_right2left:
     293.  01:6E5B  3A 4B CB            	ld	a,(aniframe)
     294.  01:6E5E  3C                  	inc	a
     295.  01:6E5F  32 4B CB            	ld	(aniframe),a
     296.  01:6E62  FE 04               	cp	4
     297.  01:6E64  CA 70 6E            	jp	z,1f
     298.  01:6E67  FE 08               	cp	8
     299.  01:6E69  C0                  	ret	nz
     300.  01:6E6A  3E 05               	ld	a,ms_spin_face_left
     301.  01:6E6C  32 4C CB            	ld	(ms_state),a
     302.  01:6E6F  C9                  	ret
     303.  01:6E70                      1:
     304.  01:6E70                      	; xor	a
     305.  01:6E70                          ; ld  (dxmap),a
     306.  01:6E70  C9                  	ret
     307.  01:6E71                      	
     308.  01:6E71                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     309.  01:6E71                      .ms_spin_face_left:
     310.  01:6E71  CD E2 6D            	call	.z_or_space
     311.  01:6E74  CC 9A 5B            	call	z,ms_shoot
     312.  01:6E77  3A 4B CB            	ld	a,(aniframe)
     313.  01:6E7A  3C                  	inc	a
     314.  01:6E7B  32 4B CB            	ld	(aniframe),a
     315.  01:6E7E  FE 10               	cp	16
     316.  01:6E80  C0                  	ret	nz
     317.  01:6E81  3E 04               	ld	a,ms_fly__left
     318.  01:6E83  32 4C CB            	ld	(ms_state),a
     319.  01:6E86  C9                  	ret
     320.  01:6E87                      	
     321.  01:6E87                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     322.  01:6E87                      .ms_fly__left:
     323.  01:6E87  3A 43 CB            	ld  a,(dxmap)
     324.  01:6E8A  3D                  	dec	a
     325.  01:6E8B  CB 7F               	bit	7,a
     326.  01:6E8D  20 0B               	jr nz,1f
     327.  01:6E8F                      	
     328.  01:6E8F  3E 10               	ld	a,16
     329.  01:6E91  32 4B CB            	ld  (aniframe),a
     330.  01:6E94  3E 09               	ld	a,ms_loop_left2right
     331.  01:6E96  32 4C CB            	ld	(ms_state),a
     332.  01:6E99  C9                  	ret	
     333.  01:6E9A                      1:
     334.  01:6E9A  3E 30               	ld	a,48
     335.  01:6E9C  32 4B CB            	ld  (aniframe),a
     336.  01:6E9F  CD E8 6D            	call	.x_and_up
     337.  01:6EA2  C2 B0 6E            	jp	nz,1f
     338.  01:6EA5  3E 30               	ld	a,48
     339.  01:6EA7  32 4B CB            	ld  (aniframe),a
     340.  01:6EAA  3E 07               	ld	a,ms_side_up__face_left
     341.  01:6EAC  32 4C CB            	ld	(ms_state),a
     342.  01:6EAF  C9                  	ret
     343.  01:6EB0  CD F4 6D            1:	call	.x_and_dwn
     344.  01:6EB3  C2 C1 6E            	jp	nz,1f
     345.  01:6EB6  3E 38               	ld	a,56
     346.  01:6EB8  32 4B CB            	ld  (aniframe),a
     347.  01:6EBB  3E 06               	ld	a,ms_side_dwn_face_left
     348.  01:6EBD  32 4C CB            	ld	(ms_state),a
     349.  01:6EC0  C9                  	ret
     350.  01:6EC1  CD 06 6E            1:	call	.right
     351.  01:6EC4  C2 D2 6E            	jp	nz,1f
     352.  01:6EC7  3E 10               	ld	a,16
     353.  01:6EC9  32 4B CB            	ld  (aniframe),a
     354.  01:6ECC  3E 09               	ld	a,ms_loop_left2right
     355.  01:6ECE  32 4C CB            	ld	(ms_state),a
     356.  01:6ED1  C9                  	ret
     357.  01:6ED2  CD E2 6D            1:	call	.z_or_space
     358.  01:6ED5  CA 9A 5B            	jp		z,ms_shoot
     359.  01:6ED8  C9                  	ret
     360.  01:6ED9                      	
     361.  01:6ED9                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     362.  01:6ED9                      .ms_loop_left2right:
     363.  01:6ED9  3A 4B CB            	ld	a,(aniframe)
     364.  01:6EDC  3C                  	inc	a
     365.  01:6EDD  32 4B CB            	ld	(aniframe),a
     366.  01:6EE0  FE 14               	cp	20
     367.  01:6EE2  CA EE 6E            	jp	z,1f
     368.  01:6EE5  FE 18               	cp	24
     369.  01:6EE7  C0                  	ret	nz
     370.  01:6EE8  3E 01               	ld	a,ms_spin_face_right
     371.  01:6EEA  32 4C CB            	ld	(ms_state),a
     372.  01:6EED  C9                  	ret
     373.  01:6EEE                      1:	; xor	a
     374.  01:6EEE                          ; ld  (dxmap),a
     375.  01:6EEE  C9                  	ret
     376.  01:6EEF                      
     377.  01:6EEF                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     378.  01:6EEF                      .ms_spin_face_right:
     379.  01:6EEF  CD E2 6D            	call	.z_or_space
     380.  01:6EF2  CC 9A 5B            	call	z,ms_shoot
     381.  01:6EF5  3A 4B CB            	ld	a,(aniframe)
     382.  01:6EF8  3C                  	inc	a
     383.  01:6EF9  32 4B CB            	ld	(aniframe),a
     384.  01:6EFC  FE 20               	cp	32
     385.  01:6EFE  C0                  	ret	nz
     386.  01:6EFF  3E 00               	ld	a,ms_fly__right
     387.  01:6F01  32 4C CB            	ld	(ms_state),a
     388.  01:6F04  C9                  	ret
     389.  01:6F05                      	
     390.  01:6F05                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     391.  01:6F05                      .ms_side_dwn_face_right:
     392.  01:6F05  CD E2 6D            	call	.z_or_space
     393.  01:6F08  CC 9A 5B            	call	z,ms_shoot
     394.  01:6F0B  3A 4B CB            	ld	a,(aniframe)
     395.  01:6F0E  FE 2C               	cp	44
     396.  01:6F10  CA 25 6F            	jp	z,1f
     397.  01:6F13                      
     398.  01:6F13  3C                  	inc	a
     399.  01:6F14  32 4B CB            	ld	(aniframe),a
     400.  01:6F17  FE 2F               	cp	47
     401.  01:6F19  C0                  	ret	nz
     402.  01:6F1A  3E 20               	ld	a,32
     403.  01:6F1C  32 4B CB            	ld	(aniframe),a
     404.  01:6F1F  3E 00               	ld	a,ms_fly__right
     405.  01:6F21  32 4C CB            	ld	(ms_state),a
     406.  01:6F24  C9                  	ret
     407.  01:6F25  3A 43 CB            1:	ld  a,(dxmap)
     408.  01:6F28  CB 7F               	bit	7,a
     409.  01:6F2A  20 0A               	jr nz,1f
     410.  01:6F2C  CD E8 6D            	call	.x_and_up
     411.  01:6F2F  CA 36 6F            	jp		z,1f
     412.  01:6F32  CD 00 6E            	call	.left
     413.  01:6F35  C0                  	ret	nz
     414.  01:6F36  3E 2D               1:	ld	a,45
     415.  01:6F38  32 4B CB            	ld	(aniframe),a
     416.  01:6F3B  C9                  	ret
     417.  01:6F3C                      
     418.  01:6F3C                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     419.  01:6F3C                      .ms_side_up__face_right	
     420.  01:6F3C  CD E2 6D            	call	.z_or_space
     421.  01:6F3F  CC 9A 5B            	call	z,ms_shoot
     422.  01:6F42  3A 4B CB            	ld	a,(aniframe)
     423.  01:6F45  FE 24               	cp	36
     424.  01:6F47  CA 5C 6F            	jp	z,1f
     425.  01:6F4A                      
     426.  01:6F4A  3C                  	inc	a
     427.  01:6F4B  32 4B CB            	ld	(aniframe),a
     428.  01:6F4E  FE 28               	cp	40
     429.  01:6F50  C0                  	ret	nz
     430.  01:6F51  3E 20               	ld	a,32
     431.  01:6F53  32 4B CB            	ld	(aniframe),a
     432.  01:6F56  3E 00               	ld	a,ms_fly__right
     433.  01:6F58  32 4C CB            	ld	(ms_state),a
     434.  01:6F5B  C9                  	ret
     435.  01:6F5C  3A 43 CB            1:	ld  a,(dxmap)
     436.  01:6F5F  CB 7F               	bit	7,a
     437.  01:6F61  20 0A               	jr nz,1f
     438.  01:6F63  CD F4 6D            	call	.x_and_dwn
     439.  01:6F66  CA 6D 6F            	jp		z,1f
     440.  01:6F69  CD 00 6E            	call	.left
     441.  01:6F6C  C0                  	ret	nz
     442.  01:6F6D  3E 25               1:	ld	a,37
     443.  01:6F6F  32 4B CB            	ld	(aniframe),a
     444.  01:6F72  C9                  	ret
     445.  01:6F73                      
     446.  01:6F73                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     447.  01:6F73                      .ms_side_dwn_face_left	
     448.  01:6F73  CD E2 6D            	call	.z_or_space
     449.  01:6F76  CC 9A 5B            	call	z,ms_shoot
     450.  01:6F79  3A 4B CB            	ld	a,(aniframe)
     451.  01:6F7C  FE 3C               	cp	60
     452.  01:6F7E  CA 93 6F            	jp	z,1f
     453.  01:6F81                      
     454.  01:6F81  3C                  	inc	a
     455.  01:6F82  32 4B CB            	ld	(aniframe),a
     456.  01:6F85  FE 3F               	cp	63
     457.  01:6F87  C0                  	ret	nz
     458.  01:6F88  3E 30               	ld	a,48
     459.  01:6F8A  32 4B CB            	ld	(aniframe),a
     460.  01:6F8D  3E 04               	ld	a,ms_fly__left
     461.  01:6F8F  32 4C CB            	ld	(ms_state),a
     462.  01:6F92  C9                  	ret
     463.  01:6F93  3A 43 CB            1:	ld  a,(dxmap)
     464.  01:6F96  3D                  	dec	a
     465.  01:6F97  CB 7F               	bit	7,a
     466.  01:6F99  28 0A               	jr z,1f
     467.  01:6F9B  CD E8 6D            	call	.x_and_up
     468.  01:6F9E  CA A5 6F            	jp		z,1f
     469.  01:6FA1  CD 06 6E            	call	.right
     470.  01:6FA4  C0                  	ret	nz
     471.  01:6FA5  3E 3D               1:	ld	a,61
     472.  01:6FA7  32 4B CB            	ld	(aniframe),a
     473.  01:6FAA  C9                  	ret
     474.  01:6FAB                      
     475.  01:6FAB                      
     476.  01:6FAB                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     477.  01:6FAB                      .ms_side_up__face_left	
     478.  01:6FAB  CD E2 6D            	call	.z_or_space
     479.  01:6FAE  CC 9A 5B            	call	z,ms_shoot
     480.  01:6FB1  3A 4B CB            	ld	a,(aniframe)
     481.  01:6FB4  FE 34               	cp	52
     482.  01:6FB6  CA CB 6F            	jp	z,1f
     483.  01:6FB9                      
     484.  01:6FB9  3C                  	inc	a
     485.  01:6FBA  32 4B CB            	ld	(aniframe),a
     486.  01:6FBD  FE 38               	cp	56
     487.  01:6FBF  C0                  	ret	nz
     488.  01:6FC0  3E 30               	ld	a,48
     489.  01:6FC2  32 4B CB            	ld	(aniframe),a
     490.  01:6FC5  3E 04               	ld	a,ms_fly__left
     491.  01:6FC7  32 4C CB            	ld	(ms_state),a
     492.  01:6FCA  C9                  	ret
     493.  01:6FCB  3A 43 CB            1:	ld  a,(dxmap)
     494.  01:6FCE  3D                  	dec	a
     495.  01:6FCF  CB 7F               	bit	7,a
     496.  01:6FD1  28 0A               	jr z,1f
     497.  01:6FD3  CD F4 6D            	call	.x_and_dwn
     498.  01:6FD6  CA DD 6F            	jp		z,1f
     499.  01:6FD9  CD 06 6E            	call	.right
     500.  01:6FDC  C0                  	ret	nz
     501.  01:6FDD  3E 35               1:	ld	a,53
     502.  01:6FDF  32 4B CB            	ld	(aniframe),a
     503.  01:6FE2  C9                  	ret
     504.  01:6FE3                      
     505.  01:6FE3                      
     506.  01:6FE3                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     507.  01:6FE3                      .ms_explode:
     508.  01:6FE3  3A 4E CB            	ld	a,(anispeed)
     509.  01:6FE6  3C                  	inc	a
     510.  01:6FE7  E6 03               	and	3
     511.  01:6FE9  32 4E CB            	ld	(anispeed),a
     512.  01:6FEC  C0                  	ret nz
     513.  01:6FED  3A 4B CB            	ld	a,(aniframe)
     514.  01:6FF0  3C                  	inc	a
     515.  01:6FF1  32 4B CB            	ld	(aniframe),a
     516.  01:6FF4  FE 50               	cp	80
     517.  01:6FF6  C0                  	ret	nz
     518.  01:6FF7  AF                  	xor	a
     519.  01:6FF8  32 48 CB            	ld	(yship),a
     520.  01:6FFB                      	; call	put_ms_sprt.expl
     521.  01:6FFB  3E 0C               	ld	a,ms_reset
     522.  01:6FFD  32 4C CB            	ld	(ms_state),a
     523.  01:7000                      	
     524.  01:7000  0E 01               	ld	c,1						; show lives on screen 
     525.  01:7002                      	; call	sub_c_lives_bin
     526.  01:7002                      	
     527.  01:7002  3E FF               	ld	a,-1
     528.  01:7004  32 4F CB            	ld	(already_dead),a	; reset at level start, set after you die
     529.  01:7007                      
     530.  01:7007  3A 50 CB            	ld	a,(lives_bin)
     531.  01:700A  A7                  	and	a
     532.  01:700B  C0                  	ret	nz
     533.  01:700C                      		
     534.  01:700C                      	; call	PT3_MUTE
     535.  01:700C  3E 13               	ld	a,19			; game over
     536.  01:700E  CD F4 56            	call AFXPLAY
     537.  01:7011                      	
     538.  01:7011                      	; ld	hl,GameOver
     539.  01:7011                      	; ld	de,0x1C00+8*3*32
     540.  01:7011                      	; call	print_strf
     541.  01:7011  06 00               	ld	b,0
     542.  01:7013  76                  1:	halt	
     543.  01:7014  10 FD               	djnz	1b
     544.  01:7016                      
     545.  01:7016                      	; you've lost 
     546.  01:7016                      	; pop af
     547.  01:7016                      	; jp	title_screen
     548.  01:7016                      
     549.  01:7016  C9                  	ret
     550.  01:7017                      
     352   01:7017                      		include	"put_ms_sprt.asm"
       1.  01:7017                      
       2.  01:7017                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       3.  01:7017                      ;
       4.  01:7017                      ;	manage SAT entries of the main ship
       5.  01:7017                      ;
       6.  01:7017                      
       7.  01:7017                      put_ms_sprt:
       8.  01:7017  3A 4C CB            	ld	a,(ms_state)
       9.  01:701A  FE 0A               	cp	ms_explode
      10.  01:701C  28 3E               	jr	z,.expl
      11.  01:701E                      						; manage SAT entries of the main ship
      12.  01:701E  21 54 CB            	ld	hl,ram_sat
      13.  01:7021  3A 48 CB            	ld	a,(yship)
      14.  01:7024  3D                  	dec	a
      15.  01:7025  77                  	ld	(hl),a
      16.  01:7026  23                  	inc hl
      17.  01:7027  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      18.  01:702A  C6 78               	add	a,xship_rel
      19.  01:702C  77                  	ld	(hl),a
      20.  01:702D  23                  	inc hl
      21.  01:702E  36 00               	ld	(hl),0		; shape 0 hard wired
      22.  01:7030                      	; ld	(hl),64		; shape 0 hard wired
      23.  01:7030  23                  	inc hl
      24.  01:7031  36 0F               	ld	(hl),15
      25.  01:7033  23                  	inc hl
      26.  01:7034                      
      27.  01:7034  3A 48 CB            	ld	a,(yship)
      28.  01:7037  3D                  	dec	a
      29.  01:7038  77                  	ld	(hl),a
      30.  01:7039  23                  	inc hl
      31.  01:703A  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      32.  01:703D  C6 78               	add	a,xship_rel
      33.  01:703F  77                  	ld	(hl),a
      34.  01:7040  23                  	inc hl
      35.  01:7041  36 04               	ld	(hl),4		; shape 4 hard wired
      36.  01:7043                      	; ld	(hl),64+4		; shape 4 hard wired
      37.  01:7043  4F                  	ld	c,a
      38.  01:7044  23                  	inc hl
      39.  01:7045  36 07               	ld	(hl),7
      40.  01:7047  23                  	inc hl
      41.  01:7048                      
      42.  01:7048  3A 48 CB            	ld	a,(yship)
      43.  01:704B  C6 0F               	add a,16-1
      44.  01:704D  77                  	ld	(hl),a
      45.  01:704E  23                  	inc hl
      46.  01:704F  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      47.  01:7052  C6 88               	add	a,xship_rel+16
      48.  01:7054  77                  	ld	(hl),a
      49.  01:7055  23                  	inc hl
      50.  01:7056  36 08               	ld	(hl),8		; shape 8 hard wired
      51.  01:7058                      	; ld	(hl),64+4		; shape 8 hard wired
      52.  01:7058  23                  	inc hl
      53.  01:7059  36 01               	ld	(hl),1
      54.  01:705B  C9                  	ret
      55.  01:705C                      .expl:
      56.  01:705C                      						; manage SAT entries of the main ship
      57.  01:705C  21 54 CB            	ld	hl,ram_sat
      58.  01:705F  3A 48 CB            	ld	a,(yship)
      59.  01:7062  77                  	ld	(hl),a
      60.  01:7063  23                  	inc hl
      61.  01:7064  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      62.  01:7067  C6 78               	add	a,xship_rel
      63.  01:7069  77                  	ld	(hl),a
      64.  01:706A  23                  	inc hl
      65.  01:706B  36 00               	ld	(hl),0		; shape 0 hard wired
      66.  01:706D  23                  	inc hl
      67.  01:706E                      ;	ld	(hl),10
      68.  01:706E  23                  	inc hl
      69.  01:706F                      
      70.  01:706F  3A 48 CB            	ld	a,(yship)
      71.  01:7072  77                  	ld	(hl),a
      72.  01:7073  23                  	inc hl
      73.  01:7074  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      74.  01:7077  C6 78               	add	a,xship_rel
      75.  01:7079  77                  	ld	(hl),a
      76.  01:707A  23                  	inc hl
      77.  01:707B  36 04               	ld	(hl),4		; shape 4 hard wired
      78.  01:707D  4F                  	ld	c,a
      79.  01:707E  23                  	inc hl
      80.  01:707F                      ;	ld	(hl),11
      81.  01:707F  23                  	inc hl
      82.  01:7080                      
      83.  01:7080  3A 48 CB            	ld	a,(yship)
      84.  01:7083  77                  	ld	(hl),a
      85.  01:7084  23                  	inc hl
      86.  01:7085  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
      87.  01:7088  C6 78               	add	a,xship_rel
      88.  01:708A  77                  	ld	(hl),a
      89.  01:708B  23                  	inc hl
      90.  01:708C  36 08               	ld	(hl),8		; shape 8 hard wired
      91.  01:708E                      ;	inc hl
      92.  01:708E                      ;	ld	(hl),6
      93.  01:708E  C9                  	ret
      94.  01:708F                      	
      95.  01:708F                      .landing:
      96.  01:708F  21 5C CB            	ld	hl,ram_sat+4*2
      97.  01:7092  3A 48 CB            	ld	a,(yship)
      98.  01:7095  3D                  	dec	a
      99.  01:7096  77                  	ld	(hl),a
     100.  01:7097  23                  	inc hl
     101.  01:7098  3A 44 CB            	ld	a,(xmap)
     102.  01:709B  57                  	ld  d,a
     103.  01:709C  3A 49 CB            	ld	a,(xship)
     104.  01:709F  92                  	sub	a,d
     105.  01:70A0  77                  	ld	(hl),a		; xship_rel
     106.  01:70A1  23                  	inc hl
     107.  01:70A2  36 00               	ld	(hl),0		; shape 0 hard wired
     108.  01:70A4  23                  	inc hl
     109.  01:70A5  36 0F               	ld	(hl),15
     110.  01:70A7                      	
     111.  01:70A7  11 F9 FF            	ld  de,-7
     112.  01:70AA  19                  	add hl,de
     113.  01:70AB                      	
     114.  01:70AB  3A 48 CB            	ld	a,(yship)
     115.  01:70AE  3D                  	dec	a
     116.  01:70AF  77                  	ld	(hl),a
     117.  01:70B0  23                  	inc hl
     118.  01:70B1  3A 44 CB            	ld	a,(xmap)
     119.  01:70B4  57                  	ld  d,a
     120.  01:70B5  3A 49 CB            	ld	a,(xship)
     121.  01:70B8  92                  	sub	a,d
     122.  01:70B9  77                  	ld	(hl),a		; xship_rel
     123.  01:70BA  23                  	inc hl
     124.  01:70BB  36 04               	ld	(hl),4		; shape 4 hard wired
     125.  01:70BD  4F                  	ld	c,a
     126.  01:70BE  23                  	inc hl
     127.  01:70BF  36 07               	ld	(hl),7
     128.  01:70C1                      
     129.  01:70C1  11 F9 FF            	ld  de,-7
     130.  01:70C4  19                  	add hl,de
     131.  01:70C5                      
     132.  01:70C5  3A 48 CB            	ld	a,(yship)
     133.  01:70C8  80                  	add a,b 
     134.  01:70C9  77                  	ld	(hl),a
     135.  01:70CA  23                  	inc hl
     136.  01:70CB                      
     137.  01:70CB  3A 44 CB            	ld	a,(xmap)
     138.  01:70CE  57                  	ld  d,a
     139.  01:70CF  3A 49 CB            	ld	a,(xship)
     140.  01:70D2  92                  	sub	a,d
     141.  01:70D3  80                  	add	a,b
     142.  01:70D4  77                  	ld	(hl),a
     143.  01:70D5  23                  	inc hl
     144.  01:70D6  36 08               	ld	(hl),8		; shape 8 hard wired
     145.  01:70D8  23                  	inc hl
     146.  01:70D9  36 01               	ld	(hl),1
     147.  01:70DB  C9                  	ret
     353   01:70DC                      		include probe_level.asm				
       1.  01:70DC                       
       2.  01:70DC                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       3.  01:70DC                      ;	peek a tile
       4.  01:70DC                      ; in	a:	y (screen coordinate)
       5.  01:70DC                      ;		hl: x (level coordinate)
       6.  01:70DC                      ; out	a:  tile at x,y
       7.  01:70DC                      ;		hl: pointer in level_buffer to  tile
       8.  01:70DC                       
       9.  01:70DC                      probe_level:
      10.  01:70DC                      
      11.  01:70DC  01 00 C0            	ld	bc,_levelmap
      12.  01:70DF  0F 0F 0F 0F         [4]	rrca
      13.  01:70E3  E6 0F               	and 15
      14.  01:70E5  29 29 29 29         [4]	add	hl,hl
      15.  01:70E9  6C                  	ld	l,h
      16.  01:70EA  67                  	ld	h,a
      17.  01:70EB  09                  	add	hl,bc
      18.  01:70EC  7E                  	ld	a,(hl)
      19.  01:70ED  C9                  	ret
      20.  01:70EE                      	
      21.  01:70EE                      	struct star_data
      22.  01:70EE                    < x	db	0
      23.  01:70EE                    < y	db	0
      24.  01:70EE                    < add	dw	0
      25.  01:70EE                    < 	ends
      26.  01:70EE                      	
      27.  01:70EE                      starlist:
      28.  01:70EE  20 4A 02 00         	star_data	 32,64+10, 32/16+(10/16)*256
      29.  01:70F2  D0 72 0D 03         	star_data	208,64+50,208/16+(50/16)*256
      30.  01:70F6  80 74 08 03         	star_data	128,64+52,128/16+(52/16)*256
      31.  01:70FA                      starlist2:
      32.  01:70FA  10 45 01 04             star_data	 16,64+5,  16/16+((64+ 5)/16)*256
      33.  01:70FE  30 51 03 05             star_data	 48,64+17, 48/16+((64+17)/16)*256
      34.  01:7102  70 5A 07 05         	star_data	112,64+26,112/16+((64+26)/16)*256
      35.  01:7106                      starlist3:
      36.  01:7106  30 51 03 09             star_data	 48,64+17, 48/16+((128+17)/16)*256
      37.  01:710A  70 5A 07 09         	star_data	112,64+26,112/16+((128+26)/16)*256
      38.  01:710E  E0 6A 0E 0A         	star_data	224,64+42,224/16+((128+42)/16)*256
      39.  01:7112                      	
      40.  01:7112                      test_star:
      41.  01:7112  F3                  	di
      42.  01:7113  3A 35 CB            	ld	a,(_xoffset)
      43.  01:7116  87 87 87 87         [4]	add	a,a
      44.  01:711A  4F                  	ld  c,a
      45.  01:711B                      	
      46.  01:711B  3A 33 CB            	ld	a,(_displaypage)
      47.  01:711E  87 87               [2]	add	a,a
      48.  01:7120  47                  	ld	b,a
      49.  01:7121                      	
      50.  01:7121  DD 21 EE 70         	ld	ix,starlist
      51.  01:7125  CD 3A 71            	call	.star_loop	
      52.  01:7128                      
      53.  01:7128  04                  	inc	b
      54.  01:7129  78                  	ld	a,b
      55.  01:712A                      
      56.  01:712A  CD 3A 71            	call	.star_loop
      57.  01:712D                      
      58.  01:712D  04                  	inc	b
      59.  01:712E  78                  	ld	a,b
      60.  01:712F                      
      61.  01:712F  CD 3A 71            	call	.star_loop
      62.  01:7132                      
      63.  01:7132  3A 35 CB            	ld	a,(_xoffset)		
      64.  01:7135  32 37 CB            	ld	(__xoffset),a
      65.  01:7138  FB                  	ei
      66.  01:7139  C9                  	ret
      67.  01:713A                      	
      68.  01:713A                      .star_loop
      69.  01:713A  D3 99               	out (0x99),a ;set bits 14-16
      70.  01:713C  3E 8E               	ld a,14+128
      71.  01:713E  D3 99               	out (0x99),a
      72.  01:7140                      
      73.  01:7140                      
      74.  01:7140                      	repeat 3
      75.  01:7140                    < 1:	ld	e,(ix+star_data.add)
      76.  01:7140                    < 	ld	d,(ix+star_data.add+1)
      77.  01:7140                    < 	ld	hl,(_levelmap_pos)
      78.  01:7140                    < 	add	hl,de
      79.  01:7140                    < 	ld	a,(hl)
      80.  01:7140                    < 	and	a
      81.  01:7140                    < 	jp	nz,2f
      82.  01:7140                    < 	ld	a,(__xoffset)		; compensate R#18 
      83.  01:7140                    < 	add	a,(ix+star_data.x)
      84.  01:7140                    < 	out (0x99),a
      85.  01:7140                    < 	ld a,(ix+star_data.y) 	;	set bits 8-13
      86.  01:7140                    < 	out (0x99),a
      87.  01:7140                    < 	xor	a
      88.  01:7140                    < 	out	(0x98),a
      89.  01:7140                    < 	call	.set_star
      90.  01:7140                    < 2:	ld	de,star_data
      91.  01:7140                    < 	add	ix,de
      92.  01:7140                    < 	endrepeat
      92.  01:7140  DD 5E 02 DD 56 03 2A 2F CB 19 7E A7 C2 62 71 3A 
      92.  01:7150  37 CB DD 86 00 D3 99 DD 7E 01 D3 99 AF D3 98 CD 
      92.  01:7160  B6 71 11 04 00 DD 19 DD 5E 02 DD 56 03 2A 2F CB 
      92.  01:7170  19 7E A7 C2 89 71 3A 37 CB DD 86 00 D3 99 DD 7E 
      92.  01:7180  01 D3 99 AF D3 98 CD B6 71 11 04 00 DD 19 DD 5E 
      92.  01:7190  02 DD 56 03 2A 2F CB 19 7E A7 C2 B0 71 3A 37 CB 
      92.  01:71A0  DD 86 00 D3 99 DD 7E 01 D3 99 AF D3 98 CD B6 71 
      92.  01:71B0  11 04 00 DD 19 
      93.  01:71B5  C9                  	ret
      94.  01:71B6                      	
      95.  01:71B6                      .set_star:
      96.  01:71B6  79                  	ld	a,c
      97.  01:71B7  DD BE 00            	cp	(ix+star_data.x)
      98.  01:71BA  C8                  	ret	z
      99.  01:71BB  3A 35 CB            	ld	a,(_xoffset)		; compensate R#18 
     100.  01:71BE  DD 86 00            	add	a,(ix+star_data.x)
     101.  01:71C1  D3 99               	out (0x99),a
     102.  01:71C3  DD 7E 01            	ld a,(ix+star_data.y) 	;	set bits 8-13
     103.  01:71C6  D3 99               	out (0x99),a
     104.  01:71C8  3E FF               	ld	a,255
     105.  01:71CA  D3 98               	out	(0x98),a
     106.  01:71CC  C9                  	ret
     107.  01:71CD                      	
     108.  01:71CD                      ; unused_other:
     109.  01:71CD                      	; ld	hl,(xship)
     110.  01:71CD                      	; ld	a,(yship)
     111.  01:71CD                      	; call	probe_level
     112.  01:71CD                      	; exx
     113.  01:71CD                      	; ld	hl,_levelmap+256
     114.  01:71CD                      	; ld	bc,13
     115.  01:71CD                      	; cpir
     116.  01:71CD                      	; ret nz
     117.  01:71CD                      	; dec	h
     118.  01:71CD                      	; dec l
     119.  01:71CD                      	; ld  a,(hl)
     120.  01:71CD                      	; exx
     121.  01:71CD                      	; ld  (hl),a
     122.  01:71CD                      	; exx
     123.  01:71CD                      	; ld  a,l
     124.  01:71CD                      	; sub	a,low _levelmap
     125.  01:71CD                      	; ld  l,a
     126.  01:71CD                      	; push	hl					; L block#
     127.  01:71CD                      		
     128.  01:71CD                      	; ld		a,(_displaypage)
     129.  01:71CD                      	; ld		h,a
     130.  01:71CD                      	; ld		a,(_xoffset)		; compensate R#18 
     131.  01:71CD                      	; add		a,xship_rel
     132.  01:71CD                      	; and		0xF0
     133.  01:71CD                      	; ld		e,a					; destX
     134.  01:71CD                      	; ld		a,(yship)
     135.  01:71CD                      	; and 	0xF0
     136.  01:71CD                      	; ld		d,a					; destY
     137.  01:71CD                      
     138.  01:71CD                      	; push	de
     139.  01:71CD                      	; call	_plot_distrucable
     140.  01:71CD                      	; pop		de
     141.  01:71CD                      	
     142.  01:71CD                      	; pop		hl
     143.  01:71CD                      	; ld		a,h
     144.  01:71CD                      	; xor		1
     145.  01:71CD                      	; ld		h,a
     146.  01:71CD                      	
     147.  01:71CD                      	; ret
     148.  01:71CD                      	; ld		a,(dxmap)
     149.  01:71CD                      	; rlc a
     150.  01:71CD                      	; jp	nc,1f		; >0 == dx
     151.  01:71CD                      					; ; <0 == sx
     152.  01:71CD                      	; ld	a,-16
     153.  01:71CD                      	; add	a,e
     154.  01:71CD                      	; ld	e,a
     155.  01:71CD                      	; jp		_plot_distrucable
     156.  01:71CD                      	
     157.  01:71CD                      ; 1:	ld	a,+16
     158.  01:71CD                      	; add	a,e
     159.  01:71CD                      	; ld	e,a
     160.  01:71CD                      	; jp		_plot_distrucable
     354   01:71CD                      		
     355   01:71CD                      outvram:
     356   01:71CD  7A                  2:		ld	a,d
     357   01:71CE  32 00 B0            		ld	(_kBank4),a
     358   01:71D1  21 00 A0            		ld	hl,0xA000
     359   01:71D4  01 98 00            		ld	bc,0x98
     360   01:71D7  3E 20               		ld	a,32
     361   01:71D9  ED B3               1:		otir
     362   01:71DB  3D                  		dec	a
     363   01:71DC  C2 D9 71            		jp	nz,1b
     364   01:71DF  14                  		inc	d
     365   01:71E0  1D                  		dec	e
     366   01:71E1  20 EA               		jr	nz,2b
     367   01:71E3  C9                  		ret
     368   01:71E4                      		
     369   01:71E4  (02)                		page 2
     370   02:8000                      	; include mainhero_LMMM.asm
     371   02:8000                      
     372   02:8000                      	
     373   02:8000  (03)                		page 3
     374   03:A000                      manta_color:
     375   03:A000  (0680)              		incbin mship03_clr.bin
     376   03:A680                      ms_spt:
     377   03:A680  (1380)              		incbin mship03_frm.bin
     378   03:BA00                      		
     379   03:BA00  (04)                		page 4
     380   04:A000                      _tiles0:
     381   04:A000  (2000)              		incbin "tiles.bin",0x0000,0x2000
     382   04:C000  (05)                		page 5
     383   05:A000  (2000)              		incbin "tiles.bin",0x2000,0x2000
     384   05:C000  (06)                		page 6
     385   06:A000  (2000)              		incbin "tiles.bin",0x4000,0x2000
     386   06:C000  (07)                		page 7
     387   07:A000  (2000)              		incbin "tiles.bin",0x6000,0x2000
     388   07:C000  (08)                		page 8
     389   08:A000  (2000)              		incbin "tiles.bin",0x8000,0x2000
     390   08:C000  (09)                		page 9
     391   09:A000  (2000)              		incbin "tiles.bin",0xA000,0x2000
     392   09:C000  (0A)                		page 10
     393   0A:A000  (2000)              		incbin "tiles.bin",0xC000,0x2000
     394   0A:C000  (0B)                		page 11
     395   0B:A000  (1100)              		incbin "tiles.bin",0xE000;,0x2000
     396   0B:B100                      
     397   0B:B100  (0C)                		page 12
     398   0C:A000                      demo_song:
     399   0C:A000                      musbuff:
     400   0C:A000                      		; org 0x0040
     401   0C:A000                      		include	"demosong.asm"
       1.  0C:A000                      ; Compiled using tt_compile.exe V0.3 [12-04-2015]
       2.  0C:A000                      ; Copyright 2015 Richard Cornelisse
       3.  0C:A000                      
       4.  0C:A000                      ; Song: Namachuukei68 - Game Set        
       5.  0C:A000                      ; By:   KONAMI/TECHNOuchi/T4N3  (c) 2015
       6.  0C:A000                      
       7.  0C:A000                      ;	org $c000
       8.  0C:A000                      
       9.  0C:A000                      ; [ Song start data ]
      10.  0C:A000  05                  	db $05				; Initial song speed.
      11.  0C:A001  99 A0               	dw .waveform_start 		; Start of the waveform data.
      12.  0C:A003  39 A1               	dw .instrument_start 		; Start of the instrument data.
      13.  0C:A005                      
      14.  0C:A005                      ; [ Song order pointer list ]
      15.  0C:A005                      		dw .track_0,.track_1,.track_1,.track_2,.track_1,.track_1,.track_1,.track_1		; Sequence step 0 /pattern 0
      15.  0C:A005  B3 A3 CF A3 CF A3 D1 A3 CF A3 CF A3 CF A3 CF A3 
      16.  0C:A015                      .restart:
      17.  0C:A015                      		dw .track_3,.track_4,.track_5,.track_6,.track_7,.track_8,.track_9,.track_10		; Sequence step 1 /pattern 1
      17.  0C:A015  1B A4 55 A4 7D A4 94 A4 BC A4 D3 A4 EC A4 23 A5 
      18.  0C:A025                      		dw .track_11,.track_12,.track_13,.track_14,.track_15,.track_16,.track_17,.track_18		; Sequence step 2 /pattern 2
      18.  0C:A025  3D A5 6C A5 90 A5 9A A5 BE A5 D0 A5 E2 A5 32 A6 
      19.  0C:A035                      		dw .track_11,.track_19,.track_20,.track_21,.track_22,.track_23,.track_24,.track_25		; Sequence step 3 /pattern 3
      19.  0C:A035  3D A5 65 A6 94 A6 A3 A6 D5 A6 EB A6 01 A7 54 A7 
      20.  0C:A045                      		dw .track_26,.track_27,.track_28,.track_29,.track_30,.track_31,.track_32,.track_33		; Sequence step 4 /pattern 4
      20.  0C:A045  78 A7 A7 A7 DF A7 EA A7 22 A8 32 A8 42 A8 97 A8 
      21.  0C:A055                      		dw .track_3,.track_34,.track_5,.track_6,.track_7,.track_8,.track_35,.track_36		; Sequence step 5 /pattern 5
      21.  0C:A055  1B A4 D0 A8 7D A4 94 A4 BC A4 D3 A4 F8 A8 4B A9 
      22.  0C:A065                      		dw .track_11,.track_37,.track_13,.track_14,.track_15,.track_16,.track_38,.track_39		; Sequence step 6 /pattern 6
      22.  0C:A065  3D A5 73 A9 90 A5 9A A5 BE A5 D0 A5 99 A9 F4 A9 
      23.  0C:A075                      		dw .track_11,.track_40,.track_20,.track_41,.track_22,.track_23,.track_42,.track_43		; Sequence step 7 /pattern 7
      23.  0C:A075  3D A5 37 AA 94 A6 6A AA D5 A6 EB A6 9B AA EA AA 
      24.  0C:A085                      		dw .track_44,.track_45,.track_28,.track_29,.track_46,.track_47,.track_48,.track_49		; Sequence step 8 /pattern 8
      24.  0C:A085  09 AB 41 AB DF A7 EA A7 7B AB 93 AB AB AB ED AB 
      25.  0C:A095  00 00 15 A0         		dw 0x0000, .restart			; End of sequence delimiter + restart address.
      26.  0C:A099                      
      27.  0C:A099                      .waveform_start:
      28.  0C:A099                      	db $80,$B0,$C0,$10,$1A,$2A,$2C,$1A,$00,$E0,$D0,$E0,$22,$53,$70,$75,$70,$31,$EA,$80,$88,$8A,$8C,$8E,$00,$7F,$75,$73,$62,$00,$C0,$90	; Waveform 0(was 0)
      28.  0C:A099  80 B0 C0 10 1A 2A 2C 1A 00 E0 D0 E0 22 53 70 75 
      28.  0C:A0A9  70 31 EA 80 88 8A 8C 8E 00 7F 75 73 62 00 C0 90 
      29.  0C:A0B9                      	db $00,$20,$30,$40,$50,$58,$60,$68,$70,$68,$60,$58,$50,$40,$30,$20,$00,$E0,$D0,$C0,$B0,$A0,$98,$90,$88,$90,$98,$A0,$B0,$C0,$D0,$E0	; Waveform 1(was 1)
      29.  0C:A0B9  00 20 30 40 50 58 60 68 70 68 60 58 50 40 30 20 
      29.  0C:A0C9  00 E0 D0 C0 B0 A0 98 90 88 90 98 A0 B0 C0 D0 E0 
      30.  0C:A0D9                      	db $80,$AA,$C8,$00,$24,$40,$5C,$70,$7F,$6A,$4A,$26,$00,$D0,$A8,$8C,$80,$AA,$C8,$00,$24,$40,$5C,$70,$7F,$6A,$4A,$26,$00,$D0,$A8,$8C	; Waveform 2(was 2)
      30.  0C:A0D9  80 AA C8 00 24 40 5C 70 7F 6A 4A 26 00 D0 A8 8C 
      30.  0C:A0E9  80 AA C8 00 24 40 5C 70 7F 6A 4A 26 00 D0 A8 8C 
      31.  0C:A0F9                      	db $30,$50,$50,$30,$00,$00,$10,$40,$60,$70,$60,$30,$F0,$E0,$E0,$00,$20,$20,$10,$C0,$A0,$90,$A0,$C0,$00,$00,$D0,$B0,$B0,$D0,$00,$00	; Waveform 3(was 4)
      31.  0C:A0F9  30 50 50 30 00 00 10 40 60 70 60 30 F0 E0 E0 00 
      31.  0C:A109  20 20 10 C0 A0 90 A0 C0 00 00 D0 B0 B0 D0 00 00 
      32.  0C:A119                      	db $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00	; Waveform 4(was 31)
      32.  0C:A119  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      32.  0C:A129  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      33.  0C:A139                      
      34.  0C:A139                      .instrument_start:
      35.  0C:A139  59 A1               	dw .ins_1
      36.  0C:A13B  5E A1               	dw .ins_2
      37.  0C:A13D  97 A1               	dw .ins_3
      38.  0C:A13F  C8 A1               	dw .ins_4
      39.  0C:A141  D4 A1               	dw .ins_5
      40.  0C:A143  D4 A1               	dw .ins_6
      41.  0C:A145  E7 A1               	dw .ins_7
      42.  0C:A147  2A A2               	dw .ins_8
      43.  0C:A149  4B A2               	dw .ins_9
      44.  0C:A14B  53 A2               	dw .ins_10
      45.  0C:A14D  9D A2               	dw .ins_11
      46.  0C:A14F  CA A2               	dw .ins_12
      47.  0C:A151  E3 A2               	dw .ins_13
      48.  0C:A153  26 A3               	dw .ins_14
      49.  0C:A155  69 A3               	dw .ins_15
      50.  0C:A157  AC A3               	dw .ins_16
      51.  0C:A159                      .ins_1:						; PSG BD          
      52.  0C:A159  00                  		db 0					; Waveform (was 0)
      53.  0C:A15A                      .rst_i1:
      54.  0C:A15A  0B 0E               		db $0B,$0E
      55.  0C:A15C  5A A1               		dw .rst_i1
      56.  0C:A15E                      .ins_2:						; PSG SD          
      57.  0C:A15E  00                  		db 0					; Waveform (was 0)
      58.  0C:A15F  13 0E               		db $13,$0E
      59.  0C:A161  85 0D 05 00         		db $85,$0D,$05,$00
      60.  0C:A165  85 0C 04 00         		db $85,$0C,$04,$00
      61.  0C:A169  85 0B 04 00         		db $85,$0B,$04,$00
      62.  0C:A16D  85 0A 04 00         		db $85,$0A,$04,$00
      63.  0C:A171  A5 0A 01 04 00      		db $A5,$0A,$01,$04,$00
      64.  0C:A176  81 09               		db $81,$09
      65.  0C:A178  A1 09 01            		db $A1,$09,$01
      66.  0C:A17B  81 09               		db $81,$09
      67.  0C:A17D  81 08               		db $81,$08
      68.  0C:A17F  81 08               		db $81,$08
      69.  0C:A181  81 07               		db $81,$07
      70.  0C:A183  81 06               		db $81,$06
      71.  0C:A185  81 05               		db $81,$05
      72.  0C:A187  81 03               		db $81,$03
      73.  0C:A189  81 01               		db $81,$01
      74.  0C:A18B  81 01               		db $81,$01
      75.  0C:A18D  81 01               		db $81,$01
      76.  0C:A18F  81 01               		db $81,$01
      77.  0C:A191  81 00               		db $81,$00
      78.  0C:A193                      .rst_i2:
      79.  0C:A193  89 00               		db $89,$00
      80.  0C:A195  93 A1               		dw .rst_i2
      81.  0C:A197                      .ins_3:						; PSG SD2         
      82.  0C:A197  00                  		db 0					; Waveform (was 0)
      83.  0C:A198  73 0C 1F            		db $73,$0C,$1F
      84.  0C:A19B  E1 0A 03            		db $E1,$0A,$03
      85.  0C:A19E  81 09               		db $81,$09
      86.  0C:A1A0  E1 08 01            		db $E1,$08,$01
      87.  0C:A1A3  81 07               		db $81,$07
      88.  0C:A1A5  A1 06 03            		db $A1,$06,$03
      89.  0C:A1A8  81 05               		db $81,$05
      90.  0C:A1AA  81 05               		db $81,$05
      91.  0C:A1AC  81 04               		db $81,$04
      92.  0C:A1AE  81 04               		db $81,$04
      93.  0C:A1B0  81 04               		db $81,$04
      94.  0C:A1B2  81 04               		db $81,$04
      95.  0C:A1B4  81 04               		db $81,$04
      96.  0C:A1B6  81 04               		db $81,$04
      97.  0C:A1B8  81 04               		db $81,$04
      98.  0C:A1BA  81 04               		db $81,$04
      99.  0C:A1BC  81 04               		db $81,$04
     100.  0C:A1BE  81 04               		db $81,$04
     101.  0C:A1C0  81 04               		db $81,$04
     102.  0C:A1C2  81 04               		db $81,$04
     103.  0C:A1C4                      .rst_i3:
     104.  0C:A1C4  09 04               		db $09,$04
     105.  0C:A1C6  C4 A1               		dw .rst_i3
     106.  0C:A1C8                      .ins_4:						; PSG HH          
     107.  0C:A1C8  00                  		db 0					; Waveform (was 0)
     108.  0C:A1C9  91 0C               		db $91,$0C
     109.  0C:A1CB  81 05               		db $81,$05
     110.  0C:A1CD  81 02               		db $81,$02
     111.  0C:A1CF                      .rst_i4:
     112.  0C:A1CF  A9 00 1F            		db $A9,$00,$1F
     113.  0C:A1D2  CF A1               		dw .rst_i4
     114.  0C:A1D4                      .ins_5:						; PSG HH2         
     115.  0C:A1D4                      .ins_6:						; PSG HH3         
     116.  0C:A1D4  00                  		db 0					; Waveform (was 0)
     117.  0C:A1D5  87 09 05 00         		db $87,$09,$05,$00
     118.  0C:A1D9  85 06 05 00         		db $85,$06,$05,$00
     119.  0C:A1DD  85 01 05 00         		db $85,$01,$05,$00
     120.  0C:A1E1                      .rst_i6:
     121.  0C:A1E1  8D 00 05 00         		db $8D,$00,$05,$00
     122.  0C:A1E5  E1 A1               		dw .rst_i6
     123.  0C:A1E7                      .ins_7:						; PSG CY          
     124.  0C:A1E7  00                  		db 0					; Waveform (was 0)
     125.  0C:A1E8  81 0C               		db $81,$0C
     126.  0C:A1EA  81 0A               		db $81,$0A
     127.  0C:A1EC  81 09               		db $81,$09
     128.  0C:A1EE  81 08               		db $81,$08
     129.  0C:A1F0  81 08               		db $81,$08
     130.  0C:A1F2  81 07               		db $81,$07
     131.  0C:A1F4  81 07               		db $81,$07
     132.  0C:A1F6  81 07               		db $81,$07
     133.  0C:A1F8  81 06               		db $81,$06
     134.  0C:A1FA  81 06               		db $81,$06
     135.  0C:A1FC  81 05               		db $81,$05
     136.  0C:A1FE  81 04               		db $81,$04
     137.  0C:A200  81 04               		db $81,$04
     138.  0C:A202  81 04               		db $81,$04
     139.  0C:A204  81 03               		db $81,$03
     140.  0C:A206  81 03               		db $81,$03
     141.  0C:A208  81 03               		db $81,$03
     142.  0C:A20A  81 03               		db $81,$03
     143.  0C:A20C  81 02               		db $81,$02
     144.  0C:A20E  81 02               		db $81,$02
     145.  0C:A210  81 02               		db $81,$02
     146.  0C:A212  81 01               		db $81,$01
     147.  0C:A214  81 01               		db $81,$01
     148.  0C:A216  81 01               		db $81,$01
     149.  0C:A218  81 01               		db $81,$01
     150.  0C:A21A  81 01               		db $81,$01
     151.  0C:A21C  81 01               		db $81,$01
     152.  0C:A21E  81 01               		db $81,$01
     153.  0C:A220  81 01               		db $81,$01
     154.  0C:A222  81 01               		db $81,$01
     155.  0C:A224  81 01               		db $81,$01
     156.  0C:A226                      .rst_i7:
     157.  0C:A226  89 00               		db $89,$00
     158.  0C:A228  26 A2               		dw .rst_i7
     159.  0C:A22A                      .ins_8:						; TomSine         
     160.  0C:A22A  08                  		db 8					; Waveform (was 1)
     161.  0C:A22B  11 0C               		db $11,$0C
     162.  0C:A22D  11 09               		db $11,$09
     163.  0C:A22F  11 07               		db $11,$07
     164.  0C:A231  11 06               		db $11,$06
     165.  0C:A233  11 05               		db $11,$05
     166.  0C:A235  11 05               		db $11,$05
     167.  0C:A237  11 04               		db $11,$04
     168.  0C:A239  11 04               		db $11,$04
     169.  0C:A23B  11 04               		db $11,$04
     170.  0C:A23D  11 03               		db $11,$03
     171.  0C:A23F  11 03               		db $11,$03
     172.  0C:A241  11 02               		db $11,$02
     173.  0C:A243  11 01               		db $11,$01
     174.  0C:A245  11 00               		db $11,$00
     175.  0C:A247                      .rst_i8:
     176.  0C:A247  19 00               		db $19,$00
     177.  0C:A249  47 A2               		dw .rst_i8
     178.  0C:A24B                      .ins_9:						; Click           
     179.  0C:A24B  00                  		db 0					; Waveform (was 0)
     180.  0C:A24C  01 00               		db $01,$00
     181.  0C:A24E  00                  		db $00
     182.  0C:A24F                      .rst_i9:
     183.  0C:A24F  0B 0E               		db $0B,$0E
     184.  0C:A251  4F A2               		dw .rst_i9
     185.  0C:A253                      .ins_10:						; PSG RC          
     186.  0C:A253  00                  		db 0					; Waveform (was 0)
     187.  0C:A254  91 0B               		db $91,$0B
     188.  0C:A256  D5 0C E1 02 00      		db $D5,$0C,$E1,$02,$00
     189.  0C:A25B  F5 0B 1F F8 FF      		db $F5,$0B,$1F,$F8,$FF
     190.  0C:A260  F1 0B 1F            		db $F1,$0B,$1F
     191.  0C:A263  91 0B               		db $91,$0B
     192.  0C:A265  91 0A               		db $91,$0A
     193.  0C:A267  91 0A               		db $91,$0A
     194.  0C:A269  91 0A               		db $91,$0A
     195.  0C:A26B  91 0A               		db $91,$0A
     196.  0C:A26D  91 0A               		db $91,$0A
     197.  0C:A26F  91 09               		db $91,$09
     198.  0C:A271  91 09               		db $91,$09
     199.  0C:A273  91 08               		db $91,$08
     200.  0C:A275  91 08               		db $91,$08
     201.  0C:A277  91 08               		db $91,$08
     202.  0C:A279  91 07               		db $91,$07
     203.  0C:A27B  91 07               		db $91,$07
     204.  0C:A27D  91 07               		db $91,$07
     205.  0C:A27F  91 06               		db $91,$06
     206.  0C:A281  91 06               		db $91,$06
     207.  0C:A283  91 06               		db $91,$06
     208.  0C:A285  91 06               		db $91,$06
     209.  0C:A287  91 05               		db $91,$05
     210.  0C:A289  91 05               		db $91,$05
     211.  0C:A28B  91 04               		db $91,$04
     212.  0C:A28D  91 04               		db $91,$04
     213.  0C:A28F  91 04               		db $91,$04
     214.  0C:A291  91 03               		db $91,$03
     215.  0C:A293  91 03               		db $91,$03
     216.  0C:A295  91 03               		db $91,$03
     217.  0C:A297  91 02               		db $91,$02
     218.  0C:A299                      .rst_i10:
     219.  0C:A299  99 01               		db $99,$01
     220.  0C:A29B  99 A2               		dw .rst_i10
     221.  0C:A29D                      .ins_11:						; GekiPenaBass    
     222.  0C:A29D  00                  		db 0					; Waveform (was 0)
     223.  0C:A29E  11 09               		db $11,$09
     224.  0C:A2A0  11 07               		db $11,$07
     225.  0C:A2A2  11 06               		db $11,$06
     226.  0C:A2A4  11 04               		db $11,$04
     227.  0C:A2A6  11 03               		db $11,$03
     228.  0C:A2A8  11 03               		db $11,$03
     229.  0C:A2AA  11 03               		db $11,$03
     230.  0C:A2AC  11 03               		db $11,$03
     231.  0C:A2AE  11 03               		db $11,$03
     232.  0C:A2B0  11 03               		db $11,$03
     233.  0C:A2B2  11 03               		db $11,$03
     234.  0C:A2B4  11 02               		db $11,$02
     235.  0C:A2B6  11 02               		db $11,$02
     236.  0C:A2B8  11 02               		db $11,$02
     237.  0C:A2BA  11 02               		db $11,$02
     238.  0C:A2BC  11 02               		db $11,$02
     239.  0C:A2BE  11 02               		db $11,$02
     240.  0C:A2C0  11 02               		db $11,$02
     241.  0C:A2C2  11 02               		db $11,$02
     242.  0C:A2C4  11 02               		db $11,$02
     243.  0C:A2C6                      .rst_i11:
     244.  0C:A2C6  19 01               		db $19,$01
     245.  0C:A2C8  C6 A2               		dw .rst_i11
     246.  0C:A2CA                      .ins_12:						; PSG Bass        
     247.  0C:A2CA  00                  		db 0					; Waveform (was 0)
     248.  0C:A2CB  11 0F               		db $11,$0F
     249.  0C:A2CD  11 0D               		db $11,$0D
     250.  0C:A2CF  11 0C               		db $11,$0C
     251.  0C:A2D1  11 0B               		db $11,$0B
     252.  0C:A2D3  11 0A               		db $11,$0A
     253.  0C:A2D5  11 08               		db $11,$08
     254.  0C:A2D7  11 07               		db $11,$07
     255.  0C:A2D9  11 06               		db $11,$06
     256.  0C:A2DB  11 05               		db $11,$05
     257.  0C:A2DD  11 05               		db $11,$05
     258.  0C:A2DF                      .rst_i12:
     259.  0C:A2DF  19 05               		db $19,$05
     260.  0C:A2E1  DF A2               		dw .rst_i12
     261.  0C:A2E3                      .ins_13:						; SofTriDouble    
     262.  0C:A2E3  10                  		db 16					; Waveform (was 2)
     263.  0C:A2E4  13 09               		db $13,$09
     264.  0C:A2E6  11 08               		db $11,$08
     265.  0C:A2E8  11 07               		db $11,$07
     266.  0C:A2EA  11 07               		db $11,$07
     267.  0C:A2EC  11 06               		db $11,$06
     268.  0C:A2EE  11 06               		db $11,$06
     269.  0C:A2F0  11 06               		db $11,$06
     270.  0C:A2F2  11 05               		db $11,$05
     271.  0C:A2F4  11 05               		db $11,$05
     272.  0C:A2F6  11 05               		db $11,$05
     273.  0C:A2F8  11 05               		db $11,$05
     274.  0C:A2FA  11 04               		db $11,$04
     275.  0C:A2FC  11 04               		db $11,$04
     276.  0C:A2FE  11 04               		db $11,$04
     277.  0C:A300  11 04               		db $11,$04
     278.  0C:A302  11 04               		db $11,$04
     279.  0C:A304  11 03               		db $11,$03
     280.  0C:A306  11 03               		db $11,$03
     281.  0C:A308  11 03               		db $11,$03
     282.  0C:A30A  11 03               		db $11,$03
     283.  0C:A30C  11 03               		db $11,$03
     284.  0C:A30E  11 03               		db $11,$03
     285.  0C:A310  11 03               		db $11,$03
     286.  0C:A312  11 03               		db $11,$03
     287.  0C:A314  11 03               		db $11,$03
     288.  0C:A316  11 03               		db $11,$03
     289.  0C:A318  11 03               		db $11,$03
     290.  0C:A31A  11 03               		db $11,$03
     291.  0C:A31C  11 03               		db $11,$03
     292.  0C:A31E  11 03               		db $11,$03
     293.  0C:A320  11 03               		db $11,$03
     294.  0C:A322                      .rst_i13:
     295.  0C:A322  19 03               		db $19,$03
     296.  0C:A324  22 A3               		dw .rst_i13
     297.  0C:A326                      .ins_14:						; PSG Tone        
     298.  0C:A326  00                  		db 0					; Waveform (was 0)
     299.  0C:A327  13 0F               		db $13,$0F
     300.  0C:A329  11 0E               		db $11,$0E
     301.  0C:A32B  11 0D               		db $11,$0D
     302.  0C:A32D  11 0D               		db $11,$0D
     303.  0C:A32F  11 0C               		db $11,$0C
     304.  0C:A331  11 0C               		db $11,$0C
     305.  0C:A333  11 0C               		db $11,$0C
     306.  0C:A335  11 0B               		db $11,$0B
     307.  0C:A337  11 0B               		db $11,$0B
     308.  0C:A339  11 0B               		db $11,$0B
     309.  0C:A33B  11 0B               		db $11,$0B
     310.  0C:A33D  11 0A               		db $11,$0A
     311.  0C:A33F  11 0A               		db $11,$0A
     312.  0C:A341  11 0A               		db $11,$0A
     313.  0C:A343  11 0A               		db $11,$0A
     314.  0C:A345  11 0A               		db $11,$0A
     315.  0C:A347  11 0A               		db $11,$0A
     316.  0C:A349  11 09               		db $11,$09
     317.  0C:A34B  11 09               		db $11,$09
     318.  0C:A34D  11 09               		db $11,$09
     319.  0C:A34F  11 09               		db $11,$09
     320.  0C:A351  11 09               		db $11,$09
     321.  0C:A353  11 09               		db $11,$09
     322.  0C:A355  11 09               		db $11,$09
     323.  0C:A357  11 09               		db $11,$09
     324.  0C:A359  11 08               		db $11,$08
     325.  0C:A35B  11 08               		db $11,$08
     326.  0C:A35D  11 08               		db $11,$08
     327.  0C:A35F  11 08               		db $11,$08
     328.  0C:A361  11 08               		db $11,$08
     329.  0C:A363  11 08               		db $11,$08
     330.  0C:A365                      .rst_i14:
     331.  0C:A365  19 08               		db $19,$08
     332.  0C:A367  65 A3               		dw .rst_i14
     333.  0C:A369                      .ins_15:						; GekipenaLead    
     334.  0C:A369  18                  		db 24					; Waveform (was 4)
     335.  0C:A36A  13 0B               		db $13,$0B
     336.  0C:A36C  11 0A               		db $11,$0A
     337.  0C:A36E  11 09               		db $11,$09
     338.  0C:A370  11 08               		db $11,$08
     339.  0C:A372  11 08               		db $11,$08
     340.  0C:A374  11 08               		db $11,$08
     341.  0C:A376  11 07               		db $11,$07
     342.  0C:A378  11 07               		db $11,$07
     343.  0C:A37A  11 07               		db $11,$07
     344.  0C:A37C  11 07               		db $11,$07
     345.  0C:A37E  11 06               		db $11,$06
     346.  0C:A380  11 06               		db $11,$06
     347.  0C:A382  11 06               		db $11,$06
     348.  0C:A384  11 06               		db $11,$06
     349.  0C:A386  11 05               		db $11,$05
     350.  0C:A388  11 05               		db $11,$05
     351.  0C:A38A  11 05               		db $11,$05
     352.  0C:A38C  11 05               		db $11,$05
     353.  0C:A38E  11 04               		db $11,$04
     354.  0C:A390  11 04               		db $11,$04
     355.  0C:A392  11 04               		db $11,$04
     356.  0C:A394  11 04               		db $11,$04
     357.  0C:A396  11 04               		db $11,$04
     358.  0C:A398  11 04               		db $11,$04
     359.  0C:A39A  11 04               		db $11,$04
     360.  0C:A39C  11 04               		db $11,$04
     361.  0C:A39E  11 04               		db $11,$04
     362.  0C:A3A0  11 04               		db $11,$04
     363.  0C:A3A2  11 04               		db $11,$04
     364.  0C:A3A4  11 04               		db $11,$04
     365.  0C:A3A6  11 04               		db $11,$04
     366.  0C:A3A8                      .rst_i15:
     367.  0C:A3A8  19 04               		db $19,$04
     368.  0C:A3AA  A8 A3               		dw .rst_i15
     369.  0C:A3AC                      .ins_16:						; GekipenaLeadEcho
     370.  0C:A3AC  18                  		db 24					; Waveform (was 4)
     371.  0C:A3AD  13 0F               		db $13,$0F
     372.  0C:A3AF                      .rst_i16:
     373.  0C:A3AF  19 0F               		db $19,$0F
     374.  0C:A3B1  AF A3               		dw .rst_i16
     375.  0C:A3B3                      
     376.  0C:A3B3                      ; [ Song track data ]
     377.  0C:A3B3                      .track_0:
     378.  0C:A3B3  13                  	db $13		;[Note] 20
     379.  0C:A3B4  6F                  	db $6F		;[Volume] 15
     380.  0C:A3B5  72                  	db $72		;[Instrument] 3
     381.  0C:A3B6  C3                  	db $C3		;[Wait] 4
     382.  0C:A3B7  19                  	db $19		;[Note] 26
     383.  0C:A3B8                      				;[Skip delay] 4
     384.  0C:A3B8  13                  	db $13		;[Note] 20
     385.  0C:A3B9                      				;[Skip delay] 4
     386.  0C:A3B9  13                  	db $13		;[Note] 20
     387.  0C:A3BA  76                  	db $76		;[Instrument] 7
     388.  0C:A3BB  C6                  	db $C6		;[Wait] 7
     389.  0C:A3BC  1A                  	db $1A		;[Note] 27
     390.  0C:A3BD  78                  	db $78		;[Instrument] 9
     391.  0C:A3BE  C0                  	db $C0		;[Wait] 1
     392.  0C:A3BF  13                  	db $13		;[Note] 20
     393.  0C:A3C0  6E                  	db $6E		;[Volume] 14
     394.  0C:A3C1  71                  	db $71		;[Instrument] 2
     395.  0C:A3C2                      				;[Skip delay] 1
     396.  0C:A3C2  6D                  	db $6D		;[Volume] 13
     397.  0C:A3C3  C2                  	db $C2		;[Wait] 3
     398.  0C:A3C4  13                  	db $13		;[Note] 20
     399.  0C:A3C5  6E                  	db $6E		;[Volume] 14
     400.  0C:A3C6  C0                  	db $C0		;[Wait] 1
     401.  0C:A3C7  6D                  	db $6D		;[Volume] 13
     402.  0C:A3C8  C2                  	db $C2		;[Wait] 3
     403.  0C:A3C9  13                  	db $13		;[Note] 20
     404.  0C:A3CA  6E                  	db $6E		;[Volume] 14
     405.  0C:A3CB  C0                  	db $C0		;[Wait] 1
     406.  0C:A3CC  6D                  	db $6D		;[Volume] 13
     407.  0C:A3CD  C2                  	db $C2		;[Wait] 3
     408.  0C:A3CE  BF                  	db $BF		;[End-Of-Track]
     409.  0C:A3CF                      .track_1:
     410.  0C:A3CF  DF                  	db $DF		;[Wait] 32
     411.  0C:A3D0  BF                  	db $BF		;[End-Of-Track]
     412.  0C:A3D1                      .track_2:
     413.  0C:A3D1  2A                  	db $2A		;[Note] 43
     414.  0C:A3D2  6E                  	db $6E		;[Volume] 14
     415.  0C:A3D3  77                  	db $77		;[Instrument] 8
     416.  0C:A3D4  A5 0E               	db $A5, $0E; slide-down
     417.  0C:A3D6  C0                  	db $C0		;[Wait] 1
     418.  0C:A3D7  A5 0E               	db $A5, $0E; slide-down
     419.  0C:A3D9                      				;[Skip delay] 1
     420.  0C:A3D9  2A                  	db $2A		;[Note] 43
     421.  0C:A3DA  A5 0F               	db $A5, $0F; slide-down
     422.  0C:A3DC                      				;[Skip delay] 1
     423.  0C:A3DC  A5 0F               	db $A5, $0F; slide-down
     424.  0C:A3DE                      				;[Skip delay] 1
     425.  0C:A3DE  28                  	db $28		;[Note] 41
     426.  0C:A3DF  6F                  	db $6F		;[Volume] 15
     427.  0C:A3E0  A5 0E               	db $A5, $0E; slide-down
     428.  0C:A3E2                      				;[Skip delay] 1
     429.  0C:A3E2  A5 0E               	db $A5, $0E; slide-down
     430.  0C:A3E4                      				;[Skip delay] 1
     431.  0C:A3E4  A5 0F               	db $A5, $0F; slide-down
     432.  0C:A3E6                      				;[Skip delay] 1
     433.  0C:A3E6  A5 0F               	db $A5, $0F; slide-down
     434.  0C:A3E8                      				;[Skip delay] 1
     435.  0C:A3E8  2A                  	db $2A		;[Note] 43
     436.  0C:A3E9  6E                  	db $6E		;[Volume] 14
     437.  0C:A3EA  A5 0E               	db $A5, $0E; slide-down
     438.  0C:A3EC                      				;[Skip delay] 1
     439.  0C:A3EC  A5 0E               	db $A5, $0E; slide-down
     440.  0C:A3EE                      				;[Skip delay] 1
     441.  0C:A3EE  A5 0F               	db $A5, $0F; slide-down
     442.  0C:A3F0                      				;[Skip delay] 1
     443.  0C:A3F0  A5 0F               	db $A5, $0F; slide-down
     444.  0C:A3F2                      				;[Skip delay] 1
     445.  0C:A3F2  24                  	db $24		;[Note] 37
     446.  0C:A3F3  6F                  	db $6F		;[Volume] 15
     447.  0C:A3F4  A5 0E               	db $A5, $0E; slide-down
     448.  0C:A3F6                      				;[Skip delay] 1
     449.  0C:A3F6  A5 0E               	db $A5, $0E; slide-down
     450.  0C:A3F8                      				;[Skip delay] 1
     451.  0C:A3F8  A5 0F               	db $A5, $0F; slide-down
     452.  0C:A3FA                      				;[Skip delay] 1
     453.  0C:A3FA  A5 0F               	db $A5, $0F; slide-down
     454.  0C:A3FC  C4                  	db $C4		;[Wait] 5
     455.  0C:A3FD  1C                  	db $1C		;[Note] 29
     456.  0C:A3FE  6A                  	db $6A		;[Volume] 10
     457.  0C:A3FF  A5 0E               	db $A5, $0E; slide-down
     458.  0C:A401  C0                  	db $C0		;[Wait] 1
     459.  0C:A402  A5 0E               	db $A5, $0E; slide-down
     460.  0C:A404                      				;[Skip delay] 1
     461.  0C:A404  A5 0F               	db $A5, $0F; slide-down
     462.  0C:A406                      				;[Skip delay] 1
     463.  0C:A406  A5 0F               	db $A5, $0F; slide-down
     464.  0C:A408                      				;[Skip delay] 1
     465.  0C:A408  1A                  	db $1A		;[Note] 27
     466.  0C:A409  A5 0E               	db $A5, $0E; slide-down
     467.  0C:A40B                      				;[Skip delay] 1
     468.  0C:A40B  A5 0E               	db $A5, $0E; slide-down
     469.  0C:A40D                      				;[Skip delay] 1
     470.  0C:A40D  A5 0F               	db $A5, $0F; slide-down
     471.  0C:A40F                      				;[Skip delay] 1
     472.  0C:A40F  A5 0F               	db $A5, $0F; slide-down
     473.  0C:A411                      				;[Skip delay] 1
     474.  0C:A411  18                  	db $18		;[Note] 25
     475.  0C:A412  A5 0E               	db $A5, $0E; slide-down
     476.  0C:A414                      				;[Skip delay] 1
     477.  0C:A414  A5 0E               	db $A5, $0E; slide-down
     478.  0C:A416                      				;[Skip delay] 1
     479.  0C:A416  A5 0F               	db $A5, $0F; slide-down
     480.  0C:A418                      				;[Skip delay] 1
     481.  0C:A418  A5 0F               	db $A5, $0F; slide-down
     482.  0C:A41A                      				;[Skip delay] 1
     483.  0C:A41A  BF                  	db $BF		;[End-Of-Track]
     484.  0C:A41B                      .track_3:
     485.  0C:A41B  0F                  	db $0F		;[Note] 16
     486.  0C:A41C  6F                  	db $6F		;[Volume] 15
     487.  0C:A41D  76                  	db $76		;[Instrument] 7
     488.  0C:A41E  94 01               	db $94, $01	; vibrato control
     489.  0C:A420  C6                  	db $C6		;[Wait] 7
     490.  0C:A421  1A                  	db $1A		;[Note] 27
     491.  0C:A422  78                  	db $78		;[Instrument] 9
     492.  0C:A423  C0                  	db $C0		;[Wait] 1
     493.  0C:A424  13                  	db $13		;[Note] 20
     494.  0C:A425  6E                  	db $6E		;[Volume] 14
     495.  0C:A426  71                  	db $71		;[Instrument] 2
     496.  0C:A427  C7                  	db $C7		;[Wait] 8
     497.  0C:A428  5A                  	db $5A		;[Note] 91
     498.  0C:A429  6F                  	db $6F		;[Volume] 15
     499.  0C:A42A  73                  	db $73		;[Instrument] 4
     500.  0C:A42B  C3                  	db $C3		;[Wait] 4
     501.  0C:A42C  0C                  	db $0C		;[Note] 13
     502.  0C:A42D  70                  	db $70		;[Instrument] 1
     503.  0C:A42E                      				;[Skip delay] 4
     504.  0C:A42E  13                  	db $13		;[Note] 20
     505.  0C:A42F  6E                  	db $6E		;[Volume] 14
     506.  0C:A430  71                  	db $71		;[Instrument] 2
     507.  0C:A431  C0                  	db $C0		;[Wait] 1
     508.  0C:A432  6D                  	db $6D		;[Volume] 13
     509.  0C:A433  C2                  	db $C2		;[Wait] 3
     510.  0C:A434  0C                  	db $0C		;[Note] 13
     511.  0C:A435  6F                  	db $6F		;[Volume] 15
     512.  0C:A436  70                  	db $70		;[Instrument] 1
     513.  0C:A437  C3                  	db $C3		;[Wait] 4
     514.  0C:A438  5A                  	db $5A		;[Note] 91
     515.  0C:A439  73                  	db $73		;[Instrument] 4
     516.  0C:A43A                      				;[Skip delay] 4
     517.  0C:A43A  0C                  	db $0C		;[Note] 13
     518.  0C:A43B  70                  	db $70		;[Instrument] 1
     519.  0C:A43C                      				;[Skip delay] 4
     520.  0C:A43C  13                  	db $13		;[Note] 20
     521.  0C:A43D  6E                  	db $6E		;[Volume] 14
     522.  0C:A43E  71                  	db $71		;[Instrument] 2
     523.  0C:A43F  C0                  	db $C0		;[Wait] 1
     524.  0C:A440  6D                  	db $6D		;[Volume] 13
     525.  0C:A441  C2                  	db $C2		;[Wait] 3
     526.  0C:A442  0C                  	db $0C		;[Note] 13
     527.  0C:A443  6F                  	db $6F		;[Volume] 15
     528.  0C:A444  70                  	db $70		;[Instrument] 1
     529.  0C:A445  C3                  	db $C3		;[Wait] 4
     530.  0C:A446  5A                  	db $5A		;[Note] 91
     531.  0C:A447  73                  	db $73		;[Instrument] 4
     532.  0C:A448                      				;[Skip delay] 4
     533.  0C:A448  0C                  	db $0C		;[Note] 13
     534.  0C:A449  70                  	db $70		;[Instrument] 1
     535.  0C:A44A                      				;[Skip delay] 4
     536.  0C:A44A  13                  	db $13		;[Note] 20
     537.  0C:A44B  6E                  	db $6E		;[Volume] 14
     538.  0C:A44C  71                  	db $71		;[Instrument] 2
     539.  0C:A44D  C0                  	db $C0		;[Wait] 1
     540.  0C:A44E  6D                  	db $6D		;[Volume] 13
     541.  0C:A44F  C2                  	db $C2		;[Wait] 3
     542.  0C:A450  5F                  	db $5F		;[Note] 96
     543.  0C:A451  6F                  	db $6F		;[Volume] 15
     544.  0C:A452  79                  	db $79		;[Instrument] 10
     545.  0C:A453  C3                  	db $C3		;[Wait] 4
     546.  0C:A454  BF                  	db $BF		;[End-Of-Track]
     547.  0C:A455                      .track_4:
     548.  0C:A455  0E                  	db $0E		;[Note] 15
     549.  0C:A456  6B                  	db $6B		;[Volume] 11
     550.  0C:A457  7B                  	db $7B		;[Instrument] 12
     551.  0C:A458  95 01               	db $95, $01	; track detune
     552.  0C:A45A  C7                  	db $C7		;[Wait] 8
     553.  0C:A45B  0E                  	db $0E		;[Note] 15
     554.  0C:A45C                      				;[Skip delay] 8
     555.  0C:A45C  0E                  	db $0E		;[Note] 15
     556.  0C:A45D  C3                  	db $C3		;[Wait] 4
     557.  0C:A45E  10                  	db $10		;[Note] 17
     558.  0C:A45F                      				;[Skip delay] 4
     559.  0C:A45F  12                  	db $12		;[Note] 19
     560.  0C:A460                      				;[Skip delay] 4
     561.  0C:A460  14                  	db $14		;[Note] 21
     562.  0C:A461  95 02               	db $95, $02	; track detune
     563.  0C:A463  C0                  	db $C0		;[Wait] 1
     564.  0C:A464  15                  	db $15		;[Note] 22
     565.  0C:A465  A6 0E               	db $A6, $0E; tone-slide
     566.  0C:A467                      				;[Skip delay] 1
     567.  0C:A467  A6 0C               	db $A6, $0C; tone-slide
     568.  0C:A469                      				;[Skip delay] 1
     569.  0C:A469  A6 0D               	db $A6, $0D; tone-slide
     570.  0C:A46B                      				;[Skip delay] 1
     571.  0C:A46B  A6 0E               	db $A6, $0E; tone-slide
     572.  0C:A46D                      				;[Skip delay] 1
     573.  0C:A46D  A6 0E               	db $A6, $0E; tone-slide
     574.  0C:A46F                      				;[Skip delay] 1
     575.  0C:A46F  B0 02               	db $B0, $02; tone-slide rep
     576.  0C:A471  C1                  	db $C1		;[Wait] 2
     577.  0C:A472  15                  	db $15		;[Note] 22
     578.  0C:A473  C7                  	db $C7		;[Wait] 8
     579.  0C:A474  15                  	db $15		;[Note] 22
     580.  0C:A475                      				;[Skip delay] 8
     581.  0C:A475  14                  	db $14		;[Note] 21
     582.  0C:A476  95 03               	db $95, $03	; track detune
     583.  0C:A478                      				;[Skip delay] 8
     584.  0C:A478  13                  	db $13		;[Note] 20
     585.  0C:A479  95 04               	db $95, $04	; track detune
     586.  0C:A47B  C3                  	db $C3		;[Wait] 4
     587.  0C:A47C  BF                  	db $BF		;[End-Of-Track]
     588.  0C:A47D                      .track_5:
     589.  0C:A47D  21                  	db $21		;[Note] 34
     590.  0C:A47E  6A                  	db $6A		;[Volume] 10
     591.  0C:A47F  7D                  	db $7D		;[Instrument] 14
     592.  0C:A480  95 09               	db $95, $09	; track detune
     593.  0C:A482  CF                  	db $CF		;[Wait] 16
     594.  0C:A483  69                  	db $69		;[Volume] 9
     595.  0C:A484  C3                  	db $C3		;[Wait] 4
     596.  0C:A485  21                  	db $21		;[Note] 34
     597.  0C:A486  6A                  	db $6A		;[Volume] 10
     598.  0C:A487  C7                  	db $C7		;[Wait] 8
     599.  0C:A488  24                  	db $24		;[Note] 37
     600.  0C:A489  95 09               	db $95, $09	; track detune
     601.  0C:A48B  CF                  	db $CF		;[Wait] 16
     602.  0C:A48C  69                  	db $69		;[Volume] 9
     603.  0C:A48D  C3                  	db $C3		;[Wait] 4
     604.  0C:A48E  24                  	db $24		;[Note] 37
     605.  0C:A48F  6A                  	db $6A		;[Volume] 10
     606.  0C:A490  CB                  	db $CB		;[Wait] 12
     607.  0C:A491  69                  	db $69		;[Volume] 9
     608.  0C:A492  C3                  	db $C3		;[Wait] 4
     609.  0C:A493  BF                  	db $BF		;[End-Of-Track]
     610.  0C:A494                      .track_6:
     611.  0C:A494  0E                  	db $0E		;[Note] 15
     612.  0C:A495  6F                  	db $6F		;[Volume] 15
     613.  0C:A496  7A                  	db $7A		;[Instrument] 11
     614.  0C:A497  95 01               	db $95, $01	; track detune
     615.  0C:A499  C7                  	db $C7		;[Wait] 8
     616.  0C:A49A  0E                  	db $0E		;[Note] 15
     617.  0C:A49B                      				;[Skip delay] 8
     618.  0C:A49B  0E                  	db $0E		;[Note] 15
     619.  0C:A49C  C3                  	db $C3		;[Wait] 4
     620.  0C:A49D  10                  	db $10		;[Note] 17
     621.  0C:A49E                      				;[Skip delay] 4
     622.  0C:A49E  12                  	db $12		;[Note] 19
     623.  0C:A49F                      				;[Skip delay] 4
     624.  0C:A49F  14                  	db $14		;[Note] 21
     625.  0C:A4A0  95 02               	db $95, $02	; track detune
     626.  0C:A4A2  C0                  	db $C0		;[Wait] 1
     627.  0C:A4A3  15                  	db $15		;[Note] 22
     628.  0C:A4A4  A6 0E               	db $A6, $0E; tone-slide
     629.  0C:A4A6                      				;[Skip delay] 1
     630.  0C:A4A6  A6 0B               	db $A6, $0B; tone-slide
     631.  0C:A4A8                      				;[Skip delay] 1
     632.  0C:A4A8  A6 0C               	db $A6, $0C; tone-slide
     633.  0C:A4AA                      				;[Skip delay] 1
     634.  0C:A4AA  A6 0D               	db $A6, $0D; tone-slide
     635.  0C:A4AC                      				;[Skip delay] 1
     636.  0C:A4AC  A6 0D               	db $A6, $0D; tone-slide
     637.  0C:A4AE                      				;[Skip delay] 1
     638.  0C:A4AE  B0 02               	db $B0, $02; tone-slide rep
     639.  0C:A4B0  C1                  	db $C1		;[Wait] 2
     640.  0C:A4B1  15                  	db $15		;[Note] 22
     641.  0C:A4B2  C7                  	db $C7		;[Wait] 8
     642.  0C:A4B3  15                  	db $15		;[Note] 22
     643.  0C:A4B4                      				;[Skip delay] 8
     644.  0C:A4B4  14                  	db $14		;[Note] 21
     645.  0C:A4B5  95 03               	db $95, $03	; track detune
     646.  0C:A4B7                      				;[Skip delay] 8
     647.  0C:A4B7  13                  	db $13		;[Note] 20
     648.  0C:A4B8  95 04               	db $95, $04	; track detune
     649.  0C:A4BA  C3                  	db $C3		;[Wait] 4
     650.  0C:A4BB  BF                  	db $BF		;[End-Of-Track]
     651.  0C:A4BC                      .track_7:
     652.  0C:A4BC  1E                  	db $1E		;[Note] 31
     653.  0C:A4BD  6F                  	db $6F		;[Volume] 15
     654.  0C:A4BE  7C                  	db $7C		;[Instrument] 13
     655.  0C:A4BF  95 07               	db $95, $07	; track detune
     656.  0C:A4C1  C7                  	db $C7		;[Wait] 8
     657.  0C:A4C2  6E                  	db $6E		;[Volume] 14
     658.  0C:A4C3                      				;[Skip delay] 8
     659.  0C:A4C3  6D                  	db $6D		;[Volume] 13
     660.  0C:A4C4  C3                  	db $C3		;[Wait] 4
     661.  0C:A4C5  1E                  	db $1E		;[Note] 31
     662.  0C:A4C6  6F                  	db $6F		;[Volume] 15
     663.  0C:A4C7  C7                  	db $C7		;[Wait] 8
     664.  0C:A4C8  1E                  	db $1E		;[Note] 31
     665.  0C:A4C9  95 07               	db $95, $07	; track detune
     666.  0C:A4CB                      				;[Skip delay] 8
     667.  0C:A4CB  6E                  	db $6E		;[Volume] 14
     668.  0C:A4CC                      				;[Skip delay] 8
     669.  0C:A4CC  6D                  	db $6D		;[Volume] 13
     670.  0C:A4CD  C3                  	db $C3		;[Wait] 4
     671.  0C:A4CE  1E                  	db $1E		;[Note] 31
     672.  0C:A4CF  6F                  	db $6F		;[Volume] 15
     673.  0C:A4D0  C7                  	db $C7		;[Wait] 8
     674.  0C:A4D1  6E                  	db $6E		;[Volume] 14
     675.  0C:A4D2                      				;[Skip delay] 8
     676.  0C:A4D2  BF                  	db $BF		;[End-Of-Track]
     677.  0C:A4D3                      .track_8:
     678.  0C:A4D3  19                  	db $19		;[Note] 26
     679.  0C:A4D4  6F                  	db $6F		;[Volume] 15
     680.  0C:A4D5  7C                  	db $7C		;[Instrument] 13
     681.  0C:A4D6  95 07               	db $95, $07	; track detune
     682.  0C:A4D8  C7                  	db $C7		;[Wait] 8
     683.  0C:A4D9  6E                  	db $6E		;[Volume] 14
     684.  0C:A4DA                      				;[Skip delay] 8
     685.  0C:A4DA  6D                  	db $6D		;[Volume] 13
     686.  0C:A4DB  C3                  	db $C3		;[Wait] 4
     687.  0C:A4DC  19                  	db $19		;[Note] 26
     688.  0C:A4DD  6F                  	db $6F		;[Volume] 15
     689.  0C:A4DE  C7                  	db $C7		;[Wait] 8
     690.  0C:A4DF  1C                  	db $1C		;[Note] 29
     691.  0C:A4E0  95 06               	db $95, $06	; track detune
     692.  0C:A4E2                      				;[Skip delay] 8
     693.  0C:A4E2  6E                  	db $6E		;[Volume] 14
     694.  0C:A4E3                      				;[Skip delay] 8
     695.  0C:A4E3  6D                  	db $6D		;[Volume] 13
     696.  0C:A4E4  C3                  	db $C3		;[Wait] 4
     697.  0C:A4E5  1B                  	db $1B		;[Note] 28
     698.  0C:A4E6  6F                  	db $6F		;[Volume] 15
     699.  0C:A4E7  95 00               	db $95, $00	; track detune
     700.  0C:A4E9  C7                  	db $C7		;[Wait] 8
     701.  0C:A4EA  6E                  	db $6E		;[Volume] 14
     702.  0C:A4EB                      				;[Skip delay] 8
     703.  0C:A4EB  BF                  	db $BF		;[End-Of-Track]
     704.  0C:A4EC                      .track_9:
     705.  0C:A4EC  35                  	db $35		;[Note] 54
     706.  0C:A4ED  6A                  	db $6A		;[Volume] 10
     707.  0C:A4EE  7E                  	db $7E		;[Instrument] 15
     708.  0C:A4EF  95 02               	db $95, $02	; track detune
     709.  0C:A4F1  C0                  	db $C0		;[Wait] 1
     710.  0C:A4F2  36                  	db $36		;[Note] 55
     711.  0C:A4F3  6B                  	db $6B		;[Volume] 11
     712.  0C:A4F4  A6 01               	db $A6, $01; tone-slide
     713.  0C:A4F6                      				;[Skip delay] 1
     714.  0C:A4F6  6C                  	db $6C		;[Volume] 12
     715.  0C:A4F7                      				;[Skip delay] 1
     716.  0C:A4F7  6D                  	db $6D		;[Volume] 13
     717.  0C:A4F8  C0                  	db $C0		;[Wait..] 1
     718.  0C:A4F9  B0 01               	db $B0, $01; tone-slide rep
     719.  0C:A4FB                      				;[Skip delay] 1
     720.  0C:A4FB  6E                  	db $6E		;[Volume] 14
     721.  0C:A4FC  95 01               	db $95, $01	; track detune
     722.  0C:A4FE                      				;[Skip delay] 1
     723.  0C:A4FE  95 01               	db $95, $01	; track detune
     724.  0C:A500                      				;[Skip delay] 1
     725.  0C:A500  B0 01               	db $B0, $01; tone-slide rep
     726.  0C:A502                      				;[Skip delay] 1
     727.  0C:A502  6F                  	db $6F		;[Volume] 15
     728.  0C:A503  C0                  	db $C0		;[Wait..] 1
     729.  0C:A504  B0 01               	db $B0, $01; tone-slide rep
     730.  0C:A506  C3                  	db $C3		;[Wait] 4
     731.  0C:A507  B0 07               	db $B0, $07; tone-slide rep
     732.  0C:A509  CA                  	db $CA		;[Wait] 11
     733.  0C:A50A  A7 74               	db $A7, $74	;[CMD vibrato]
     734.  0C:A50C  C0                  	db $C0		;[Wait] 1
     735.  0C:A50D  B1 1B               	db $B1, $1B	;[CMD vibrato] rep
     736.  0C:A50F  DA                  	db $DA		;[Wait] 27
     737.  0C:A510  3B                  	db $3B		;[Note] 60
     738.  0C:A511  6B                  	db $6B		;[Volume] 11
     739.  0C:A512  95 08               	db $95, $08	; track detune
     740.  0C:A514  C0                  	db $C0		;[Wait] 1
     741.  0C:A515  6C                  	db $6C		;[Volume] 12
     742.  0C:A516                      				;[Skip delay] 1
     743.  0C:A516  6B                  	db $6B		;[Volume] 11
     744.  0C:A517                      				;[Skip delay] 1
     745.  0C:A517  6A                  	db $6A		;[Volume] 10
     746.  0C:A518                      				;[Skip delay] 1
     747.  0C:A518  39                  	db $39		;[Note] 58
     748.  0C:A519  6B                  	db $6B		;[Volume] 11
     749.  0C:A51A                      				;[Skip delay] 1
     750.  0C:A51A  6C                  	db $6C		;[Volume] 12
     751.  0C:A51B                      				;[Skip delay] 1
     752.  0C:A51B  6B                  	db $6B		;[Volume] 11
     753.  0C:A51C                      				;[Skip delay] 1
     754.  0C:A51C  6A                  	db $6A		;[Volume] 10
     755.  0C:A51D                      				;[Skip delay] 1
     756.  0C:A51D  3B                  	db $3B		;[Note] 60
     757.  0C:A51E  6B                  	db $6B		;[Volume] 11
     758.  0C:A51F                      				;[Skip delay] 1
     759.  0C:A51F  6C                  	db $6C		;[Volume] 12
     760.  0C:A520                      				;[Skip delay] 1
     761.  0C:A520  6B                  	db $6B		;[Volume] 11
     762.  0C:A521                      				;[Skip delay] 1
     763.  0C:A521  6A                  	db $6A		;[Volume] 10
     764.  0C:A522                      				;[Skip delay] 1
     765.  0C:A522  BF                  	db $BF		;[End-Of-Track]
     766.  0C:A523                      .track_10:
     767.  0C:A523  C5                  	db $C5		;[Wait] 6
     768.  0C:A524  35                  	db $35		;[Note] 54
     769.  0C:A525  62                  	db $62		;[Volume] 2
     770.  0C:A526  7F                  	db $7F		;[Instrument] 16
     771.  0C:A527  95 02               	db $95, $02	; track detune
     772.  0C:A529  C0                  	db $C0		;[Wait] 1
     773.  0C:A52A  36                  	db $36		;[Note] 55
     774.  0C:A52B  A6 01               	db $A6, $01; tone-slide
     775.  0C:A52D                      				;[Skip delay] 1
     776.  0C:A52D  B0 12               	db $B0, $12; tone-slide rep
     777.  0C:A52F  D5                  	db $D5		;[Wait] 22
     778.  0C:A530  A7 74               	db $A7, $74	;[CMD vibrato]
     779.  0C:A532  C0                  	db $C0		;[Wait] 1
     780.  0C:A533  B1 1B               	db $B1, $1B	;[CMD vibrato] rep
     781.  0C:A535  DA                  	db $DA		;[Wait] 27
     782.  0C:A536  3B                  	db $3B		;[Note] 60
     783.  0C:A537  95 00               	db $95, $00	; track detune
     784.  0C:A539  C3                  	db $C3		;[Wait] 4
     785.  0C:A53A  39                  	db $39		;[Note] 58
     786.  0C:A53B  C1                  	db $C1		;[Wait] 2
     787.  0C:A53C  BF                  	db $BF		;[End-Of-Track]
     788.  0C:A53D                      .track_11:
     789.  0C:A53D  0C                  	db $0C		;[Note] 13
     790.  0C:A53E  6F                  	db $6F		;[Volume] 15
     791.  0C:A53F  70                  	db $70		;[Instrument] 1
     792.  0C:A540  C3                  	db $C3		;[Wait] 4
     793.  0C:A541  0C                  	db $0C		;[Note] 13
     794.  0C:A542  75                  	db $75		;[Instrument] 6
     795.  0C:A543                      				;[Skip delay] 4
     796.  0C:A543  13                  	db $13		;[Note] 20
     797.  0C:A544  6E                  	db $6E		;[Volume] 14
     798.  0C:A545  71                  	db $71		;[Instrument] 2
     799.  0C:A546  C7                  	db $C7		;[Wait] 8
     800.  0C:A547  5A                  	db $5A		;[Note] 91
     801.  0C:A548  6F                  	db $6F		;[Volume] 15
     802.  0C:A549  73                  	db $73		;[Instrument] 4
     803.  0C:A54A  C3                  	db $C3		;[Wait] 4
     804.  0C:A54B  0C                  	db $0C		;[Note] 13
     805.  0C:A54C  70                  	db $70		;[Instrument] 1
     806.  0C:A54D                      				;[Skip delay] 4
     807.  0C:A54D  13                  	db $13		;[Note] 20
     808.  0C:A54E  6E                  	db $6E		;[Volume] 14
     809.  0C:A54F  71                  	db $71		;[Instrument] 2
     810.  0C:A550                      				;[Skip delay] 4
     811.  0C:A550  0C                  	db $0C		;[Note] 13
     812.  0C:A551  6F                  	db $6F		;[Volume] 15
     813.  0C:A552  70                  	db $70		;[Instrument] 1
     814.  0C:A553                      				;[Skip delay] 4
     815.  0C:A553  5A                  	db $5A		;[Note] 91
     816.  0C:A554  73                  	db $73		;[Instrument] 4
     817.  0C:A555                      				;[Skip delay] 4
     818.  0C:A555  0C                  	db $0C		;[Note] 13
     819.  0C:A556  70                  	db $70		;[Instrument] 1
     820.  0C:A557                      				;[Skip delay] 4
     821.  0C:A557  13                  	db $13		;[Note] 20
     822.  0C:A558  6E                  	db $6E		;[Volume] 14
     823.  0C:A559  71                  	db $71		;[Instrument] 2
     824.  0C:A55A                      				;[Skip delay] 4
     825.  0C:A55A  0C                  	db $0C		;[Note] 13
     826.  0C:A55B  6F                  	db $6F		;[Volume] 15
     827.  0C:A55C  70                  	db $70		;[Instrument] 1
     828.  0C:A55D                      				;[Skip delay] 4
     829.  0C:A55D  5A                  	db $5A		;[Note] 91
     830.  0C:A55E  73                  	db $73		;[Instrument] 4
     831.  0C:A55F                      				;[Skip delay] 4
     832.  0C:A55F  0C                  	db $0C		;[Note] 13
     833.  0C:A560  70                  	db $70		;[Instrument] 1
     834.  0C:A561                      				;[Skip delay] 4
     835.  0C:A561  13                  	db $13		;[Note] 20
     836.  0C:A562  6E                  	db $6E		;[Volume] 14
     837.  0C:A563  71                  	db $71		;[Instrument] 2
     838.  0C:A564  C0                  	db $C0		;[Wait] 1
     839.  0C:A565  6D                  	db $6D		;[Volume] 13
     840.  0C:A566  C2                  	db $C2		;[Wait] 3
     841.  0C:A567  5F                  	db $5F		;[Note] 96
     842.  0C:A568  6F                  	db $6F		;[Volume] 15
     843.  0C:A569  79                  	db $79		;[Instrument] 10
     844.  0C:A56A  C3                  	db $C3		;[Wait] 4
     845.  0C:A56B  BF                  	db $BF		;[End-Of-Track]
     846.  0C:A56C                      .track_12:
     847.  0C:A56C  94 01               	db $94, $01	; vibrato control
     848.  0C:A56E  C7                  	db $C7		;[Wait] 8
     849.  0C:A56F  13                  	db $13		;[Note] 20
     850.  0C:A570  6B                  	db $6B		;[Volume] 11
     851.  0C:A571  7B                  	db $7B		;[Instrument] 12
     852.  0C:A572  95 04               	db $95, $04	; track detune
     853.  0C:A574                      				;[Skip delay] 8
     854.  0C:A574  13                  	db $13		;[Note] 20
     855.  0C:A575  C3                  	db $C3		;[Wait] 4
     856.  0C:A576  0E                  	db $0E		;[Note] 15
     857.  0C:A577  95 01               	db $95, $01	; track detune
     858.  0C:A579                      				;[Skip delay] 4
     859.  0C:A579  0D                  	db $0D		;[Note] 14
     860.  0C:A57A  95 02               	db $95, $02	; track detune
     861.  0C:A57C                      				;[Skip delay] 4
     862.  0C:A57C  0C                  	db $0C		;[Note] 13
     863.  0C:A57D  CB                  	db $CB		;[Wait] 12
     864.  0C:A57E  0C                  	db $0C		;[Note] 13
     865.  0C:A57F  C7                  	db $C7		;[Wait] 8
     866.  0C:A580  0C                  	db $0C		;[Note] 13
     867.  0C:A581  C3                  	db $C3		;[Wait] 4
     868.  0C:A582  0E                  	db $0E		;[Note] 15
     869.  0C:A583  95 01               	db $95, $01	; track detune
     870.  0C:A585                      				;[Skip delay] 4
     871.  0C:A585  10                  	db $10		;[Note] 17
     872.  0C:A586  95 07               	db $95, $07	; track detune
     873.  0C:A588                      				;[Skip delay] 4
     874.  0C:A588  12                  	db $12		;[Note] 19
     875.  0C:A589  95 07               	db $95, $07	; track detune
     876.  0C:A58B  C0                  	db $C0		;[Wait] 1
     877.  0C:A58C  A5 01               	db $A5, $01; slide-down
     878.  0C:A58E  C2                  	db $C2		;[Wait] 3
     879.  0C:A58F  BF                  	db $BF		;[End-Of-Track]
     880.  0C:A590                      .track_13:
     881.  0C:A590  23                  	db $23		;[Note] 36
     882.  0C:A591  6A                  	db $6A		;[Volume] 10
     883.  0C:A592  7D                  	db $7D		;[Instrument] 14
     884.  0C:A593  95 09               	db $95, $09	; track detune
     885.  0C:A595  DF                  	db $DF		;[Wait] 32
     886.  0C:A596  1F                  	db $1F		;[Note] 32
     887.  0C:A597  95 03               	db $95, $03	; track detune
     888.  0C:A599                      				;[Skip delay] 32
     889.  0C:A599  BF                  	db $BF		;[End-Of-Track]
     890.  0C:A59A                      .track_14:
     891.  0C:A59A  C7                  	db $C7		;[Wait] 8
     892.  0C:A59B  13                  	db $13		;[Note] 20
     893.  0C:A59C  6F                  	db $6F		;[Volume] 15
     894.  0C:A59D  7A                  	db $7A		;[Instrument] 11
     895.  0C:A59E  95 04               	db $95, $04	; track detune
     896.  0C:A5A0                      				;[Skip delay] 8
     897.  0C:A5A0  13                  	db $13		;[Note] 20
     898.  0C:A5A1  C3                  	db $C3		;[Wait] 4
     899.  0C:A5A2  0E                  	db $0E		;[Note] 15
     900.  0C:A5A3  95 01               	db $95, $01	; track detune
     901.  0C:A5A5                      				;[Skip delay] 4
     902.  0C:A5A5  0D                  	db $0D		;[Note] 14
     903.  0C:A5A6  95 02               	db $95, $02	; track detune
     904.  0C:A5A8                      				;[Skip delay] 4
     905.  0C:A5A8  0C                  	db $0C		;[Note] 13
     906.  0C:A5A9  95 02               	db $95, $02	; track detune
     907.  0C:A5AB  CB                  	db $CB		;[Wait] 12
     908.  0C:A5AC  0C                  	db $0C		;[Note] 13
     909.  0C:A5AD  C7                  	db $C7		;[Wait] 8
     910.  0C:A5AE  0C                  	db $0C		;[Note] 13
     911.  0C:A5AF  C3                  	db $C3		;[Wait] 4
     912.  0C:A5B0  0E                  	db $0E		;[Note] 15
     913.  0C:A5B1  95 01               	db $95, $01	; track detune
     914.  0C:A5B3                      				;[Skip delay] 4
     915.  0C:A5B3  10                  	db $10		;[Note] 17
     916.  0C:A5B4  95 07               	db $95, $07	; track detune
     917.  0C:A5B6                      				;[Skip delay] 4
     918.  0C:A5B6  12                  	db $12		;[Note] 19
     919.  0C:A5B7  95 07               	db $95, $07	; track detune
     920.  0C:A5B9  C0                  	db $C0		;[Wait] 1
     921.  0C:A5BA  A5 01               	db $A5, $01; slide-down
     922.  0C:A5BC  C2                  	db $C2		;[Wait] 3
     923.  0C:A5BD  BF                  	db $BF		;[End-Of-Track]
     924.  0C:A5BE                      .track_15:
     925.  0C:A5BE  1E                  	db $1E		;[Note] 31
     926.  0C:A5BF  6F                  	db $6F		;[Volume] 15
     927.  0C:A5C0  7C                  	db $7C		;[Instrument] 13
     928.  0C:A5C1  95 07               	db $95, $07	; track detune
     929.  0C:A5C3  C7                  	db $C7		;[Wait] 8
     930.  0C:A5C4  6E                  	db $6E		;[Volume] 14
     931.  0C:A5C5                      				;[Skip delay] 8
     932.  0C:A5C5  6D                  	db $6D		;[Volume] 13
     933.  0C:A5C6  CF                  	db $CF		;[Wait] 16
     934.  0C:A5C7  1C                  	db $1C		;[Note] 29
     935.  0C:A5C8  6F                  	db $6F		;[Volume] 15
     936.  0C:A5C9  95 05               	db $95, $05	; track detune
     937.  0C:A5CB  C7                  	db $C7		;[Wait] 8
     938.  0C:A5CC  6E                  	db $6E		;[Volume] 14
     939.  0C:A5CD                      				;[Skip delay] 8
     940.  0C:A5CD  6D                  	db $6D		;[Volume] 13
     941.  0C:A5CE  CF                  	db $CF		;[Wait] 16
     942.  0C:A5CF  BF                  	db $BF		;[End-Of-Track]
     943.  0C:A5D0                      .track_16:
     944.  0C:A5D0  1A                  	db $1A		;[Note] 27
     945.  0C:A5D1  6F                  	db $6F		;[Volume] 15
     946.  0C:A5D2  7C                  	db $7C		;[Instrument] 13
     947.  0C:A5D3  95 06               	db $95, $06	; track detune
     948.  0C:A5D5  C7                  	db $C7		;[Wait] 8
     949.  0C:A5D6  6E                  	db $6E		;[Volume] 14
     950.  0C:A5D7                      				;[Skip delay] 8
     951.  0C:A5D7  6D                  	db $6D		;[Volume] 13
     952.  0C:A5D8  CF                  	db $CF		;[Wait] 16
     953.  0C:A5D9  16                  	db $16		;[Note] 23
     954.  0C:A5DA  6F                  	db $6F		;[Volume] 15
     955.  0C:A5DB  95 07               	db $95, $07	; track detune
     956.  0C:A5DD  C7                  	db $C7		;[Wait] 8
     957.  0C:A5DE  6E                  	db $6E		;[Volume] 14
     958.  0C:A5DF                      				;[Skip delay] 8
     959.  0C:A5DF  6D                  	db $6D		;[Volume] 13
     960.  0C:A5E0  CF                  	db $CF		;[Wait] 16
     961.  0C:A5E1  BF                  	db $BF		;[End-Of-Track]
     962.  0C:A5E2                      .track_17:
     963.  0C:A5E2  32                  	db $32		;[Note] 51
     964.  0C:A5E3  6B                  	db $6B		;[Volume] 11
     965.  0C:A5E4  7E                  	db $7E		;[Instrument] 15
     966.  0C:A5E5  95 00               	db $95, $00	; track detune
     967.  0C:A5E7  C0                  	db $C0		;[Wait] 1
     968.  0C:A5E8  6C                  	db $6C		;[Volume] 12
     969.  0C:A5E9                      				;[Skip delay] 1
     970.  0C:A5E9  6B                  	db $6B		;[Volume] 11
     971.  0C:A5EA                      				;[Skip delay] 1
     972.  0C:A5EA  6C                  	db $6C		;[Volume] 12
     973.  0C:A5EB                      				;[Skip delay] 1
     974.  0C:A5EB  6D                  	db $6D		;[Volume] 13
     975.  0C:A5EC                      				;[Skip delay] 1
     976.  0C:A5EC  6E                  	db $6E		;[Volume] 14
     977.  0C:A5ED  C2                  	db $C2		;[Wait] 3
     978.  0C:A5EE  6D                  	db $6D		;[Volume] 13
     979.  0C:A5EF  A7 74               	db $A7, $74	;[CMD vibrato]
     980.  0C:A5F1  C0                  	db $C0		;[Wait] 1
     981.  0C:A5F2  B1 0B               	db $B1, $0B	;[CMD vibrato] rep
     982.  0C:A5F4  CA                  	db $CA		;[Wait] 11
     983.  0C:A5F5  32                  	db $32		;[Note] 51
     984.  0C:A5F6  6B                  	db $6B		;[Volume] 11
     985.  0C:A5F7  C0                  	db $C0		;[Wait] 1
     986.  0C:A5F8  6C                  	db $6C		;[Volume] 12
     987.  0C:A5F9                      				;[Skip delay] 1
     988.  0C:A5F9  6B                  	db $6B		;[Volume] 11
     989.  0C:A5FA                      				;[Skip delay] 1
     990.  0C:A5FA  6A                  	db $6A		;[Volume] 10
     991.  0C:A5FB                      				;[Skip delay] 1
     992.  0C:A5FB  34                  	db $34		;[Note] 53
     993.  0C:A5FC  6B                  	db $6B		;[Volume] 11
     994.  0C:A5FD                      				;[Skip delay] 1
     995.  0C:A5FD  6C                  	db $6C		;[Volume] 12
     996.  0C:A5FE                      				;[Skip delay] 1
     997.  0C:A5FE  6B                  	db $6B		;[Volume] 11
     998.  0C:A5FF                      				;[Skip delay] 1
     999.  0C:A5FF  6A                  	db $6A		;[Volume] 10
    1000.  0C:A600                      				;[Skip delay] 1
    1001.  0C:A600  32                  	db $32		;[Note] 51
    1002.  0C:A601  6B                  	db $6B		;[Volume] 11
    1003.  0C:A602                      				;[Skip delay] 1
    1004.  0C:A602  6C                  	db $6C		;[Volume] 12
    1005.  0C:A603                      				;[Skip delay] 1
    1006.  0C:A603  6B                  	db $6B		;[Volume] 11
    1007.  0C:A604                      				;[Skip delay] 1
    1008.  0C:A604  6A                  	db $6A		;[Volume] 10
    1009.  0C:A605                      				;[Skip delay] 1
    1010.  0C:A605  37                  	db $37		;[Note] 56
    1011.  0C:A606  6B                  	db $6B		;[Volume] 11
    1012.  0C:A607  95 08               	db $95, $08	; track detune
    1013.  0C:A609                      				;[Skip delay] 1
    1014.  0C:A609  39                  	db $39		;[Note] 58
    1015.  0C:A60A  6C                  	db $6C		;[Volume] 12
    1016.  0C:A60B  A6 06               	db $A6, $06; tone-slide
    1017.  0C:A60D                      				;[Skip delay] 1
    1018.  0C:A60D  A6 05               	db $A6, $05; tone-slide
    1019.  0C:A60F                      				;[Skip delay] 1
    1020.  0C:A60F  A6 06               	db $A6, $06; tone-slide
    1021.  0C:A611                      				;[Skip delay] 1
    1022.  0C:A611  A6 07               	db $A6, $07; tone-slide
    1023.  0C:A613                      				;[Skip delay] 1
    1024.  0C:A613  B0 03               	db $B0, $03; tone-slide rep
    1025.  0C:A615  C2                  	db $C2		;[Wait] 3
    1026.  0C:A616  37                  	db $37		;[Note] 56
    1027.  0C:A617  6B                  	db $6B		;[Volume] 11
    1028.  0C:A618  95 00               	db $95, $00	; track detune
    1029.  0C:A61A  C0                  	db $C0		;[Wait] 1
    1030.  0C:A61B  6C                  	db $6C		;[Volume] 12
    1031.  0C:A61C                      				;[Skip delay] 1
    1032.  0C:A61C  6B                  	db $6B		;[Volume] 11
    1033.  0C:A61D                      				;[Skip delay] 1
    1034.  0C:A61D  6C                  	db $6C		;[Volume] 12
    1035.  0C:A61E  C4                  	db $C4		;[Wait] 5
    1036.  0C:A61F  32                  	db $32		;[Note] 51
    1037.  0C:A620  6B                  	db $6B		;[Volume] 11
    1038.  0C:A621  95 00               	db $95, $00	; track detune
    1039.  0C:A623  C0                  	db $C0		;[Wait] 1
    1040.  0C:A624  6C                  	db $6C		;[Volume] 12
    1041.  0C:A625                      				;[Skip delay] 1
    1042.  0C:A625  6B                  	db $6B		;[Volume] 11
    1043.  0C:A626                      				;[Skip delay] 1
    1044.  0C:A626  6C                  	db $6C		;[Volume] 12
    1045.  0C:A627  C4                  	db $C4		;[Wait] 5
    1046.  0C:A628  2E                  	db $2E		;[Note] 47
    1047.  0C:A629  6B                  	db $6B		;[Volume] 11
    1048.  0C:A62A  95 02               	db $95, $02	; track detune
    1049.  0C:A62C  C0                  	db $C0		;[Wait] 1
    1050.  0C:A62D  6C                  	db $6C		;[Volume] 12
    1051.  0C:A62E                      				;[Skip delay] 1
    1052.  0C:A62E  6B                  	db $6B		;[Volume] 11
    1053.  0C:A62F                      				;[Skip delay] 1
    1054.  0C:A62F  6C                  	db $6C		;[Volume] 12
    1055.  0C:A630  C4                  	db $C4		;[Wait] 5
    1056.  0C:A631  BF                  	db $BF		;[End-Of-Track]
    1057.  0C:A632                      .track_18:
    1058.  0C:A632  C1                  	db $C1		;[Wait] 2
    1059.  0C:A633  3B                  	db $3B		;[Note] 60
    1060.  0C:A634  62                  	db $62		;[Volume] 2
    1061.  0C:A635  7F                  	db $7F		;[Instrument] 16
    1062.  0C:A636  95 00               	db $95, $00	; track detune
    1063.  0C:A638  C3                  	db $C3		;[Wait] 4
    1064.  0C:A639  32                  	db $32		;[Note] 51
    1065.  0C:A63A  95 01               	db $95, $01	; track detune
    1066.  0C:A63C  C7                  	db $C7		;[Wait] 8
    1067.  0C:A63D  A7 74               	db $A7, $74	;[CMD vibrato]
    1068.  0C:A63F  C0                  	db $C0		;[Wait] 1
    1069.  0C:A640  B1 0B               	db $B1, $0B	;[CMD vibrato] rep
    1070.  0C:A642                      				;[Skip delay] 1
    1071.  0C:A642  61                  	db $61		;[Volume] 1
    1072.  0C:A643  C9                  	db $C9		;[Wait] 10
    1073.  0C:A644  32                  	db $32		;[Note] 51
    1074.  0C:A645  62                  	db $62		;[Volume] 2
    1075.  0C:A646  C3                  	db $C3		;[Wait] 4
    1076.  0C:A647  34                  	db $34		;[Note] 53
    1077.  0C:A648                      				;[Skip delay] 4
    1078.  0C:A648  32                  	db $32		;[Note] 51
    1079.  0C:A649                      				;[Skip delay] 4
    1080.  0C:A649  37                  	db $37		;[Note] 56
    1081.  0C:A64A  95 00               	db $95, $00	; track detune
    1082.  0C:A64C  C0                  	db $C0		;[Wait] 1
    1083.  0C:A64D  39                  	db $39		;[Note] 58
    1084.  0C:A64E  A6 06               	db $A6, $06; tone-slide
    1085.  0C:A650                      				;[Skip delay] 1
    1086.  0C:A650  A6 05               	db $A6, $05; tone-slide
    1087.  0C:A652                      				;[Skip delay] 1
    1088.  0C:A652  A6 06               	db $A6, $06; tone-slide
    1089.  0C:A654                      				;[Skip delay] 1
    1090.  0C:A654  A6 07               	db $A6, $07; tone-slide
    1091.  0C:A656                      				;[Skip delay] 1
    1092.  0C:A656  B0 03               	db $B0, $03; tone-slide rep
    1093.  0C:A658  C2                  	db $C2		;[Wait] 3
    1094.  0C:A659  37                  	db $37		;[Note] 56
    1095.  0C:A65A  95 01               	db $95, $01	; track detune
    1096.  0C:A65C  C7                  	db $C7		;[Wait] 8
    1097.  0C:A65D  32                  	db $32		;[Note] 51
    1098.  0C:A65E  95 01               	db $95, $01	; track detune
    1099.  0C:A660                      				;[Skip delay] 8
    1100.  0C:A660  2E                  	db $2E		;[Note] 47
    1101.  0C:A661  95 03               	db $95, $03	; track detune
    1102.  0C:A663  C1                  	db $C1		;[Wait] 2
    1103.  0C:A664  BF                  	db $BF		;[End-Of-Track]
    1104.  0C:A665                      .track_19:
    1105.  0C:A665  C7                  	db $C7		;[Wait] 8
    1106.  0C:A666  12                  	db $12		;[Note] 19
    1107.  0C:A667  6B                  	db $6B		;[Volume] 11
    1108.  0C:A668  7B                  	db $7B		;[Instrument] 12
    1109.  0C:A669  95 07               	db $95, $07	; track detune
    1110.  0C:A66B  C0                  	db $C0		;[Wait] 1
    1111.  0C:A66C  A5 01               	db $A5, $01; slide-down
    1112.  0C:A66E  C6                  	db $C6		;[Wait] 7
    1113.  0C:A66F  10                  	db $10		;[Note] 17
    1114.  0C:A670  95 02               	db $95, $02	; track detune
    1115.  0C:A672  C3                  	db $C3		;[Wait] 4
    1116.  0C:A673  12                  	db $12		;[Note] 19
    1117.  0C:A674  95 07               	db $95, $07	; track detune
    1118.  0C:A676  C0                  	db $C0		;[Wait] 1
    1119.  0C:A677  A5 01               	db $A5, $01; slide-down
    1120.  0C:A679  C6                  	db $C6		;[Wait] 7
    1121.  0C:A67A  0B                  	db $0B		;[Note] 12
    1122.  0C:A67B  95 06               	db $95, $06	; track detune
    1123.  0C:A67D  C7                  	db $C7		;[Wait] 8
    1124.  0C:A67E  17                  	db $17		;[Note] 24
    1125.  0C:A67F  C3                  	db $C3		;[Wait] 4
    1126.  0C:A680  0B                  	db $0B		;[Note] 12
    1127.  0C:A681                      				;[Skip delay] 4
    1128.  0C:A681  19                  	db $19		;[Note] 26
    1129.  0C:A682                      				;[Skip delay] 4
    1130.  0C:A682  0E                  	db $0E		;[Note] 15
    1131.  0C:A683  95 03               	db $95, $03	; track detune
    1132.  0C:A685                      				;[Skip delay] 4
    1133.  0C:A685  1B                  	db $1B		;[Note] 28
    1134.  0C:A686  95 01               	db $95, $01	; track detune
    1135.  0C:A688                      				;[Skip delay] 4
    1136.  0C:A688  12                  	db $12		;[Note] 19
    1137.  0C:A689  95 07               	db $95, $07	; track detune
    1138.  0C:A68B  C0                  	db $C0		;[Wait] 1
    1139.  0C:A68C  A5 01               	db $A5, $01; slide-down
    1140.  0C:A68E  C2                  	db $C2		;[Wait] 3
    1141.  0C:A68F  10                  	db $10		;[Note] 17
    1142.  0C:A690  95 07               	db $95, $07	; track detune
    1143.  0C:A692  C3                  	db $C3		;[Wait] 4
    1144.  0C:A693  BF                  	db $BF		;[End-Of-Track]
    1145.  0C:A694                      .track_20:
    1146.  0C:A694  21                  	db $21		;[Note] 34
    1147.  0C:A695  6A                  	db $6A		;[Volume] 10
    1148.  0C:A696  7D                  	db $7D		;[Instrument] 14
    1149.  0C:A697  95 09               	db $95, $09	; track detune
    1150.  0C:A699  DB                  	db $DB		;[Wait] 28
    1151.  0C:A69A  21                  	db $21		;[Note] 34
    1152.  0C:A69B  95 09               	db $95, $09	; track detune
    1153.  0C:A69D  D3                  	db $D3		;[Wait] 20
    1154.  0C:A69E  21                  	db $21		;[Note] 34
    1155.  0C:A69F  95 09               	db $95, $09	; track detune
    1156.  0C:A6A1  CF                  	db $CF		;[Wait] 16
    1157.  0C:A6A2  BF                  	db $BF		;[End-Of-Track]
    1158.  0C:A6A3                      .track_21:
    1159.  0C:A6A3  C7                  	db $C7		;[Wait] 8
    1160.  0C:A6A4  12                  	db $12		;[Note] 19
    1161.  0C:A6A5  6F                  	db $6F		;[Volume] 15
    1162.  0C:A6A6  7A                  	db $7A		;[Instrument] 11
    1163.  0C:A6A7  95 07               	db $95, $07	; track detune
    1164.  0C:A6A9  C0                  	db $C0		;[Wait] 1
    1165.  0C:A6AA  A5 01               	db $A5, $01; slide-down
    1166.  0C:A6AC  C6                  	db $C6		;[Wait] 7
    1167.  0C:A6AD  10                  	db $10		;[Note] 17
    1168.  0C:A6AE  95 02               	db $95, $02	; track detune
    1169.  0C:A6B0  C3                  	db $C3		;[Wait] 4
    1170.  0C:A6B1  12                  	db $12		;[Note] 19
    1171.  0C:A6B2  95 07               	db $95, $07	; track detune
    1172.  0C:A6B4  C0                  	db $C0		;[Wait] 1
    1173.  0C:A6B5  A5 01               	db $A5, $01; slide-down
    1174.  0C:A6B7  C6                  	db $C6		;[Wait] 7
    1175.  0C:A6B8  0B                  	db $0B		;[Note] 12
    1176.  0C:A6B9  95 06               	db $95, $06	; track detune
    1177.  0C:A6BB  C7                  	db $C7		;[Wait] 8
    1178.  0C:A6BC  17                  	db $17		;[Note] 24
    1179.  0C:A6BD  95 06               	db $95, $06	; track detune
    1180.  0C:A6BF  C3                  	db $C3		;[Wait] 4
    1181.  0C:A6C0  0B                  	db $0B		;[Note] 12
    1182.  0C:A6C1                      				;[Skip delay] 4
    1183.  0C:A6C1  19                  	db $19		;[Note] 26
    1184.  0C:A6C2                      				;[Skip delay] 4
    1185.  0C:A6C2  0E                  	db $0E		;[Note] 15
    1186.  0C:A6C3  6E                  	db $6E		;[Volume] 14
    1187.  0C:A6C4  95 03               	db $95, $03	; track detune
    1188.  0C:A6C6                      				;[Skip delay] 4
    1189.  0C:A6C6  1B                  	db $1B		;[Note] 28
    1190.  0C:A6C7  95 01               	db $95, $01	; track detune
    1191.  0C:A6C9                      				;[Skip delay] 4
    1192.  0C:A6C9  12                  	db $12		;[Note] 19
    1193.  0C:A6CA  95 07               	db $95, $07	; track detune
    1194.  0C:A6CC  C0                  	db $C0		;[Wait] 1
    1195.  0C:A6CD  A5 01               	db $A5, $01; slide-down
    1196.  0C:A6CF  C2                  	db $C2		;[Wait] 3
    1197.  0C:A6D0  10                  	db $10		;[Note] 17
    1198.  0C:A6D1  95 07               	db $95, $07	; track detune
    1199.  0C:A6D3  C3                  	db $C3		;[Wait] 4
    1200.  0C:A6D4  BF                  	db $BF		;[End-Of-Track]
    1201.  0C:A6D5                      .track_22:
    1202.  0C:A6D5  1C                  	db $1C		;[Note] 29
    1203.  0C:A6D6  6F                  	db $6F		;[Volume] 15
    1204.  0C:A6D7  7C                  	db $7C		;[Instrument] 13
    1205.  0C:A6D8  95 05               	db $95, $05	; track detune
    1206.  0C:A6DA  C7                  	db $C7		;[Wait] 8
    1207.  0C:A6DB  6E                  	db $6E		;[Volume] 14
    1208.  0C:A6DC  D3                  	db $D3		;[Wait] 20
    1209.  0C:A6DD  1E                  	db $1E		;[Note] 31
    1210.  0C:A6DE  6F                  	db $6F		;[Volume] 15
    1211.  0C:A6DF  95 07               	db $95, $07	; track detune
    1212.  0C:A6E1  C7                  	db $C7		;[Wait] 8
    1213.  0C:A6E2  6E                  	db $6E		;[Volume] 14
    1214.  0C:A6E3  CB                  	db $CB		;[Wait] 12
    1215.  0C:A6E4  1E                  	db $1E		;[Note] 31
    1216.  0C:A6E5  6F                  	db $6F		;[Volume] 15
    1217.  0C:A6E6  95 07               	db $95, $07	; track detune
    1218.  0C:A6E8  C7                  	db $C7		;[Wait] 8
    1219.  0C:A6E9  6E                  	db $6E		;[Volume] 14
    1220.  0C:A6EA                      				;[Skip delay] 8
    1221.  0C:A6EA  BF                  	db $BF		;[End-Of-Track]
    1222.  0C:A6EB                      .track_23:
    1223.  0C:A6EB  19                  	db $19		;[Note] 26
    1224.  0C:A6EC  6F                  	db $6F		;[Volume] 15
    1225.  0C:A6ED  7C                  	db $7C		;[Instrument] 13
    1226.  0C:A6EE  95 07               	db $95, $07	; track detune
    1227.  0C:A6F0  C7                  	db $C7		;[Wait] 8
    1228.  0C:A6F1  6E                  	db $6E		;[Volume] 14
    1229.  0C:A6F2  D3                  	db $D3		;[Wait] 20
    1230.  0C:A6F3  1A                  	db $1A		;[Note] 27
    1231.  0C:A6F4  6F                  	db $6F		;[Volume] 15
    1232.  0C:A6F5  95 05               	db $95, $05	; track detune
    1233.  0C:A6F7  C7                  	db $C7		;[Wait] 8
    1234.  0C:A6F8  6E                  	db $6E		;[Volume] 14
    1235.  0C:A6F9  CB                  	db $CB		;[Wait] 12
    1236.  0C:A6FA  17                  	db $17		;[Note] 24
    1237.  0C:A6FB  6F                  	db $6F		;[Volume] 15
    1238.  0C:A6FC  95 05               	db $95, $05	; track detune
    1239.  0C:A6FE  C7                  	db $C7		;[Wait] 8
    1240.  0C:A6FF  6E                  	db $6E		;[Volume] 14
    1241.  0C:A700                      				;[Skip delay] 8
    1242.  0C:A700  BF                  	db $BF		;[End-Of-Track]
    1243.  0C:A701                      .track_24:
    1244.  0C:A701  2D                  	db $2D		;[Note] 46
    1245.  0C:A702  6B                  	db $6B		;[Volume] 11
    1246.  0C:A703  7E                  	db $7E		;[Instrument] 15
    1247.  0C:A704  95 00               	db $95, $00	; track detune
    1248.  0C:A706  C0                  	db $C0		;[Wait] 1
    1249.  0C:A707  6C                  	db $6C		;[Volume] 12
    1250.  0C:A708                      				;[Skip delay] 1
    1251.  0C:A708  6B                  	db $6B		;[Volume] 11
    1252.  0C:A709                      				;[Skip delay] 1
    1253.  0C:A709  6A                  	db $6A		;[Volume] 10
    1254.  0C:A70A                      				;[Skip delay] 1
    1255.  0C:A70A  31                  	db $31		;[Note] 50
    1256.  0C:A70B  6B                  	db $6B		;[Volume] 11
    1257.  0C:A70C  95 08               	db $95, $08	; track detune
    1258.  0C:A70E                      				;[Skip delay] 1
    1259.  0C:A70E  6C                  	db $6C		;[Volume] 12
    1260.  0C:A70F                      				;[Skip delay] 1
    1261.  0C:A70F  6B                  	db $6B		;[Volume] 11
    1262.  0C:A710                      				;[Skip delay] 1
    1263.  0C:A710  6A                  	db $6A		;[Volume] 10
    1264.  0C:A711                      				;[Skip delay] 1
    1265.  0C:A711  36                  	db $36		;[Note] 55
    1266.  0C:A712  6B                  	db $6B		;[Volume] 11
    1267.  0C:A713  95 01               	db $95, $01	; track detune
    1268.  0C:A715                      				;[Skip delay] 1
    1269.  0C:A715  6C                  	db $6C		;[Volume] 12
    1270.  0C:A716                      				;[Skip delay] 1
    1271.  0C:A716  6B                  	db $6B		;[Volume] 11
    1272.  0C:A717                      				;[Skip delay] 1
    1273.  0C:A717  6A                  	db $6A		;[Volume] 10
    1274.  0C:A718                      				;[Skip delay] 1
    1275.  0C:A718  34                  	db $34		;[Note] 53
    1276.  0C:A719  6B                  	db $6B		;[Volume] 11
    1277.  0C:A71A  95 00               	db $95, $00	; track detune
    1278.  0C:A71C                      				;[Skip delay] 1
    1279.  0C:A71C  6C                  	db $6C		;[Volume] 12
    1280.  0C:A71D  C1                  	db $C1		;[Wait] 2
    1281.  0C:A71E  6B                  	db $6B		;[Volume] 11
    1282.  0C:A71F  C4                  	db $C4		;[Wait] 5
    1283.  0C:A720  32                  	db $32		;[Note] 51
    1284.  0C:A721  95 00               	db $95, $00	; track detune
    1285.  0C:A723  C0                  	db $C0		;[Wait] 1
    1286.  0C:A724  6C                  	db $6C		;[Volume] 12
    1287.  0C:A725  C1                  	db $C1		;[Wait] 2
    1288.  0C:A726  6B                  	db $6B		;[Volume] 11
    1289.  0C:A727  C4                  	db $C4		;[Wait] 5
    1290.  0C:A728  31                  	db $31		;[Note] 50
    1291.  0C:A729  95 08               	db $95, $08	; track detune
    1292.  0C:A72B  C0                  	db $C0		;[Wait] 1
    1293.  0C:A72C  6C                  	db $6C		;[Volume] 12
    1294.  0C:A72D  C1                  	db $C1		;[Wait] 2
    1295.  0C:A72E  6B                  	db $6B		;[Volume] 11
    1296.  0C:A72F  C4                  	db $C4		;[Wait] 5
    1297.  0C:A730  32                  	db $32		;[Note] 51
    1298.  0C:A731  95 00               	db $95, $00	; track detune
    1299.  0C:A733  C0                  	db $C0		;[Wait] 1
    1300.  0C:A734  6C                  	db $6C		;[Volume] 12
    1301.  0C:A735  C1                  	db $C1		;[Wait] 2
    1302.  0C:A736  6B                  	db $6B		;[Volume] 11
    1303.  0C:A737  C4                  	db $C4		;[Wait] 5
    1304.  0C:A738  2F                  	db $2F		;[Note] 48
    1305.  0C:A739  C0                  	db $C0		;[Wait] 1
    1306.  0C:A73A  6C                  	db $6C		;[Volume] 12
    1307.  0C:A73B  C1                  	db $C1		;[Wait] 2
    1308.  0C:A73C  6B                  	db $6B		;[Volume] 11
    1309.  0C:A73D  C4                  	db $C4		;[Wait] 5
    1310.  0C:A73E  31                  	db $31		;[Note] 50
    1311.  0C:A73F  95 08               	db $95, $08	; track detune
    1312.  0C:A741  C0                  	db $C0		;[Wait] 1
    1313.  0C:A742  6C                  	db $6C		;[Volume] 12
    1314.  0C:A743                      				;[Skip delay] 1
    1315.  0C:A743  6B                  	db $6B		;[Volume] 11
    1316.  0C:A744  C1                  	db $C1		;[Wait] 2
    1317.  0C:A745  32                  	db $32		;[Note] 51
    1318.  0C:A746  95 00               	db $95, $00	; track detune
    1319.  0C:A748  C0                  	db $C0		;[Wait] 1
    1320.  0C:A749  6C                  	db $6C		;[Volume] 12
    1321.  0C:A74A                      				;[Skip delay] 1
    1322.  0C:A74A  6B                  	db $6B		;[Volume] 11
    1323.  0C:A74B  C1                  	db $C1		;[Wait] 2
    1324.  0C:A74C  34                  	db $34		;[Note] 53
    1325.  0C:A74D  95 00               	db $95, $00	; track detune
    1326.  0C:A74F  C0                  	db $C0		;[Wait] 1
    1327.  0C:A750  6C                  	db $6C		;[Volume] 12
    1328.  0C:A751                      				;[Skip delay] 1
    1329.  0C:A751  6B                  	db $6B		;[Volume] 11
    1330.  0C:A752                      				;[Skip delay] 1
    1331.  0C:A752  6A                  	db $6A		;[Volume] 10
    1332.  0C:A753                      				;[Skip delay] 1
    1333.  0C:A753  BF                  	db $BF		;[End-Of-Track]
    1334.  0C:A754                      .track_25:
    1335.  0C:A754  C5                  	db $C5		;[Wait] 6
    1336.  0C:A755  2D                  	db $2D		;[Note] 46
    1337.  0C:A756  62                  	db $62		;[Volume] 2
    1338.  0C:A757  7F                  	db $7F		;[Instrument] 16
    1339.  0C:A758  95 01               	db $95, $01	; track detune
    1340.  0C:A75A  C3                  	db $C3		;[Wait] 4
    1341.  0C:A75B  31                  	db $31		;[Note] 50
    1342.  0C:A75C  95 00               	db $95, $00	; track detune
    1343.  0C:A75E                      				;[Skip delay] 4
    1344.  0C:A75E  36                  	db $36		;[Note] 55
    1345.  0C:A75F  95 01               	db $95, $01	; track detune
    1346.  0C:A761                      				;[Skip delay] 4
    1347.  0C:A761  34                  	db $34		;[Note] 53
    1348.  0C:A762  95 01               	db $95, $01	; track detune
    1349.  0C:A764  C7                  	db $C7		;[Wait] 8
    1350.  0C:A765  32                  	db $32		;[Note] 51
    1351.  0C:A766  95 01               	db $95, $01	; track detune
    1352.  0C:A768                      				;[Skip delay] 8
    1353.  0C:A768  31                  	db $31		;[Note] 50
    1354.  0C:A769  95 00               	db $95, $00	; track detune
    1355.  0C:A76B                      				;[Skip delay] 8
    1356.  0C:A76B  32                  	db $32		;[Note] 51
    1357.  0C:A76C  95 01               	db $95, $01	; track detune
    1358.  0C:A76E                      				;[Skip delay] 8
    1359.  0C:A76E  2F                  	db $2F		;[Note] 48
    1360.  0C:A76F                      				;[Skip delay] 8
    1361.  0C:A76F  31                  	db $31		;[Note] 50
    1362.  0C:A770  95 00               	db $95, $00	; track detune
    1363.  0C:A772  C3                  	db $C3		;[Wait] 4
    1364.  0C:A773  32                  	db $32		;[Note] 51
    1365.  0C:A774  95 01               	db $95, $01	; track detune
    1366.  0C:A776  C1                  	db $C1		;[Wait] 2
    1367.  0C:A777  BF                  	db $BF		;[End-Of-Track]
    1368.  0C:A778                      .track_26:
    1369.  0C:A778  0C                  	db $0C		;[Note] 13
    1370.  0C:A779  6F                  	db $6F		;[Volume] 15
    1371.  0C:A77A  70                  	db $70		;[Instrument] 1
    1372.  0C:A77B  C3                  	db $C3		;[Wait] 4
    1373.  0C:A77C  0C                  	db $0C		;[Note] 13
    1374.  0C:A77D  75                  	db $75		;[Instrument] 6
    1375.  0C:A77E                      				;[Skip delay] 4
    1376.  0C:A77E  13                  	db $13		;[Note] 20
    1377.  0C:A77F  6E                  	db $6E		;[Volume] 14
    1378.  0C:A780  71                  	db $71		;[Instrument] 2
    1379.  0C:A781  C7                  	db $C7		;[Wait] 8
    1380.  0C:A782  13                  	db $13		;[Note] 20
    1381.  0C:A783  C0                  	db $C0		;[Wait] 1
    1382.  0C:A784  6D                  	db $6D		;[Volume] 13
    1383.  0C:A785  C2                  	db $C2		;[Wait] 3
    1384.  0C:A786  0C                  	db $0C		;[Note] 13
    1385.  0C:A787  6F                  	db $6F		;[Volume] 15
    1386.  0C:A788  70                  	db $70		;[Instrument] 1
    1387.  0C:A789  C3                  	db $C3		;[Wait] 4
    1388.  0C:A78A  13                  	db $13		;[Note] 20
    1389.  0C:A78B  6E                  	db $6E		;[Volume] 14
    1390.  0C:A78C  71                  	db $71		;[Instrument] 2
    1391.  0C:A78D                      				;[Skip delay] 4
    1392.  0C:A78D  5F                  	db $5F		;[Note] 96
    1393.  0C:A78E  6F                  	db $6F		;[Volume] 15
    1394.  0C:A78F  79                  	db $79		;[Instrument] 10
    1395.  0C:A790  C7                  	db $C7		;[Wait] 8
    1396.  0C:A791  0C                  	db $0C		;[Note] 13
    1397.  0C:A792  70                  	db $70		;[Instrument] 1
    1398.  0C:A793  C3                  	db $C3		;[Wait] 4
    1399.  0C:A794  13                  	db $13		;[Note] 20
    1400.  0C:A795  6E                  	db $6E		;[Volume] 14
    1401.  0C:A796  71                  	db $71		;[Instrument] 2
    1402.  0C:A797                      				;[Skip delay] 4
    1403.  0C:A797  5F                  	db $5F		;[Note] 96
    1404.  0C:A798  6F                  	db $6F		;[Volume] 15
    1405.  0C:A799  79                  	db $79		;[Instrument] 10
    1406.  0C:A79A                      				;[Skip delay] 4
    1407.  0C:A79A  0C                  	db $0C		;[Note] 13
    1408.  0C:A79B  70                  	db $70		;[Instrument] 1
    1409.  0C:A79C                      				;[Skip delay] 4
    1410.  0C:A79C  13                  	db $13		;[Note] 20
    1411.  0C:A79D  6E                  	db $6E		;[Volume] 14
    1412.  0C:A79E  71                  	db $71		;[Instrument] 2
    1413.  0C:A79F                      				;[Skip delay] 4
    1414.  0C:A79F  13                  	db $13		;[Note] 20
    1415.  0C:A7A0  C0                  	db $C0		;[Wait] 1
    1416.  0C:A7A1  6D                  	db $6D		;[Volume] 13
    1417.  0C:A7A2  C2                  	db $C2		;[Wait] 3
    1418.  0C:A7A3  13                  	db $13		;[Note] 20
    1419.  0C:A7A4  6E                  	db $6E		;[Volume] 14
    1420.  0C:A7A5  C3                  	db $C3		;[Wait] 4
    1421.  0C:A7A6  BF                  	db $BF		;[End-Of-Track]
    1422.  0C:A7A7                      .track_27:
    1423.  0C:A7A7  C3                  	db $C3		;[Wait] 4
    1424.  0C:A7A8  10                  	db $10		;[Note] 17
    1425.  0C:A7A9  6B                  	db $6B		;[Volume] 11
    1426.  0C:A7AA  7B                  	db $7B		;[Instrument] 12
    1427.  0C:A7AB  95 07               	db $95, $07	; track detune
    1428.  0C:A7AD                      				;[Skip delay] 4
    1429.  0C:A7AD  1C                  	db $1C		;[Note] 29
    1430.  0C:A7AE  95 01               	db $95, $01	; track detune
    1431.  0C:A7B0                      				;[Skip delay] 4
    1432.  0C:A7B0  10                  	db $10		;[Note] 17
    1433.  0C:A7B1  95 07               	db $95, $07	; track detune
    1434.  0C:A7B3                      				;[Skip delay] 4
    1435.  0C:A7B3  0E                  	db $0E		;[Note] 15
    1436.  0C:A7B4  95 06               	db $95, $06	; track detune
    1437.  0C:A7B6  C0                  	db $C0		;[Wait] 1
    1438.  0C:A7B7  10                  	db $10		;[Note] 17
    1439.  0C:A7B8  A6 10               	db $A6, $10; tone-slide
    1440.  0C:A7BA                      				;[Skip delay] 1
    1441.  0C:A7BA  A6 13               	db $A6, $13; tone-slide
    1442.  0C:A7BC                      				;[Skip delay] 1
    1443.  0C:A7BC  A6 10               	db $A6, $10; tone-slide
    1444.  0C:A7BE                      				;[Skip delay] 1
    1445.  0C:A7BE  A6 11               	db $A6, $11; tone-slide
    1446.  0C:A7C0                      				;[Skip delay] 1
    1447.  0C:A7C0  A6 11               	db $A6, $11; tone-slide
    1448.  0C:A7C2                      				;[Skip delay] 1
    1449.  0C:A7C2  B0 02               	db $B0, $02; tone-slide rep
    1450.  0C:A7C4  C1                  	db $C1		;[Wait] 2
    1451.  0C:A7C5  0B                  	db $0B		;[Note] 12
    1452.  0C:A7C6  95 01               	db $95, $01	; track detune
    1453.  0C:A7C8  C3                  	db $C3		;[Wait] 4
    1454.  0C:A7C9  09                  	db $09		;[Note] 10
    1455.  0C:A7CA  95 00               	db $95, $00	; track detune
    1456.  0C:A7CC  C7                  	db $C7		;[Wait] 8
    1457.  0C:A7CD  09                  	db $09		;[Note] 10
    1458.  0C:A7CE  C3                  	db $C3		;[Wait] 4
    1459.  0C:A7CF  15                  	db $15		;[Note] 22
    1460.  0C:A7D0  95 02               	db $95, $02	; track detune
    1461.  0C:A7D2                      				;[Skip delay] 4
    1462.  0C:A7D2  09                  	db $09		;[Note] 10
    1463.  0C:A7D3  95 00               	db $95, $00	; track detune
    1464.  0C:A7D5  C7                  	db $C7		;[Wait] 8
    1465.  0C:A7D6  09                  	db $09		;[Note] 10
    1466.  0C:A7D7  C3                  	db $C3		;[Wait] 4
    1467.  0C:A7D8  0B                  	db $0B		;[Note] 12
    1468.  0C:A7D9  95 02               	db $95, $02	; track detune
    1469.  0C:A7DB                      				;[Skip delay] 4
    1470.  0C:A7DB  0E                  	db $0E		;[Note] 15
    1471.  0C:A7DC  95 02               	db $95, $02	; track detune
    1472.  0C:A7DE                      				;[Skip delay] 4
    1473.  0C:A7DE  BF                  	db $BF		;[End-Of-Track]
    1474.  0C:A7DF                      .track_28:
    1475.  0C:A7DF  23                  	db $23		;[Note] 36
    1476.  0C:A7E0  6A                  	db $6A		;[Volume] 10
    1477.  0C:A7E1  7D                  	db $7D		;[Instrument] 14
    1478.  0C:A7E2  95 09               	db $95, $09	; track detune
    1479.  0C:A7E4  DB                  	db $DB		;[Wait] 28
    1480.  0C:A7E5  23                  	db $23		;[Note] 36
    1481.  0C:A7E6  95 09               	db $95, $09	; track detune
    1482.  0C:A7E8  E3                  	db $E3		;[Wait] 36
    1483.  0C:A7E9  BF                  	db $BF		;[End-Of-Track]
    1484.  0C:A7EA                      .track_29:
    1485.  0C:A7EA  C3                  	db $C3		;[Wait] 4
    1486.  0C:A7EB  10                  	db $10		;[Note] 17
    1487.  0C:A7EC  6F                  	db $6F		;[Volume] 15
    1488.  0C:A7ED  7A                  	db $7A		;[Instrument] 11
    1489.  0C:A7EE  95 07               	db $95, $07	; track detune
    1490.  0C:A7F0                      				;[Skip delay] 4
    1491.  0C:A7F0  1C                  	db $1C		;[Note] 29
    1492.  0C:A7F1  95 01               	db $95, $01	; track detune
    1493.  0C:A7F3                      				;[Skip delay] 4
    1494.  0C:A7F3  10                  	db $10		;[Note] 17
    1495.  0C:A7F4  95 07               	db $95, $07	; track detune
    1496.  0C:A7F6                      				;[Skip delay] 4
    1497.  0C:A7F6  0E                  	db $0E		;[Note] 15
    1498.  0C:A7F7  95 06               	db $95, $06	; track detune
    1499.  0C:A7F9  C0                  	db $C0		;[Wait] 1
    1500.  0C:A7FA  10                  	db $10		;[Note] 17
    1501.  0C:A7FB  A6 0F               	db $A6, $0F; tone-slide
    1502.  0C:A7FD                      				;[Skip delay] 1
    1503.  0C:A7FD  A6 10               	db $A6, $10; tone-slide
    1504.  0C:A7FF                      				;[Skip delay] 1
    1505.  0C:A7FF  A6 0F               	db $A6, $0F; tone-slide
    1506.  0C:A801                      				;[Skip delay] 1
    1507.  0C:A801  A6 0F               	db $A6, $0F; tone-slide
    1508.  0C:A803                      				;[Skip delay] 1
    1509.  0C:A803  A6 10               	db $A6, $10; tone-slide
    1510.  0C:A805                      				;[Skip delay] 1
    1511.  0C:A805  B0 02               	db $B0, $02; tone-slide rep
    1512.  0C:A807  C1                  	db $C1		;[Wait] 2
    1513.  0C:A808  0B                  	db $0B		;[Note] 12
    1514.  0C:A809  95 01               	db $95, $01	; track detune
    1515.  0C:A80B  C3                  	db $C3		;[Wait] 4
    1516.  0C:A80C  09                  	db $09		;[Note] 10
    1517.  0C:A80D  95 00               	db $95, $00	; track detune
    1518.  0C:A80F  C7                  	db $C7		;[Wait] 8
    1519.  0C:A810  09                  	db $09		;[Note] 10
    1520.  0C:A811  C3                  	db $C3		;[Wait] 4
    1521.  0C:A812  15                  	db $15		;[Note] 22
    1522.  0C:A813  95 02               	db $95, $02	; track detune
    1523.  0C:A815                      				;[Skip delay] 4
    1524.  0C:A815  09                  	db $09		;[Note] 10
    1525.  0C:A816  95 00               	db $95, $00	; track detune
    1526.  0C:A818  C7                  	db $C7		;[Wait] 8
    1527.  0C:A819  09                  	db $09		;[Note] 10
    1528.  0C:A81A  C3                  	db $C3		;[Wait] 4
    1529.  0C:A81B  0B                  	db $0B		;[Note] 12
    1530.  0C:A81C  95 02               	db $95, $02	; track detune
    1531.  0C:A81E                      				;[Skip delay] 4
    1532.  0C:A81E  0E                  	db $0E		;[Note] 15
    1533.  0C:A81F  95 02               	db $95, $02	; track detune
    1534.  0C:A821                      				;[Skip delay] 4
    1535.  0C:A821  BF                  	db $BF		;[End-Of-Track]
    1536.  0C:A822                      .track_30:
    1537.  0C:A822  1E                  	db $1E		;[Note] 31
    1538.  0C:A823  6F                  	db $6F		;[Volume] 15
    1539.  0C:A824  7C                  	db $7C		;[Instrument] 13
    1540.  0C:A825  95 07               	db $95, $07	; track detune
    1541.  0C:A827  C7                  	db $C7		;[Wait] 8
    1542.  0C:A828  6E                  	db $6E		;[Volume] 14
    1543.  0C:A829  D3                  	db $D3		;[Wait] 20
    1544.  0C:A82A  1F                  	db $1F		;[Note] 32
    1545.  0C:A82B  6F                  	db $6F		;[Volume] 15
    1546.  0C:A82C  95 07               	db $95, $07	; track detune
    1547.  0C:A82E  C7                  	db $C7		;[Wait] 8
    1548.  0C:A82F  6E                  	db $6E		;[Volume] 14
    1549.  0C:A830  DB                  	db $DB		;[Wait] 28
    1550.  0C:A831  BF                  	db $BF		;[End-Of-Track]
    1551.  0C:A832                      .track_31:
    1552.  0C:A832  1A                  	db $1A		;[Note] 27
    1553.  0C:A833  6F                  	db $6F		;[Volume] 15
    1554.  0C:A834  7C                  	db $7C		;[Instrument] 13
    1555.  0C:A835  95 06               	db $95, $06	; track detune
    1556.  0C:A837  C7                  	db $C7		;[Wait] 8
    1557.  0C:A838  6E                  	db $6E		;[Volume] 14
    1558.  0C:A839  D3                  	db $D3		;[Wait] 20
    1559.  0C:A83A  1A                  	db $1A		;[Note] 27
    1560.  0C:A83B  6F                  	db $6F		;[Volume] 15
    1561.  0C:A83C  95 06               	db $95, $06	; track detune
    1562.  0C:A83E  C7                  	db $C7		;[Wait] 8
    1563.  0C:A83F  6E                  	db $6E		;[Volume] 14
    1564.  0C:A840  DB                  	db $DB		;[Wait] 28
    1565.  0C:A841  BF                  	db $BF		;[End-Of-Track]
    1566.  0C:A842                      .track_32:
    1567.  0C:A842  36                  	db $36		;[Note] 55
    1568.  0C:A843  6A                  	db $6A		;[Volume] 10
    1569.  0C:A844  7E                  	db $7E		;[Instrument] 15
    1570.  0C:A845  95 01               	db $95, $01	; track detune
    1571.  0C:A847  C0                  	db $C0		;[Wait] 1
    1572.  0C:A848  37                  	db $37		;[Note] 56
    1573.  0C:A849  6B                  	db $6B		;[Volume] 11
    1574.  0C:A84A  A6 01               	db $A6, $01; tone-slide
    1575.  0C:A84C                      				;[Skip delay] 1
    1576.  0C:A84C  6C                  	db $6C		;[Volume] 12
    1577.  0C:A84D  95 00               	db $95, $00	; track detune
    1578.  0C:A84F                      				;[Skip delay] 1
    1579.  0C:A84F  6D                  	db $6D		;[Volume] 13
    1580.  0C:A850  B0 02               	db $B0, $02; tone-slide rep
    1581.  0C:A852                      				;[Skip delay] 1
    1582.  0C:A852  6E                  	db $6E		;[Volume] 14
    1583.  0C:A853                      				;[Skip delay] 1
    1584.  0C:A853  6F                  	db $6F		;[Volume] 15
    1585.  0C:A854  C0                  	db $C0		;[Wait..] 1
    1586.  0C:A855  B0 02               	db $B0, $02; tone-slide rep
    1587.  0C:A857  C1                  	db $C1		;[Wait] 2
    1588.  0C:A858  A7 74               	db $A7, $74	;[CMD vibrato]
    1589.  0C:A85A  C0                  	db $C0		;[Wait] 1
    1590.  0C:A85B  B1 03               	db $B1, $03	;[CMD vibrato] rep
    1591.  0C:A85D  C2                  	db $C2		;[Wait] 3
    1592.  0C:A85E  36                  	db $36		;[Note] 55
    1593.  0C:A85F  6B                  	db $6B		;[Volume] 11
    1594.  0C:A860  95 01               	db $95, $01	; track detune
    1595.  0C:A862  C0                  	db $C0		;[Wait] 1
    1596.  0C:A863  6C                  	db $6C		;[Volume] 12
    1597.  0C:A864                      				;[Skip delay] 1
    1598.  0C:A864  6D                  	db $6D		;[Volume] 13
    1599.  0C:A865  C9                  	db $C9		;[Wait] 10
    1600.  0C:A866  32                  	db $32		;[Note] 51
    1601.  0C:A867  6B                  	db $6B		;[Volume] 11
    1602.  0C:A868  95 01               	db $95, $01	; track detune
    1603.  0C:A86A  C0                  	db $C0		;[Wait] 1
    1604.  0C:A86B  6C                  	db $6C		;[Volume] 12
    1605.  0C:A86C                      				;[Skip delay] 1
    1606.  0C:A86C  6B                  	db $6B		;[Volume] 11
    1607.  0C:A86D                      				;[Skip delay] 1
    1608.  0C:A86D  6A                  	db $6A		;[Volume] 10
    1609.  0C:A86E                      				;[Skip delay] 1
    1610.  0C:A86E  32                  	db $32		;[Note] 51
    1611.  0C:A86F  6B                  	db $6B		;[Volume] 11
    1612.  0C:A870                      				;[Skip delay] 1
    1613.  0C:A870  6C                  	db $6C		;[Volume] 12
    1614.  0C:A871  C6                  	db $C6		;[Wait] 7
    1615.  0C:A872  2D                  	db $2D		;[Note] 46
    1616.  0C:A873  6B                  	db $6B		;[Volume] 11
    1617.  0C:A874  95 00               	db $95, $00	; track detune
    1618.  0C:A876  C0                  	db $C0		;[Wait] 1
    1619.  0C:A877  6C                  	db $6C		;[Volume] 12
    1620.  0C:A878  C2                  	db $C2		;[Wait] 3
    1621.  0C:A879  2F                  	db $2F		;[Note] 48
    1622.  0C:A87A  6B                  	db $6B		;[Volume] 11
    1623.  0C:A87B  95 00               	db $95, $00	; track detune
    1624.  0C:A87D  C0                  	db $C0		;[Wait] 1
    1625.  0C:A87E  6C                  	db $6C		;[Volume] 12
    1626.  0C:A87F  C2                  	db $C2		;[Wait] 3
    1627.  0C:A880  3B                  	db $3B		;[Note] 60
    1628.  0C:A881  6B                  	db $6B		;[Volume] 11
    1629.  0C:A882  95 00               	db $95, $00	; track detune
    1630.  0C:A884  C0                  	db $C0		;[Wait] 1
    1631.  0C:A885  6C                  	db $6C		;[Volume] 12
    1632.  0C:A886  C2                  	db $C2		;[Wait] 3
    1633.  0C:A887  6B                  	db $6B		;[Volume] 11
    1634.  0C:A888  C3                  	db $C3		;[Wait] 4
    1635.  0C:A889  39                  	db $39		;[Note] 58
    1636.  0C:A88A  95 08               	db $95, $08	; track detune
    1637.  0C:A88C  C0                  	db $C0		;[Wait] 1
    1638.  0C:A88D  6C                  	db $6C		;[Volume] 12
    1639.  0C:A88E                      				;[Skip delay] 1
    1640.  0C:A88E  6D                  	db $6D		;[Volume] 13
    1641.  0C:A88F  C1                  	db $C1		;[Wait] 2
    1642.  0C:A890  A7 74               	db $A7, $74	;[CMD vibrato]
    1643.  0C:A892  C0                  	db $C0		;[Wait] 1
    1644.  0C:A893  B1 07               	db $B1, $07	;[CMD vibrato] rep
    1645.  0C:A895  C6                  	db $C6		;[Wait] 7
    1646.  0C:A896  BF                  	db $BF		;[End-Of-Track]
    1647.  0C:A897                      .track_33:
    1648.  0C:A897  C1                  	db $C1		;[Wait] 2
    1649.  0C:A898  34                  	db $34		;[Note] 53
    1650.  0C:A899  62                  	db $62		;[Volume] 2
    1651.  0C:A89A  7F                  	db $7F		;[Instrument] 16
    1652.  0C:A89B  95 01               	db $95, $01	; track detune
    1653.  0C:A89D  C3                  	db $C3		;[Wait] 4
    1654.  0C:A89E  36                  	db $36		;[Note] 55
    1655.  0C:A89F  95 02               	db $95, $02	; track detune
    1656.  0C:A8A1  C0                  	db $C0		;[Wait] 1
    1657.  0C:A8A2  37                  	db $37		;[Note] 56
    1658.  0C:A8A3  A6 01               	db $A6, $01; tone-slide
    1659.  0C:A8A5                      				;[Skip delay] 1
    1660.  0C:A8A5  95 00               	db $95, $00	; track detune
    1661.  0C:A8A7                      				;[Skip delay] 1
    1662.  0C:A8A7  B0 02               	db $B0, $02; tone-slide rep
    1663.  0C:A8A9  C2                  	db $C2		;[Wait] 3
    1664.  0C:A8AA  B0 02               	db $B0, $02; tone-slide rep
    1665.  0C:A8AC  C1                  	db $C1		;[Wait] 2
    1666.  0C:A8AD  A7 74               	db $A7, $74	;[CMD vibrato]
    1667.  0C:A8AF  C0                  	db $C0		;[Wait] 1
    1668.  0C:A8B0  B1 03               	db $B1, $03	;[CMD vibrato] rep
    1669.  0C:A8B2  C2                  	db $C2		;[Wait] 3
    1670.  0C:A8B3  36                  	db $36		;[Note] 55
    1671.  0C:A8B4  95 02               	db $95, $02	; track detune
    1672.  0C:A8B6  CB                  	db $CB		;[Wait] 12
    1673.  0C:A8B7  32                  	db $32		;[Note] 51
    1674.  0C:A8B8  95 02               	db $95, $02	; track detune
    1675.  0C:A8BA  C3                  	db $C3		;[Wait] 4
    1676.  0C:A8BB  32                  	db $32		;[Note] 51
    1677.  0C:A8BC  C7                  	db $C7		;[Wait] 8
    1678.  0C:A8BD  2D                  	db $2D		;[Note] 46
    1679.  0C:A8BE  95 01               	db $95, $01	; track detune
    1680.  0C:A8C0  C3                  	db $C3		;[Wait] 4
    1681.  0C:A8C1  2F                  	db $2F		;[Note] 48
    1682.  0C:A8C2                      				;[Skip delay] 4
    1683.  0C:A8C2  3B                  	db $3B		;[Note] 60
    1684.  0C:A8C3  95 01               	db $95, $01	; track detune
    1685.  0C:A8C5  C7                  	db $C7		;[Wait] 8
    1686.  0C:A8C6  39                  	db $39		;[Note] 58
    1687.  0C:A8C7  95 00               	db $95, $00	; track detune
    1688.  0C:A8C9  C3                  	db $C3		;[Wait] 4
    1689.  0C:A8CA  A7 74               	db $A7, $74	;[CMD vibrato]
    1690.  0C:A8CC  C0                  	db $C0		;[Wait] 1
    1691.  0C:A8CD  B1 01               	db $B1, $01	;[CMD vibrato] rep
    1692.  0C:A8CF                      				;[Skip delay] 1
    1693.  0C:A8CF  BF                  	db $BF		;[End-Of-Track]
    1694.  0C:A8D0                      .track_34:
    1695.  0C:A8D0  0E                  	db $0E		;[Note] 15
    1696.  0C:A8D1  6B                  	db $6B		;[Volume] 11
    1697.  0C:A8D2  7B                  	db $7B		;[Instrument] 12
    1698.  0C:A8D3  95 01               	db $95, $01	; track detune
    1699.  0C:A8D5  C7                  	db $C7		;[Wait] 8
    1700.  0C:A8D6  0E                  	db $0E		;[Note] 15
    1701.  0C:A8D7                      				;[Skip delay] 8
    1702.  0C:A8D7  0E                  	db $0E		;[Note] 15
    1703.  0C:A8D8  C3                  	db $C3		;[Wait] 4
    1704.  0C:A8D9  10                  	db $10		;[Note] 17
    1705.  0C:A8DA                      				;[Skip delay] 4
    1706.  0C:A8DA  12                  	db $12		;[Note] 19
    1707.  0C:A8DB                      				;[Skip delay] 4
    1708.  0C:A8DB  14                  	db $14		;[Note] 21
    1709.  0C:A8DC  95 02               	db $95, $02	; track detune
    1710.  0C:A8DE  C0                  	db $C0		;[Wait] 1
    1711.  0C:A8DF  15                  	db $15		;[Note] 22
    1712.  0C:A8E0  A6 0E               	db $A6, $0E; tone-slide
    1713.  0C:A8E2                      				;[Skip delay] 1
    1714.  0C:A8E2  A6 0B               	db $A6, $0B; tone-slide
    1715.  0C:A8E4                      				;[Skip delay] 1
    1716.  0C:A8E4  A6 0C               	db $A6, $0C; tone-slide
    1717.  0C:A8E6                      				;[Skip delay] 1
    1718.  0C:A8E6  A6 0D               	db $A6, $0D; tone-slide
    1719.  0C:A8E8                      				;[Skip delay] 1
    1720.  0C:A8E8  A6 0D               	db $A6, $0D; tone-slide
    1721.  0C:A8EA                      				;[Skip delay] 1
    1722.  0C:A8EA  B0 02               	db $B0, $02; tone-slide rep
    1723.  0C:A8EC  C1                  	db $C1		;[Wait] 2
    1724.  0C:A8ED  15                  	db $15		;[Note] 22
    1725.  0C:A8EE  C7                  	db $C7		;[Wait] 8
    1726.  0C:A8EF  15                  	db $15		;[Note] 22
    1727.  0C:A8F0                      				;[Skip delay] 8
    1728.  0C:A8F0  14                  	db $14		;[Note] 21
    1729.  0C:A8F1  95 03               	db $95, $03	; track detune
    1730.  0C:A8F3                      				;[Skip delay] 8
    1731.  0C:A8F3  13                  	db $13		;[Note] 20
    1732.  0C:A8F4  95 04               	db $95, $04	; track detune
    1733.  0C:A8F6  C3                  	db $C3		;[Wait] 4
    1734.  0C:A8F7  BF                  	db $BF		;[End-Of-Track]
    1735.  0C:A8F8                      .track_35:
    1736.  0C:A8F8  60                  	db $60		;[Note] 97
    1737.  0C:A8F9  C7                  	db $C7		;[Wait] 8
    1738.  0C:A8FA  36                  	db $36		;[Note] 55
    1739.  0C:A8FB  6B                  	db $6B		;[Volume] 11
    1740.  0C:A8FC  7E                  	db $7E		;[Instrument] 15
    1741.  0C:A8FD  95 01               	db $95, $01	; track detune
    1742.  0C:A8FF  C0                  	db $C0		;[Wait] 1
    1743.  0C:A900  6C                  	db $6C		;[Volume] 12
    1744.  0C:A901  C1                  	db $C1		;[Wait] 2
    1745.  0C:A902  6B                  	db $6B		;[Volume] 11
    1746.  0C:A903  C0                  	db $C0		;[Wait] 1
    1747.  0C:A904  37                  	db $37		;[Note] 56
    1748.  0C:A905  95 00               	db $95, $00	; track detune
    1749.  0C:A907                      				;[Skip delay] 1
    1750.  0C:A907  6C                  	db $6C		;[Volume] 12
    1751.  0C:A908  C1                  	db $C1		;[Wait] 2
    1752.  0C:A909  6A                  	db $6A		;[Volume] 10
    1753.  0C:A90A  C0                  	db $C0		;[Wait] 1
    1754.  0C:A90B  3B                  	db $3B		;[Note] 60
    1755.  0C:A90C  6B                  	db $6B		;[Volume] 11
    1756.  0C:A90D                      				;[Skip delay] 1
    1757.  0C:A90D  6C                  	db $6C		;[Volume] 12
    1758.  0C:A90E  C2                  	db $C2		;[Wait] 3
    1759.  0C:A90F  39                  	db $39		;[Note] 58
    1760.  0C:A910  6B                  	db $6B		;[Volume] 11
    1761.  0C:A911  C0                  	db $C0		;[Wait] 1
    1762.  0C:A912  6C                  	db $6C		;[Volume] 12
    1763.  0C:A913  C2                  	db $C2		;[Wait] 3
    1764.  0C:A914  3B                  	db $3B		;[Note] 60
    1765.  0C:A915  6B                  	db $6B		;[Volume] 11
    1766.  0C:A916  C0                  	db $C0		;[Wait] 1
    1767.  0C:A917  6C                  	db $6C		;[Volume] 12
    1768.  0C:A918  C1                  	db $C1		;[Wait] 2
    1769.  0C:A919  6B                  	db $6B		;[Volume] 11
    1770.  0C:A91A  C0                  	db $C0		;[Wait] 1
    1771.  0C:A91B  3E                  	db $3E		;[Note] 63
    1772.  0C:A91C  95 00               	db $95, $00	; track detune
    1773.  0C:A91E                      				;[Skip delay] 1
    1774.  0C:A91E  6C                  	db $6C		;[Volume] 12
    1775.  0C:A91F                      				;[Skip delay] 1
    1776.  0C:A91F  6B                  	db $6B		;[Volume] 11
    1777.  0C:A920                      				;[Skip delay] 1
    1778.  0C:A920  6A                  	db $6A		;[Volume] 10
    1779.  0C:A921  C4                  	db $C4		;[Wait] 5
    1780.  0C:A922  3B                  	db $3B		;[Note] 60
    1781.  0C:A923  6B                  	db $6B		;[Volume] 11
    1782.  0C:A924  95 00               	db $95, $00	; track detune
    1783.  0C:A926  C0                  	db $C0		;[Wait] 1
    1784.  0C:A927  6C                  	db $6C		;[Volume] 12
    1785.  0C:A928                      				;[Skip delay] 1
    1786.  0C:A928  6B                  	db $6B		;[Volume] 11
    1787.  0C:A929                      				;[Skip delay] 1
    1788.  0C:A929  6A                  	db $6A		;[Volume] 10
    1789.  0C:A92A  C4                  	db $C4		;[Wait] 5
    1790.  0C:A92B  39                  	db $39		;[Note] 58
    1791.  0C:A92C  6B                  	db $6B		;[Volume] 11
    1792.  0C:A92D  C0                  	db $C0		;[Wait] 1
    1793.  0C:A92E  6C                  	db $6C		;[Volume] 12
    1794.  0C:A92F                      				;[Skip delay] 1
    1795.  0C:A92F  6B                  	db $6B		;[Volume] 11
    1796.  0C:A930                      				;[Skip delay] 1
    1797.  0C:A930  6A                  	db $6A		;[Volume] 10
    1798.  0C:A931  C4                  	db $C4		;[Wait] 5
    1799.  0C:A932  35                  	db $35		;[Note] 54
    1800.  0C:A933  6B                  	db $6B		;[Volume] 11
    1801.  0C:A934  95 01               	db $95, $01	; track detune
    1802.  0C:A936  C0                  	db $C0		;[Wait] 1
    1803.  0C:A937  36                  	db $36		;[Note] 55
    1804.  0C:A938  6C                  	db $6C		;[Volume] 12
    1805.  0C:A939  A6 03               	db $A6, $03; tone-slide
    1806.  0C:A93B                      				;[Skip delay] 1
    1807.  0C:A93B  A6 03               	db $A6, $03; tone-slide
    1808.  0C:A93D                      				;[Skip delay] 1
    1809.  0C:A93D  A6 09               	db $A6, $09; tone-slide
    1810.  0C:A93F                      				;[Skip delay] 1
    1811.  0C:A93F  34                  	db $34		;[Note] 53
    1812.  0C:A940  6B                  	db $6B		;[Volume] 11
    1813.  0C:A941  95 00               	db $95, $00	; track detune
    1814.  0C:A943                      				;[Skip delay] 1
    1815.  0C:A943  6C                  	db $6C		;[Volume] 12
    1816.  0C:A944                      				;[Skip delay] 1
    1817.  0C:A944  6B                  	db $6B		;[Volume] 11
    1818.  0C:A945  C1                  	db $C1		;[Wait] 2
    1819.  0C:A946  32                  	db $32		;[Note] 51
    1820.  0C:A947  C0                  	db $C0		;[Wait] 1
    1821.  0C:A948  6C                  	db $6C		;[Volume] 12
    1822.  0C:A949  C2                  	db $C2		;[Wait] 3
    1823.  0C:A94A  BF                  	db $BF		;[End-Of-Track]
    1824.  0C:A94B                      .track_36:
    1825.  0C:A94B  61                  	db $61		;[Volume] 1
    1826.  0C:A94C  B1 06               	db $B1, $06	;[CMD vibrato] rep
    1827.  0C:A94E  C5                  	db $C5		;[Wait] 6
    1828.  0C:A94F  60                  	db $60		;[Note] 97
    1829.  0C:A950  C7                  	db $C7		;[Wait] 8
    1830.  0C:A951  36                  	db $36		;[Note] 55
    1831.  0C:A952  62                  	db $62		;[Volume] 2
    1832.  0C:A953  7F                  	db $7F		;[Instrument] 16
    1833.  0C:A954  95 02               	db $95, $02	; track detune
    1834.  0C:A956  C3                  	db $C3		;[Wait] 4
    1835.  0C:A957  37                  	db $37		;[Note] 56
    1836.  0C:A958  95 01               	db $95, $01	; track detune
    1837.  0C:A95A                      				;[Skip delay] 4
    1838.  0C:A95A  3B                  	db $3B		;[Note] 60
    1839.  0C:A95B                      				;[Skip delay] 4
    1840.  0C:A95B  39                  	db $39		;[Note] 58
    1841.  0C:A95C                      				;[Skip delay] 4
    1842.  0C:A95C  3B                  	db $3B		;[Note] 60
    1843.  0C:A95D  61                  	db $61		;[Volume] 1
    1844.  0C:A95E                      				;[Skip delay] 4
    1845.  0C:A95E  3E                  	db $3E		;[Note] 63
    1846.  0C:A95F  62                  	db $62		;[Volume] 2
    1847.  0C:A960  95 00               	db $95, $00	; track detune
    1848.  0C:A962  C7                  	db $C7		;[Wait] 8
    1849.  0C:A963  3B                  	db $3B		;[Note] 60
    1850.  0C:A964  95 01               	db $95, $01	; track detune
    1851.  0C:A966                      				;[Skip delay] 8
    1852.  0C:A966  39                  	db $39		;[Note] 58
    1853.  0C:A967                      				;[Skip delay] 8
    1854.  0C:A967  35                  	db $35		;[Note] 54
    1855.  0C:A968  C0                  	db $C0		;[Wait] 1
    1856.  0C:A969  36                  	db $36		;[Note] 55
    1857.  0C:A96A  A6 03               	db $A6, $03; tone-slide
    1858.  0C:A96C                      				;[Skip delay] 1
    1859.  0C:A96C  A6 03               	db $A6, $03; tone-slide
    1860.  0C:A96E                      				;[Skip delay] 1
    1861.  0C:A96E  A6 09               	db $A6, $09; tone-slide
    1862.  0C:A970                      				;[Skip delay] 1
    1863.  0C:A970  34                  	db $34		;[Note] 53
    1864.  0C:A971  C1                  	db $C1		;[Wait] 2
    1865.  0C:A972  BF                  	db $BF		;[End-Of-Track]
    1866.  0C:A973                      .track_37:
    1867.  0C:A973  94 01               	db $94, $01	; vibrato control
    1868.  0C:A975  C7                  	db $C7		;[Wait] 8
    1869.  0C:A976  13                  	db $13		;[Note] 20
    1870.  0C:A977  6B                  	db $6B		;[Volume] 11
    1871.  0C:A978  7B                  	db $7B		;[Instrument] 12
    1872.  0C:A979  95 04               	db $95, $04	; track detune
    1873.  0C:A97B                      				;[Skip delay] 8
    1874.  0C:A97B  13                  	db $13		;[Note] 20
    1875.  0C:A97C  C3                  	db $C3		;[Wait] 4
    1876.  0C:A97D  0E                  	db $0E		;[Note] 15
    1877.  0C:A97E  95 01               	db $95, $01	; track detune
    1878.  0C:A980                      				;[Skip delay] 4
    1879.  0C:A980  0D                  	db $0D		;[Note] 14
    1880.  0C:A981  95 02               	db $95, $02	; track detune
    1881.  0C:A983                      				;[Skip delay] 4
    1882.  0C:A983  0C                  	db $0C		;[Note] 13
    1883.  0C:A984  95 02               	db $95, $02	; track detune
    1884.  0C:A986  CB                  	db $CB		;[Wait] 12
    1885.  0C:A987  0C                  	db $0C		;[Note] 13
    1886.  0C:A988  C7                  	db $C7		;[Wait] 8
    1887.  0C:A989  0C                  	db $0C		;[Note] 13
    1888.  0C:A98A  C3                  	db $C3		;[Wait] 4
    1889.  0C:A98B  0E                  	db $0E		;[Note] 15
    1890.  0C:A98C  95 01               	db $95, $01	; track detune
    1891.  0C:A98E                      				;[Skip delay] 4
    1892.  0C:A98E  10                  	db $10		;[Note] 17
    1893.  0C:A98F  95 07               	db $95, $07	; track detune
    1894.  0C:A991                      				;[Skip delay] 4
    1895.  0C:A991  12                  	db $12		;[Note] 19
    1896.  0C:A992  95 07               	db $95, $07	; track detune
    1897.  0C:A994  C0                  	db $C0		;[Wait] 1
    1898.  0C:A995  A5 01               	db $A5, $01; slide-down
    1899.  0C:A997  C2                  	db $C2		;[Wait] 3
    1900.  0C:A998  BF                  	db $BF		;[End-Of-Track]
    1901.  0C:A999                      .track_38:
    1902.  0C:A999  6D                  	db $6D		;[Volume] 13
    1903.  0C:A99A  A7 74               	db $A7, $74	;[CMD vibrato]
    1904.  0C:A99C  C0                  	db $C0		;[Wait] 1
    1905.  0C:A99D  B1 0F               	db $B1, $0F	;[CMD vibrato] rep
    1906.  0C:A99F  C6                  	db $C6		;[Wait] 7
    1907.  0C:A9A0  6C                  	db $6C		;[Volume] 12
    1908.  0C:A9A1  C7                  	db $C7		;[Wait] 8
    1909.  0C:A9A2  60                  	db $60		;[Note] 97
    1910.  0C:A9A3  C3                  	db $C3		;[Wait] 4
    1911.  0C:A9A4  2D                  	db $2D		;[Note] 46
    1912.  0C:A9A5  6B                  	db $6B		;[Volume] 11
    1913.  0C:A9A6  7E                  	db $7E		;[Instrument] 15
    1914.  0C:A9A7  95 00               	db $95, $00	; track detune
    1915.  0C:A9A9  C0                  	db $C0		;[Wait] 1
    1916.  0C:A9AA  6C                  	db $6C		;[Volume] 12
    1917.  0C:A9AB  C2                  	db $C2		;[Wait] 3
    1918.  0C:A9AC  2F                  	db $2F		;[Note] 48
    1919.  0C:A9AD  6B                  	db $6B		;[Volume] 11
    1920.  0C:A9AE  C0                  	db $C0		;[Wait] 1
    1921.  0C:A9AF  6C                  	db $6C		;[Volume] 12
    1922.  0C:A9B0  C1                  	db $C1		;[Wait] 2
    1923.  0C:A9B1  6A                  	db $6A		;[Volume] 10
    1924.  0C:A9B2  C0                  	db $C0		;[Wait] 1
    1925.  0C:A9B3  32                  	db $32		;[Note] 51
    1926.  0C:A9B4  6B                  	db $6B		;[Volume] 11
    1927.  0C:A9B5                      				;[Skip delay] 1
    1928.  0C:A9B5  6C                  	db $6C		;[Volume] 12
    1929.  0C:A9B6  C1                  	db $C1		;[Wait] 2
    1930.  0C:A9B7  6B                  	db $6B		;[Volume] 11
    1931.  0C:A9B8  C0                  	db $C0		;[Wait] 1
    1932.  0C:A9B9  37                  	db $37		;[Note] 56
    1933.  0C:A9BA  95 00               	db $95, $00	; track detune
    1934.  0C:A9BC                      				;[Skip delay] 1
    1935.  0C:A9BC  39                  	db $39		;[Note] 58
    1936.  0C:A9BD  6C                  	db $6C		;[Volume] 12
    1937.  0C:A9BE  A6 03               	db $A6, $03; tone-slide
    1938.  0C:A9C0                      				;[Skip delay] 1
    1939.  0C:A9C0  A6 05               	db $A6, $05; tone-slide
    1940.  0C:A9C2                      				;[Skip delay] 1
    1941.  0C:A9C2  6D                  	db $6D		;[Volume] 13
    1942.  0C:A9C3  A6 07               	db $A6, $07; tone-slide
    1943.  0C:A9C5                      				;[Skip delay] 1
    1944.  0C:A9C5  B0 01               	db $B0, $01; tone-slide rep
    1945.  0C:A9C7                      				;[Skip delay] 1
    1946.  0C:A9C7  A6 08               	db $A6, $08; tone-slide
    1947.  0C:A9C9                      				;[Skip delay] 1
    1948.  0C:A9C9  B0 02               	db $B0, $02; tone-slide rep
    1949.  0C:A9CB  C1                  	db $C1		;[Wait] 2
    1950.  0C:A9CC  37                  	db $37		;[Note] 56
    1951.  0C:A9CD  6B                  	db $6B		;[Volume] 11
    1952.  0C:A9CE  95 01               	db $95, $01	; track detune
    1953.  0C:A9D0  C0                  	db $C0		;[Wait] 1
    1954.  0C:A9D1  6C                  	db $6C		;[Volume] 12
    1955.  0C:A9D2  C1                  	db $C1		;[Wait] 2
    1956.  0C:A9D3  6D                  	db $6D		;[Volume] 13
    1957.  0C:A9D4  C4                  	db $C4		;[Wait] 5
    1958.  0C:A9D5  3D                  	db $3D		;[Note] 62
    1959.  0C:A9D6  6B                  	db $6B		;[Volume] 11
    1960.  0C:A9D7  95 00               	db $95, $00	; track detune
    1961.  0C:A9D9  C0                  	db $C0		;[Wait] 1
    1962.  0C:A9DA  3E                  	db $3E		;[Note] 63
    1963.  0C:A9DB  6C                  	db $6C		;[Volume] 12
    1964.  0C:A9DC  A6 03               	db $A6, $03; tone-slide
    1965.  0C:A9DE                      				;[Skip delay] 1
    1966.  0C:A9DE  A6 03               	db $A6, $03; tone-slide
    1967.  0C:A9E0                      				;[Skip delay] 1
    1968.  0C:A9E0  6D                  	db $6D		;[Volume] 13
    1969.  0C:A9E1  A6 07               	db $A6, $07; tone-slide
    1970.  0C:A9E3                      				;[Skip delay] 1
    1971.  0C:A9E3  A6 08               	db $A6, $08; tone-slide
    1972.  0C:A9E5                      				;[Skip delay] 1
    1973.  0C:A9E5  B0 01               	db $B0, $01; tone-slide rep
    1974.  0C:A9E7                      				;[Skip delay] 1
    1975.  0C:A9E7  A6 09               	db $A6, $09; tone-slide
    1976.  0C:A9E9                      				;[Skip delay] 1
    1977.  0C:A9E9  B0 01               	db $B0, $01; tone-slide rep
    1978.  0C:A9EB                      				;[Skip delay] 1
    1979.  0C:A9EB  3A                  	db $3A		;[Note] 59
    1980.  0C:A9EC  6B                  	db $6B		;[Volume] 11
    1981.  0C:A9ED  95 00               	db $95, $00	; track detune
    1982.  0C:A9EF                      				;[Skip delay] 1
    1983.  0C:A9EF  6C                  	db $6C		;[Volume] 12
    1984.  0C:A9F0  C1                  	db $C1		;[Wait] 2
    1985.  0C:A9F1  6D                  	db $6D		;[Volume] 13
    1986.  0C:A9F2  C4                  	db $C4		;[Wait] 5
    1987.  0C:A9F3  BF                  	db $BF		;[End-Of-Track]
    1988.  0C:A9F4                      .track_39:
    1989.  0C:A9F4  C1                  	db $C1		;[Wait] 2
    1990.  0C:A9F5  32                  	db $32		;[Note] 51
    1991.  0C:A9F6  62                  	db $62		;[Volume] 2
    1992.  0C:A9F7  7F                  	db $7F		;[Instrument] 16
    1993.  0C:A9F8  C3                  	db $C3		;[Wait] 4
    1994.  0C:A9F9  A7 74               	db $A7, $74	;[CMD vibrato]
    1995.  0C:A9FB  C0                  	db $C0		;[Wait] 1
    1996.  0C:A9FC  B1 0F               	db $B1, $0F	;[CMD vibrato] rep
    1997.  0C:A9FE                      				;[Skip delay] 1
    1998.  0C:A9FE  61                  	db $61		;[Volume] 1
    1999.  0C:A9FF  CD                  	db $CD		;[Wait] 14
    2000.  0C:AA00  60                  	db $60		;[Note] 97
    2001.  0C:AA01  C3                  	db $C3		;[Wait] 4
    2002.  0C:AA02  2D                  	db $2D		;[Note] 46
    2003.  0C:AA03  62                  	db $62		;[Volume] 2
    2004.  0C:AA04  95 01               	db $95, $01	; track detune
    2005.  0C:AA06                      				;[Skip delay] 4
    2006.  0C:AA06  2F                  	db $2F		;[Note] 48
    2007.  0C:AA07  7E                  	db $7E		;[Instrument] 15
    2008.  0C:AA08                      				;[Skip delay] 4
    2009.  0C:AA08  32                  	db $32		;[Note] 51
    2010.  0C:AA09                      				;[Skip delay] 4
    2011.  0C:AA09  37                  	db $37		;[Note] 56
    2012.  0C:AA0A  95 01               	db $95, $01	; track detune
    2013.  0C:AA0C  C0                  	db $C0		;[Wait] 1
    2014.  0C:AA0D  39                  	db $39		;[Note] 58
    2015.  0C:AA0E  A6 03               	db $A6, $03; tone-slide
    2016.  0C:AA10                      				;[Skip delay] 1
    2017.  0C:AA10  A6 05               	db $A6, $05; tone-slide
    2018.  0C:AA12                      				;[Skip delay] 1
    2019.  0C:AA12  A6 07               	db $A6, $07; tone-slide
    2020.  0C:AA14                      				;[Skip delay] 1
    2021.  0C:AA14  B0 01               	db $B0, $01; tone-slide rep
    2022.  0C:AA16                      				;[Skip delay] 1
    2023.  0C:AA16  A6 08               	db $A6, $08; tone-slide
    2024.  0C:AA18                      				;[Skip delay] 1
    2025.  0C:AA18  B0 02               	db $B0, $02; tone-slide rep
    2026.  0C:AA1A  C1                  	db $C1		;[Wait] 2
    2027.  0C:AA1B  37                  	db $37		;[Note] 56
    2028.  0C:AA1C  95 02               	db $95, $02	; track detune
    2029.  0C:AA1E  C7                  	db $C7		;[Wait] 8
    2030.  0C:AA1F  3D                  	db $3D		;[Note] 62
    2031.  0C:AA20  95 01               	db $95, $01	; track detune
    2032.  0C:AA22  C0                  	db $C0		;[Wait] 1
    2033.  0C:AA23  3E                  	db $3E		;[Note] 63
    2034.  0C:AA24  A6 03               	db $A6, $03; tone-slide
    2035.  0C:AA26                      				;[Skip delay] 1
    2036.  0C:AA26  A6 03               	db $A6, $03; tone-slide
    2037.  0C:AA28                      				;[Skip delay] 1
    2038.  0C:AA28  A6 07               	db $A6, $07; tone-slide
    2039.  0C:AA2A                      				;[Skip delay] 1
    2040.  0C:AA2A  A6 08               	db $A6, $08; tone-slide
    2041.  0C:AA2C                      				;[Skip delay] 1
    2042.  0C:AA2C  B0 01               	db $B0, $01; tone-slide rep
    2043.  0C:AA2E                      				;[Skip delay] 1
    2044.  0C:AA2E  A6 09               	db $A6, $09; tone-slide
    2045.  0C:AA30                      				;[Skip delay] 1
    2046.  0C:AA30  B0 01               	db $B0, $01; tone-slide rep
    2047.  0C:AA32                      				;[Skip delay] 1
    2048.  0C:AA32  3A                  	db $3A		;[Note] 59
    2049.  0C:AA33  95 01               	db $95, $01	; track detune
    2050.  0C:AA35  C1                  	db $C1		;[Wait] 2
    2051.  0C:AA36  BF                  	db $BF		;[End-Of-Track]
    2052.  0C:AA37                      .track_40:
    2053.  0C:AA37  94 01               	db $94, $01	; vibrato control
    2054.  0C:AA39  C7                  	db $C7		;[Wait] 8
    2055.  0C:AA3A  12                  	db $12		;[Note] 19
    2056.  0C:AA3B  6B                  	db $6B		;[Volume] 11
    2057.  0C:AA3C  7B                  	db $7B		;[Instrument] 12
    2058.  0C:AA3D  95 07               	db $95, $07	; track detune
    2059.  0C:AA3F  C0                  	db $C0		;[Wait] 1
    2060.  0C:AA40  A5 01               	db $A5, $01; slide-down
    2061.  0C:AA42  C6                  	db $C6		;[Wait] 7
    2062.  0C:AA43  10                  	db $10		;[Note] 17
    2063.  0C:AA44  95 02               	db $95, $02	; track detune
    2064.  0C:AA46  C3                  	db $C3		;[Wait] 4
    2065.  0C:AA47  12                  	db $12		;[Note] 19
    2066.  0C:AA48  95 07               	db $95, $07	; track detune
    2067.  0C:AA4A  C0                  	db $C0		;[Wait] 1
    2068.  0C:AA4B  A5 01               	db $A5, $01; slide-down
    2069.  0C:AA4D  C6                  	db $C6		;[Wait] 7
    2070.  0C:AA4E  0B                  	db $0B		;[Note] 12
    2071.  0C:AA4F  95 06               	db $95, $06	; track detune
    2072.  0C:AA51  C7                  	db $C7		;[Wait] 8
    2073.  0C:AA52  17                  	db $17		;[Note] 24
    2074.  0C:AA53  95 06               	db $95, $06	; track detune
    2075.  0C:AA55  C3                  	db $C3		;[Wait] 4
    2076.  0C:AA56  0B                  	db $0B		;[Note] 12
    2077.  0C:AA57                      				;[Skip delay] 4
    2078.  0C:AA57  19                  	db $19		;[Note] 26
    2079.  0C:AA58                      				;[Skip delay] 4
    2080.  0C:AA58  0E                  	db $0E		;[Note] 15
    2081.  0C:AA59  95 03               	db $95, $03	; track detune
    2082.  0C:AA5B                      				;[Skip delay] 4
    2083.  0C:AA5B  1B                  	db $1B		;[Note] 28
    2084.  0C:AA5C  95 01               	db $95, $01	; track detune
    2085.  0C:AA5E                      				;[Skip delay] 4
    2086.  0C:AA5E  12                  	db $12		;[Note] 19
    2087.  0C:AA5F  95 07               	db $95, $07	; track detune
    2088.  0C:AA61  C0                  	db $C0		;[Wait] 1
    2089.  0C:AA62  A5 01               	db $A5, $01; slide-down
    2090.  0C:AA64  C2                  	db $C2		;[Wait] 3
    2091.  0C:AA65  10                  	db $10		;[Note] 17
    2092.  0C:AA66  95 07               	db $95, $07	; track detune
    2093.  0C:AA68  C3                  	db $C3		;[Wait] 4
    2094.  0C:AA69  BF                  	db $BF		;[End-Of-Track]
    2095.  0C:AA6A                      .track_41:
    2096.  0C:AA6A  C7                  	db $C7		;[Wait] 8
    2097.  0C:AA6B  12                  	db $12		;[Note] 19
    2098.  0C:AA6C  6F                  	db $6F		;[Volume] 15
    2099.  0C:AA6D  7A                  	db $7A		;[Instrument] 11
    2100.  0C:AA6E  95 07               	db $95, $07	; track detune
    2101.  0C:AA70  C0                  	db $C0		;[Wait] 1
    2102.  0C:AA71  A5 01               	db $A5, $01; slide-down
    2103.  0C:AA73  C6                  	db $C6		;[Wait] 7
    2104.  0C:AA74  10                  	db $10		;[Note] 17
    2105.  0C:AA75  95 02               	db $95, $02	; track detune
    2106.  0C:AA77  C3                  	db $C3		;[Wait] 4
    2107.  0C:AA78  12                  	db $12		;[Note] 19
    2108.  0C:AA79  95 07               	db $95, $07	; track detune
    2109.  0C:AA7B  C0                  	db $C0		;[Wait] 1
    2110.  0C:AA7C  A5 01               	db $A5, $01; slide-down
    2111.  0C:AA7E  C6                  	db $C6		;[Wait] 7
    2112.  0C:AA7F  0B                  	db $0B		;[Note] 12
    2113.  0C:AA80  95 06               	db $95, $06	; track detune
    2114.  0C:AA82  C7                  	db $C7		;[Wait] 8
    2115.  0C:AA83  17                  	db $17		;[Note] 24
    2116.  0C:AA84  95 06               	db $95, $06	; track detune
    2117.  0C:AA86  C3                  	db $C3		;[Wait] 4
    2118.  0C:AA87  0B                  	db $0B		;[Note] 12
    2119.  0C:AA88                      				;[Skip delay] 4
    2120.  0C:AA88  19                  	db $19		;[Note] 26
    2121.  0C:AA89                      				;[Skip delay] 4
    2122.  0C:AA89  0E                  	db $0E		;[Note] 15
    2123.  0C:AA8A  95 03               	db $95, $03	; track detune
    2124.  0C:AA8C                      				;[Skip delay] 4
    2125.  0C:AA8C  1B                  	db $1B		;[Note] 28
    2126.  0C:AA8D  95 01               	db $95, $01	; track detune
    2127.  0C:AA8F                      				;[Skip delay] 4
    2128.  0C:AA8F  12                  	db $12		;[Note] 19
    2129.  0C:AA90  95 07               	db $95, $07	; track detune
    2130.  0C:AA92  C0                  	db $C0		;[Wait] 1
    2131.  0C:AA93  A5 01               	db $A5, $01; slide-down
    2132.  0C:AA95  C2                  	db $C2		;[Wait] 3
    2133.  0C:AA96  10                  	db $10		;[Note] 17
    2134.  0C:AA97  95 07               	db $95, $07	; track detune
    2135.  0C:AA99  C3                  	db $C3		;[Wait] 4
    2136.  0C:AA9A  BF                  	db $BF		;[End-Of-Track]
    2137.  0C:AA9B                      .track_42:
    2138.  0C:AA9B  39                  	db $39		;[Note] 58
    2139.  0C:AA9C  6B                  	db $6B		;[Volume] 11
    2140.  0C:AA9D  7E                  	db $7E		;[Instrument] 15
    2141.  0C:AA9E  95 00               	db $95, $00	; track detune
    2142.  0C:AAA0  C0                  	db $C0		;[Wait] 1
    2143.  0C:AAA1  6C                  	db $6C		;[Volume] 12
    2144.  0C:AAA2  C2                  	db $C2		;[Wait] 3
    2145.  0C:AAA3  32                  	db $32		;[Note] 51
    2146.  0C:AAA4  6B                  	db $6B		;[Volume] 11
    2147.  0C:AAA5  C0                  	db $C0		;[Wait] 1
    2148.  0C:AAA6  6C                  	db $6C		;[Volume] 12
    2149.  0C:AAA7                      				;[Skip delay] 1
    2150.  0C:AAA7  6A                  	db $6A		;[Volume] 10
    2151.  0C:AAA8                      				;[Skip delay] 1
    2152.  0C:AAA8  6B                  	db $6B		;[Volume] 11
    2153.  0C:AAA9                      				;[Skip delay] 1
    2154.  0C:AAA9  3B                  	db $3B		;[Note] 60
    2155.  0C:AAAA  C0                  	db $C0		;[Wait..] 1
    2156.  0C:AAAB  6C                  	db $6C		;[Volume] 12
    2157.  0C:AAAC  C2                  	db $C2		;[Wait] 3
    2158.  0C:AAAD  32                  	db $32		;[Note] 51
    2159.  0C:AAAE  6B                  	db $6B		;[Volume] 11
    2160.  0C:AAAF  C0                  	db $C0		;[Wait] 1
    2161.  0C:AAB0  6C                  	db $6C		;[Volume] 12
    2162.  0C:AAB1                      				;[Skip delay] 1
    2163.  0C:AAB1  6A                  	db $6A		;[Volume] 10
    2164.  0C:AAB2                      				;[Skip delay] 1
    2165.  0C:AAB2  6B                  	db $6B		;[Volume] 11
    2166.  0C:AAB3                      				;[Skip delay] 1
    2167.  0C:AAB3  3D                  	db $3D		;[Note] 62
    2168.  0C:AAB4  C0                  	db $C0		;[Wait..] 1
    2169.  0C:AAB5  6C                  	db $6C		;[Volume] 12
    2170.  0C:AAB6  C2                  	db $C2		;[Wait] 3
    2171.  0C:AAB7  32                  	db $32		;[Note] 51
    2172.  0C:AAB8  6B                  	db $6B		;[Volume] 11
    2173.  0C:AAB9  C0                  	db $C0		;[Wait] 1
    2174.  0C:AABA  6C                  	db $6C		;[Volume] 12
    2175.  0C:AABB  C1                  	db $C1		;[Wait] 2
    2176.  0C:AABC  6A                  	db $6A		;[Volume] 10
    2177.  0C:AABD  C0                  	db $C0		;[Wait] 1
    2178.  0C:AABE  39                  	db $39		;[Note] 58
    2179.  0C:AABF  6B                  	db $6B		;[Volume] 11
    2180.  0C:AAC0                      				;[Skip delay] 1
    2181.  0C:AAC0  6C                  	db $6C		;[Volume] 12
    2182.  0C:AAC1  C2                  	db $C2		;[Wait] 3
    2183.  0C:AAC2  3D                  	db $3D		;[Note] 62
    2184.  0C:AAC3  6B                  	db $6B		;[Volume] 11
    2185.  0C:AAC4  C0                  	db $C0		;[Wait] 1
    2186.  0C:AAC5  3E                  	db $3E		;[Note] 63
    2187.  0C:AAC6  6C                  	db $6C		;[Volume] 12
    2188.  0C:AAC7  A6 03               	db $A6, $03; tone-slide
    2189.  0C:AAC9                      				;[Skip delay] 1
    2190.  0C:AAC9  A6 06               	db $A6, $06; tone-slide
    2191.  0C:AACB                      				;[Skip delay] 1
    2192.  0C:AACB  A6 09               	db $A6, $09; tone-slide
    2193.  0C:AACD                      				;[Skip delay] 1
    2194.  0C:AACD  6B                  	db $6B		;[Volume] 11
    2195.  0C:AACE  B0 04               	db $B0, $04; tone-slide rep
    2196.  0C:AAD0  C3                  	db $C3		;[Wait] 4
    2197.  0C:AAD1  3D                  	db $3D		;[Note] 62
    2198.  0C:AAD2  C0                  	db $C0		;[Wait] 1
    2199.  0C:AAD3  6C                  	db $6C		;[Volume] 12
    2200.  0C:AAD4  C2                  	db $C2		;[Wait] 3
    2201.  0C:AAD5  6B                  	db $6B		;[Volume] 11
    2202.  0C:AAD6  C3                  	db $C3		;[Wait] 4
    2203.  0C:AAD7  3B                  	db $3B		;[Note] 60
    2204.  0C:AAD8  C0                  	db $C0		;[Wait] 1
    2205.  0C:AAD9  6C                  	db $6C		;[Volume] 12
    2206.  0C:AADA  C2                  	db $C2		;[Wait] 3
    2207.  0C:AADB  6B                  	db $6B		;[Volume] 11
    2208.  0C:AADC  C3                  	db $C3		;[Wait] 4
    2209.  0C:AADD  3E                  	db $3E		;[Note] 63
    2210.  0C:AADE  C0                  	db $C0		;[Wait] 1
    2211.  0C:AADF  6C                  	db $6C		;[Volume] 12
    2212.  0C:AAE0  C2                  	db $C2		;[Wait] 3
    2213.  0C:AAE1  6B                  	db $6B		;[Volume] 11
    2214.  0C:AAE2  C3                  	db $C3		;[Wait] 4
    2215.  0C:AAE3  39                  	db $39		;[Note] 58
    2216.  0C:AAE4  6A                  	db $6A		;[Volume] 10
    2217.  0C:AAE5  C0                  	db $C0		;[Wait] 1
    2218.  0C:AAE6  6B                  	db $6B		;[Volume] 11
    2219.  0C:AAE7                      				;[Skip delay] 1
    2220.  0C:AAE7  6C                  	db $6C		;[Volume] 12
    2221.  0C:AAE8                      				;[Skip delay] 1
    2222.  0C:AAE8  6D                  	db $6D		;[Volume] 13
    2223.  0C:AAE9                      				;[Skip delay] 1
    2224.  0C:AAE9  BF                  	db $BF		;[End-Of-Track]
    2225.  0C:AAEA                      .track_43:
    2226.  0C:AAEA  C5                  	db $C5		;[Wait] 6
    2227.  0C:AAEB  39                  	db $39		;[Note] 58
    2228.  0C:AAEC  62                  	db $62		;[Volume] 2
    2229.  0C:AAED  7F                  	db $7F		;[Instrument] 16
    2230.  0C:AAEE  95 00               	db $95, $00	; track detune
    2231.  0C:AAF0  C3                  	db $C3		;[Wait] 4
    2232.  0C:AAF1  32                  	db $32		;[Note] 51
    2233.  0C:AAF2                      				;[Skip delay] 4
    2234.  0C:AAF2  3B                  	db $3B		;[Note] 60
    2235.  0C:AAF3                      				;[Skip delay] 4
    2236.  0C:AAF3  32                  	db $32		;[Note] 51
    2237.  0C:AAF4                      				;[Skip delay] 4
    2238.  0C:AAF4  3D                  	db $3D		;[Note] 62
    2239.  0C:AAF5                      				;[Skip delay] 4
    2240.  0C:AAF5  32                  	db $32		;[Note] 51
    2241.  0C:AAF6                      				;[Skip delay] 4
    2242.  0C:AAF6  39                  	db $39		;[Note] 58
    2243.  0C:AAF7                      				;[Skip delay] 4
    2244.  0C:AAF7  3D                  	db $3D		;[Note] 62
    2245.  0C:AAF8  C0                  	db $C0		;[Wait] 1
    2246.  0C:AAF9  3E                  	db $3E		;[Note] 63
    2247.  0C:AAFA  A6 03               	db $A6, $03; tone-slide
    2248.  0C:AAFC                      				;[Skip delay] 1
    2249.  0C:AAFC  A6 06               	db $A6, $06; tone-slide
    2250.  0C:AAFE                      				;[Skip delay] 1
    2251.  0C:AAFE  A6 09               	db $A6, $09; tone-slide
    2252.  0C:AB00                      				;[Skip delay] 1
    2253.  0C:AB00  B0 04               	db $B0, $04; tone-slide rep
    2254.  0C:AB02  C3                  	db $C3		;[Wait] 4
    2255.  0C:AB03  3D                  	db $3D		;[Note] 62
    2256.  0C:AB04  C7                  	db $C7		;[Wait] 8
    2257.  0C:AB05  3B                  	db $3B		;[Note] 60
    2258.  0C:AB06                      				;[Skip delay] 8
    2259.  0C:AB06  3E                  	db $3E		;[Note] 63
    2260.  0C:AB07  C5                  	db $C5		;[Wait] 6
    2261.  0C:AB08  BF                  	db $BF		;[End-Of-Track]
    2262.  0C:AB09                      .track_44:
    2263.  0C:AB09  0C                  	db $0C		;[Note] 13
    2264.  0C:AB0A  6F                  	db $6F		;[Volume] 15
    2265.  0C:AB0B  70                  	db $70		;[Instrument] 1
    2266.  0C:AB0C  C3                  	db $C3		;[Wait] 4
    2267.  0C:AB0D  0C                  	db $0C		;[Note] 13
    2268.  0C:AB0E  75                  	db $75		;[Instrument] 6
    2269.  0C:AB0F                      				;[Skip delay] 4
    2270.  0C:AB0F  13                  	db $13		;[Note] 20
    2271.  0C:AB10  6E                  	db $6E		;[Volume] 14
    2272.  0C:AB11  71                  	db $71		;[Instrument] 2
    2273.  0C:AB12  C7                  	db $C7		;[Wait] 8
    2274.  0C:AB13  13                  	db $13		;[Note] 20
    2275.  0C:AB14  C0                  	db $C0		;[Wait] 1
    2276.  0C:AB15  6D                  	db $6D		;[Volume] 13
    2277.  0C:AB16  C2                  	db $C2		;[Wait] 3
    2278.  0C:AB17  0C                  	db $0C		;[Note] 13
    2279.  0C:AB18  6F                  	db $6F		;[Volume] 15
    2280.  0C:AB19  70                  	db $70		;[Instrument] 1
    2281.  0C:AB1A  C3                  	db $C3		;[Wait] 4
    2282.  0C:AB1B  13                  	db $13		;[Note] 20
    2283.  0C:AB1C  6E                  	db $6E		;[Volume] 14
    2284.  0C:AB1D  71                  	db $71		;[Instrument] 2
    2285.  0C:AB1E                      				;[Skip delay] 4
    2286.  0C:AB1E  5F                  	db $5F		;[Note] 96
    2287.  0C:AB1F  6F                  	db $6F		;[Volume] 15
    2288.  0C:AB20  79                  	db $79		;[Instrument] 10
    2289.  0C:AB21  C7                  	db $C7		;[Wait] 8
    2290.  0C:AB22  13                  	db $13		;[Note] 20
    2291.  0C:AB23  6E                  	db $6E		;[Volume] 14
    2292.  0C:AB24  71                  	db $71		;[Instrument] 2
    2293.  0C:AB25  C0                  	db $C0		;[Wait] 1
    2294.  0C:AB26  6D                  	db $6D		;[Volume] 13
    2295.  0C:AB27  C2                  	db $C2		;[Wait] 3
    2296.  0C:AB28  13                  	db $13		;[Note] 20
    2297.  0C:AB29  6E                  	db $6E		;[Volume] 14
    2298.  0C:AB2A  C0                  	db $C0		;[Wait] 1
    2299.  0C:AB2B  6D                  	db $6D		;[Volume] 13
    2300.  0C:AB2C  C2                  	db $C2		;[Wait] 3
    2301.  0C:AB2D  13                  	db $13		;[Note] 20
    2302.  0C:AB2E  6E                  	db $6E		;[Volume] 14
    2303.  0C:AB2F  C3                  	db $C3		;[Wait] 4
    2304.  0C:AB30  13                  	db $13		;[Note] 20
    2305.  0C:AB31  C0                  	db $C0		;[Wait] 1
    2306.  0C:AB32  6D                  	db $6D		;[Volume] 13
    2307.  0C:AB33  C2                  	db $C2		;[Wait] 3
    2308.  0C:AB34  13                  	db $13		;[Note] 20
    2309.  0C:AB35  6E                  	db $6E		;[Volume] 14
    2310.  0C:AB36                      				;[Skip delay] 3
    2311.  0C:AB36  6D                  	db $6D		;[Volume] 13
    2312.  0C:AB37  C0                  	db $C0		;[Wait] 1
    2313.  0C:AB38  13                  	db $13		;[Note] 20
    2314.  0C:AB39  6E                  	db $6E		;[Volume] 14
    2315.  0C:AB3A                      				;[Skip delay] 1
    2316.  0C:AB3A  6D                  	db $6D		;[Volume] 13
    2317.  0C:AB3B  C2                  	db $C2		;[Wait] 3
    2318.  0C:AB3C  13                  	db $13		;[Note] 20
    2319.  0C:AB3D  6E                  	db $6E		;[Volume] 14
    2320.  0C:AB3E                      				;[Skip delay] 3
    2321.  0C:AB3E  6D                  	db $6D		;[Volume] 13
    2322.  0C:AB3F  C0                  	db $C0		;[Wait] 1
    2323.  0C:AB40  BF                  	db $BF		;[End-Of-Track]
    2324.  0C:AB41                      .track_45:
    2325.  0C:AB41  94 01               	db $94, $01	; vibrato control
    2326.  0C:AB43  C3                  	db $C3		;[Wait] 4
    2327.  0C:AB44  10                  	db $10		;[Note] 17
    2328.  0C:AB45  6B                  	db $6B		;[Volume] 11
    2329.  0C:AB46  7B                  	db $7B		;[Instrument] 12
    2330.  0C:AB47  95 07               	db $95, $07	; track detune
    2331.  0C:AB49                      				;[Skip delay] 4
    2332.  0C:AB49  1C                  	db $1C		;[Note] 29
    2333.  0C:AB4A  95 01               	db $95, $01	; track detune
    2334.  0C:AB4C                      				;[Skip delay] 4
    2335.  0C:AB4C  10                  	db $10		;[Note] 17
    2336.  0C:AB4D  95 07               	db $95, $07	; track detune
    2337.  0C:AB4F                      				;[Skip delay] 4
    2338.  0C:AB4F  0E                  	db $0E		;[Note] 15
    2339.  0C:AB50  95 06               	db $95, $06	; track detune
    2340.  0C:AB52  C0                  	db $C0		;[Wait] 1
    2341.  0C:AB53  10                  	db $10		;[Note] 17
    2342.  0C:AB54  A6 0F               	db $A6, $0F; tone-slide
    2343.  0C:AB56                      				;[Skip delay] 1
    2344.  0C:AB56  A6 10               	db $A6, $10; tone-slide
    2345.  0C:AB58                      				;[Skip delay] 1
    2346.  0C:AB58  A6 0F               	db $A6, $0F; tone-slide
    2347.  0C:AB5A                      				;[Skip delay] 1
    2348.  0C:AB5A  A6 0F               	db $A6, $0F; tone-slide
    2349.  0C:AB5C                      				;[Skip delay] 1
    2350.  0C:AB5C  A6 10               	db $A6, $10; tone-slide
    2351.  0C:AB5E                      				;[Skip delay] 1
    2352.  0C:AB5E  B0 02               	db $B0, $02; tone-slide rep
    2353.  0C:AB60  C1                  	db $C1		;[Wait] 2
    2354.  0C:AB61  0B                  	db $0B		;[Note] 12
    2355.  0C:AB62  95 01               	db $95, $01	; track detune
    2356.  0C:AB64  C3                  	db $C3		;[Wait] 4
    2357.  0C:AB65  09                  	db $09		;[Note] 10
    2358.  0C:AB66  95 00               	db $95, $00	; track detune
    2359.  0C:AB68  C7                  	db $C7		;[Wait] 8
    2360.  0C:AB69  09                  	db $09		;[Note] 10
    2361.  0C:AB6A  C3                  	db $C3		;[Wait] 4
    2362.  0C:AB6B  15                  	db $15		;[Note] 22
    2363.  0C:AB6C  95 02               	db $95, $02	; track detune
    2364.  0C:AB6E                      				;[Skip delay] 4
    2365.  0C:AB6E  09                  	db $09		;[Note] 10
    2366.  0C:AB6F  95 00               	db $95, $00	; track detune
    2367.  0C:AB71  C7                  	db $C7		;[Wait] 8
    2368.  0C:AB72  09                  	db $09		;[Note] 10
    2369.  0C:AB73  C3                  	db $C3		;[Wait] 4
    2370.  0C:AB74  0B                  	db $0B		;[Note] 12
    2371.  0C:AB75  95 02               	db $95, $02	; track detune
    2372.  0C:AB77                      				;[Skip delay] 4
    2373.  0C:AB77  0E                  	db $0E		;[Note] 15
    2374.  0C:AB78  95 02               	db $95, $02	; track detune
    2375.  0C:AB7A                      				;[Skip delay] 4
    2376.  0C:AB7A  BF                  	db $BF		;[End-Of-Track]
    2377.  0C:AB7B                      .track_46:
    2378.  0C:AB7B  1E                  	db $1E		;[Note] 31
    2379.  0C:AB7C  6F                  	db $6F		;[Volume] 15
    2380.  0C:AB7D  7C                  	db $7C		;[Instrument] 13
    2381.  0C:AB7E  95 07               	db $95, $07	; track detune
    2382.  0C:AB80  C7                  	db $C7		;[Wait] 8
    2383.  0C:AB81  6E                  	db $6E		;[Volume] 14
    2384.  0C:AB82  D3                  	db $D3		;[Wait] 20
    2385.  0C:AB83  1F                  	db $1F		;[Note] 32
    2386.  0C:AB84  6F                  	db $6F		;[Volume] 15
    2387.  0C:AB85  95 07               	db $95, $07	; track detune
    2388.  0C:AB87  C7                  	db $C7		;[Wait] 8
    2389.  0C:AB88  6E                  	db $6E		;[Volume] 14
    2390.  0C:AB89                      				;[Skip delay] 8
    2391.  0C:AB89  1F                  	db $1F		;[Note] 32
    2392.  0C:AB8A  6F                  	db $6F		;[Volume] 15
    2393.  0C:AB8B  95 07               	db $95, $07	; track detune
    2394.  0C:AB8D                      				;[Skip delay] 8
    2395.  0C:AB8D  1F                  	db $1F		;[Note] 32
    2396.  0C:AB8E  95 07               	db $95, $07	; track detune
    2397.  0C:AB90                      				;[Skip delay] 8
    2398.  0C:AB90  6E                  	db $6E		;[Volume] 14
    2399.  0C:AB91  C3                  	db $C3		;[Wait] 4
    2400.  0C:AB92  BF                  	db $BF		;[End-Of-Track]
    2401.  0C:AB93                      .track_47:
    2402.  0C:AB93  1A                  	db $1A		;[Note] 27
    2403.  0C:AB94  6F                  	db $6F		;[Volume] 15
    2404.  0C:AB95  7C                  	db $7C		;[Instrument] 13
    2405.  0C:AB96  95 06               	db $95, $06	; track detune
    2406.  0C:AB98  C7                  	db $C7		;[Wait] 8
    2407.  0C:AB99  6E                  	db $6E		;[Volume] 14
    2408.  0C:AB9A  D3                  	db $D3		;[Wait] 20
    2409.  0C:AB9B  1A                  	db $1A		;[Note] 27
    2410.  0C:AB9C  6F                  	db $6F		;[Volume] 15
    2411.  0C:AB9D  95 06               	db $95, $06	; track detune
    2412.  0C:AB9F  C7                  	db $C7		;[Wait] 8
    2413.  0C:ABA0  6E                  	db $6E		;[Volume] 14
    2414.  0C:ABA1                      				;[Skip delay] 8
    2415.  0C:ABA1  1A                  	db $1A		;[Note] 27
    2416.  0C:ABA2  6F                  	db $6F		;[Volume] 15
    2417.  0C:ABA3  95 06               	db $95, $06	; track detune
    2418.  0C:ABA5                      				;[Skip delay] 8
    2419.  0C:ABA5  1A                  	db $1A		;[Note] 27
    2420.  0C:ABA6  95 06               	db $95, $06	; track detune
    2421.  0C:ABA8                      				;[Skip delay] 8
    2422.  0C:ABA8  6E                  	db $6E		;[Volume] 14
    2423.  0C:ABA9  C3                  	db $C3		;[Wait] 4
    2424.  0C:ABAA  BF                  	db $BF		;[End-Of-Track]
    2425.  0C:ABAB                      .track_48:
    2426.  0C:ABAB  6E                  	db $6E		;[Volume] 14
    2427.  0C:ABAC  C3                  	db $C3		;[Wait] 4
    2428.  0C:ABAD  A7 74               	db $A7, $74	;[CMD vibrato]
    2429.  0C:ABAF  C0                  	db $C0		;[Wait] 1
    2430.  0C:ABB0  B1 0B               	db $B1, $0B	;[CMD vibrato] rep
    2431.  0C:ABB2  C2                  	db $C2		;[Wait] 3
    2432.  0C:ABB3  6D                  	db $6D		;[Volume] 13
    2433.  0C:ABB4  C7                  	db $C7		;[Wait] 8
    2434.  0C:ABB5  60                  	db $60		;[Note] 97
    2435.  0C:ABB6  C3                  	db $C3		;[Wait] 4
    2436.  0C:ABB7  2D                  	db $2D		;[Note] 46
    2437.  0C:ABB8  6B                  	db $6B		;[Volume] 11
    2438.  0C:ABB9  7E                  	db $7E		;[Instrument] 15
    2439.  0C:ABBA  95 00               	db $95, $00	; track detune
    2440.  0C:ABBC  C0                  	db $C0		;[Wait] 1
    2441.  0C:ABBD  6C                  	db $6C		;[Volume] 12
    2442.  0C:ABBE  C2                  	db $C2		;[Wait] 3
    2443.  0C:ABBF  2F                  	db $2F		;[Note] 48
    2444.  0C:ABC0  6B                  	db $6B		;[Volume] 11
    2445.  0C:ABC1  C0                  	db $C0		;[Wait] 1
    2446.  0C:ABC2  6C                  	db $6C		;[Volume] 12
    2447.  0C:ABC3  C2                  	db $C2		;[Wait] 3
    2448.  0C:ABC4  32                  	db $32		;[Note] 51
    2449.  0C:ABC5  6B                  	db $6B		;[Volume] 11
    2450.  0C:ABC6  C0                  	db $C0		;[Wait] 1
    2451.  0C:ABC7  6C                  	db $6C		;[Volume] 12
    2452.  0C:ABC8  C1                  	db $C1		;[Wait] 2
    2453.  0C:ABC9  6A                  	db $6A		;[Volume] 10
    2454.  0C:ABCA  C0                  	db $C0		;[Wait] 1
    2455.  0C:ABCB  36                  	db $36		;[Note] 55
    2456.  0C:ABCC  6B                  	db $6B		;[Volume] 11
    2457.  0C:ABCD  95 08               	db $95, $08	; track detune
    2458.  0C:ABCF                      				;[Skip delay] 1
    2459.  0C:ABCF  37                  	db $37		;[Note] 56
    2460.  0C:ABD0  6C                  	db $6C		;[Volume] 12
    2461.  0C:ABD1  A6 01               	db $A6, $01; tone-slide
    2462.  0C:ABD3  C1                  	db $C1		;[Wait] 2
    2463.  0C:ABD4  B0 05               	db $B0, $05; tone-slide rep
    2464.  0C:ABD6  C4                  	db $C4		;[Wait] 5
    2465.  0C:ABD7  36                  	db $36		;[Note] 55
    2466.  0C:ABD8  6B                  	db $6B		;[Volume] 11
    2467.  0C:ABD9  95 00               	db $95, $00	; track detune
    2468.  0C:ABDB  C0                  	db $C0		;[Wait] 1
    2469.  0C:ABDC  6C                  	db $6C		;[Volume] 12
    2470.  0C:ABDD  C6                  	db $C6		;[Wait] 7
    2471.  0C:ABDE  32                  	db $32		;[Note] 51
    2472.  0C:ABDF  6B                  	db $6B		;[Volume] 11
    2473.  0C:ABE0  95 01               	db $95, $01	; track detune
    2474.  0C:ABE2  C0                  	db $C0		;[Wait] 1
    2475.  0C:ABE3  6C                  	db $6C		;[Volume] 12
    2476.  0C:ABE4  C6                  	db $C6		;[Wait] 7
    2477.  0C:ABE5  34                  	db $34		;[Note] 53
    2478.  0C:ABE6  6B                  	db $6B		;[Volume] 11
    2479.  0C:ABE7  95 00               	db $95, $00	; track detune
    2480.  0C:ABE9  C0                  	db $C0		;[Wait] 1
    2481.  0C:ABEA  6C                  	db $6C		;[Volume] 12
    2482.  0C:ABEB  C6                  	db $C6		;[Wait] 7
    2483.  0C:ABEC  BF                  	db $BF		;[End-Of-Track]
    2484.  0C:ABED                      .track_49:
    2485.  0C:ABED  C1                  	db $C1		;[Wait] 2
    2486.  0C:ABEE  39                  	db $39		;[Note] 58
    2487.  0C:ABEF  62                  	db $62		;[Volume] 2
    2488.  0C:ABF0  7F                  	db $7F		;[Instrument] 16
    2489.  0C:ABF1  C7                  	db $C7		;[Wait] 8
    2490.  0C:ABF2  A7 74               	db $A7, $74	;[CMD vibrato]
    2491.  0C:ABF4  C0                  	db $C0		;[Wait] 1
    2492.  0C:ABF5  B1 0B               	db $B1, $0B	;[CMD vibrato] rep
    2493.  0C:ABF7  CA                  	db $CA		;[Wait] 11
    2494.  0C:ABF8  60                  	db $60		;[Note] 97
    2495.  0C:ABF9  C3                  	db $C3		;[Wait] 4
    2496.  0C:ABFA  2D                  	db $2D		;[Note] 46
    2497.  0C:ABFB  63                  	db $63		;[Volume] 3
    2498.  0C:ABFC  95 01               	db $95, $01	; track detune
    2499.  0C:ABFE                      				;[Skip delay] 4
    2500.  0C:ABFE  2F                  	db $2F		;[Note] 48
    2501.  0C:ABFF                      				;[Skip delay] 4
    2502.  0C:ABFF  32                  	db $32		;[Note] 51
    2503.  0C:AC00                      				;[Skip delay] 4
    2504.  0C:AC00  36                  	db $36		;[Note] 55
    2505.  0C:AC01  95 00               	db $95, $00	; track detune
    2506.  0C:AC03  C0                  	db $C0		;[Wait] 1
    2507.  0C:AC04  37                  	db $37		;[Note] 56
    2508.  0C:AC05  A6 01               	db $A6, $01; tone-slide
    2509.  0C:AC07  C1                  	db $C1		;[Wait] 2
    2510.  0C:AC08  B0 05               	db $B0, $05; tone-slide rep
    2511.  0C:AC0A  C4                  	db $C4		;[Wait] 5
    2512.  0C:AC0B  36                  	db $36		;[Note] 55
    2513.  0C:AC0C  95 00               	db $95, $00	; track detune
    2514.  0C:AC0E  C7                  	db $C7		;[Wait] 8
    2515.  0C:AC0F  32                  	db $32		;[Note] 51
    2516.  0C:AC10  95 01               	db $95, $01	; track detune
    2517.  0C:AC12                      				;[Skip delay] 8
    2518.  0C:AC12  34                  	db $34		;[Note] 53
    2519.  0C:AC13  95 00               	db $95, $00	; track detune
    2520.  0C:AC15  C1                  	db $C1		;[Wait] 2
    2521.  0C:AC16  BF                  	db $BF		;[End-Of-Track]
    2522.  0C:AC17                      .track_50:
    2523.  0C:AC17  BF                  	db $BF		;[End-Of-Track]
    2524.  0C:AC18                      ; [ Song sub-track data ]
     402   0C:AC18                      		include	"..\TTplayer\code\ttreplayDAT.asm"
       1.  0C:AC18                      
       2.  0C:AC18  00 (128)            	ds 8*16, 0
       3.  0C:AC98                      _VOLUME_TABLE
       4.  0C:AC98  (0100)              	incbin ".\voltable_combined.bin"	
       5.  0C:AD98                      
       6.  0C:AD98                      ;Konami values found in	Nemesis 2 replayer.
       7.  0C:AD98  (0C:0D40)           C_PER		equ	$6a*32	
       8.  0C:AD98  (0C:0C80)           C1_PER	equ	$64*32
       9.  0C:AD98  (0C:0BC0)           D_PER		equ	$5e*32
      10.  0C:AD98  (0C:0B20)           D1_PER	equ	$59*32
      11.  0C:AD98  (0C:0A80)           E_PER		equ	$54*32
      12.  0C:AD98  (0C:09E0)           F_PER		equ	$4f*32
      13.  0C:AD98  (0C:0940)           F1_PER	equ	$4a*32
      14.  0C:AD98  (0C:08C0)           G_PER		equ	$46*32
      15.  0C:AD98  (0C:0840)           G1_PER	equ	$42*32
      16.  0C:AD98  (0C:07E0)           A_PER		equ	$3f*32
      17.  0C:AD98  (0C:0760)           A1_PER	equ	$3b*32
      18.  0C:AD98  (0C:0700)           B_PER		equ	$38*32
      19.  0C:AD98                      
      20.  0C:AD98                      TRACK_ToneTable:	
      21.  0C:AD98                      	dw C_PER/1	,C1_PER/1  ,D_PER/1  ,D1_PER/1  ,E_PER/1	,F_PER/1  ,F1_PER/1  ,G_PER/1	 ,G1_PER/1	,A_PER/1  ,A1_PER/1  ,B_PER/1
      21.  0C:AD98  40 0D 80 0C C0 0B 20 0B 80 0A E0 09 40 09 C0 08 
      21.  0C:ADA8  40 08 E0 07 60 07 00 07 
      22.  0C:ADB0                      	dw C_PER/2	,C1_PER/2  ,D_PER/2  ,D1_PER/2  ,E_PER/2	,F_PER/2  ,F1_PER/2  ,G_PER/2	 ,G1_PER/2	,A_PER/2  ,A1_PER/2  ,B_PER/2
      22.  0C:ADB0  A0 06 40 06 E0 05 90 05 40 05 F0 04 A0 04 60 04 
      22.  0C:ADC0  20 04 F0 03 B0 03 80 03 
      23.  0C:ADC8                      	dw C_PER/4	,C1_PER/4  ,D_PER/4  ,D1_PER/4  ,E_PER/4	,F_PER/4  ,F1_PER/4  ,G_PER/4	 ,G1_PER/4	,A_PER/4  ,A1_PER/4  ,B_PER/4
      23.  0C:ADC8  50 03 20 03 F0 02 C8 02 A0 02 78 02 50 02 30 02 
      23.  0C:ADD8  10 02 F8 01 D8 01 C0 01 
      24.  0C:ADE0                      	dw C_PER/8	,C1_PER/8  ,D_PER/8  ,D1_PER/8  ,E_PER/8	,F_PER/8  ,F1_PER/8  ,G_PER/8	 ,G1_PER/8	,A_PER/8  ,A1_PER/8  ,B_PER/8
      24.  0C:ADE0  A8 01 90 01 78 01 64 01 50 01 3C 01 28 01 18 01 
      24.  0C:ADF0  08 01 FC 00 EC 00 E0 00 
      25.  0C:ADF8                      	dw C_PER/16	,C1_PER/16 ,D_PER/16 ,D1_PER/16 ,E_PER/16	,F_PER/16 ,F1_PER/16 ,G_PER/16 ,G1_PER/16	,A_PER/16 ,A1_PER/16 ,B_PER/16
      25.  0C:ADF8  D4 00 C8 00 BC 00 B2 00 A8 00 9E 00 94 00 8C 00 
      25.  0C:AE08  84 00 7E 00 76 00 70 00 
      26.  0C:AE10                      	dw C_PER/32	,C1_PER/32 ,D_PER/32 ,D1_PER/32 ,E_PER/32	,F_PER/32 ,F1_PER/32 ,G_PER/32 ,G1_PER/32	,A_PER/32 ,A1_PER/32 ,B_PER/32
      26.  0C:AE10  6A 00 64 00 5E 00 59 00 54 00 4F 00 4A 00 46 00 
      26.  0C:AE20  42 00 3F 00 3B 00 38 00 
      27.  0C:AE28                      	dw C_PER/64	,C1_PER/64 ,D_PER/64 ,D1_PER/64 ,E_PER/64	,F_PER/64 ,F1_PER/64 ,G_PER/64 ,G1_PER/64	,A_PER/64 ,A1_PER/64 ,B_PER/64
      27.  0C:AE28  35 00 32 00 2F 00 2C 00 2A 00 27 00 25 00 23 00 
      27.  0C:AE38  21 00 1F 00 1D 00 1C 00 
      28.  0C:AE40                      	dw C_PER/128,C1_PER/128,D_PER/128,D1_PER/128,E_PER/128,F_PER/128,F1_PER/128,G_PER/128,G1_PER/128,A_PER/128,A1_PER/128,B_PER/128
      28.  0C:AE40  1A 00 19 00 17 00 16 00 15 00 13 00 12 00 11 00 
      28.  0C:AE50  10 00 0F 00 0E 00 0E 00 
      29.  0C:AE58                      
      30.  0C:AE58                      
      31.  0C:AE58                      TRACK_Vibrato_sine:
      32.  0C:AE58                      	db	 0*2,	2*2, 4*2, 7*2,11*2,16*2,22*2,28*2,35*2,43*2,51*2,59*2,68*2,77*2,87*2,96*2
      32.  0C:AE58  00 04 08 0E 16 20 2C 38 46 56 66 76 88 9A AE C0 
      33.  0C:AE68                      	db	96*2,86*2,77*2,68*2,59*2,51*2,43*2,35*2,28*2,22*2,16*2,11*2, 7*2,	4*2, 2*2, 0*2
      33.  0C:AE68  C0 AC 9A 88 76 66 56 46 38 2C 20 16 0E 08 04 00 
      34.  0C:AE78                      
      35.  0C:AE78                      TRACK_Vibrato_triangle:
      36.  0C:AE78                      	db	 0, 6,12,18,24,30,36,42,48,54,60,66,72,78,84,90
      36.  0C:AE78  00 06 0C 12 18 1E 24 2A 30 36 3C 42 48 4E 54 5A 
      37.  0C:AE88                      	db	96,90,84,78,72,66,60,54,48,42,36,30,24,18,12, 6
      37.  0C:AE88  60 5A 54 4E 48 42 3C 36 30 2A 24 1E 18 12 0C 06 
      38.  0C:AE98                      
      39.  0C:AE98                      TRACK_Vibrato_pulse:
      40.  0C:AE98                      	db	255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255
      40.  0C:AE98  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
      41.  0C:AEA8                      	db      0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0	
      41.  0C:AEA8  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
      42.  0C:AEB8                      	
     403   0C:AEB8                      end_demo_song:	
     404   0C:AEB8                      
     405   0C:AEB8  (0F)                		page 15
     406   0F:A000                      _level:
     407   0F:A000  (0B00)              		incbin "datamap.bin"
     408   0F:AB00                      	
     409   0F:AB00  (10)                		page 16
     410   10:A000                      _opening:
     411   10:A000  (2000)              		incbin "opening.bin",0x0000,0x2000
     412   10:C000  (11)                		page 17
     413   11:A000  (2000)              		incbin "opening.bin",0x2000,0x2000
     414   11:C000  (12)                		page 18
     415   12:A000  (2000)              		incbin "opening.bin",0x4000,0x2000
     416   12:C000  (13)                		page 19
     417   13:A000  (2000)              		incbin "opening.bin",0x6000,0x2000
     418   13:C000  (14)                		page 20
     419   14:A000  (2000)              		incbin "opening.bin",0x8000,0x2000
     420   14:C000  (15)                		page 21
     421   15:A000  (2000)              		incbin "opening.bin",0xA000,0x2000
     422   15:C000  (16)                		page 22
     423   16:A000  (1400)              		incbin "opening.bin",0xC000;,0x2000
     424   16:B400  (17)                		page 23
     425   17:A000                      		; incbin "opening.bin",0xE000;,,0x2000
     426   17:A000                      	
     427   17:A000  (18)                		page 24
     428   18:A000                      _scorebar:	
     429   18:A000  (1800)              		incbin scorebar.bin
     430   18:B800                      	
     431   18:B800  (19)                		page 25
     432   19:A000                      _animated:	
     433   19:A000  (2000)              		incbin animated.bin,0x0000,0x2000
     434   19:C000  (1A)                		page 26
     435   1A:A000  (2000)              		incbin animated.bin,0x2000,0x2000
     436   1A:C000                      
     437   1A:C000  (1B)                		page 27
     438   1B:A000                      sprtdata:
     439   1B:A000  (0200)              		incbin 	uridium_revA.bin,,16*32
     440   1B:A200  (0600)              		incbin 	enemies_frm.bin
     441   1B:A800                      
     442   1B:A800  (1C)                		page 28
     443   1C:A000                      color_base:
     444   1C:A000                      		repeat 4
     445   1C:A000                    < 		ds	16,8
     446   1C:A000                    < 		ds	16,10+64
     447   1C:A000  08 (16)           < 		endrepeat
     448   1C:A080                      		repeat 4
     449   1C:A080                    < 		ds	16,8
     450   1C:A080                    < 		ds	16,10+64
     451   1C:A080  08 (16)           < 		endrepeat
     452   1C:A100                      
     453   1C:A100                      		
     454   1C:A100  (0300)              		incbin 	enemies_clr.bin
     455   1C:A400                      		
     456   1C:A400                      FINISH:
     457   1C:A400                      
     458   1C:A400                      
     459   1C:A400                      ;---------------------------------------------------------
     460   1C:A400                      ; Variables
     461   1C:A400                      ;---------------------------------------------------------
     462   1C:A400                      	
     463   1C:A400  (0100)              	MAP 0x100
     464   1C:A400  (1C:0100)           ttreplayRAM:		#0
     465   1C:A400                      	include	"..\TTplayer\code\ttreplayRAM.asm"
       1.  1C:A400                      ;================================
       2.  1C:A400                      ; The new replayer.
       3.  1C:A400                      ;
       4.  1C:A400                      ; Persistent RAM unswappable
       5.  1C:A400                      ;
       6.  1C:A400                      ;================================
       7.  1C:A400                      
       8.  1C:A400  (1C:FFFFFFEF)       TRACK_Instrument		equ 0-17
       9.  1C:A400  (1C:FFFFFFF0)       TRACK_Command		equ 1-17
      10.  1C:A400  (1C:FFFFFFF1)       TRACK_MacroPointer	equ 2-17
      11.  1C:A400  (1C:FFFFFFF3)       TRACK_MacroStart		equ 4-17
      12.  1C:A400  (1C:FFFFFFF5)       TRACK_MacroRestart 	equ 6-17		; no longer needed
      13.  1C:A400  (1C:FFFFFFF6)       TRACK_Note			equ 7-17
      14.  1C:A400  (1C:FFFFFFF7)       TRACK_Volume		equ 8-17
      15.  1C:A400  (1C:FFFFFFF8)       TRACK_Waveform		equ 9-17
      16.  1C:A400  (1C:FFFFFFF9)       TRACK_Flags			equ 10-17
      17.  1C:A400                      	; 0 = note trigger
      18.  1C:A400                      	; 1 = note active
      19.  1C:A400                      	; 4 = morph active		;-< for SCC when 1 then waveform is following morph buffer
      20.  1C:A400                      	; 3 = command trigger
      21.  1C:A400                      	; 2 = envelope trigger
      22.  1C:A400                      	; 5 = instrument trigger
      23.  1C:A400                      	; 6 = waveform trigger
      24.  1C:A400                      	; 7 = PSG/SCC
      25.  1C:A400  (1C:FFFFFFFA)       TRACK_empty			equ 11-17		; needed for pushing 0 at note start
      26.  1C:A400  (1C:FFFFFFFB)       TRACK_ToneAdd		equ 12-17		; reset after note set
      27.  1C:A400  (1C:FFFFFFFD)       TRACK_VolumeAdd		equ 14-17		; reset after note set
      28.  1C:A400  (1C:FFFFFFFE)       TRACK_Noise			equ 15-17		; reset after note set
      29.  1C:A400  (1C:FFFFFFFF)       TRACK_cmd_VolumeAdd	equ 16-17		; reset after note set
      30.  1C:A400  (1C:0000)           TRACK_cmd_ToneSlideAdd	equ 17-17		; reset after note set
      31.  1C:A400  (1C:0002)           TRACK_cmd_ToneAdd		equ 19-17		; reset after note set
      32.  1C:A400                      
      33.  1C:A400  (1C:0004)           TRACK_cmd_detune		equ 21-17
      34.  1C:A400  (1C:0005)           TRACK_cmd_0			equ 22-17
      35.  1C:A400  (1C:0006)           TRACK_cmd_1			equ 23-17
      36.  1C:A400  (1C:0007)           TRACK_cmd_2			equ 24-17
      37.  1C:A400  (1C:0008)           TRACK_cmd_3			equ 25-17
      38.  1C:A400  (1C:0009)           TRACK_cmd_4_depth		equ 26-17
      39.  1C:A400  (1C:000A)           TRACK_cmd_4_step		equ 27-17
      40.  1C:A400  (1C:000B)           TRACK_cmd_NoteAdd		equ 28-17		;x reset after note set
      41.  1C:A400  (1C:000C)           TRACK_cmd_A			equ 29-17		
      42.  1C:A400  (1C:000D)           TRACK_cmd_B			equ 30-17		
      43.  1C:A400  (1C:000E)           TRACK_cmd_E			equ 31-17
      44.  1C:A400  (1C:000F)           TRACK_Timer			equ 32-17		; used for timing by all cmd's
      45.  1C:A400  (1C:0010)           TRACK_Step			equ 33-17		; only for VIBRATO???
      46.  1C:A400  (1C:0011)           TRACK_Delay			equ 34-17		; rows to wait till next data
      47.  1C:A400  (1C:0012)           TRACK_Retrig		equ 35-17		; rows to retrigger command
      48.  1C:A400  (1C:0013)           TRACK_prevDelay		equ 36-17
      49.  1C:A400  (1C:0014)           TRACK_cmd_A_add		equ 37-17	;<< Still in use???
      50.  1C:A400                      
      51.  1C:A400  (1C:0026)           TRACK_REC_SIZE		equ 38
      52.  1C:A400                      
      53.  1C:A400                      
      54.  1C:A400  (1C:0000)           B_TRGNOT			equ 0			; note trigger
      55.  1C:A400  (1C:0001)           B_ACTNOT			equ 1			; note active
      56.  1C:A400  (1C:0002)           B_TRGENV			equ 2			; envelope trigger
      57.  1C:A400  (1C:0003)           B_TRGCMD			equ 3			; command active
      58.  1C:A400  (1C:0004)           B_ACTMOR			equ 4			; morph active
      59.  1C:A400  (1C:0005)           B_TRGINS			equ 5			; instrument trigger
      60.  1C:A400  (1C:0006)           B_TRGWAV			equ 6			; waveform trigger
      61.  1C:A400  (1C:0007)           B_PSGSCC			equ 7			; chip type (PSG or SCC)
      62.  1C:A400                      
      63.  1C:A400                      
      64.  1C:A400  (1C:0100)           _SP_Storage			#2			; to store the SP
      65.  1C:A400                      
      66.  1C:A400  (1C:0102)           replay_trigger		#1			; trigger byte.
      67.  1C:A400  (1C:0103)           replay_mainPSGvol		#2			; volume mixer for PSG SCC balance
      68.  1C:A400  (1C:0105)           replay_mainSCCvol		#2			; volume mixer for PSG SCC balance
      69.  1C:A400                      ;replay_songbase:		#2			; pointer to song data
      70.  1C:A400  (1C:0107)           replay_wavebase:		#2			; pointer to waveform data
      71.  1C:A400  (1C:0109)           replay_insbase:		#2			; pointer to instrument data
      72.  1C:A400  (1C:010B)           replay_orderpointer:	#2			; pointer to the order track list pointers
      73.  1C:A400                      
      74.  1C:A400  (1C:010D)           replay_speed 		#1			; speed to replay (get from song)
      75.  1C:A400  (1C:010E)           replay_speed_subtimer 	#1			; counter for finer speed
      76.  1C:A400  (1C:010F)           replay_speed_timer 	#1 			; counter for speed
      77.  1C:A400  (1C:0110)           replay_mode 		#1			; Replayer status
      78.  1C:A400                      ; mode 0  = no sound output
      79.  1C:A400                      ; mode 1  = replay song 
      80.  1C:A400  (1C:0111)           replay_fade			#1			; Fade active (value = fade speed)
      81.  1C:A400  (1C:0112)           replay_fade_timer		#1			; Timer for fade
      82.  1C:A400  (1C:0113)           replay_fade_vol		#1			; fade volume to lower the channel volume.
      83.  1C:A400                      
      84.  1C:A400                      
      85.  1C:A400  (1C:0114)           replay_previous_note	#1			; previous note played
      86.  1C:A400  (1C:0115)           replay_mainvol		#2			; the volume correction.
      87.  1C:A400                      
      88.  1C:A400  (1C:0117)           replay_vib_table		#2			; pointer to the vibrato table
      89.  1C:A400  (1C:0119)           replay_Tonetable		#2			; ToneTable (affected by transpose);
      90.  1C:A400                      
      91.  1C:A400  (1C:011B)           replay_morph_active	#1			; flag to indicate morphing is active
      92.  1C:A400                      ;replay_morph_update	#1			; flag to indicate a new waveform is ready
      93.  1C:A400  (1C:011C)           replay_morph_timer	#1			; step timer between morphs
      94.  1C:A400  (1C:011D)           replay_morph_speed	#1 
      95.  1C:A400  (1C:011E)           replay_morph_counter	#1			; counter till end morph
      96.  1C:A400  (1C:011F)           replay_morph_buffer	#64			; interleaved buffer with morphed waveform and morph delta values
      97.  1C:A400  (1C:015F)           replay_morph_waveform	#1 			; waveform we are morphing to.
      98.  1C:A400                      
      99.  1C:A400                      
     100.  1C:A400  (1C:0160)           TRACK_Chan1			#TRACK_REC_SIZE
     101.  1C:A400  (1C:0186)           TRACK_Chan2			#TRACK_REC_SIZE
     102.  1C:A400  (1C:01AC)           TRACK_Chan3			#TRACK_REC_SIZE
     103.  1C:A400  (1C:01D2)           TRACK_Chan4			#TRACK_REC_SIZE
     104.  1C:A400  (1C:01F8)           TRACK_Chan5			#TRACK_REC_SIZE
     105.  1C:A400  (1C:021E)           TRACK_Chan6			#TRACK_REC_SIZE
     106.  1C:A400  (1C:0244)           TRACK_Chan7			#TRACK_REC_SIZE
     107.  1C:A400  (1C:026A)           TRACK_Chan8			#TRACK_REC_SIZE
     108.  1C:A400                      
     109.  1C:A400  (1C:0290)           TRACK_pointer1		#2
     110.  1C:A400  (1C:0292)           TRACK_pointer2		#2
     111.  1C:A400  (1C:0294)           TRACK_pointer3		#2
     112.  1C:A400  (1C:0296)           TRACK_pointer4		#2
     113.  1C:A400  (1C:0298)           TRACK_pointer5		#2
     114.  1C:A400  (1C:029A)           TRACK_pointer6		#2
     115.  1C:A400  (1C:029C)           TRACK_pointer7		#2
     116.  1C:A400  (1C:029E)           TRACK_pointer8		#2
     117.  1C:A400                      
     118.  1C:A400                      
     119.  1C:A400                      ;--- AY SPECIFIC
     120.  1C:A400  (1C:02A0)           AY_registers		#0 
     121.  1C:A400  (1C:02A0)           AY_regToneA 		#2	; Tone A freq low (8bit)
     122.  1C:A400                      					; Tone A freq high (4bit)
     123.  1C:A400  (1C:02A2)           AY_regToneB 		#2	; Tone B freq low
     124.  1C:A400                      					; Tone B freq high
     125.  1C:A400  (1C:02A4)           AY_regToneC 		#2	; Tone C freq low
     126.  1C:A400                      					; Tone C freq high
     127.  1C:A400  (1C:02A6)           AY_regNOISE 		#1	; Noise freq (5bit)
     128.  1C:A400  (1C:02A7)           AY_regMIXER 		#1	;0x38	;x3f	; Mixer control (1 = off, 0 = on)
     129.  1C:A400  (1C:02A8)           AY_regVOLA 			#1	; Chan A volume
     130.  1C:A400  (1C:02A9)           AY_regVOLB 			#1	; Chan B volume
     131.  1C:A400  (1C:02AA)           AY_regVOLC  		#1	; Chan C volume
     132.  1C:A400  (1C:02AB)           AY_regEnvL 			#1	; Volume Env Freq low (8bit)	
     133.  1C:A400  (1C:02AC)           AY_regEnvH 			#1	; Volume Env Freq high (4bit)
     134.  1C:A400  (1C:02AD)           AY_regEnvShape 		#1	; Volume Env Shape (4bit)
     135.  1C:A400                      
     136.  1C:A400                      ;--- SCC SPECIFIC
     137.  1C:A400                      
     138.  1C:A400  (1C:02AE)           _0x9800:	#32			; Waveform data
     139.  1C:A400  (1C:02CE)           _0x9820:	#32
     140.  1C:A400  (1C:02EE)           _0x9840:	#32
     141.  1C:A400  (1C:030E)           _0x9860:	#32
     142.  1C:A400  (1C:032E)           SCC_registers 		#0
     143.  1C:A400  (1C:032E)           SCC_regToneA 		#2	; Tone A freq low (8bit)
     144.  1C:A400                      					; Tone A freq high (4bit)
     145.  1C:A400  (1C:0330)           SCC_regToneB 		#2	; Tone B freq low
     146.  1C:A400                      					; Tone B freq high
     147.  1C:A400  (1C:0332)           SCC_regToneC 		#2	; Tone C freq low
     148.  1C:A400                      					; Tone C freq high
     149.  1C:A400  (1C:0334)           SCC_regToneD 		#2	; Tone D freq low
     150.  1C:A400                      					; Tone D freq high
     151.  1C:A400  (1C:0336)           SCC_regToneE 		#2	; Tone E freq low
     152.  1C:A400                      					; Tone E freq high
     153.  1C:A400  (1C:0338)           SCC_regVOLA 		#1	; Chan A volume
     154.  1C:A400  (1C:0339)           SCC_regVOLB 		#1	; Chan B volume
     155.  1C:A400  (1C:033A)           SCC_regVOLC  		#1	; Chan C volume
     156.  1C:A400  (1C:033B)           SCC_regVOLD 		#1	; Chan D volume
     157.  1C:A400  (1C:033C)           SCC_regVOLE  		#1	; Chan E volume
     158.  1C:A400  (1C:033D)           SCC_regMIXER 		#1	; x3f	; Mixer control (1 = off, 0 = on)
     159.  1C:A400                      
     160.  1C:A400                      
     161.  1C:A400                      ;/// see to remove this.
     162.  1C:A400                      ;-- SCC registers
     163.  1C:A400  (1C:033E)           oldregs:	#(32*4)+(3*5)+1		; a way to int the SCC
     164.  1C:A400                      
     165.  1C:A400                      
     466   1C:A400  (1C:03CE)           end_ttreplayRAM:	#0
     467   1C:A400  (0000)              	ENDMAP
     468   1C:A400                      	
     469   1C:A400  (C000)              	MAP 0xC000
     470   1C:A400                      
     471   1C:A400  (1C:C000)           _levelmap:			#mapWidth*mapHeight
     472   1C:A400                      
     473   1C:A400  (1C:CB00)           slotvar				#1
     474   1C:A400  (1C:CB01)           slotram				#1
     475   1C:A400  (1C:CB02)           SEL_NTSC			#1
     476   1C:A400                      
     477   1C:A400  (1C:CB03)           joystick			#1
     478   1C:A400                      
     479   1C:A400  (1C:CB04)           _mcdivider			#1
     480   1C:A400                      
     481   1C:A400  (1C:CB05)           _mcx				#2	; relative with in the frame on the screen
     482   1C:A400  (1C:CB07)           _mcy				#2
     483   1C:A400                      
     484   1C:A400  (1C:CB09)           _mclx				#2	; absolute with the level in ram
     485   1C:A400  (1C:CB0B)           _mcly				#2
     486   1C:A400                      
     487   1C:A400  (1C:CB0D)           _mcframe			#1
     488   1C:A400  (1C:CB0E)           _mcstate			#1
     489   1C:A400                      
     490   1C:A400  (1C:CB0F)           _mcdx				#2
     491   1C:A400  (1C:CB11)           _mcdy				#2
     492   1C:A400                      
     493   1C:A400  (1C:CB13)           _mcprobe:			#1
     494   1C:A400  (1C:CB14)           _mcprobeb:			#1
     495   1C:A400                      
     496   1C:A400  (1C:CB15)           _ticxframe			#1
     497   1C:A400                      
     498   1C:A400  (1C:CB16)           _buffer:			#16
     499   1C:A400  (1C:CB26)           _fps:				#2
     500   1C:A400  (1C:CB28)           _nframes:			#2
     501   1C:A400  (1C:CB2A)           _vbit16:			#2
     502   1C:A400                      
     503   1C:A400  (1C:CB2C)           _ymappos:			#1
     504   1C:A400  (1C:CB2D)           _xmappos:			#2
     505   1C:A400  (1C:CB2F)           _levelmap_pos:		#2
     506   1C:A400                      
     507   1C:A400  (1C:CB31)           _shadowbuff:		#2
     508   1C:A400                      
     509   1C:A400  (1C:CB33)           _displaypage:		#1
     510   1C:A400                      
     511   1C:A400  (1C:CB34)           _mccolorchange:		#1
     512   1C:A400  (1C:CB35)           _xoffset:			#1
     513   1C:A400  (1C:CB36)           _yoffset:			#1
     514   1C:A400                      
     515   1C:A400  (1C:CB37)           __xoffset:			#1
     516   1C:A400  (1C:CB38)           __r18:				#1
     517   1C:A400                      
     518   1C:A400  (1C:CB39)           randSeed:			#2
     519   1C:A400  (1C:CB3B)           cur_level:			#1
     520   1C:A400  (1C:CB3C)           wave_count:			#1
     521   1C:A400  (1C:CB3D)           landing_permission:	#1
     522   1C:A400  (1C:CB3E)           assault_wave_timer:	#2
     523   1C:A400  (1C:CB40)           bullet_rate:		#1
     524   1C:A400  (1C:CB41)           _dxchng:			#1		; <>0 if direction changes
     525   1C:A400  (1C:CB42)           _dxmap:				#1		; previous dxmap
     526   1C:A400  (1C:CB43)           dxmap:				#1
     527   1C:A400  (1C:CB44)           xmap:				#2
     528   1C:A400  (1C:CB46)           _xmapx4:			#2		; xmap x 4
     529   1C:A400  (1C:CB48)           yship:				#1
     530   1C:A400  (1C:CB49)           xship:				#2
     531   1C:A400  (1C:CB4B)           aniframe:			#1
     532   1C:A400  (1C:CB4C)           ms_state:			#1
     533   1C:A400  (1C:CB4D)           old_aniframe:		#1
     534   1C:A400  (1C:CB4E)           anispeed:			#1
     535   1C:A400  (1C:CB4F)           already_dead:		#1
     536   1C:A400  (1C:CB50)           lives_bin:			#1
     537   1C:A400                      
     538   1C:A400  (1C:CB51)           god_mode:			#1
     539   1C:A400  (1C:CB52)           visible_sprts:		#1
     540   1C:A400  (1C:CB53)           flip_flop:			#1
     541   1C:A400                      
     542   1C:A400  (1C:CB54)           ram_sat:			#3*4
     543   1C:A400                      
     544   1C:A400                      	struct enemy_data
     545   1C:A400                    < y				db	0
     546   1C:A400                    < x				dw	0
     547   1C:A400                    < xoff			db	0
     548   1C:A400                    < yoff			db	0
     549   1C:A400                    < xsize			db	0
     550   1C:A400                    < ysize			db	0
     551   1C:A400                    < status			db	0	; B7 = DWN/UP | B6 = RIGHT/LEFT | B5 = ok/wrong clr | B0 = Inactive/Active
     552   1C:A400                    < cntr			db	0
     553   1C:A400                    < kind			db	0
     554   1C:A400                    < frame			db	0
     555   1C:A400                    < color			db	0
     556   1C:A400                    < color2			db	0
     557   1C:A400                    < speed			dw	0
     558   1C:A400                    < 	ends
     559   1C:A400                      	
     560   1C:A400  (1C:CB60)           any_object:			#0
     561   1C:A400  (1C:CB60)           ms_bullets:			#enemy_data*max_bullets
     562   1C:A400  (1C:CB7E)           enem_bullets:		#enemy_data*max_enem_bullets
     563   1C:A400  (1C:CBAB)           enemies:			#enemy_data*max_enem
     564   1C:A400  (1C:CC5F)           endram:				#1
     565   1C:A400  (0000)              	ENDMAP

    LABELS
-------------------------------------------------
00:00005000   _kBank1
00:00007000   _kBank2
00:00009000   _kBank3
00:0000B000   _kBank4
00:00000100   mapWidth
00:0000000B   mapHeight
00:000000A8   YSIZE
00:0000000C   max_enem
00:00000003   max_enem_bullets
00:00000002   max_bullets
00:00000004   maxspeed
00:000000B4   assault_wave_timer_preset
00:00000002   enemy_bullet_speed
00:00000078   xship_rel
00:00000024 X ENASLT
00:00000138   RSLREG
00:0000FCC1   EXPTBL
00:00004010   search_slot
00:0000402F   search_slotram
00:00004050   search_slotram0
00:00004055 X setrompage0
00:0000405B   setrampage0
00:00004061   setrompage2
00:00004067 X setrampage2
00:0000406D X setrompage3
00:00004073 X setrampage3
00:00004079 X recbios
00:0000407C   setslotpage0
00:000040B3 X setslotpage1
00:000040F2   setslotpage2
00:00004139   setslotpage3
00:00004178   _cls
00:00004190   _cls0
00:00000099 X vdpport1
00:0000009A X vdpport2
00:000041A5   _vdpsetvramwr
00:000041A6 X _vdpsetvramwr2
00:000041B6 X _vdpsetvramwr14
00:000041BF X _vdpsetvramrd
00:000041D9   _setpage
00:0000005F   chgmod
00:0000000C X RDSLT
00:00000156 X KILBUF
00:000041EA   set_scr
00:0000421F   _waitvdp
00:0000000C X rdslt
00:0000001C X CALSLT
00:00000180   chgcpu
00:0000FCC1 X exttbl
00:0000422E   _set_r800
00:0000424F   set_turbo_tr
00:0000F3DF   RG0SAV
00:0000F3E0   RG1SAV
00:0000F3E1 X RG2SAV
00:0000F3E2 X RG3SAV
00:0000F3E3 X RG4SAV
00:0000F3E4 X RG5SAV
00:0000F3E5 X RG6SAV
00:0000F3E6   RG7SAV
00:0000FFE7   RG8SAV
00:0000FFE8   RG9SAV
00:0000FFE9 X RG10SAV
00:0000FFEA X RG11SAV
00:0000FFEB X RG12SAV
00:0000FFEC X RG13SAV
00:0000FFED X RG14SAV
00:0000FFEE X RG15SAV
00:0000FFEF X RG16SAV
00:0000FFF0 X RG17SAV
00:0000FFF1 X RG18SAV
00:0000FFF2 X RG19SAV
00:0000FFF3 X RG20SAV
00:0000FFF4 X RG21SAV
00:0000FFF5 X RG22SAV
00:0000FFF7 X RG23SAV
00:0000FC9E   _jiffy
00:00004257   _fake_isr
00:0000428A   _isrinit
00:000042AE   _intreset
00:000042CA   _scroll
00:000042E9 X waitHBLANK
00:000042F9   lint
00:0000433E   lint.exit
00:00000000   border_color
00:00004358   vblank
00:00004385   _replay_loadsong
00:0000438E   _replay_play
00:00004398   _replay_init
00:000043A1 X _replay_pause
00:000043AA   _replay_route
00:000043B3   _blank_line_lft
00:000043BC   _blank_line_rgt
00:000043C5   inc_xoffset
00:000043D1   inc_xoffset.movex
00:000043D7 X inc_xoffset.case0
00:000043E2   inc_xoffset.case1_15
00:000043ED   dec_xoffset
00:000043F9   dec_xoffset.movex
00:00004400 X dec_xoffset.case15
00:0000440B   dec_xoffset.case0_14
00:00004416   newxmap
00:00004459   activate_window
00:00004498   changedir
00:000044B0 X changedir.left
00:000044C4   changedir.right
00:000044D8   nodirchange
00:000044EF X nodirchange.left
00:000044FF   nodirchange.right
00:0000450F   checkkbd
00:0000451C   _hw_sprite_init
00:00000004 S teller
00:00004565   load_colors
00:0000457C   bull_color
00:00004585   set_manta
00:0000458E   plot_enemy
00:00004599 X directplot_enemy
00:000045E8   directplot_enemy.next1
00:00004631   directplot_enemy.next2
00:0000463D   directplot_enemy.spriteoff1
00:0000464A   directplot_enemy.spriteoff2
00:0000465F   reverseplot_enemy
00:000046B6   reverseplot_enemy.next2
00:000046F4   reverseplot_enemy.next1
00:00004703   reverseplot_enemy.spriteoff1
00:00004710   reverseplot_enemy.spriteoff2
00:00004800   sprite_collision_windows
00:00004800 X sprite_0
00:00004804 X sprite_1
00:00004808 X sprite_2
00:0000480C X sprite_3
00:00004810 X sprite_4
00:00004814 X sprite_5
00:00004818 X sprite_6
00:0000481C X sprite_7
00:00004820 X sprite_8
00:00004824 X sprite_9
00:00004828 X sprite_10
00:0000482C X sprite_11
00:00004830 X sprite_12
00:00004834 X sprite_13
00:00004838 X sprite_14
00:0000483C X sprite_15
00:00004840 X sprite_16
00:00004844 X sprite_17
00:00004848 X sprite_18
00:0000484C X sprite_19
00:00004850 X sprite_20
00:00004854 X sprite_21
00:00004858 X sprite_22
00:0000485C X sprite_23
00:00004860   set_size
00:00004883   bullet_set_size2
00:000048A4   bullet_sprite_collision_windows
00:000048A4 X bullet_sprite_collision_windows.sprite_8
00:000048A8 X bullet_sprite_collision_windows.sprite_9
00:000048AC X bullet_sprite_collision_windows.sprite_10
00:000048B0 X bullet_sprite_collision_windows.sprite_11
00:000048B4 X bullet_sprite_collision_windows.sprite_12
00:000048B8 X bullet_sprite_collision_windows.sprite_13
00:000048BC X bullet_sprite_collision_windows.sprite_14
00:000048C0 X bullet_sprite_collision_windows.sprite_15
00:000048C4   bullet_set_size
00:000048E5   test_collision_enemy_bullets
00:00004925   test_collision_msbullets
00:0000493E   test_collision
00:00004974   CalcCollision
00:0000497E   CalcCollision.switch
00:00004984   CollisionCheck_8b
00:0000498A   CollisionCheck_8b.other
00:00000000   obj_data.y
00:00000001   obj_data.x
00:00000003   obj_data.xoff
00:00000004   obj_data.yoff
00:00000005   obj_data.xsize
00:00000006   obj_data.ysize
00:00000007 X obj_data
00:0000498E X _check_obj_collision
00:00004994 X check_obj_collision_8_16
00:000049AD X swap_objects_y
00:000049DB X swap_objects_x
00:000049EB   ms_ani
00:000049EB X mship03_ani
00:00004A3B   ms_col_win
00:00004A3B X mship03_coll_wind
00:00004B0B   add_bc_score_bin
00:00004B0C   rand8_init
00:00004B15   rand8
00:00004B22   land_now_test
00:00004B40   npc_init
00:00004B6D X bull_init
00:00004B86 X manual_wave_ctrl
00:00004B90 X levels_0_8
00:00004B94   levels_8_16
00:00004BC5   wave_timer
00:00004C0C   wave0
00:00004C0C   wave1
00:00004C22 X wave1.neg
00:00004C33   wave1.pos
00:00004C8E   wave1.next
00:00004C98   wave2
00:00004CA6 X wave2.neg
00:00004CBB   wave2.pos
00:00004D1D   wave2.next
00:00004D24   wave3
00:00004D32 X wave3.neg
00:00004D3A   wave3.pos
00:00004D95   wave3.next
00:00004D9C   wave4
00:00004DAB   _wave4_cont
00:00004DAE X _wave4_cont.neg
00:00004DC2   _wave4_cont.pos
00:00004E29   _wave4_cont.next
00:00004E30   wave5
00:00004E3E X wave5.neg
00:00004E45   wave5.pos
00:00004E9D   wave5.next
00:00004EA4   wave6
00:00004EAF   wave7
00:00004EC1 X wave7.neg
00:00004EC8   wave7.pos
00:00004F16   wave7.next
00:00004F1D   npc_loop
00:00004F4D   next
00:00004F56   npcdies
00:00004F7D   enemy255
00:00004F99   enemy0
00:00004F99 X enemy1
00:00004F9F X enemy1.go_left
00:00004FC2   enemy1.go_right
00:00004FF4   enemy2
00:00004FF4 X enemy3
00:0000500D X enemy3.go_left
00:00005023   enemy3.go_right
00:00005048   enemy4
00:00005061 X enemy4.go_left
00:00005077   enemy4.go_right
00:00005094 X enemy4.go_up
00:0000509E   enemy4.go_dwn
00:00005100   rotation
00:00005104   rotate
00:00005200   sinewave
00:00005240   enemy5
00:00005259 X enemy5.go_left
00:0000526F   enemy5.go_right
00:000052A7   enemy6
00:000052C0 X enemy6.go_left
00:000052DE   enemy6.go_right
00:00005306 X enemy6.go_up
00:00005310   enemy6.go_dwn
00:0000532D   enemy7
00:00005346 X enemy7.go_left
00:00005364   enemy7.go_right
00:000053A7   book_enemy_shoot
00:000053EE   book_enemy_shoot.activate_this
00:000053F4 X book_enemy_shoot.shootdx
00:00005403   book_enemy_shoot.shootsx
00:00005439   enemy_bullet_loop
00:00005523   test_obstacles.found
00:0000553D X _plot_distrucable
00:0000557F   START
00:0000558C   _ntsc
00:00005633   restart
00:000056B2   main_loop
00:000056F4   AFXPLAY
00:000056F5 X _print_probe
00:0000573A X _print_fps
00:00005757 X _compute_fps
00:0000575E   int2ascii
00:00005761 X Num2asc
00:0000577A   Num1
00:0000577C   Num2
00:00005785   blank_line
00:000057B9   plot_line_lft1
00:000057C1   plot_line_lft2
00:000057C9   plot_line_rgt1
00:000057D5   plot_line_rgt2
00:000057E1   plot_tile
00:0000582C X init_page0
00:00005858   clrboder
00:0000588A   move_block
00:000058CA   plot_line1
00:000058E1   plot_line2
00:00005922   _1stblock
00:0000594D   _1st
00:0000597A   _2nd
00:00005A02   _plot_spt
00:00005A38   out48
00:00005A58   out32
00:00005A78 X out16
00:00005A99   set_manta_color
00:00005ACA   color_enemy
00:00005AD5 X directcolor_enemy
00:00005B19   directcolor_enemy.next
00:00005B28   reversecolor_enemy
00:00005B66   reversecolor_enemy.next
00:00005B7A   ms_bllts_col_win
00:00005B7A X ms_bllts_coll_wind
00:00000005   max_bullet_rate
00:00005B9A   ms_shoot
00:00005BA6   ms_shoot.book_bullet
00:00005BBF   ms_shoot.activate_this
00:00005BCA X ms_shoot.shootdx
00:00005BD4   ms_shoot.shootsx
00:00005C10   bullet_loop
00:00005C73   bullet_loop.test_obstacles
01:00006000   replay_init
01:0000600F   replay_pause
01:00006024   _replay_pause_r
01:0000602A X replay_fade_out
01:00006035 X replay_transpose
01:0000603E   replay_set_SCC_balance
01:00006045   replay_set_PSG_balance
01:0000604C   _getnewbalancebase
01:0000605A   replay_loadsong
01:0000606C   replay_loadsong.nwu
01:00006079   replay_loadsong.niu
01:0000611F   _replay_check_patternend
01:00006143   _replay_check_patternend.no_restart
01:00006151   replay_play
01:0000616D X replay_decodedata
01:0000617C   replay_decodedata.retrig_skip1
01:0000619D   replay_decodedata.decode2
01:000061AC   replay_decodedata.retrig_skip2
01:000061CD   replay_decodedata.decode3
01:000061DC   replay_decodedata.retrig_skip3
01:000061FD   replay_decodedata.decode4
01:0000620C   replay_decodedata.retrig_skip4
01:0000622D   replay_decodedata.decode5
01:0000623C   replay_decodedata.retrig_skip5
01:0000625D   replay_decodedata.decode6
01:0000626C   replay_decodedata.retrig_skip6
01:0000628D   replay_decodedata.decode7
01:0000629C   replay_decodedata.retrig_skip7
01:000062BD   replay_decodedata.decode8
01:000062CC   replay_decodedata.retrig_skip8
01:000062ED   replay_decodedata.decode_end
01:000062ED   replay_decodedata_NO
01:000063EF   replay_decodedata_NO.cont_fadeing
01:000063F5   replay_decodedata_NO.no_new_step
01:00006409   replay_decodedata_NO.calc_vol
01:0000640F   replay_decodedata_NO.no_carry
01:00006414   replay_decode_chan
01:00006420   _rdn2
01:00006425   _rdv2
01:0000642A   _rdi2
01:00006432   _rdn
01:0000643A   _rdi
01:00006442   _rdv
01:0000644A   _rdc
01:00006454   _rd_delay
01:0000645B   _replay_decode_note
01:00006467   _replay_decode_rest
01:00006470   _replay_decode_ins
01:00006487   _replay_decode_ins.skip
01:000064A4   _replay_decode_ins.skip_ins
01:000064A9   _replay_decode_vol
01:000064BE   _replay_decode_delay
01:000064CB   _replay_decode_cmd
01:000064DA   _replay_decode_cmd.skip
01:000064E1   DECODE_CMDLIST
01:00006533   _CHIPcmd0_arpeggio
01:00006543   _CHIPcmd1_port_up
01:0000654F   _CHIPcmd2_port_down
01:0000655B   _CHIPcmd3_RE_port_tone
01:00006561   _CHIPcmd3_port_tone
01:0000656C   _CHIPcmd3_port_tone_cont
01:00006583   _CHIPcmd3_port_tone_cont.skip
01:0000659B   _CHIPcmd3_port_tone_cont.skip2
01:000065AF   _CHIPcmd4_vibrato
01:000065CD   _CHIPcmd5_vibrato_port_tone
01:000065CD   _CHIPcmd6_vibrato_vol
01:000065CD   _CHIPcmd7_vol_slide
01:000065DD   _CHIPcmd8_macro_offset
01:000065E0   _CHIPcmd9_env_shape
01:000065EC   _CHIPcmdA_env_mul
01:00006601   _CHIPcmdB_wave_res
01:00006609   _CHIPcmdC_wave_duty
01:00006609   _CHIPcmdD_wave_cut
01:00006609   _CHIPcmdE_wave_compr
01:00006613   _CHIPcmdF_wave_set
01:0000661D   _CHIPcmd10_morph_slave
01:00006623   _CHIPcmd11_morph_start
01:0000663B   _CHIPcmd11_morph_start.loop
01:00006649   _CHIPcmd12_morph_cont
01:00006660   _CHIPcmd13_short_arp
01:0000666C   _CHIPcmd14_fine_up
01:0000666C   _CHIPcmd15_fine_down
01:00006678   _CHIPcmd16_vib_ctrl
01:00006683 X _cmd16_pulse
01:0000668C   _cmd16_tri
01:00006695   _cmd16_sine
01:0000669E   _CHIPcmd17_track_detune
01:000066B3   _CHIPcmd17_track_detune.pos
01:000066BD   _CHIPcmd18_transpose
01:000066D1   _CHIPcmd18_transpose.skip1
01:000066D7   _CHIPcmd18_transpose.pos
01:000066DD   _CHIPcmd18_transpose.skip2
01:000066E3   _CHIPcmdXX_note_cut
01:000066EC   _CHIPcmd19_note_delay
01:0000670A   _CHIPcmd1A_trigger
01:00006710   _CHIPcmd1B_speed
01:00006723   _CHIPcmd1C_notelink
01:00006729 X _CHIPcmd1C_call
01:00006729   _CHIPcmd1D_ret
01:0000672D   _CHIPcmd0_RE_arpeggio
01:00006731   _CHIPcmd1_RE_port_up
01:00006731   _CHIPcmd2_RE_port_down
01:00006731   _CHIPcmd4_RE_vibrato
01:00006739   _CHIPcmd5_RE_vibrato_port_tone
01:00006739   _CHIPcmd6_RE_vibrato_vol
01:00006739   _CHIPcmd7_RE_vol_slide
01:00006745   _CHIPcmd8_RE_macro_offset
01:00006751   _CHIPcmd9_RE_env_shape
01:00006759   replay_process_chan_AY
01:00006770   replay_process_chan_AY.skip
01:00006775   _pcAY_noCommand
01:00006775   _pcAY_commandEND
01:0000677A X _pcAY_triggerNote
01:0000679E   _pcAY_noNoteTrigger
01:000067C2   _vol_change
01:000067C9 X _vol_rel
01:000067DB   _vol_rel.skip
01:000067DC   _vol_base
01:000067EC   _noEnv
01:000067F7 X _noEnv.add_Vadd
01:00006801   _noEnv.sub_Vadd
01:0000680D   _noEnv.skip2
01:0000680D   _Vadd
01:00006817   _Vadd.skip
01:00006821   _Vadd.skip2
01:00006826   _noVolume
01:00006847   _noVolume.skip
01:0000684D   _noNoise
01:0000685A   _pcAY_noTone
01:00006870   _pcAY_noTone.skip
01:00006877   _pcAY_noToneAdd
01:00006880   _pcAY_noToneAdd.noend
01:00006890   _pcAY_noToneAdd.skip
01:000068A6   _pcAY_noNoteActive
01:000068AB   _pcAY_cmdlist
01:000068E1   _pcAY_cmd0_arpeggio
01:000068FD   _pcAY_cmd0_arpeggio.step2
01:00006911   _pcAY_cmd0_arpeggio.step3
01:00006918   _pcAY_cmd1_port_up
01:0000692C   _pcAY_cmd2_port_down
01:00006940   _pcAY_cmd3_port_tone
01:0000694E X _pcAY_cmd3_add
01:00006961   _pcAY_cmd3_sub
01:00006974   _pcAY_cmd3_stop
01:00006981   _pcAY_cmd4_vibrato
01:0000699C   _pcAY_cmd4_vibrato.skip
01:000069A0   _pcAY_cmd4_vibrato.loop
01:000069B3   _pcAY_cmd4pos
01:000069B9   _pcAY_cmd4pos.skip
01:000069BD   _pcAY_cmd4pos.loop
01:000069C1   _pcAY_cmd4_zero
01:000069CB   _pcAY_cmd5_vibrato_port_tone
01:000069D1   _pcAY_cmd6_vibrato_vol
01:000069D7   _pcAY_cmd7_vol_slide
01:000069DD   _pcAY_cmdasub
01:000069F2 X _pcAY_cmda_dec
01:000069FB   _pcAY_cmda_inc
01:00006A04   _pcAY_cmd8_macro_offset
01:00006A0F   _pcAY_cmdc_wave_duty
01:00006A21   _pcAY_cmdc_wave_duty.skip
01:00006A2A   _wspw_loop_h
01:00006A35   _wspw_loop_l
01:00006A3C   _pcAY_cmdd_wave_cut
01:00006A50   _pcAY_cmdd_wave_cut.skip
01:00006A76   _wsc_l
01:00006A7D   _pcAY_cmde_wave_compr
01:00006A91   _pcAY_cmde_wave_compr.skip
01:00006AB1   _wcomp_loop
01:00006AC3   _wcomp_loop.skip
01:00006AC5   _wcomp_loop.loop
01:00006ACE   _pcAY_cmd13_short_arp
01:00006ADF   _pcAY_cmd14_fine_up
01:00006AF9   _pcAY_cmd15_fine_down
01:00006B13   _pcAY_cmdXX_note_cut
01:00006B20   _pcAY_cmd19_note_delay
01:00006B33   replay_route
01:00006B3A   _comp_loop
01:00006B53   _ptAY_loop
01:00006B6B   _ptAY_noEnv
01:00006B70 X _ptAY_noEnv.nosfx
01:00006B83   _ptAY_noEnv.skip
01:00006B96   _ptAY_noEnv.skip2
01:00006BA9   _ptAY_noEnv.skip3
01:00006BBC   _ptAY_noEnv.skip4
01:00006BBC   scc_reg_update
01:00006BCC   loop
01:00006BD3   loop.skip
01:00006BDB   _write_SCC_wave
01:00006BE5 X _write_SCC_wave.normalwave
01:00006BF5   _write_SCC_wave.ramwave
01:00006C03   _write_SCC_wave.skip
01:00006C09   _write_SCC_special
01:00006C0E   _wss_l
01:00006C16   replay_process_morph
01:00006C23   replay_process_morph.loop
01:00006C2A   replay_process_morph.skip
01:00006C49   replay_process_morph.skip2
01:00006C4F   replay_process_morph.skip3
01:00006C51   _rpm_loop
01:00006C5E X _rpm_larger
01:00006C6C   _rpm_smaller
01:00006C7C   _rpm_next_step
01:00006C91   _rpm_next_step.skip
01:00006C97   _rpm_ns_loop
01:00006C9D X _rmp_ns_sub
01:00006CA4   _rmp_ns_sub.skip
01:00006CAF   _rmp_ns_add
01:00006CB4   _rmp_ns_add.skip
01:00000000   ms_fly__right
01:00000001   ms_spin_face_right
01:00000002   ms_side_dwn_face_right
01:00000003   ms_side_up__face_right
01:00000004   ms_fly__left
01:00000005   ms_spin_face_left
01:00000006   ms_side_dwn_face_left
01:00000007   ms_side_up__face_left
01:00000008   ms_loop_right2left
01:00000009   ms_loop_left2right
01:0000000A   ms_explode
01:0000000B   ms_landing
01:0000000C   ms_reset
01:00006CBD   ms_ctrl
01:00006CCF X ms_ctrl.intro
01:00006D19   ms_ctrl.ms_landing
01:00006D19   ms_ctrl.ms_reset
01:00006D1A   ms_ctrl.ms_directions
01:00006D50   ms_ctrl.test_move_right
01:00006D63   ms_ctrl.test_move_left
01:00006D76   ms_ctrl._dw
01:00006D81   ms_ctrl._up
01:00006D8A   ms_ctrl.rd_joy
01:00006D98 X ms_ctrl.rd_key
01:00006DE2   ms_ctrl.z_or_space
01:00006DE8   ms_ctrl.x_and_up
01:00006DEE   ms_ctrl.up
01:00006DF4   ms_ctrl.x_and_dwn
01:00006DFA   ms_ctrl.dwn
01:00006E00   ms_ctrl.left
01:00006E06   ms_ctrl.right
01:00006E0C   ms_ctrl.ms_fly__right
01:00006E5B   ms_ctrl.ms_loop_right2left
01:00006E71   ms_ctrl.ms_spin_face_left
01:00006E87   ms_ctrl.ms_fly__left
01:00006ED9   ms_ctrl.ms_loop_left2right
01:00006EEF   ms_ctrl.ms_spin_face_right
01:00006F05   ms_ctrl.ms_side_dwn_face_right
01:00006F3C   ms_ctrl.ms_side_up__face_right
01:00006F73   ms_ctrl.ms_side_dwn_face_left
01:00006FAB   ms_ctrl.ms_side_up__face_left
01:00006FE3   ms_ctrl.ms_explode
01:00007017   put_ms_sprt
01:0000705C   put_ms_sprt.expl
01:0000708F X put_ms_sprt.landing
01:000070DC X probe_level
00:00000000   star_data.x
00:00000001   star_data.y
00:00000002   star_data.add
00:00000004   star_data
01:000070EE   starlist
01:000070FA X starlist2
01:00007106 X starlist3
01:00007112   test_star
01:0000713A   test_star.star_loop
01:000071B6   test_star.set_star
01:000071CD   outvram
03:0000A000   manta_color
03:0000A680   ms_spt
04:0000A000   _tiles0
0C:0000A000   demo_song
0C:0000A000 X musbuff
0C:0000A015   musbuff.restart
0C:0000A099   musbuff.waveform_start
0C:0000A139   musbuff.instrument_start
0C:0000A159   musbuff.ins_1
0C:0000A15A   musbuff.rst_i1
0C:0000A15E   musbuff.ins_2
0C:0000A193   musbuff.rst_i2
0C:0000A197   musbuff.ins_3
0C:0000A1C4   musbuff.rst_i3
0C:0000A1C8   musbuff.ins_4
0C:0000A1CF   musbuff.rst_i4
0C:0000A1D4   musbuff.ins_5
0C:0000A1D4   musbuff.ins_6
0C:0000A1E1   musbuff.rst_i6
0C:0000A1E7   musbuff.ins_7
0C:0000A226   musbuff.rst_i7
0C:0000A22A   musbuff.ins_8
0C:0000A247   musbuff.rst_i8
0C:0000A24B   musbuff.ins_9
0C:0000A24F   musbuff.rst_i9
0C:0000A253   musbuff.ins_10
0C:0000A299   musbuff.rst_i10
0C:0000A29D   musbuff.ins_11
0C:0000A2C6   musbuff.rst_i11
0C:0000A2CA   musbuff.ins_12
0C:0000A2DF   musbuff.rst_i12
0C:0000A2E3   musbuff.ins_13
0C:0000A322   musbuff.rst_i13
0C:0000A326   musbuff.ins_14
0C:0000A365   musbuff.rst_i14
0C:0000A369   musbuff.ins_15
0C:0000A3A8   musbuff.rst_i15
0C:0000A3AC   musbuff.ins_16
0C:0000A3AF   musbuff.rst_i16
0C:0000A3B3   musbuff.track_0
0C:0000A3CF   musbuff.track_1
0C:0000A3D1   musbuff.track_2
0C:0000A41B   musbuff.track_3
0C:0000A455   musbuff.track_4
0C:0000A47D   musbuff.track_5
0C:0000A494   musbuff.track_6
0C:0000A4BC   musbuff.track_7
0C:0000A4D3   musbuff.track_8
0C:0000A4EC   musbuff.track_9
0C:0000A523   musbuff.track_10
0C:0000A53D   musbuff.track_11
0C:0000A56C   musbuff.track_12
0C:0000A590   musbuff.track_13
0C:0000A59A   musbuff.track_14
0C:0000A5BE   musbuff.track_15
0C:0000A5D0   musbuff.track_16
0C:0000A5E2   musbuff.track_17
0C:0000A632   musbuff.track_18
0C:0000A665   musbuff.track_19
0C:0000A694   musbuff.track_20
0C:0000A6A3   musbuff.track_21
0C:0000A6D5   musbuff.track_22
0C:0000A6EB   musbuff.track_23
0C:0000A701   musbuff.track_24
0C:0000A754   musbuff.track_25
0C:0000A778   musbuff.track_26
0C:0000A7A7   musbuff.track_27
0C:0000A7DF   musbuff.track_28
0C:0000A7EA   musbuff.track_29
0C:0000A822   musbuff.track_30
0C:0000A832   musbuff.track_31
0C:0000A842   musbuff.track_32
0C:0000A897   musbuff.track_33
0C:0000A8D0   musbuff.track_34
0C:0000A8F8   musbuff.track_35
0C:0000A94B   musbuff.track_36
0C:0000A973   musbuff.track_37
0C:0000A999   musbuff.track_38
0C:0000A9F4   musbuff.track_39
0C:0000AA37   musbuff.track_40
0C:0000AA6A   musbuff.track_41
0C:0000AA9B   musbuff.track_42
0C:0000AAEA   musbuff.track_43
0C:0000AB09   musbuff.track_44
0C:0000AB41   musbuff.track_45
0C:0000AB7B   musbuff.track_46
0C:0000AB93   musbuff.track_47
0C:0000ABAB   musbuff.track_48
0C:0000ABED   musbuff.track_49
0C:0000AC17 X musbuff.track_50
0C:0000AC98   _VOLUME_TABLE
0C:00000D40   C_PER
0C:00000C80   C1_PER
0C:00000BC0   D_PER
0C:00000B20   D1_PER
0C:00000A80   E_PER
0C:000009E0   F_PER
0C:00000940   F1_PER
0C:000008C0   G_PER
0C:00000840   G1_PER
0C:000007E0   A_PER
0C:00000760   A1_PER
0C:00000700   B_PER
0C:0000AD98   TRACK_ToneTable
0C:0000AE58   TRACK_Vibrato_sine
0C:0000AE78   TRACK_Vibrato_triangle
0C:0000AE98   TRACK_Vibrato_pulse
0C:0000AEB8 X end_demo_song
0F:0000A000   _level
10:0000A000   _opening
18:0000A000   _scorebar
19:0000A000   _animated
1B:0000A000   sprtdata
1C:0000A000   color_base
1C:0000A400 X FINISH
1C:00000100   ttreplayRAM
1C:FFFFFFEF   TRACK_Instrument
1C:FFFFFFF0   TRACK_Command
1C:FFFFFFF1   TRACK_MacroPointer
1C:FFFFFFF3   TRACK_MacroStart
1C:FFFFFFF5 X TRACK_MacroRestart
1C:FFFFFFF6   TRACK_Note
1C:FFFFFFF7   TRACK_Volume
1C:FFFFFFF8   TRACK_Waveform
1C:FFFFFFF9   TRACK_Flags
1C:FFFFFFFA X TRACK_empty
1C:FFFFFFFB   TRACK_ToneAdd
1C:FFFFFFFD   TRACK_VolumeAdd
1C:FFFFFFFE   TRACK_Noise
1C:FFFFFFFF   TRACK_cmd_VolumeAdd
1C:00000000   TRACK_cmd_ToneSlideAdd
1C:00000002   TRACK_cmd_ToneAdd
1C:00000004   TRACK_cmd_detune
1C:00000005   TRACK_cmd_0
1C:00000006   TRACK_cmd_1
1C:00000007   TRACK_cmd_2
1C:00000008   TRACK_cmd_3
1C:00000009   TRACK_cmd_4_depth
1C:0000000A   TRACK_cmd_4_step
1C:0000000B   TRACK_cmd_NoteAdd
1C:0000000C   TRACK_cmd_A
1C:0000000D   TRACK_cmd_B
1C:0000000E   TRACK_cmd_E
1C:0000000F   TRACK_Timer
1C:00000010   TRACK_Step
1C:00000011   TRACK_Delay
1C:00000012   TRACK_Retrig
1C:00000013   TRACK_prevDelay
1C:00000014 X TRACK_cmd_A_add
1C:00000026   TRACK_REC_SIZE
1C:00000000   B_TRGNOT
1C:00000001   B_ACTNOT
1C:00000002   B_TRGENV
1C:00000003   B_TRGCMD
1C:00000004   B_ACTMOR
1C:00000005 X B_TRGINS
1C:00000006   B_TRGWAV
1C:00000007   B_PSGSCC
1C:00000100   _SP_Storage
1C:00000102   replay_trigger
1C:00000103   replay_mainPSGvol
1C:00000105   replay_mainSCCvol
1C:00000107   replay_wavebase
1C:00000109   replay_insbase
1C:0000010B   replay_orderpointer
1C:0000010D   replay_speed
1C:0000010E   replay_speed_subtimer
1C:0000010F   replay_speed_timer
1C:00000110   replay_mode
1C:00000111   replay_fade
1C:00000112   replay_fade_timer
1C:00000113   replay_fade_vol
1C:00000114   replay_previous_note
1C:00000115   replay_mainvol
1C:00000117   replay_vib_table
1C:00000119   replay_Tonetable
1C:0000011B   replay_morph_active
1C:0000011C   replay_morph_timer
1C:0000011D   replay_morph_speed
1C:0000011E   replay_morph_counter
1C:0000011F   replay_morph_buffer
1C:0000015F   replay_morph_waveform
1C:00000160   TRACK_Chan1
1C:00000186   TRACK_Chan2
1C:000001AC   TRACK_Chan3
1C:000001D2   TRACK_Chan4
1C:000001F8   TRACK_Chan5
1C:0000021E   TRACK_Chan6
1C:00000244   TRACK_Chan7
1C:0000026A   TRACK_Chan8
1C:00000290   TRACK_pointer1
1C:00000292   TRACK_pointer2
1C:00000294   TRACK_pointer3
1C:00000296   TRACK_pointer4
1C:00000298   TRACK_pointer5
1C:0000029A   TRACK_pointer6
1C:0000029C   TRACK_pointer7
1C:0000029E   TRACK_pointer8
1C:000002A0   AY_registers
1C:000002A0   AY_regToneA
1C:000002A2   AY_regToneB
1C:000002A4   AY_regToneC
1C:000002A6   AY_regNOISE
1C:000002A7   AY_regMIXER
1C:000002A8   AY_regVOLA
1C:000002A9   AY_regVOLB
1C:000002AA   AY_regVOLC
1C:000002AB   AY_regEnvL
1C:000002AC   AY_regEnvH
1C:000002AD   AY_regEnvShape
1C:000002AE   _0x9800
1C:000002CE X _0x9820
1C:000002EE X _0x9840
1C:0000030E X _0x9860
1C:0000032E   SCC_registers
1C:0000032E   SCC_regToneA
1C:00000330   SCC_regToneB
1C:00000332   SCC_regToneC
1C:00000334   SCC_regToneD
1C:00000336   SCC_regToneE
1C:00000338   SCC_regVOLA
1C:00000339   SCC_regVOLB
1C:0000033A   SCC_regVOLC
1C:0000033B   SCC_regVOLD
1C:0000033C   SCC_regVOLE
1C:0000033D   SCC_regMIXER
1C:0000033E   oldregs
1C:000003CE   end_ttreplayRAM
1C:0000C000   _levelmap
1C:0000CB00   slotvar
1C:0000CB01   slotram
1C:0000CB02   SEL_NTSC
1C:0000CB03   joystick
1C:0000CB04   _mcdivider
1C:0000CB05 X _mcx
1C:0000CB07 X _mcy
1C:0000CB09 X _mclx
1C:0000CB0B X _mcly
1C:0000CB0D   _mcframe
1C:0000CB0E X _mcstate
1C:0000CB0F   _mcdx
1C:0000CB11 X _mcdy
1C:0000CB13 X _mcprobe
1C:0000CB14   _mcprobeb
1C:0000CB15   _ticxframe
1C:0000CB16   _buffer
1C:0000CB26   _fps
1C:0000CB28   _nframes
1C:0000CB2A X _vbit16
1C:0000CB2C   _ymappos
1C:0000CB2D   _xmappos
1C:0000CB2F   _levelmap_pos
1C:0000CB31 X _shadowbuff
1C:0000CB33   _displaypage
1C:0000CB34   _mccolorchange
1C:0000CB35   _xoffset
1C:0000CB36   _yoffset
1C:0000CB37   __xoffset
1C:0000CB38 X __r18
1C:0000CB39   randSeed
1C:0000CB3B   cur_level
1C:0000CB3C   wave_count
1C:0000CB3D   landing_permission
1C:0000CB3E   assault_wave_timer
1C:0000CB40   bullet_rate
1C:0000CB41   _dxchng
1C:0000CB42   _dxmap
1C:0000CB43   dxmap
1C:0000CB44   xmap
1C:0000CB46   _xmapx4
1C:0000CB48   yship
1C:0000CB49   xship
1C:0000CB4B   aniframe
1C:0000CB4C   ms_state
1C:0000CB4D   old_aniframe
1C:0000CB4E   anispeed
1C:0000CB4F   already_dead
1C:0000CB50   lives_bin
1C:0000CB51   god_mode
1C:0000CB52 X visible_sprts
1C:0000CB53   flip_flop
1C:0000CB54   ram_sat
00:00000000   enemy_data.y
00:00000001   enemy_data.x
00:00000003   enemy_data.xoff
00:00000004   enemy_data.yoff
00:00000005   enemy_data.xsize
00:00000006   enemy_data.ysize
00:00000007   enemy_data.status
00:00000008   enemy_data.cntr
00:00000009   enemy_data.kind
00:0000000A   enemy_data.frame
00:0000000B   enemy_data.color
00:0000000C   enemy_data.color2
00:0000000D   enemy_data.speed
00:0000000F   enemy_data
1C:0000CB60   any_object
1C:0000CB60   ms_bullets
1C:0000CB7E   enem_bullets
1C:0000CBAB   enemies
1C:0000CC5F X endram


 Output: main.out
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00000000

    No output

 Output: urd_scr8.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: 00002000  Used: 00001CC4

   Address   Length Align   Label
   00004000    7364         search_slot
   00005CC4     828       <empty>

 Page: 01
  Org: 00006000  Size: 00002000  Used: 000011E4

   Address   Length Align   Label
   00006000    4580         replay_init
   000071E4    3612       <empty>

 Page: 02
  Org: 00008000  Size: 00002000  Used: 00000000

   00008000    8192       <empty>

 Page: 03
  Org: 0000A000  Size: 00002000  Used: 00001A00

   Address   Length Align   Label
   0000A000    6656         manta_color
   0000BA00    1536       <empty>

 Page: 04
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         _tiles0

 Page: 05
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 06
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 07
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 08
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 09
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 0A
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 0B
  Org: 0000A000  Size: 00002000  Used: 00001100

   Address   Length Align   Label
   0000A000    4352         
   0000B100    3840       <empty>

 Page: 0C
  Org: 0000A000  Size: 00002000  Used: 00000EB8

   Address   Length Align   Label
   0000A000    3768         demo_song
   0000AEB8    4424       <empty>

 Page: 0D
  Org: 00006000  Size: 00002000  Used: 00000000

   00006000    8192       <empty>

 Page: 0E
  Org: 00008000  Size: 00002000  Used: 00000000

   00008000    8192       <empty>

 Page: 0F
  Org: 0000A000  Size: 00002000  Used: 00000B00

   Address   Length Align   Label
   0000A000    2816         _level
   0000AB00    5376       <empty>

 Page: 10
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         _opening

 Page: 11
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 12
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 13
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 14
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 15
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 16
  Org: 0000A000  Size: 00002000  Used: 00001400

   Address   Length Align   Label
   0000A000    5120         
   0000B400    3072       <empty>

 Page: 17
  Org: 0000A000  Size: 00002000  Used: 00000000

   0000A000    8192       <empty>

 Page: 18
  Org: 0000A000  Size: 00002000  Used: 00001800

   Address   Length Align   Label
   0000A000    6144         _scorebar
   0000B800    2048       <empty>

 Page: 19
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         _animated

 Page: 1A
  Org: 0000A000  Size: 00002000  Used: 00002000

   Address   Length Align   Label
   0000A000    8192         

 Page: 1B
  Org: 0000A000  Size: 00002000  Used: 00000800

   Address   Length Align   Label
   0000A000    2048         sprtdata
   0000A800    6144       <empty>

 Page: 1C
  Org: 0000A000  Size: 00002000  Used: 00000400

   Address   Length Align   Label
   0000A000    1024         color_base
   0000A400    7168       <empty>

 Page: 1D
  Org: 0000A000  Size: 00002000  Used: 00000000

   0000A000    8192       <empty>

 Page: 1E
  Org: 0000A000  Size: 00002000  Used: 00000000

   0000A000    8192       <empty>

 Page: 1F
  Org: 0000A000  Size: 00002000  Used: 00000000

   0000A000    8192       <empty>
